<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CoastalME (Coastal Modelling Environment): create_profiles.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CoastalME (Coastal Modelling Environment)
   </div>
   <div id="projectbrief">Simulates the long-term behaviour of complex coastlines</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">create_profiles.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="create__profiles_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> This file is part of CoastalME, the Coastal Modelling Environment.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> CoastalME is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// #include &lt;assert.h&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;cfloat&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using</span> std::cout;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">using</span> std::cerr;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">using</span> std::endl;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">using</span> std::ios;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">using</span> std::setiosflags;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">using</span> std::setprecision;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">using</span> std::sort;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keyword">using</span> std::find;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">using</span> std::pair;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">using</span> std::make_pair;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cme_8h.html">cme.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="simulation_8h.html">simulation.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="coast_8h.html">coast.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> Function used to sort coastline curvature values for creating normal profiles</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="create__profiles_8cpp.html#ae04a8509dc0ab747823a37fe3bb91f26">   57</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="create__profiles_8cpp.html#ae04a8509dc0ab747823a37fe3bb91f26">bCurvaturePairCompareDescending</a>(<span class="keyword">const</span> pair&lt;int, double&gt; &amp;prLeft, <span class="keyword">const</span> pair&lt;int, double&gt; &amp;prRight)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;{</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   <span class="comment">// Sort in descending order (i.e. most concave first)</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   <span class="keywordflow">return</span> prLeft.second &gt; prRight.second;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> Create coastline-normal profiles for all coastlines: first at a limited number at natural and artificial cape positions, then at locations of greatest concave curvature of the vector coastline. Finally, grid-edge normal profiles are created</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keywordtype">int</span> CSimulation::nCreateAllProfiles(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;{</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;   <span class="keywordtype">int</span> nProfileToNodeSpacing = m_nCoastNormalAvgSpacing / 2;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nCoast = 0; nCoast &lt; m_VCoast.size(); nCoast++)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;   {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;         nProfile = -1,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;         nCoastSize = m_VCoast[nCoast].nGetCoastlineSize();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="comment">// Any interventions?</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keywordflow">if</span> (! m_strInterventionHeightFile.empty())</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;         <span class="comment">// Create normal profiles(s) on intervention(s) at points on the intervention coastline at which detailed convexity is high (a large -ve value)</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;         CreateInterventionProfiles(nCoast, nProfile <span class="comment">/*, nProfileToNodeSpacing*/</span>);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="comment">// Now create a vector of pairs: the first value of the pair is the coastline point, the second is the coastline&#39;s smoothed curvature at that point</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      vector&lt;pair&lt;int, double&gt; &gt; prVCurvature;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoastPoint = 0; nCoastPoint &lt; nCoastSize; nCoastPoint++)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;         <span class="keywordtype">double</span> dCurvature = m_VCoast[nCoast].dGetSmoothCurvature(nCoastPoint);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;         prVCurvature.push_back(make_pair(nCoastPoint, dCurvature));</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="comment">// Sort this pair vector in descending order, so that the most concave smoothed-curvature points are first</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      sort(prVCurvature.begin(), prVCurvature.end(), <a class="code" href="create__profiles_8cpp.html#ae04a8509dc0ab747823a37fe3bb91f26">bCurvaturePairCompareDescending</a>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="comment">// Create a bool vector to mark coast points which have been searched</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      vector&lt;bool&gt; bVCoastPointSearched(nCoastSize, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="comment">// Mark intervention coast points so they don&#39;t get searched (already done)</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoastPoint = 0; nCoastPoint &lt; nCoastSize; nCoastPoint++)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;         <span class="keywordflow">if</span> (m_VCoast[nCoast].pGetCoastLandform(nCoastPoint)-&gt;nGetLandFormCategory() == <a class="code" href="cme_8h.html#ad4c91de5db6eb59e27fe49d05080ca6b">LF_CAT_INTERVENTION</a>)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            bVCoastPointSearched[nCoastPoint] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <span class="comment">// And mark points near the start and end of the coastline so that they don&#39;t get searched (will be creating &#39;special&#39; start- and end-of-coast profiles there later)</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nProfileToNodeSpacing; n++)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;         <span class="keywordflow">if</span> (n &lt; nCoastSize)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            bVCoastPointSearched[n] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;         <span class="keywordtype">int</span> m = nCoastSize - n - 1;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;         <span class="keywordflow">if</span> (m &gt;= 0)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            bVCoastPointSearched[m] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="keywordflow">if</span> (m_nNaturalCapeNormals &gt; 0)</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;         <span class="comment">// Create profiles for natural capes i.e. points on the coastline at which smoothed convexity is high (a large -ve value), but detailed convexity is low</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;         CreateNaturalCapeNormals(nCoast, nProfile, nProfileToNodeSpacing, &amp;bVCoastPointSearched, &amp;prVCurvature);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="comment">// TEST Try just one SD below the mean</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="comment">// Calculate a convexity threshold, which is two standard deviations below the mean: will not create non-cape profiles on coast points with smoothed convexity which exceeds this (i.e. with smoothed curvature values which are less than this threshold)</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;         dStdCurvature = m_VCoast[nCoast].dGetSmoothCurvatureSTD(),</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;         dCoastProfileSmoothConvexityThreshold = m_VCoast[nCoast].dGetSmoothCurvatureMean() - (2 * dStdCurvature);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">//          dCoastProfileSmoothConvexityThreshold = m_VCoast[nCoast].dGetSmoothCurvatureMean() - dStdCurvature;</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="comment">// If we have a coast with almost identical curvature everywhere (e.g. a straight line), then set the threshold to a big -ve value, so that convexity at coastline points is ignored</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dStdCurvature) &lt; <a class="code" href="cme_8h.html#a89311a98397f9d6967d2cb10d5152d77">TOLERANCE</a>)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;         dCoastProfileSmoothConvexityThreshold = -DBL_MAX;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: convexity threshold = &quot;</span> &lt;&lt; dCoastProfileSmoothConvexityThreshold &lt;&lt; endl;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="comment">// Now create normals on either side of points of maximum smoothed convexity</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      CreateRestOfNormals(nCoast, nProfile, nProfileToNodeSpacing, dCoastProfileSmoothConvexityThreshold, &amp;bVCoastPointSearched, &amp;prVCurvature);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="comment">// Did we fail to create any normal profiles? If so, quit</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">if</span> (nProfile &lt; 0)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;         <span class="keywordtype">string</span> strErr = <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> + <span class="stringliteral">&quot;timestep &quot;</span> + <a class="code" href="cme_8h.html#aae7f73171ead1e885d69fc389e3353d8">strNumToStr</a>(m_ulIter) + <span class="stringliteral">&quot;: could not create profiles for coastline &quot;</span> + <a class="code" href="cme_8h.html#aae7f73171ead1e885d69fc389e3353d8">strNumToStr</a>(nCoast) ;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;         <span class="keywordflow">if</span> (m_ulIter == 1)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            strErr += <span class="stringliteral">&quot;. Check the SWL&quot;</span>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;         strErr += <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;         cerr &lt;&lt; strErr;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; strErr;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#acdd64b7170fa6e0b8b42193b48eb2bbc">RTN_ERR_NO_PROFILES_1</a>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="comment">// Create a &#39;special&#39; profile at the beginning of the coastline, and put this onto the raster grid</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="keywordtype">int</span> nRet = nCreateGridEdgeProfile(<span class="keyword">true</span>, nCoast, nProfile);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="comment">// Create a &#39;special&#39; profile at the end of the coastline, and put this onto the raster grid</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      nRet = nCreateGridEdgeProfile(<span class="keyword">false</span>, nCoast, nProfile);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="comment">// Create an index to the profiles in along-coast sequence</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      m_VCoast[nCoast].CreateAlongCoastProfileIndex();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">//       // DEBUG CODE =======================================================</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">//       int nProf = m_VCoast[nCoast].nGetNumProfiles();</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">//       for (int n = 0; n &lt; nProf; n++)</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">//          LogStream &lt;&lt; n &lt;&lt; &quot;\t&quot; &lt;&lt; m_VCoast[nCoast].nGetProfileFromAlongCoastProfileIndex(n) &lt;&lt; endl;</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">//       // DEBUG CODE =======================================================</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">//       // DEBUG CODE =======================================================</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">//       for (int n = 0; n &lt; nCoastSize; n++)</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">//          LogStream &lt;&lt; n;</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">//          if (m_VCoast[nCoast].bIsProfileStartPoint(n))</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">//             LogStream &lt;&lt; &quot; profile &quot; &lt;&lt; m_VCoast[nCoast].nGetProfileNumber(n);</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">//          LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">//       LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">//       // DEBUG CODE =======================================================</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;}</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment"> Create profiles normal to the coastline, modifies these if they intersect, then puts the profiles onto the raster grid</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="keywordtype">int</span> CSimulation::nCreateAllProfilesAndCheckForIntersection(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;{</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="comment">// Create all coastline-normal profiles, in coastline-concave-curvature sequence i.e. the first profiles are created &#39;around&#39; the most concave bits of coast. An index is also created which allows profiles to be accessed in along-coast sequence. Also create &#39;special&#39; profiles at the start and end of the coast, and put these onto the raster griid now</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   <span class="keywordtype">int</span> nRet = nCreateAllProfiles();</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   <span class="comment">// Check to see which coastline-normal profiles intersect. Then modify intersecting profiles so that the sections of each profile seaward of the point of intersection are &#39;shared&#39; i.e. are multi-lines. This creates the boundaries of the triangular polygons</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   nRet = nModifyAllIntersectingProfiles();</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   <span class="comment">// Again check the normal profiles for insufficient length: is the water depth at the end point less than the depth of closure? We do this again because some profiles may have been shortened as a result of intersection. Do once for every coastline object</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nCoast = 0; nCoast &lt; m_VCoast.size(); nCoast++)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProf = 0; nProf &lt; m_VCoast[nCoast].nGetNumProfiles(); nProf++)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;         <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pProfile = m_VCoast[nCoast].pGetProfile(nProf);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;         <span class="keywordflow">if</span> (pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a8dc4e3ce21668f7149ca11aeb7efadf7">bProfileOK</a>())</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;         {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a>* pPtEnd = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(pProfile-&gt;<a class="code" href="class_c_geom_profile.html#abaf88697019588a2b0901bd19044aee4">nGetProfileSize</a>()-1);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiEnd = PtiExtCRSToGrid(pPtEnd);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;               nXEnd = PtiEnd.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;               nYEnd = PtiEnd.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="comment">// Safety check: the point may be outside the grid because of rounding, so keep it within the grid</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            nXEnd = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(nXEnd, 0);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            nXEnd = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(nXEnd, m_nXGridMax-1);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            nYEnd = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(nYEnd, 0);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            nYEnd = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(nYEnd, m_nYGridMax-1);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nXEnd][nYEnd].<a class="code" href="class_c_geom_cell.html#a3a378431e2f6095792582989f50fb435">dGetSeaDepth</a>() &lt; m_dDepthOfClosure)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;               <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; nProf &lt;&lt; <span class="stringliteral">&quot; is invalid, is too short for depth of closure &quot;</span> &lt;&lt; m_dDepthOfClosure &lt;&lt; <span class="stringliteral">&quot; at end point [&quot;</span> &lt;&lt; nXEnd &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nYEnd &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; pPtEnd-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; pPtEnd-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() &lt;&lt; <span class="stringliteral">&quot;}, flagging as too short&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;               pProfile-&gt;<a class="code" href="class_c_geom_profile.html#afef14f6eea8432a83715ec8eb68eac14">SetTooShort</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;         }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   <span class="comment">// Put all valid coastline-normal profiles (apart from the profiles at the start and end of the coast, since they have already been done) onto the raster grid. But if the profile is not long enough, or crosses a coastline or hits dry land, then mark the profile as invalid</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;   nRet = nPutAllProfilesOntoGrid();</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment"> Create normal profiles(s) on intervention(s) at points on the intervention coastline at which detailed convexity is high (a large -ve value)</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="keywordtype">void</span> CSimulation::CreateInterventionProfiles(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span>&amp; nProfile <span class="comment">/*, int const nProfileToNodeSpacing*/</span>)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;{</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   <span class="comment">// Create a vector of pairs from all parts of the coastline that have &#39;intervention&#39; as the coastal landform. The first value of the pair is the coastline point, the second is the coastline&#39;s detailed curvature at that point</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;   <span class="keywordtype">int</span> nInterventionCoastLen = 0;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   vector&lt;pair&lt;int, double&gt; &gt; prVCurvature;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoastPoint = 0; nCoastPoint &lt; m_VCoast[nCoast].nGetCoastlineSize(); nCoastPoint++)</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="keywordflow">if</span> (m_VCoast[nCoast].pGetCoastLandform(nCoastPoint)-&gt;nGetLandFormCategory() == <a class="code" href="cme_8h.html#ad4c91de5db6eb59e27fe49d05080ca6b">LF_CAT_INTERVENTION</a>)</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;         <span class="keywordtype">double</span> dCurvature = m_VCoast[nCoast].dGetDetailedCurvature(nCoastPoint);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;         prVCurvature.push_back(make_pair(nCoastPoint, dCurvature));</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;         nInterventionCoastLen++;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   <span class="comment">// Sort this pair vector in descending order, so that the most concave points are first</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   sort(prVCurvature.begin(), prVCurvature.end(), <a class="code" href="create__profiles_8cpp.html#ae04a8509dc0ab747823a37fe3bb91f26">bCurvaturePairCompareDescending</a>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;   <span class="comment">// Create a bool vector to mark coast points which have been searched</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   <span class="comment">// vector&lt;bool&gt; bVCoastPointSearched(nInterventionCoastLen, false);</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;   <span class="comment">// Work along the vector of curvature pairs starting at the convex end</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;   <span class="keywordtype">int</span> nInterventionProfilesCreated = 0;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCapePoint = nInterventionCoastLen-1; nCapePoint &gt;= 0; nCapePoint--)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="comment">// Have we created enough intervention cape profiles?</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordflow">if</span> (nInterventionProfilesCreated == <a class="code" href="cme_8h.html#ad41fd6fa6c97a8a006f6f6e88b519e2a">NUMBER_OF_INTERVENTION_CAPES</a>)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;         <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="comment">// This convex point is a potential location for an intervention cape profile</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordtype">int</span> nThisCapePoint = prVCurvature[nCapePoint].first;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="comment">// if (! bVCoastPointSearched[nThisCapePoint])</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;         <span class="comment">// We have not already searched this coast point, so try putting an intervention cape profile here</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;         <span class="keywordtype">int</span> nRet = nCreateProfile(nCoast, nThisCapePoint, nProfile);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;         <span class="comment">// bVCoastPointSearched[nThisCapePoint] = true;</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;         <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="comment">// This intervention cape profile is no good (has hit coast, or hit dry land, etc.) so forget about it</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;         <span class="comment">// This intervention cape profile is fine</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;         nInterventionProfilesCreated++;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;         <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiThis = *m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nThisCapePoint);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;         <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtThis = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nThisCapePoint);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; (intervention cape) created at coast point &quot;</span> &lt;&lt; nThisCapePoint &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; PtiThis.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiThis.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; PtThis.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; PtThis.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() &lt;&lt; <span class="stringliteral">&quot;} (smoothed curvature = &quot;</span> &lt;&lt; m_VCoast[nCoast].dGetSmoothCurvature(nThisCapePoint) &lt;&lt; <span class="stringliteral">&quot;, detailed curvature = &quot;</span> &lt;&lt; m_VCoast[nCoast].dGetDetailedCurvature(nThisCapePoint) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;         <span class="comment">// Mark points on either side of it</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">//          for (int m = 1; m &lt; nProfileToNodeSpacing; m++)</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">//          {</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">//             int nTmpPoint = nThisCapePoint + m;</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">//             if (nTmpPoint &lt; nCoastSize)</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">//                bVCoastPointSearched[nTmpPoint]= true;</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">//             nTmpPoint = nThisCapePoint - m;</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">//             if (nTmpPoint &gt;= 0)</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">//                bVCoastPointSearched[nTmpPoint] = true;</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">//          }</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;   }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"> Create profiles for natural capes i.e. points on the coastline at which smoothed convexity is high (a large -ve value), but detailed convexity is low</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="keywordtype">void</span> CSimulation::CreateNaturalCapeNormals(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span>&amp; nProfile, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileToNodeSpacing, vector&lt;bool&gt;* bVCoastPointSearched, vector&lt;pair&lt;int, double&gt; &gt; <span class="keyword">const</span>* prVCurvature)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;{</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      nCoastSize = m_VCoast[nCoast].nGetCoastlineSize(),</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      nCapeProfilesCreated = 0;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <span class="comment">// Work along the vector of curvature pairs starting at the convex end</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nCoastSize-1; n &gt;= 0; n--)</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="comment">// Have we created enough natural cape profiles?</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">if</span> (nCapeProfilesCreated == m_nNaturalCapeNormals)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;         <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="comment">// This convex point is a potential location for a natural cape profile</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordtype">int</span> nThisCapePoint = prVCurvature-&gt;at(n).first;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="comment">// If this point is at the start of end of the coast, then forget it since we will be putting coast-end profiles there later</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="keywordflow">if</span> ((nThisCapePoint == 0) || (nThisCapePoint == nCoastSize-1))</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;         <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="keywordflow">if</span> (! bVCoastPointSearched-&gt;at(nThisCapePoint))</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;         <span class="comment">// We have not already searched this coast point, so try putting a natural cape profile here</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;         <span class="keywordtype">int</span> nRet = nCreateProfile(nCoast, nThisCapePoint, nProfile);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;         bVCoastPointSearched-&gt;at(nThisCapePoint) = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;         <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="comment">// This natural cape profile is no good (has hit coast, or hit dry land, etc.) so forget about it</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;         <span class="comment">// This natural cape profile is fine</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;         nCapeProfilesCreated++;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;         <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiThis = *m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nThisCapePoint);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;         <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtThis = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nThisCapePoint);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; (natural cape) created at coast point &quot;</span> &lt;&lt; nThisCapePoint &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; PtiThis.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiThis.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; PtThis.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; PtThis.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() &lt;&lt; <span class="stringliteral">&quot;} (smoothed curvature = &quot;</span> &lt;&lt; m_VCoast[nCoast].dGetSmoothCurvature(nThisCapePoint) &lt;&lt; <span class="stringliteral">&quot;, detailed curvature = &quot;</span> &lt;&lt; m_VCoast[nCoast].dGetDetailedCurvature(nThisCapePoint) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;         <span class="comment">// Mark points on either side of it</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 1; m &lt; nProfileToNodeSpacing; m++)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;         {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            <span class="keywordtype">int</span> nTmpPoint = nThisCapePoint + m;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <span class="keywordflow">if</span> (nTmpPoint &lt; nCoastSize)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;               bVCoastPointSearched-&gt;at(nTmpPoint) = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            nTmpPoint = nThisCapePoint - m;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="keywordflow">if</span> (nTmpPoint &gt;= 0)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;               bVCoastPointSearched-&gt;at(nTmpPoint) = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;         }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;   }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"> Create normal profiles on the rest of the coastline</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"> ===============================================================================================================================*/</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="keywordtype">void</span> CSimulation::CreateRestOfNormals(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span>&amp; nProfile, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileToNodeSpacing, <span class="keywordtype">double</span> <span class="keyword">const</span> dCoastProfileSmoothConvexityThreshold, vector&lt;bool&gt;* bVCoastPointSearched, vector&lt;pair&lt;int, double&gt; &gt; <span class="keyword">const</span>* prVCurvature)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;{</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   <span class="keywordtype">int</span> nCoastSize = m_VCoast[nCoast].nGetCoastlineSize();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   <span class="comment">// Work along the vector of curvature pairs starting at the concave end</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nCoastSize; n++)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="comment">// Have we searched all the coastline points?</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordtype">int</span> nStillToSearch = 0;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt; nCoastSize; m++)</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;         <span class="keywordflow">if</span> (! bVCoastPointSearched-&gt;at(m))</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            nStillToSearch++;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordflow">if</span> (nStillToSearch == 0)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;         <span class="comment">// Nope, we are done here</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;         <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="comment">// This concave point on the coastline is a potential location for a between-normal node</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordtype">int</span> nPossibleNodePoint = prVCurvature-&gt;at(n).first;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="comment">// Search the coastline for other normals (and also the beginning or end of the coastline) on either side of this potential node point. Do this search in alternate directions, first down-coast (i.e. in increasing coastline point order) then back up-coast (in decreasing coast point order)</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordtype">int</span> nProfileDist;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nDirection = <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>; nDirection &lt;= <a class="code" href="cme_8h.html#af803adbfdc053cf78880fc2425db1f1d">DIRECTION_UPCOAST</a>; nDirection++)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;         <span class="comment">// Calculate the profile spacing, this will vary if we have a random factor but will be the same in both up-coast and down-coast directions</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;         <span class="keywordflow">if</span> (nDirection == <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">//             nProfileDist = tMax(m_nCoastNormalAvgSpacing, static_cast&lt;int&gt;(nProfileToNodeSpacing * (1 + (dGetRand0Gaussian() * m_dCoastNormalRandSpaceFact))));</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            nProfileDist = nProfileToNodeSpacing * <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(1 + (dGetRand0Gaussian() * m_dCoastNormalRandSpaceFact));</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">// TODO Assume that the above is the profile spacing on straight bits of coast. Try gradually increasing the profile spacing with increasing concavity, and decreasing the profile spacing with increasing convexity. Could use a Michaelis-Menten S-curve relationship</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">//          double fReN = pow(NowCell[nX][nY].dGetReynolds(m_dNu), m_dDepN);</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">//          double fC1 = m_dC1Laminar - ((m_dC1Diff * fReN) / (fReN + m_dReMidN));</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;         <span class="comment">// Determine the profile start point</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;         <span class="keywordtype">int</span> nProfileStartPoint;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;         <span class="keywordflow">if</span> (nDirection == <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            nProfileStartPoint = nPossibleNodePoint + nProfileDist;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            nProfileStartPoint = nPossibleNodePoint - nProfileDist;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">//          LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;DOWN&quot; : &quot;UP&quot;) &lt;&lt; &quot;-coast, nProfileStartPoint = &quot; &lt;&lt; nProfileStartPoint &lt;&lt; &quot; nPossibleNodePoint = &quot; &lt;&lt; nPossibleNodePoint &lt;&lt; endl;</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;         <span class="comment">// Now do the search</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;         <span class="keywordtype">bool</span> bNodeNoGood = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;         <span class="keywordtype">int</span> nDist = 0;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;         <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;         {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            nDist++;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <span class="keywordtype">int</span> nThisPoint;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="keywordflow">if</span> (nDirection == <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;               nThisPoint = nPossibleNodePoint + nDist;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;               nThisPoint = nPossibleNodePoint - nDist;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">//             LogStream &lt;&lt; &quot;nThisPoint = &quot; &lt;&lt; nThisPoint &lt;&lt; endl;</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="keywordflow">if</span> ((nThisPoint &lt;= 0) || (nThisPoint &gt;= nCoastSize-1))</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;               <span class="comment">// We have hit the beginning or end of the coastline</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">//                LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nThisPoint = &quot; &lt;&lt; nThisPoint &lt;&lt; &quot; hit beginning or end of coastline&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;               bNodeNoGood = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <span class="comment">// Have we already searched this point?</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">if</span> (bVCoastPointSearched-&gt;at(nThisPoint))</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">//                LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nThisPoint = &quot; &lt;&lt; nThisPoint &lt;&lt; &quot; already searched&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;               bNodeNoGood = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="comment">// No, so mark this point as searched</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            bVCoastPointSearched-&gt;at(nThisPoint) = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="keywordflow">if</span> (m_VCoast[nCoast].bIsProfileStartPoint(nThisPoint))</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;               <span class="comment">// We have hit the start point of another profile</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">//                LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nThisPoint = &quot; &lt;&lt; nThisPoint&lt;&lt; &quot; hit start of another profile, profile &quot; &lt;&lt; m_VCoast[nCoast].nGetProfileNumber(nThisPoint) &lt;&lt; endl;</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;               bNodeNoGood = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="comment">// Is this coastline point the correct distance from the max-concave point?</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">if</span> (nThisPoint == nProfileStartPoint)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">//                LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nThisPoint = &quot; &lt;&lt; nThisPoint &lt;&lt; &quot;, at nProfileStartPoint&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;               <span class="comment">// It is, so we may be able to place a normal here, but first do some checks</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;               <span class="keywordtype">bool</span> bTooClose = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCloseDist = 1; nCloseDist &lt; 10; nCloseDist++)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;               {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                  <span class="keywordtype">int</span> nClose;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                  <span class="keywordflow">if</span> (nDirection == <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                     nClose = nThisPoint + nCloseDist;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                     nClose = nThisPoint - nCloseDist;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                  <span class="keywordflow">if</span> ((nClose &gt;= 0) &amp;&amp; (nClose &lt; nCoastSize))</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                  {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                     <span class="comment">// Mark this coast point as searched</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                     bVCoastPointSearched-&gt;at(nClose) = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                     <span class="keywordflow">if</span> (m_VCoast[nCoast].bIsProfileStartPoint(nClose))</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                     {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                        <span class="comment">// The adjacent coast point is already the start point of a normal, we can&#39;t have two normals this close so abandon this one</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                        bTooClose = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                     }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                  }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;               }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;               <span class="keywordflow">if</span> (bTooClose)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;               <span class="comment">// Now check whether the coastline is too convex (a -ve number) here</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;               <span class="keywordflow">if</span> (m_VCoast[nCoast].dGetDetailedCurvature(nThisPoint) &lt;= dCoastProfileSmoothConvexityThreshold)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;               {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                  <span class="comment">// The coastline is too convex here, so try the next point along</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                  <span class="keywordflow">if</span> (nDirection == <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                     nProfileStartPoint++;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                     nProfileStartPoint--;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">//                   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: excessive detailed convexity = &quot; &lt;&lt; m_VCoast[nCoast].dGetDetailedCurvature(nThisPoint) &lt;&lt; &quot; (convexity threshold = &quot; &lt;&lt; dCoastProfileSmoothConvexityThreshold &lt;&lt; &quot;) at nThisPoint = &quot; &lt;&lt; nThisPoint &lt;&lt; &quot; when attempting to create nProfile = &quot; &lt;&lt; nProfile+1 &lt;&lt; &quot;, possible nProfileStartPoint changed to &quot; &lt;&lt; nProfileStartPoint &lt;&lt; endl;</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                  <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;               }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;               <span class="comment">// OK, try to create a profile here</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;               <span class="keywordtype">int</span> nRet = nCreateProfile(nCoast, nThisPoint, nProfile);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;               <span class="keywordflow">if</span> (nRet == <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;               {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                  <span class="comment">// Profile created OK</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                  <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiThis = *m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nThisPoint);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                  <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtThis = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nThisPoint);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                  <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; created at coast point &quot;</span> &lt;&lt; nThisPoint &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; PtiThis.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiThis.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; PtThis.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; PtThis.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() &lt;&lt; <span class="stringliteral">&quot;} (smoothed curvature = &quot;</span> &lt;&lt; m_VCoast[nCoast].dGetSmoothCurvature(nThisPoint) &lt;&lt; <span class="stringliteral">&quot;, detailed curvature = &quot;</span> &lt;&lt; m_VCoast[nCoast].dGetDetailedCurvature(nThisPoint) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">//                   LogStream &lt;&lt; &quot;\tSearch started from potential node point at coastline point &quot; &lt;&lt; nPossibleNodePoint &lt;&lt; &quot; which has detailed curvature = &quot; &lt;&lt; m_VCoast[nCoast].dGetDetailedCurvature(nPossibleNodePoint) &lt;&lt; endl;</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;               }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;               {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                  <span class="comment">// Uh-oh, this profile is no good (end is off-grid) so keep going</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">//                   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: profile &quot; &lt;&lt; nProfile+1 &lt;&lt; &quot; NOT created at nThisPoint = &quot; &lt;&lt; nThisPoint &lt;&lt; endl;</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                  bNodeNoGood = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;               }</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;         }</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;         <span class="keywordflow">if</span> (bNodeNoGood)</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;   }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;}</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment"> Creates a single coastline-normal profile (which may be an intervention profile or a cape profile)</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="keywordtype">int</span> CSimulation::nCreateProfile(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileStartPoint, <span class="keywordtype">int</span>&amp; nProfile)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;{</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   <span class="comment">// OK, we have flagged the start point of this new coastline-normal profile, so create it. Make the start of the profile the centroid of the actual cell that is marked as coast (not the cell under the smoothed vector coast, they may well be different)</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;   <span class="keywordtype">int</span> nCoastSize = m_VCoast[nCoast].nGetCoastlineSize();</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtStart;                                     <span class="comment">// PtStart has coordinates in external CRS</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   PtStart.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dGridCentroidXToExtCRSX(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nProfileStartPoint)-&gt;nGetX()));</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   PtStart.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dGridCentroidYToExtCRSY(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nProfileStartPoint)-&gt;nGetY()));</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtEnd;                                       <span class="comment">// In external CRS</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;   <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiEnd;                                     <span class="comment">// In grid CRS</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   <span class="keywordflow">if</span> (nGetCoastNormalEndPoint(nCoast, nProfileStartPoint, nCoastSize, &amp;PtStart, m_dCoastNormalLength, &amp;PtEnd, &amp;PtiEnd) != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="comment">// Could not solve end-point equation, so forget about this profile</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a3120fe2dad3cfe36a8e4fbf0231c19b6">RTN_ERR_PROFILE_ENDPOINT_IS_OFFGRID</a>;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      nXEnd = PtiEnd.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      nYEnd = PtiEnd.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   <span class="comment">// Safety check: is the end point in the contiguous sea?</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   <span class="keywordflow">if</span> (! m_pRasterGrid-&gt;m_Cell[nXEnd][nYEnd].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>())</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, possible profile with start point &quot;</span> &lt;&lt; nProfileStartPoint &lt;&lt; <span class="stringliteral">&quot; has inland end point at [&quot;</span> &lt;&lt; nXEnd &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nYEnd &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nXEnd) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nYEnd) &lt;&lt; <span class="stringliteral">&quot;}, ignoring&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a2303d86363341c55f97e14a1066071e8">RTN_ERR_PROFILE_ENDPOINT_IS_INLAND</a>;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;   <span class="comment">// Safety check: is the water depth at the end point less than the depth of closure?</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nXEnd][nYEnd].<a class="code" href="class_c_geom_cell.html#a3a378431e2f6095792582989f50fb435">dGetSeaDepth</a>() &lt; m_dDepthOfClosure)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;   {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, possible profile with start point &quot;</span> &lt;&lt; nProfileStartPoint &lt;&lt; <span class="stringliteral">&quot; is too short for depth of closure &quot;</span> &lt;&lt; m_dDepthOfClosure &lt;&lt; <span class="stringliteral">&quot; at end point [&quot;</span> &lt;&lt; nXEnd &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nYEnd &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nXEnd) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nYEnd) &lt;&lt; <span class="stringliteral">&quot;}, ignoring&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#ac026ff30d27d6c48b3e3df84ce8c9aa5">RTN_ERR_PROFILE_END_INSUFFICIENT_DEPTH</a>;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   <span class="comment">// No problems, so create the new profile</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   m_VCoast[nCoast].AppendProfile(nProfileStartPoint, ++nProfile);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;   <span class="comment">// And create the profile&#39;s coastline-normal vector (start and end points are in external CRS)</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   vector&lt;CGeom2DPoint&gt; VNormal;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;   VNormal.push_back(PtStart);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   VNormal.push_back(PtEnd);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;   pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a4d89e6572d043fea4e19aaf251349c67">SetAllPointsInProfile</a>(&amp;VNormal);         <span class="comment">// Set only two points: the start and end points</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   <span class="comment">// Create the profile&#39;s CGeomMultiLine then set nProfile as the only co-incident profile of the only line segment</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;   pProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a3f99a9c2ac66b75c432941ec88fc8538">AppendLineSegment</a>();</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;   pProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a679d5893191ff6dc5ab6b9acd1f5c770">AppendCoincidentProfileToLineSegments</a>(make_pair(nProfile, 0));</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">//    LogStream &lt;&lt; std::fixed &lt;&lt; m_ulIter &lt;&lt; &quot;: profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; created at coast point (&quot; &lt;&lt; nProfileStartPoint &lt;&lt; &quot;) from [&quot; &lt;&lt; PtStart.dGetX() &lt;&lt; &quot;][&quot; &lt;&lt; PtStart.dGetY() &lt;&lt; &quot;] to [&quot; &lt;&lt; PtEnd.dGetX() &lt;&lt; &quot;][&quot; &lt;&lt; PtEnd.dGetY() &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;}</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment"> Creates a &#39;special&#39; profile at each end of a coastline, at the edge of the raster grid. This profile is not necessarily normal to the coastline since it goes along the grid&#39;s edge</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="keywordtype">int</span> CSimulation::nCreateGridEdgeProfile(<span class="keywordtype">bool</span> <span class="keyword">const</span> bCoastStart, <span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span>&amp; nProfile)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;{</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      nCoastSize = m_VCoast[nCoast].nGetCoastlineSize(),</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      nHandedness = m_VCoast[nCoast].nGetSeaHandedness(),</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      nProfileLen = <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(m_dCoastNormalLength / m_dCellSide),         <span class="comment">// Profile length in grid CRS</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      nProfileStartEdge;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiProfileStart;               <span class="comment">// In grid CRS</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pProfile = NULL;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   vector&lt;CGeom2DIPoint&gt; VPtiNormalPoints;      <span class="comment">// In grid CRS</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;   <span class="keywordflow">if</span> (bCoastStart)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;   {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="comment">// At start of coast</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      PtiProfileStart = *m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(0);                <span class="comment">// Grid CRS</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      nProfileStartEdge = m_VCoast[nCoast].nGetStartEdge();</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;   }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;   {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="comment">// At end of coast</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      PtiProfileStart = *m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize-1);     <span class="comment">// Grid CRS</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      nProfileStartEdge = m_VCoast[nCoast].nGetEndEdge();</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;   }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160; </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;   VPtiNormalPoints.push_back(PtiProfileStart);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;   <span class="comment">// Find the start cell in the list of edge cells</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;   <span class="keyword">auto</span> it = find(m_VEdgeCell.begin(), m_VEdgeCell.end(), PtiProfileStart);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;   <span class="keywordflow">if</span> (it == m_VEdgeCell.end())</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;   {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="comment">// Not found. This can happen because of rounding problems, i.e. the cell which was stored as the first cell of the raster coastline</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> &lt;&lt; <span class="stringliteral">&quot; when constructing start-of-coast profile, [&quot;</span> &lt;&lt;  PtiProfileStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiProfileStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(PtiProfileStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(PtiProfileStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} not found in list of edge cells&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a939ab6434091cd4e82b7a512991f8bef">RTN_ERR_COAST_CANT_FIND_EDGE_CELL</a>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;   }</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;   <span class="comment">// Found</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   <span class="keywordtype">int</span> nPos = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(it - m_VEdgeCell.begin());</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;   <span class="comment">// Now construct the edge profile, searching for edge cells</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nProfileLen; n++)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;   {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">if</span> (bCoastStart)</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;         <span class="comment">// At start of coast</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;         <span class="keywordflow">if</span> (nHandedness == <a class="code" href="cme_8h.html#a96e58f57ae0cc113e899eab923e8d395">LEFT_HANDED</a>)</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;         {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            <span class="comment">// The list of edge cells is in clockwise sequence, go in this direction</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            nPos++;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordflow">if</span> (nPos &gt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(m_VEdgeCell.size()))</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;               <span class="comment">// We&#39;ve reached the end of the list of edge cells before the profile is long enough. OK, we can live with this</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;         }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;         <span class="keywordflow">else</span>     <span class="comment">// Right-handed</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;         {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            <span class="comment">// The list of edge cells is in clockwise sequence, go in the opposite direction</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            nPos--;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; </div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            <span class="keywordflow">if</span> (nPos &lt; 0)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;               <span class="comment">// We&#39;ve reached the beginning of the list of edge cells before the profile is long enough. OK, we can live with this</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;         }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      }</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      {</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;         <span class="comment">// At end of coast</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;         <span class="keywordflow">if</span> (nHandedness == <a class="code" href="cme_8h.html#a96e58f57ae0cc113e899eab923e8d395">LEFT_HANDED</a>)</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;         {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <span class="comment">// The list of edge cells is in clockwise sequence, go in the opposite direction</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            nPos--;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <span class="keywordflow">if</span> (nPos &lt; 0)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;               <span class="comment">// We&#39;ve reached the beginning of the list of edge cells before the profile is long enough. OK, we can live with this</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;         }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;         <span class="keywordflow">else</span>     <span class="comment">// Right-handed</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;         {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="comment">// The list of edge cells is in clockwise sequence, go in this direction</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            nPos++;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="keywordflow">if</span> (nPos &gt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(m_VEdgeCell.size()))</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;               <span class="comment">// We&#39;ve reached the end of the list of edge cells before the profile is long enough. OK, we can live with this</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;         }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="keywordflow">if</span> (m_VEdgeCellEdge[nPos] != nProfileStartEdge)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;         <span class="comment">// We&#39;ve reached the end of a grid side before the profile is long enough. OK, we can live with this</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="comment">// Append this grid-edge cell, making sure that there is no gap between this and the previously-appended cell (if there is, will get problems with flood fill)</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      AppendEnsureNoGap(&amp;VPtiNormalPoints, &amp;m_VEdgeCell[nPos]);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;   }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160; </div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;   <span class="comment">// Create the new start-of-coast profile</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;   <span class="keywordflow">if</span> (bCoastStart)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;   {</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="comment">// Start of coast</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      m_VCoast[nCoast].AppendProfile(0, ++nProfile);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="comment">// Mark this as a start-of-coast profile</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a5bb5e15188369a41d0ae784e6a9ed044">SetStartOfCoast</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;   }</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;   {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="comment">// End of coast</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      m_VCoast[nCoast].AppendProfile(nCoastSize-1, ++nProfile);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="comment">// Mark this as an end-of-coast profile</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a11548359d3db93535befcaf518468f64">SetEndOfCoast</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;   }</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n = 0; n &lt; VPtiNormalPoints.size(); n++)</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;   {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;         nX = VPtiNormalPoints[n].nGetX(),</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;         nY = VPtiNormalPoints[n].nGetY();</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <span class="comment">// Mark each cell in the raster grid</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#abd8d4a175fce062870745f66a1ee4299">SetProfile</a>(nProfile);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="comment">// Store the raster-grid coordinates in the profile object</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aafb35166293c29d0492621850d5d06d4">AppendCellInProfile</a>(nX, nY);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160; </div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> Pt(dGridCentroidXToExtCRSX(nX), dGridCentroidYToExtCRSY(nY));       <span class="comment">// In external CRS</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="comment">// Store the external coordinates in the profile object. Note that for this &#39;special&#39; profile, the coordinates of the cells and the coordinates of points on the profile itself are identical, this is not the case for ordinary profiles</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6152817d6ec950e1474313ca9824da46">AppendCellInProfileExtCRS</a>(&amp;Pt);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="comment">// Also store the same external ccordinatespoint in this &#39;special&#39; profile&#39;s coastline-normal vector (note that this will contain many points, whereas the coastline-normal vector of ordinary profiles contains only the two start and end points</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a19aac71e045a17e2c6d98f020f2319fa">AppendPointInProfile</a>(&amp;Pt);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   <span class="comment">// Get the deep water wave height and orientation values at the end of the profile</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      nEndX = VPtiNormalPoints.back().nGetX(),</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      nEndY = VPtiNormalPoints.back().nGetY();</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      dDeepWaterWaveHeight = m_pRasterGrid-&gt;m_Cell[nEndX][nEndY].<a class="code" href="class_c_geom_cell.html#a9afd0ac74169a81629bcbaa402be3009">dGetDeepWaterWaveHeight</a>(),</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      dDeepWaterWaveOrientation = m_pRasterGrid-&gt;m_Cell[nEndX][nEndY].<a class="code" href="class_c_geom_cell.html#a1d2e53161b9483dce3aaaf32d3287e51">dGetDeepWaterWaveOrientation</a>(),</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      dDeepWaterWavePeriod = m_pRasterGrid-&gt;m_Cell[nEndX][nEndY].<a class="code" href="class_c_geom_cell.html#ad03f0af5de19150fad5383f2e147c55e">dGetDeepWaterWavePeriod</a>();</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;   <span class="comment">// And store them for this profile</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ad253e6ede71402845e2ed5522a492efd">SetDeepWaterWaveHeight</a>(dDeepWaterWaveHeight);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;   pProfile-&gt;<a class="code" href="class_c_geom_profile.html#af4ec7ad9bc2379688a31d49db5a049f7">SetDeepWaterWaveOrientation</a>(dDeepWaterWaveOrientation);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;   pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a4f702fc67f4f75ef648761cea136c079">SetDeepWaterWavePeriod</a>(dDeepWaterWavePeriod);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160; </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;   <span class="comment">// Create the profile&#39;s CGeomMultiLine then set nProfile as the only co-incident profile of the only line segment</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;   pProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a3f99a9c2ac66b75c432941ec88fc8538">AppendLineSegment</a>();</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;   pProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a679d5893191ff6dc5ab6b9acd1f5c770">AppendCoincidentProfileToLineSegments</a>(make_pair(nProfile, 0));</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;   <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; std::fixed &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; created at coast &quot;</span> &lt;&lt; (bCoastStart ? <span class="stringliteral">&quot;start&quot;</span> : <span class="stringliteral">&quot;end&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; point &quot;</span> &lt;&lt; (bCoastStart ? 0 : nCoastSize -1) &lt;&lt; <span class="stringliteral">&quot;, from [&quot;</span> &lt;&lt; PtiProfileStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiProfileStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(PtiProfileStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(PtiProfileStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} to [&quot;</span> &lt;&lt; VPtiNormalPoints.back().nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; VPtiNormalPoints.back().nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(VPtiNormalPoints.back().nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(VPtiNormalPoints.back().nGetY()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160; </div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;}</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160; </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment"> Finds the end point of a coastline-normal line, given the start point on the vector coastline. All co-ordinates are in the external CRS</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="keywordtype">int</span> CSimulation::nGetCoastNormalEndPoint(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nStartCoastPoint, <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastSize, <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> <span class="keyword">const</span>* pPtStart, <span class="keywordtype">double</span> <span class="keyword">const</span> dLineLength, <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a>* pPtEnd, <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a>* pPtiEnd)</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;{</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;   <span class="comment">// If at beginning or end of coast, need special treatment for points before and points after</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      nCoastPointBefore = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(nStartCoastPoint-1, 0),</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      nCoastPointAfter = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(nStartCoastPoint+1, nCoastSize-1);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;   <span class="comment">// Get the y = a * x + b equation of the straight line linking the coastline points before and after &#39;this&#39; coastline point</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;   <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtBefore = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPointBefore);           <span class="comment">// PtBefore has coordinates in external CRS</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;   <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtAfter = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPointAfter);             <span class="comment">// PtAfter has coordinates in external CRS</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;   <span class="comment">// For this linking line, slope a = (y2 - y1) / (x2 - x1)</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      dYDiff = PtAfter.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() - PtBefore.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>(),</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      dXDiff = PtAfter.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() - PtBefore.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>();</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160; </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;   <span class="keywordtype">double</span> dXEnd1 = 0, dXEnd2 = 0, dYEnd1 = 0, dYEnd2 = 0;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   <span class="keywordflow">if</span> (bFPIsEqual(dYDiff, 0, <a class="code" href="cme_8h.html#a89311a98397f9d6967d2cb10d5152d77">TOLERANCE</a>))</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="comment">// The linking line runs W-E or E-W, so a straight line at right angles to this runs N-S or S-N. Calculate the two possible end points for this coastline-normal profile</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      dXEnd1 = dXEnd2 = pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>();</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      dYEnd1 = pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() + dLineLength;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      dYEnd2 = pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() - dLineLength;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;   }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bFPIsEqual(dXDiff, 0, <a class="code" href="cme_8h.html#a89311a98397f9d6967d2cb10d5152d77">TOLERANCE</a>))</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="comment">// The linking line runs N-S or S-N, so a straight line at right angles to this runs W-E or E-W. Calculate the two possible end points for this coastline-normal profile</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      dYEnd1 = dYEnd2 = pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>();</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      dXEnd1 = pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() + dLineLength;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      dXEnd2 = pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() - dLineLength;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;   }</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;   {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="comment">// The linking line runs neither W-E nor N-S so we have to work a bit harder to find the end-point of the coastline-normal profile</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <span class="keywordtype">double</span> dA = dYDiff / dXDiff;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="comment">// Now calculate the equation of the straight line which is perpendicular to this linking line</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;         dAPerp = -1 / dA,</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;         dBPerp = pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() - (dAPerp * pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>());</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="comment">// Calculate the end point of the profile: first do some substitution then rearrange as a quadratic equation i.e. in the form Ax^2 + Bx + C = 0 (see http://math.stackexchange.com/questions/228841/how-do-i-calculate-the-intersections-of-a-straight-line-and-a-circle)</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;         dQuadA = 1 + (dAPerp * dAPerp),</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;         dQuadB = 2 * ((dBPerp * dAPerp) - (dAPerp * pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>()) - pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>()),</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;         dQuadC = ((pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() * pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>()) + (pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() * pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>()) + (dBPerp * dBPerp) - (2 * pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() * dBPerp) - (dLineLength * dLineLength));</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; </div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <span class="comment">// Solve for x and y using the quadratic formula x = (B  sqrt(B^2  4AC)) / 2A</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      <span class="keywordtype">double</span> dDiscriminant = (dQuadB * dQuadB) - (4 * dQuadA * dQuadC);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="keywordflow">if</span> (dDiscriminant &lt; 0)</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> &lt;&lt; <span class="stringliteral">&quot;timestep &quot;</span> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: discriminant &lt; 0 when finding profile end point on coastline &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, from coastline point &quot;</span> &lt;&lt; nStartCoastPoint &lt;&lt; <span class="stringliteral">&quot;), ignored&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#ac3bceeea03f34d120a475e78f82f07c7">RTN_ERR_NO_SOLUTION_FOR_ENDPOINT</a>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      dXEnd1 = (-dQuadB + sqrt(dDiscriminant)) / (2 * dQuadA);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      dYEnd1 = (dAPerp * dXEnd1) + dBPerp;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      dXEnd2 = (-dQuadB - sqrt(dDiscriminant)) / (2 * dQuadA);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      dYEnd2 = (dAPerp * dXEnd2) + dBPerp;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;   }</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;   <span class="comment">// We have two possible solutions, so decide which of the two endpoints to use then create the profile end-point (coordinates in external CRS)</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;   <span class="keywordtype">int</span> nSeaHand = m_VCoast[nCoast].nGetSeaHandedness();            <span class="comment">// Assumes handedness is either 0 or 1 (i.e. not -1)</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;   *pPtEnd = PtChooseEndPoint(nSeaHand, &amp;PtBefore, &amp;PtAfter, dXEnd1, dYEnd1, dXEnd2, dYEnd2);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;   <span class="comment">// Check that pPtiEnd is not off the grid. Note that pPtiEnd is NOT (necessarily) a cell centroid</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;   pPtiEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a5ffded2cbbf18f6f3e6595824476b727">SetXY</a>(<a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dExtCRSXToGridX(pPtEnd-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>())), <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dExtCRSYToGridY(pPtEnd-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>())));</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;   <span class="keywordflow">if</span> (! bIsWithinValidGrid(pPtiEnd))</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;   {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <span class="comment">// The end point is off the grid, so constrain it to be within the valid grid</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiStart(<a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dExtCRSXToGridX(pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>())), <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dExtCRSYToGridY(pPtStart-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>())));</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      KeepWithinValidGrid(&amp;PtiStart, pPtiEnd);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160; </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      pPtEnd-&gt;<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dGridCentroidXToExtCRSX(pPtiEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()));</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      pPtEnd-&gt;<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dGridCentroidYToExtCRSY(pPtiEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()));</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: changed endpoint for profile, is now [&quot; &lt;&lt; PtiEnd.nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; PtiEnd.nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; pPtEnd-&gt;dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; pPtEnd-&gt;dGetY() &lt;&lt; &quot;}. The profile starts at coastline point &quot; &lt;&lt; nStartCoastPoint &lt;&lt; &quot; = {&quot; &lt;&lt; pPtStart-&gt;dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; pPtStart-&gt;dGetY() &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">//       return RTN_ERR_PROFILE_ENDPOINT_IS_OFFGRID;</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;   }</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;}</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment"> Choose which end point to use for the coastline-normal profile</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> CSimulation::PtChooseEndPoint(<span class="keywordtype">int</span> <span class="keyword">const</span> nHand, <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> <span class="keyword">const</span>* PtBefore, <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> <span class="keyword">const</span>* PtAfter, <span class="keywordtype">double</span> <span class="keyword">const</span> dXEnd1, <span class="keywordtype">double</span> <span class="keyword">const</span> dYEnd1, <span class="keywordtype">double</span> <span class="keyword">const</span> dXEnd2, <span class="keywordtype">double</span> <span class="keyword">const</span> dYEnd2)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;{</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;   <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtChosen;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;   <span class="comment">// All co-ords here are in the external CRS, so the origin of the grid is the bottom left</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;   <span class="keywordflow">if</span> (nHand == <a class="code" href="cme_8h.html#a6eb4dd0c67ed177ebe71b1c1adbe52ab">RIGHT_HANDED</a>)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="comment">// The sea is to the right of the linking line. So which way is the linking line oriented? First check the N-S component</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="keywordflow">if</span> (PtAfter-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() &gt; PtBefore-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>())</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;         <span class="comment">// We are going S to N and the sea is to the right: the normal endpoint is to the E. We want the larger of the two x values</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;         <span class="keywordflow">if</span> (dXEnd1 &gt; dXEnd2)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;         {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd1);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd1);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;         }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;         {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd2);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd2);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;         }</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      }</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PtAfter-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() &lt; PtBefore-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>())</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;         <span class="comment">// We are going N to S and the sea is to the right: the normal endpoint is to the W. We want the smaller of the two x values</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;         <span class="keywordflow">if</span> (dXEnd1 &lt; dXEnd2)</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;         {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd1);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd1);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;         }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;         {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd2);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd2);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;         }</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;         <span class="comment">// No N-S component i.e. the linking line is exactly W-E. So check the W-E component</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;         <span class="keywordflow">if</span> (PtAfter-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() &gt; PtBefore-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>())</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;         {</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            <span class="comment">// We are going W to E and the sea is to the right: the normal endpoint is to the s. We want the smaller of the two y values</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <span class="keywordflow">if</span> (dYEnd1 &lt; dYEnd2)</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd1);</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd1);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd2);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd2);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;         }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;         <span class="keywordflow">else</span>     <span class="comment">// Do not check for (PtAfter-&gt;dGetX() == PtBefore-&gt;dGetX()), since this would mean the two points are co-incident</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;         {</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            <span class="comment">// We are going E to W and the sea is to the right: the normal endpoint is to the N. We want the larger of the two y values</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            <span class="keywordflow">if</span> (dYEnd1 &gt; dYEnd2)</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd1);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd1);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd2);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd2);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;         }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      }</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;   }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   <span class="keywordflow">else</span>     <span class="comment">// nHand == LEFT_HANDED</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;   {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      <span class="comment">// The sea is to the left of the linking line. So which way is the linking line oriented? First check the N-S component</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      <span class="keywordflow">if</span> (PtAfter-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() &gt; PtBefore-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>())</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;         <span class="comment">// We are going S to N and the sea is to the left: the normal endpoint is to the W. We want the smaller of the two x values</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;         <span class="keywordflow">if</span> (dXEnd1 &lt; dXEnd2)</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;         {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd1);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd1);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;         }</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;         {</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd2);</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd2);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;         }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PtAfter-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() &lt; PtBefore-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>())</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      {</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;         <span class="comment">// We are going N to S and the sea is to the left: the normal endpoint is to the E. We want the larger of the two x values</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;         <span class="keywordflow">if</span> (dXEnd1 &gt; dXEnd2)</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;         {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd1);</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd1);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;         }</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;         {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd2);</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd2);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;         }</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      }</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      {</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;         <span class="comment">// No N-S component i.e. the linking line is exactly W-E. So check the W-E component</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;         <span class="keywordflow">if</span> (PtAfter-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() &gt; PtBefore-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>())</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;         {</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            <span class="comment">// We are going W to E and the sea is to the left: the normal endpoint is to the N. We want the larger of the two y values</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            <span class="keywordflow">if</span> (dYEnd1 &gt; dYEnd2)</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd1);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd1);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            }</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd2);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd2);</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;         }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;         <span class="keywordflow">else</span>     <span class="comment">// Do not check for (PtAfter-&gt;dGetX() == PtBefore-&gt;dGetX()), since this would mean the two points are co-incident</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;         {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            <span class="comment">// We are going E to W and the sea is to the left: the normal endpoint is to the S. We want the smaller of the two y values</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            <span class="keywordflow">if</span> (dYEnd1 &lt; dYEnd2)</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd1);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd1);</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            {</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dXEnd2);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;               PtChosen.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dYEnd2);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            }</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;         }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      }</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;   }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   <span class="keywordflow">return</span> PtChosen;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;}</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment"> Checks all coastline-normal profiles for intersection, and modifies those that intersect</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="keywordtype">int</span> CSimulation::nModifyAllIntersectingProfiles(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;{</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;   <span class="comment">// Do once for every coastline object</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;   <span class="keywordtype">int</span> nCoastLines = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(m_VCoast.size());</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; nCoastLines; nCoast++)</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;   {</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="keywordtype">int</span> nNumProfiles = m_VCoast[nCoast].nGetNumProfiles();</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160; </div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="comment">// Go along the coast, looking at profiles which are increasingly distant from the first profile</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="keywordtype">int</span> nMaxDist = nNumProfiles / 2;       <span class="comment">// Arbitrary</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nDist = 1; nDist &lt; nMaxDist; nDist++)</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      {</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;         <span class="comment">// Do once for every profile</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nFirst = 0; nFirst &lt; nNumProfiles; nFirst++)</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;         {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            <span class="comment">// In coastline curvature sequence</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <span class="keywordtype">int</span> nFirstProfile = m_VCoast[nCoast].nGetProfileFromAlongCoastProfileIndex(nFirst);</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            <span class="keywordflow">if</span> (nFirstProfile &lt; 0)</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;               <span class="comment">// Not found</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;               <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a76a16f6df9c13923d6716d244bd47a76">RTN_ERR_BAD_INDEX</a>;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">//            LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nFirst = &quot; &lt;&lt; nFirst &lt;&lt; &quot; nFirstProfile = &quot; &lt;&lt; nFirstProfile &lt;&lt; endl;</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160; </div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            <span class="comment">// Don&#39;t modify the start- or end-of coastline normals</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pFirstProfile = m_VCoast[nCoast].pGetProfile(nFirstProfile);</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            <span class="keywordflow">if</span> ((pFirstProfile-&gt;<a class="code" href="class_c_geom_profile.html#ac591314b290b032ffc8a70d22df64ec0">bStartOfCoast</a>()) || (pFirstProfile-&gt;<a class="code" href="class_c_geom_profile.html#aec35bc03fc47a65349def96364c99bbd">bEndOfCoast</a>()))</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;               <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="comment">// Do this in alternate directions: first down-coast (in the direction of increasing coast point numbers) then up-coast</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nDirection = <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>; nDirection &lt;= <a class="code" href="cme_8h.html#af803adbfdc053cf78880fc2425db1f1d">DIRECTION_UPCOAST</a>; nDirection++)</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;            {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;               <span class="keywordtype">int</span> nSecond;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;               <span class="keywordflow">if</span> (nDirection == <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>)</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                  nSecond = nFirst + nDist;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                  nSecond = nFirst - nDist;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160; </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;               <span class="keywordflow">if</span> ((nSecond &lt; 0) || (nSecond &gt; nNumProfiles-1))</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                  <span class="comment">// Make sure that we don&#39;t go beyond the ends of the along-coast index</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                  <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;               <span class="keywordtype">int</span> nSecondProfile = m_VCoast[nCoast].nGetProfileFromAlongCoastProfileIndex(nSecond);</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160; </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">//               LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast search, nFirst = &quot; &lt;&lt; nFirst &lt;&lt; &quot; nSecond = &quot; &lt;&lt; nSecond &lt;&lt; &quot; (profiles &quot; &lt;&lt; nFirstProfile &lt;&lt; &quot; and &quot; &lt;&lt; nSecondProfile &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160; </div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;               <span class="comment">// Only check these profiles for intersection if both are problem-free</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;               <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pSecondProfile = m_VCoast[nCoast].pGetProfile(nSecondProfile);</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;               <span class="keywordflow">if</span> (! (pFirstProfile-&gt;<a class="code" href="class_c_geom_profile.html#a8dc4e3ce21668f7149ca11aeb7efadf7">bProfileOK</a>()) || (! pSecondProfile-&gt;<a class="code" href="class_c_geom_profile.html#a8dc4e3ce21668f7149ca11aeb7efadf7">bProfileOK</a>()))</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                  <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;               <span class="comment">// Only check these two profiles for intersection if they are are not co-incident in the final line segment of both profiles (i.e. the profiles have not already intersected)</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;               <span class="keywordflow">if</span> ((pFirstProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a3063e454f1e7ef2b32484cf8c7db0e97">bFindProfileInCoincidentProfilesOfLastLineSegment</a>(nSecondProfile)) || (pSecondProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a3063e454f1e7ef2b32484cf8c7db0e97">bFindProfileInCoincidentProfilesOfLastLineSegment</a>(nFirstProfile)))</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                  <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160; </div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;               <span class="comment">// OK go for it</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;               <span class="keywordtype">int</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                  nProf1LineSeg = 0,</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                  nProf2LineSeg = 0;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;               <span class="keywordtype">double</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                  dIntersectX = 0,</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                  dIntersectY = 0,</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                  dAvgEndX = 0,</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                  dAvgEndY = 0;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160; </div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;               <span class="keywordflow">if</span> (bCheckForIntersection(pFirstProfile, pSecondProfile, nProf1LineSeg, nProf2LineSeg, dIntersectX, dIntersectY, dAvgEndX, dAvgEndY))</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;               {</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                  <span class="comment">// The profiles intersect. Is the point of intersection already present in the first profile (i.e. because there has already been an intersection at this point between the first profile and some other profile)?</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                  <span class="keywordtype">int</span> nPoint = -1;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                  <span class="keywordflow">if</span> (pFirstProfile-&gt;<a class="code" href="class_c_geom_profile.html#a442e3a6584e1a5b76e7ace39828f2bfc">bIsPointInProfile</a>(dIntersectX, dIntersectY, nPoint))</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                  {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">//                      LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: ^^^^ profiles &quot; &lt;&lt; nFirstProfile &lt;&lt; &quot; and &quot; &lt;&lt; nSecondProfile &lt;&lt; &quot; intersect, but point {&quot; &lt;&lt; dIntersectX &lt;&lt; &quot;, &quot; &lt;&lt; dIntersectY &lt;&lt; &quot;} is already present in profile &quot; &lt;&lt; nFirstProfile &lt;&lt; &quot; as point &quot; &lt;&lt; nPoint &lt;&lt; endl;</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                     <span class="comment">// Truncate the second profile and merge it with the first profile</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                     TruncateOneProfileRetainOtherProfile(nCoast, nSecondProfile, nFirstProfile, dIntersectX, dIntersectY, nProf2LineSeg, nProf1LineSeg, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                  }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                  <span class="comment">// Is the point of intersection already present in the second profile?</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSecondProfile-&gt;<a class="code" href="class_c_geom_profile.html#a442e3a6584e1a5b76e7ace39828f2bfc">bIsPointInProfile</a>(dIntersectX, dIntersectY, nPoint))</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                  {</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">//                      LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: ^^^^ profiles &quot; &lt;&lt; nFirstProfile &lt;&lt; &quot; and &quot; &lt;&lt; nSecondProfile &lt;&lt; &quot; intersect, but point {&quot; &lt;&lt; dIntersectX &lt;&lt; &quot;, &quot; &lt;&lt; dIntersectY &lt;&lt; &quot;} is already present in profile &quot; &lt;&lt; nSecondProfile &lt;&lt; &quot; as point &quot; &lt;&lt; nPoint &lt;&lt; endl;</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160; </div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                     <span class="comment">// Truncate the first profile and merge it with the second profile</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                     TruncateOneProfileRetainOtherProfile(nCoast, nFirstProfile, nSecondProfile, dIntersectX, dIntersectY, nProf1LineSeg, nProf2LineSeg, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                  }</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                  {</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                     <span class="comment">// The point of intersection is not already present in either profile, so get the number of line segments of each profile</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                     <span class="keywordtype">int</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                        nFirstProfileLineSegments = pFirstProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ae22f845fd065108959610678de571cdb">nGetNumLineSegments</a>(),</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                        nSecondProfileLineSegments = pSecondProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ae22f845fd065108959610678de571cdb">nGetNumLineSegments</a>();</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">//                   assert(nProf1LineSeg &lt; nFirstProfileLineSegments);</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">//                   assert(nProf2LineSeg &lt; nSecondProfileLineSegments);</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                     <span class="comment">//  Next check whether the point of intersection is on the final line segment of both profiles</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                     <span class="keywordflow">if</span> ((nProf1LineSeg == (nFirstProfileLineSegments-1)) &amp;&amp; (nProf2LineSeg == (nSecondProfileLineSegments-1)))</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                     {</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                        <span class="comment">// Yes, the point of intersection is on the final line segment of both profiles, so merge the profiles seaward of the point of intersection</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                        MergeProfilesAtFinalLineSegments(nCoast, nFirstProfile, nSecondProfile, nFirstProfileLineSegments, nSecondProfileLineSegments, dIntersectX, dIntersectY, dAvgEndX, dAvgEndY);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; </div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">//                         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: &quot; &lt;&lt; ((nDirection == DIRECTION_DOWNCOAST) ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast search, end-segment intersection between profiles {&quot; &lt;&lt; nFirstProfile &lt;&lt; &quot;} and {&quot; &lt;&lt; nSecondProfile &lt;&lt; &quot;} at [&quot; &lt;&lt; dIntersectX &lt;&lt; &quot;, &quot; &lt;&lt; dIntersectY &lt;&lt; &quot;] in line segment [&quot; &lt;&lt; nProf1LineSeg &lt;&lt; &quot;] of &quot; &lt;&lt; nFirstProfileLineSegments &lt;&lt; &quot;, and line segment [&quot; &lt;&lt; nProf2LineSeg &lt;&lt; &quot;] of &quot; &lt;&lt; nSecondProfileLineSegments &lt;&lt; &quot;, respectively&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160; </div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">//                         // DEBUG CODE =============================</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">//                         int nSizeTmp = pFirstProfile-&gt;nGetProfileSize();</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">//                         CGeom2DPoint PtEndTmp = *pFirstProfile-&gt;pPtGetPointInProfile(nSizeTmp-1);</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">//                         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: end of first profile (&quot; &lt;&lt; nFirstProfile &lt;&lt; &quot;) is point &quot; &lt;&lt; nSizeTmp-1 &lt;&lt; &quot; at [&quot; &lt;&lt; dExtCRSXToGridX(PtEndTmp.dGetX()) &lt;&lt; &quot;][&quot; &lt;&lt; dExtCRSYToGridY(PtEndTmp.dGetY()) &lt;&lt; &quot;} = {&quot; &lt;&lt; PtEndTmp.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtEndTmp.dGetY() &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">//                         nSizeTmp = pSecondProfile-&gt;nGetProfileSize();</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">//                         PtEndTmp = *pSecondProfile-&gt;pPtGetPointInProfile(nSizeTmp-1);</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">//                         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: end of second profile (&quot; &lt;&lt; nSecondProfile &lt;&lt; &quot;) is point &quot; &lt;&lt; nSizeTmp-1 &lt;&lt; &quot; at [&quot; &lt;&lt; dExtCRSXToGridX(PtEndTmp.dGetX()) &lt;&lt; &quot;][&quot; &lt;&lt; dExtCRSYToGridY(PtEndTmp.dGetY()) &lt;&lt; &quot;} = {&quot; &lt;&lt; PtEndTmp.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtEndTmp.dGetY() &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">//                         // DEBUG CODE =============================</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                     }</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                     <span class="keywordflow">else</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                     {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                        <span class="comment">// The profiles intersect, but the point of intersection is not on the final line segment of both profiles. One of the profiles will be truncated, the other profile will be retained</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">//                         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: &quot; &lt;&lt; ((nDirection == DIRECTION_DOWNCOAST) ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast search, intersection (NOT both end segments) between profiles {&quot; &lt;&lt; nFirstProfile &lt;&lt; &quot;} and {&quot; &lt;&lt; nSecondProfile &lt;&lt; &quot;} at [&quot; &lt;&lt; dIntersectX &lt;&lt; &quot;, &quot; &lt;&lt; dIntersectY &lt;&lt; &quot;] in line segment [&quot; &lt;&lt; nProf1LineSeg &lt;&lt; &quot;] of &quot; &lt;&lt; nFirstProfileLineSegments &lt;&lt; &quot;, and line segment [&quot; &lt;&lt; nProf2LineSeg &lt;&lt; &quot;] of &quot; &lt;&lt; nSecondProfileLineSegments &lt;&lt; &quot;, respectively&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160; </div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                        <span class="comment">// Decide which profile to truncate, and which to retain</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                        <span class="keywordflow">if</span> (nFirstProfileLineSegments &gt; nSecondProfileLineSegments)</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                           <span class="comment">// Truncate the second profile, since it has a smaller number of line segments</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                           TruncateOneProfileRetainOtherProfile(nCoast, nSecondProfile, nFirstProfile, dIntersectX, dIntersectY, nProf2LineSeg, nProf1LineSeg, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160; </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nFirstProfileLineSegments &lt; nSecondProfileLineSegments)</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                           <span class="comment">// Truncate the first profile, since it has a smaller number of line segments</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                           TruncateOneProfileRetainOtherProfile(nCoast, nFirstProfile, nSecondProfile, dIntersectX, dIntersectY, nProf1LineSeg, nProf2LineSeg, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160; </div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                        {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                           <span class="comment">// Both profiles have the same number of line segments, so choose randomnly</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                           <span class="keywordflow">if</span> (dGetRand0d1() &gt;= 0.5)</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                              TruncateOneProfileRetainOtherProfile(nCoast, nFirstProfile, nSecondProfile, dIntersectX, dIntersectY, nProf1LineSeg, nProf2LineSeg, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                           <span class="keywordflow">else</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                              TruncateOneProfileRetainOtherProfile(nCoast, nSecondProfile, nFirstProfile, dIntersectX, dIntersectY, nProf2LineSeg, nProf1LineSeg, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                        }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                     }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                  }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">//                   int</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">//                      nProfile1NumSegments = pFirstProfile-&gt;nGetNumLineSegments(),</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">//                      nProfile2NumSegments = pSecondProfile-&gt;nGetNumLineSegments(),</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">//                      nProfile1Size = pFirstProfile-&gt;nGetProfileSize(),</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">//                      nProfile2Size = pSecondProfile-&gt;nGetProfileSize();</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">//                   assert(pFirstProfile-&gt;nGetNumLineSegments() &gt; 0);</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">//                   assert(pSecondProfile-&gt;nGetNumLineSegments() &gt; 0);</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">//                   assert(nProfile1Size == nProfile1NumSegments+1);</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">//                   assert(nProfile2Size == nProfile2NumSegments+1);</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;               }</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;            }</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;         }</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      }</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;   }</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;}</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160; </div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160; </div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment"> Checks all line segments of a pair of coastline-normal profiles for intersection. If the lines intersect, returns true with numbers of the line segments at which intersection occurs in nProfile1LineSegment and nProfile1LineSegment, the intersection point in dXIntersect and dYIntersect, and the &#39;average&#39; seaward endpoint of the two intersecting profiles at dXAvgEnd and dYAvgEnd</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="keywordtype">bool</span> CSimulation::bCheckForIntersection(<a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* <span class="keyword">const</span> pVProfile1, <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* <span class="keyword">const</span> pVProfile2, <span class="keywordtype">int</span>&amp; nProfile1LineSegment, <span class="keywordtype">int</span>&amp; nProfile2LineSegment, <span class="keywordtype">double</span>&amp; dXIntersect, <span class="keywordtype">double</span>&amp; dYIntersect, <span class="keywordtype">double</span>&amp; dXAvgEnd, <span class="keywordtype">double</span>&amp; dYAvgEnd)</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;{</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;   <span class="comment">// For both profiles, look at all line segments</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      nProfile1NumSegments = pVProfile1-&gt;<a class="code" href="class_c_geom_multi_line.html#ae22f845fd065108959610678de571cdb">nGetNumLineSegments</a>(),</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      nProfile2NumSegments = pVProfile2-&gt;<a class="code" href="class_c_geom_multi_line.html#ae22f845fd065108959610678de571cdb">nGetNumLineSegments</a>();</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment">//       nProfile1Size = pVProfile1-&gt;nGetProfileSize(),</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment">//       nProfile2Size = pVProfile2-&gt;nGetProfileSize();</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160; </div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment">//    assert(nProfile1Size == nProfile1NumSegments+1);</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment">//    assert(nProfile2Size == nProfile2NumSegments+1);</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160; </div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfile1NumSegments; i++)</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;   {</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nProfile2NumSegments; j++)</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;         <span class="comment">// In external coordinates</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            dX1 = pVProfile1-&gt;<a class="code" href="class_c_a2_d_shape.html#a20acae762de7cf6769eb938621f6a842">pPtVGetPoints</a>()-&gt;at(i).dGetX(),</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            dY1 = pVProfile1-&gt;<a class="code" href="class_c_a2_d_shape.html#a20acae762de7cf6769eb938621f6a842">pPtVGetPoints</a>()-&gt;at(i).dGetY(),</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            dX2 = pVProfile1-&gt;<a class="code" href="class_c_a2_d_shape.html#a20acae762de7cf6769eb938621f6a842">pPtVGetPoints</a>()-&gt;at(i+1).dGetX(),</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            dY2 = pVProfile1-&gt;<a class="code" href="class_c_a2_d_shape.html#a20acae762de7cf6769eb938621f6a842">pPtVGetPoints</a>()-&gt;at(i+1).dGetY();</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            dX3 = pVProfile2-&gt;<a class="code" href="class_c_a2_d_shape.html#a20acae762de7cf6769eb938621f6a842">pPtVGetPoints</a>()-&gt;at(j).dGetX(),</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            dY3 = pVProfile2-&gt;<a class="code" href="class_c_a2_d_shape.html#a20acae762de7cf6769eb938621f6a842">pPtVGetPoints</a>()-&gt;at(j).dGetY(),</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;            dX4 = pVProfile2-&gt;<a class="code" href="class_c_a2_d_shape.html#a20acae762de7cf6769eb938621f6a842">pPtVGetPoints</a>()-&gt;at(j+1).dGetX(),</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            dY4 = pVProfile2-&gt;<a class="code" href="class_c_a2_d_shape.html#a20acae762de7cf6769eb938621f6a842">pPtVGetPoints</a>()-&gt;at(j+1).dGetY();</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160; </div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;         <span class="comment">// Uses Cramer&#39;s Rule to solve the equations. Modified from code at http://stackoverflow.com/questions/563198/how-do-you-detect-where-two-line-segments-intersect (in turn based on Andre LeMothe&#39;s &quot;Tricks of the Windows Game Programming Gurus&quot;)</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            dDiffX1 = dX2 - dX1,</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            dDiffY1 = dY2 - dY1,</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            dDiffX2 = dX4 - dX3,</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            dDiffY2 = dY4 - dY3;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;            dS = -999,</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            dT = -999,</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            dTmp = 0;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160; </div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;         dTmp = -dDiffX2 * dDiffY1 + dDiffX1 * dDiffY2;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;         <span class="keywordflow">if</span> (dTmp != 0)</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;            dS = (-dDiffY1 * (dX1 - dX3) + dDiffX1 * (dY1 - dY3)) / dTmp;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160; </div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;         dTmp = -dDiffX2 * dDiffY1 + dDiffX1 * dDiffY2;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;         <span class="keywordflow">if</span> (dTmp != 0)</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            dT = (dDiffX2 * (dY1 - dY3) - dDiffY2 * (dX1 - dX3)) / dTmp;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160; </div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;         <span class="keywordflow">if</span> (dS &gt;= 0 &amp;&amp; dS &lt;= 1 &amp;&amp; dT &gt;= 0 &amp;&amp; dT &lt;= 1)</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;         {</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            <span class="comment">// Collision detected, calculate intersection co-ords</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            dXIntersect = dX1 + (dT * dDiffX1);</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;            dYIntersect = dY1 + (dT * dDiffY1);</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160; </div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;            <span class="comment">// And calc the average end-point co-ords</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;            dXAvgEnd = (dX2 + dX4) / 2;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;            dYAvgEnd = (dY2 + dY4) / 2;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160; </div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;            <span class="comment">// Get the line segments at which intersection occurred</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            nProfile1LineSegment = i;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;            nProfile2LineSegment = j;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160; </div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">//             LogStream &lt;&lt; &quot;\t&quot; &lt;&lt; &quot;INTERSECTION dX2 = &quot; &lt;&lt; dX2 &lt;&lt; &quot; dX4 = &quot; &lt;&lt; dX4 &lt;&lt; &quot; dY2 = &quot; &lt;&lt; dY2 &lt;&lt; &quot; dY4 = &quot; &lt;&lt; dY4 &lt;&lt; endl;</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;         }</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      }</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;   }</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160; </div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="comment">// No collision</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;}</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160; </div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment"> Puts the coastline-normal profiles (apart from the &#39;special&#39; ones at the start and end of the coast) onto the raster grid, i.e. rasterizes multi-line vector objects onto the raster grid. Note that this doesn&#39;t work if the vector has already been interpolated to fit on the grid i.e. if distances between vector points are just one cell apart</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="keywordtype">int</span> CSimulation::nPutAllProfilesOntoGrid(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;{</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   <span class="keywordtype">int</span> nValidProfiles = 0;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160; </div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;   <span class="comment">// Do once for every coastline</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(m_VCoast.size()); nCoast++)</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;   {</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <span class="comment">// How many profiles on this coast?</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="keywordtype">int</span> nProfiles = m_VCoast[nCoast].nGetNumProfiles();</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      <span class="keywordflow">if</span> (nProfiles == 0)</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      {</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;         <span class="comment">// This can happen if the coastline is very short, so just give a warning and carry on with the next coastline</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code" href="cme_8h.html#aefc63c4bde02ca170b0e7bd038ba7702">WARN</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; has no profiles&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;         <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      }</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160; </div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="comment">// Now do this loop for every profile in the list, apart from the last two (i.e. the profiles at the start and end of the coast)</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfile = 0; nProfile &lt; nProfiles-2; nProfile++)</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      {</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;         <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* <span class="keyword">const</span> pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160; </div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;         <span class="comment">// If this profile has a problem, then forget about it. Still do start- and end-of-coast profiles however</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;         <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aac223e2610d50ca2c7eadaf8542e9498">bOKIncStartAndEndOfCoast</a>())</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160; </div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;         <span class="keywordtype">int</span> nPoints = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#abaf88697019588a2b0901bd19044aee4">nGetProfileSize</a>();</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;         <span class="keywordflow">if</span> (nPoints &lt; 2)</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;         {</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;            <span class="comment">// Need at least two points in the profile, so this profile is invalid: mark it</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;            pProfile-&gt;<a class="code" href="class_c_geom_profile.html#afef14f6eea8432a83715ec8eb68eac14">SetTooShort</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160; </div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; is invalid, has only &quot;</span> &lt;&lt; nPoints &lt;&lt; <span class="stringliteral">&quot; points&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160; </div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;         }</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160; </div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;         <span class="comment">// OK, go for it: set up temporary vectors to hold the x-y coords (in grid CRS) of the cells which we will mark</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;         vector&lt;CGeom2DIPoint&gt; VCellsToMark;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;         vector&lt;bool&gt; bVShared;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;         <span class="keywordtype">bool</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            bTooShort          = <span class="keyword">false</span>,</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            bTruncated         = <span class="keyword">false</span>,</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            bHitCoast          = <span class="keyword">false</span>,</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            bHitLand           = <span class="keyword">false</span>,</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            bHitAnotherProfile = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160; </div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;         RasterizeProfile(nCoast, nProfile, &amp;VCellsToMark, &amp;bVShared, bTooShort, bTruncated, bHitCoast, bHitLand, bHitAnotherProfile);</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160; </div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;         <span class="keywordflow">if</span> ((bTruncated &amp;&amp; (! <a class="code" href="cme_8h.html#a92f31bb0474b68983566237e1c9a0b8f">ACCEPT_SHORT_PROFILES</a>)) || bTooShort || bHitCoast || bHitLand || bHitAnotherProfile)</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160; </div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;         <span class="comment">// This profile is fine</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;         nValidProfiles++;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160; </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; VCellsToMark.size(); k++)</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;         {</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            <span class="comment">// So mark each cell in the raster grid</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            m_pRasterGrid-&gt;m_Cell[VCellsToMark[k].nGetX()][VCellsToMark[k].nGetY()].<a class="code" href="class_c_geom_cell.html#abd8d4a175fce062870745f66a1ee4299">SetProfile</a>(nProfile);</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; </div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            <span class="comment">// Store the raster-grid coordinates in the profile object</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aafb35166293c29d0492621850d5d06d4">AppendCellInProfile</a>(VCellsToMark[k].nGetX(), VCellsToMark[k].nGetY());</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160; </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;            <span class="comment">// And also store the external coordinates in the profile object</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;            pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6152817d6ec950e1474313ca9824da46">AppendCellInProfileExtCRS</a>(dGridCentroidXToExtCRSX(VCellsToMark[k].nGetX()), dGridCentroidYToExtCRSY(VCellsToMark[k].nGetY()));</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            <span class="comment">// Mark the shared (i.e. multi-line) parts of the profile (if any)</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment">//             if (bVShared[k])</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">//             {</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment">//                pProfile-&gt;AppendPointShared(true);</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment">// //                  LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: profile &quot; &lt;&lt; j &lt;&lt; &quot; point &quot; &lt;&lt; k &lt;&lt; &quot; marked as shared&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">//             }</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">//             else</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">//             {</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment">//                pProfile-&gt;AppendPointShared(false);</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">// //                  LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; point &quot; &lt;&lt; k &lt;&lt; &quot; marked as NOT shared&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">//             }</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;         }</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160; </div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;         <span class="comment">// Get the deep water wave height and orientation values at the end of the profile</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            dDeepWaterWaveHeight = m_pRasterGrid-&gt;m_Cell[VCellsToMark.back().nGetX()][VCellsToMark.back().nGetY()].<a class="code" href="class_c_geom_cell.html#a9afd0ac74169a81629bcbaa402be3009">dGetDeepWaterWaveHeight</a>(),</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            dDeepWaterWaveOrientation = m_pRasterGrid-&gt;m_Cell[VCellsToMark.back().nGetX()][VCellsToMark.back().nGetY()].<a class="code" href="class_c_geom_cell.html#a1d2e53161b9483dce3aaaf32d3287e51">dGetDeepWaterWaveOrientation</a>(),</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;            dDeepWaterWavePeriod = m_pRasterGrid-&gt;m_Cell[VCellsToMark.back().nGetX()][VCellsToMark.back().nGetY()].<a class="code" href="class_c_geom_cell.html#ad03f0af5de19150fad5383f2e147c55e">dGetDeepWaterWavePeriod</a>();</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160; </div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;         <span class="comment">// And store them for this profile</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;         pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ad253e6ede71402845e2ed5522a492efd">SetDeepWaterWaveHeight</a>(dDeepWaterWaveHeight);</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;         pProfile-&gt;<a class="code" href="class_c_geom_profile.html#af4ec7ad9bc2379688a31d49db5a049f7">SetDeepWaterWaveOrientation</a>(dDeepWaterWaveOrientation);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;     pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a4f702fc67f4f75ef648761cea136c079">SetDeepWaterWavePeriod</a>(dDeepWaterWavePeriod);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;   }</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160; </div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;   <span class="keywordflow">if</span> (nValidProfiles == 0)</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;   {</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      <span class="comment">// Problem! No valid profiles, so quit</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      cerr &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> &lt;&lt; <span class="stringliteral">&quot;no coastline-normal profiles created&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a844aea83f4cb0eede0026a83e7e874d3">RTN_ERR_NO_PROFILES_2</a>;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;   }</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;}</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160; </div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160; </div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment"> Given a pointer to a coastline-normal profile, returns an output vector of cells which are &#39;under&#39; every line segment of the profile. If there is a problem with the profile (e.g. a rasterized cell is dry land or coast, or the profile has to be truncated) then we pass this back as an error code</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="keywordtype">void</span> CSimulation::RasterizeProfile(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfile, vector&lt;CGeom2DIPoint&gt;* pVIPointsOut, vector&lt;bool&gt;* pbVShared, <span class="keywordtype">bool</span>&amp; bTooShort, <span class="keywordtype">bool</span>&amp; bTruncated, <span class="keywordtype">bool</span>&amp; bHitCoast, <span class="keywordtype">bool</span> <span class="keyword">const</span> bHitLand, <span class="keywordtype">bool</span>&amp; bHitAnotherProfile)</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;{</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* <span class="keyword">const</span> pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160; </div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;   pVIPointsOut-&gt;clear();</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      nSeg = 0,</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      nSegments = pProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ae22f845fd065108959610678de571cdb">nGetNumLineSegments</a>(),</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      nProfiles = m_VCoast[nCoast].nGetNumProfiles();    <span class="comment">// TODO this is a bodge, needed if we hit a profile which belongs to a different coast object</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160; </div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;   <span class="comment">// This contains a list of &#39;other&#39; profiles which intersect this profile, but which are OK (i.e. they are coincident profiles of this profile). Added for efficiency</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;   vector&lt;int&gt; VnOtherProfileOK;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160; </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;   <span class="comment">// Do for every segment of this profile</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;   <span class="keywordflow">for</span> (nSeg = 0; nSeg &lt; nSegments; nSeg++)</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;   {</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      <span class="comment">// Do once for every line segment</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;      vector&lt;CGeom2DPoint&gt; PtVSegment;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      PtVSegment.push_back(*pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg));</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      PtVSegment.push_back(*pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg+1));     <span class="comment">// This is OK</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160; </div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      <span class="keywordtype">bool</span> bShared = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      <span class="keywordflow">if</span> (pProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a3516022bd96ee15709653b3bb7cc0155">nGetNumCoincidentProfilesInLineSegment</a>(nSeg) &gt; 1)</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;         bShared = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160; </div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      <span class="comment">// The start point of the normal, must convert from the external CRS to grid CRS. If this is the first line segment of the profile, then the start point is the centroid of a coastline cell</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;         dXStart = dExtCRSXToGridX(PtVSegment[0].dGetX()),</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;         dYStart = dExtCRSYToGridY(PtVSegment[0].dGetY());</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160; </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      <span class="comment">// The end point of the normal, again convert from the external CRS to grid CRS. Note too that it could be off the grid</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;         dXEnd = dExtCRSXToGridX(PtVSegment[1].dGetX()),</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;         dYEnd = dExtCRSYToGridY(PtVSegment[1].dGetY());</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160; </div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      <span class="comment">// Interpolate between cells by a simple DDA line algorithm, see http://en.wikipedia.org/wiki/Digital_differential_analyzer_(graphics_algorithm) Note that Bresenham&#39;s algorithm gave occasional gaps</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;         dXInc = dXEnd - dXStart,</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;         dYInc = dYEnd - dYStart,</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;         dLength = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(<a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dXInc), <a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dYInc));</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      dXInc /= dLength;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      dYInc /= dLength;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160; </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;         dX = dXStart,</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;         dY = dYStart;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      <span class="comment">// Process each interpolated point</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt;= <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dLength); m++)</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      {</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;         <span class="keywordtype">int</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;            nX = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(dX),</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;            nY = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(dY);</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160; </div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;         <span class="comment">// Do some checking of this interpolated point, but only if this is not a grid-edge profile (these profiles are always valid)</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;         <span class="keywordflow">if</span> ((! pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ac591314b290b032ffc8a70d22df64ec0">bStartOfCoast</a>()) &amp;&amp; (! pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aec35bc03fc47a65349def96364c99bbd">bEndOfCoast</a>()))</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;         {</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;            <span class="comment">// Is the interpolated point within the valid raster grid?</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            <span class="keywordflow">if</span> (! bIsWithinValidGrid(nX, nY))</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            {</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;               <span class="comment">// It is outside the valid grid, so mark this profile and quit the loop</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;               bTruncated = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160; </div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;               <span class="keywordflow">if</span> (! <a class="code" href="cme_8h.html#a92f31bb0474b68983566237e1c9a0b8f">ACCEPT_SHORT_PROFILES</a>)</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;                  pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a753c1ed80d2ebd882faa4181b16aa8c0">SetTruncated</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160; </div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;               <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; is invalid, truncated at [&quot;</span> &lt;&lt; nX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nY &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160; </div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            }</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160; </div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            <span class="comment">// If this is the first line segment of the profile, then once we are clear of the coastline (say, when m &gt; 1), check if this profile hits land at this interpolated point</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            <span class="comment">// NOTE Get problems here since if the coastline vector has been heavily smoothed, this can result is &#39;false positives&#39; profiles marked as invalid which are not actually invalid, because the profile hits land when m = 0 or m = 1. This results in some cells being flagged as profile cells which are actually inland</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;            <span class="keywordflow">if</span> (((nSeg == 0) &amp;&amp; (m &gt; 1)) || (nSeg &gt; 0))</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;            {</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;               <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">bIsCoastline</a>())</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;               {</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                  <span class="comment">// We&#39;ve hit a coastline so set a switch and mark the profile, then quit</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                  bHitCoast = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                  pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a45410879aaf7f8f9abc073fc54363d03">SetHitCoast</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160; </div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                  <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; is invalid, hit coast at [&quot;</span> &lt;&lt; nX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nY &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160; </div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;               }</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160; </div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;               <span class="comment">// Two diagonal(ish) raster lines can cross each other without any intersection, so must also test an adjacent cell for intersection (does not matter which adjacent cell)</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;               <span class="keywordflow">if</span> (bIsWithinValidGrid(nX, nY+1) &amp;&amp; m_pRasterGrid-&gt;m_Cell[nX][nY+1].<a class="code" href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">bIsCoastline</a>())</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;               {</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                  <span class="comment">// We&#39;ve hit a coastline so set a switch and mark the profile, then quit</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                  bHitCoast = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                  pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a45410879aaf7f8f9abc073fc54363d03">SetHitCoast</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160; </div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                  <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; is invalid, hit coast at [&quot;</span> &lt;&lt; nX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nY+1 &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nY+1) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160; </div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;               }</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160; </div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;               <span class="comment">//                if (! m_pRasterGrid-&gt;m_Cell[nX][nY].bIsInContiguousSea())</span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment">//                {</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">//                   // We&#39;ve hit dry land so set a switch and mark the profile</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment">//                   bHitLand = true;</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment">//                   pProfile-&gt;SetHitLand(true);</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="comment">//                   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; HIT LAND at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}, elevation = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetSedimentTopElev() &lt;&lt; &quot;, SWL = &quot; &lt;&lt; m_dThisTimestepSWL &lt;&lt; endl;</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="comment">//                   LogStream &lt;&lt; &quot;On [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}, sea depth = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetSeaDepth() &lt;&lt; &quot;, bIsInContiguousSea = &quot; &lt;&lt; (m_pRasterGrid-&gt;m_Cell[nX][nY].bIsInContiguousSea() ? &quot;true&quot; : &quot;false&quot;) &lt;&lt; &quot;, landform = &quot; &lt;&lt; (m_pRasterGrid-&gt;m_Cell[nX][nY].bIsInContiguousSea() ? &quot;sea&quot; : &quot;not sea&quot;) &lt;&lt; endl;</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment">//                   LogStream &lt;&lt; &quot;On [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}, elevation of consolidated sediment = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetConsSedTopForLayerAboveBasement(m_pRasterGrid-&gt;m_Cell[nX][nY].nGetTopNonZeroLayerAboveBasement()) &lt;&lt; &quot;, total cliff collapse = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetTotCliffCollapse() &lt;&lt; &quot;, total beach deposition = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetTotBeachDeposition() &lt;&lt; endl;</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment">//                   return;</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160; </div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="comment">//                }</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;            }</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160; </div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;            <span class="comment">// Now check to see if we hit another profile which is not a coincident normal to this normal</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ad2c6f63894b9feea63d71d15932c0825">bIsProfile</a>())</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            {</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;               <span class="comment">// We&#39;ve hit a raster cell which is already marked as &#39;under&#39; a normal profile. Get the number of the profile which marked this cell</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;               <span class="keywordtype">int</span> nHitProfile = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a6f4767a0af009db7b04b3a160d6a2ef0">nGetProfile</a>();</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160; </div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;               <span class="comment">// Search for the &#39;other&#39; profile in the list of OK profiles</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;               <span class="keywordflow">if</span> (std::find(VnOtherProfileOK.begin(), VnOtherProfileOK.end(), nHitProfile) == VnOtherProfileOK.end())</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;               {</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                  <span class="comment">// Not found, so it must be the first time we&#39;ve encountered this &#39;other&#39; profile</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">//                   LogStream &lt;&lt; &quot;VVVV Profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; touches profile &quot; &lt;&lt; nHitProfile &lt;&lt; endl;</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                  VnOtherProfileOK.push_back(nHitProfile);</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160; </div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                  <span class="comment">// TODO Bodge in case we hit a profile which belongs to a different coast</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;                  <span class="keywordflow">if</span> (nHitProfile &gt; nProfiles-1)</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                  {</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                     bHitAnotherProfile = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                     pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d4286ac64e3fe9aef428c93fdcd4230">SetHitAnotherProfile</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160; </div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                     <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; is invalid, crosses another profile A1 (&quot;</span> &lt;&lt; nHitProfile &lt;&lt; <span class="stringliteral">&quot;) at [&quot;</span> &lt;&lt; nX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nY &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160; </div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                     <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                  }</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160; </div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                  <span class="comment">// Only set the flag if this isn&#39;t a coincident normal to one or other of the profiles</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment">// DEBUG CODE ==============================</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment">//                   bool</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">//                      bOtherConcidentToThis = pProfile-&gt;bFindProfileInCoincidentProfiles(nHitProfile),</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment">//                      bThisCoincidentToOther = m_VCoast[nCoast].pGetProfile(nHitProfile)-&gt;bFindProfileInCoincidentProfiles(nProfile);</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment">//                   if (bOtherConcidentToThis)</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment">//                      LogStream &lt;&lt; &quot;Profile &quot; &lt;&lt; nHitProfile &lt;&lt; &quot; is coincident with &quot; &lt;&lt; nProfile &lt;&lt; endl;</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">//                   if (bThisCoincidentToOther)</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment">//                      LogStream &lt;&lt; &quot;Profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; is coincident with &quot; &lt;&lt; nHitProfile &lt;&lt; endl;</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment">//                   if ((! bOtherConcidentToThis) &amp;&amp; (! bThisCoincidentToOther))</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;                  <span class="comment">// DEBUG CODE ==============================</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160; </div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;                  <span class="comment">// Note only need to test whether the &#39;other&#39; profile is concident with his since the concidence relationship is mutual</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                  <span class="comment">// if ((! pProfile-&gt;bFindProfileInCoincidentProfiles(nHitProfile)) &amp;&amp; (! m_VCoast[nCoast].pGetProfile(nHitProfile)-&gt;bFindProfileInCoincidentProfiles(nProfile)))</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                  <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a397a6f2cc166220b5342cf3444e16753">bFindProfileInCoincidentProfiles</a>(nHitProfile))</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;                  {</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;                     bHitAnotherProfile = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;                     pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d4286ac64e3fe9aef428c93fdcd4230">SetHitAnotherProfile</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160; </div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                     <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; is invalid, crosses another profile B1 (&quot;</span> &lt;&lt; nHitProfile &lt;&lt; <span class="stringliteral">&quot;) at [&quot;</span> &lt;&lt; nX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nY &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160; </div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                     <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                  }</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;               }</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;            }</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160; </div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            <span class="comment">// Try diagonal too</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;               nXTmp = nX+1,</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;               nYTmp = nY;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160; </div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;            <span class="keywordflow">if</span> (bIsWithinValidGrid(nXTmp, nYTmp) &amp;&amp; m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#ad2c6f63894b9feea63d71d15932c0825">bIsProfile</a>())</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            {</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;               <span class="comment">// We&#39;ve hit a raster cell which is already marked as &#39;under&#39; a normal profile. Get the number of the profile which marked this cell</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;               <span class="keywordtype">int</span> nHitProfile = m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#a6f4767a0af009db7b04b3a160d6a2ef0">nGetProfile</a>();</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160; </div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;               <span class="comment">// Search for the &#39;other&#39; profile in the list of OK profiles</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;               <span class="keywordflow">if</span> (std::find(VnOtherProfileOK.begin(), VnOtherProfileOK.end(), nHitProfile) == VnOtherProfileOK.end())</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;               {</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;                  <span class="comment">// Not found, so it must be the first time we&#39;ve encountered this &#39;other&#39; profile</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment">//                   LogStream &lt;&lt; &quot;VVVV Profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; touches profile &quot; &lt;&lt; nHitProfile &lt;&lt; &quot; diagonally&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;                  VnOtherProfileOK.push_back(nHitProfile);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160; </div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                  <span class="comment">// TODO Bodge in case we hit a profile which belongs to a different coast</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                  <span class="keywordflow">if</span> (nHitProfile &gt; nProfiles-1)</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                  {</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                     bHitAnotherProfile = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                     pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d4286ac64e3fe9aef428c93fdcd4230">SetHitAnotherProfile</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160; </div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                     <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; is invalid, crosses another profile diagonally A2 (&quot;</span> &lt;&lt; nHitProfile &lt;&lt; <span class="stringliteral">&quot;) at [&quot;</span> &lt;&lt; nXTmp &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nYTmp &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nXTmp) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nYTmp) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160; </div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                     <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                  }</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160; </div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                  <span class="comment">// Only set the flag if this isn&#39;t a coincident normal to one or other of the profiles</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                  <span class="comment">// DEBUG CODE ==============================</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment">//                   bool</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="comment">//                      bOtherConcidentToThis = pProfile-&gt;bFindProfileInCoincidentProfiles(nHitProfile),</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">//                      bThisCoincidentToOther = m_VCoast[nCoast].pGetProfile(nHitProfile)-&gt;bFindProfileInCoincidentProfiles(nProfile);</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment">//                   if (bOtherConcidentToThis)</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">//                      LogStream &lt;&lt; &quot;Profile &quot; &lt;&lt; nHitProfile &lt;&lt; &quot; is coincident with &quot; &lt;&lt; nProfile &lt;&lt; endl;</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment">//                   if (bThisCoincidentToOther)</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">//                      LogStream &lt;&lt; &quot;Profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; is coincident with &quot; &lt;&lt; nHitProfile &lt;&lt; endl;</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">//                   if ((! bOtherConcidentToThis) &amp;&amp; (! bThisCoincidentToOther))</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                  <span class="comment">// DEBUG CODE ==============================</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160; </div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                  <span class="comment">// Note only need to test whether the &#39;other&#39; profile is concident with his since the concidence relationship is mutual</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                  <span class="comment">// if ((! pProfile-&gt;bFindProfileInCoincidentProfiles(nHitProfile)) &amp;&amp; (! m_VCoast[nCoast].pGetProfile(nHitProfile)-&gt;bFindProfileInCoincidentProfiles(nProfile)))</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                  <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a397a6f2cc166220b5342cf3444e16753">bFindProfileInCoincidentProfiles</a>(nHitProfile))</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                  {</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                     bHitAnotherProfile = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                     pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d4286ac64e3fe9aef428c93fdcd4230">SetHitAnotherProfile</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160; </div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                     <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; is invalid, crosses another profile diagonally B2 (&quot;</span> &lt;&lt; nHitProfile &lt;&lt; <span class="stringliteral">&quot;) at [&quot;</span> &lt;&lt; nXTmp &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nYTmp &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nXTmp) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nYTmp) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160; </div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                     <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                  }</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;               }</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            }</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;         }</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160; </div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;         <span class="comment">// Append this point to the output vector</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;         pVIPointsOut-&gt;push_back(<a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a>(nX, nY));         <span class="comment">// Is in raster-grid co-ordinates</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;         pbVShared-&gt;push_back(bShared);</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160; </div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;         <span class="comment">// And increment for next time</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;         dX += dXInc;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;         dY += dYInc;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      }</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160; </div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      <span class="keywordflow">if</span> (bTruncated)</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;   }</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160; </div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;   <span class="keywordflow">if</span> (bTruncated)</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;   {</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      <span class="keywordflow">if</span> (nSeg &lt; (nSegments-1))</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;         <span class="comment">// We are truncating the profile, so remove any line segments after this one</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;         pProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a5b5c8a7d272d53dd98279480f7a6a976">TruncateLineSegments</a>(nSeg);</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160; </div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      <span class="comment">// Shorten the vector input</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;         nOutSize = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(pVIPointsOut-&gt;size()),</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;         nLastX = pVIPointsOut-&gt;at(nOutSize-1).nGetX(),</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;         nLastY = pVIPointsOut-&gt;at(nOutSize-1).nGetY();</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160; </div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;      pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg+1)-&gt;<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dGridCentroidXToExtCRSX(nLastX));</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg+1)-&gt;<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dGridCentroidYToExtCRSY(nLastY));</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;   }</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160; </div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;   <span class="keywordflow">if</span> (pVIPointsOut-&gt;size() &lt; 3)</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;   {</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      <span class="comment">// For shore platform coastline-normal profiles, we cannot have very short normal profiles with less than 3 cells, since we cannot calculate along-profile slope properly for such short profiles</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      bTooShort = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      pProfile-&gt;<a class="code" href="class_c_geom_profile.html#afef14f6eea8432a83715ec8eb68eac14">SetTooShort</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160; </div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; is invalid, is too short, only &quot;</span> &lt;&lt; pVIPointsOut-&gt;size() &lt;&lt; <span class="stringliteral">&quot; points, HitLand?&quot;</span> &lt;&lt; bHitLand &lt;&lt; <span class="stringliteral">&quot;. From [&quot;</span> &lt;&lt; pVIPointsOut-&gt;at(0).nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; pVIPointsOut-&gt;at(0).nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(pVIPointsOut-&gt;at(0).nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(pVIPointsOut-&gt;at(0).nGetY()) &lt;&lt; <span class="stringliteral">&quot;} to [&quot;</span> &lt;&lt; pVIPointsOut-&gt;at(pVIPointsOut-&gt;size()-1).nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; pVIPointsOut-&gt;at(pVIPointsOut-&gt;size()-1).nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(pVIPointsOut-&gt;at(pVIPointsOut-&gt;size()-1).nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(pVIPointsOut-&gt;at(pVIPointsOut-&gt;size()-1).nGetY()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;   }</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;}</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160; </div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160; </div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment"> Merges two profiles which intersect at their final (most seaward) line segments, seaward of their point of intersection</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="keywordtype">void</span> CSimulation::MergeProfilesAtFinalLineSegments(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nFirstProfile, <span class="keywordtype">int</span> <span class="keyword">const</span> nSecondProfile, <span class="keywordtype">int</span> <span class="keyword">const</span> nFirstProfileLineSegments, <span class="keywordtype">int</span> <span class="keyword">const</span> nSecondProfileLineSegments, <span class="keywordtype">double</span> <span class="keyword">const</span> dIntersectX, <span class="keywordtype">double</span> <span class="keyword">const</span> dIntersectY, <span class="keywordtype">double</span> <span class="keyword">const</span> dAvgEndX, <span class="keywordtype">double</span> <span class="keyword">const</span> dAvgEndY)</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;{</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;   <span class="comment">// The point of intersection is on the final (most seaward) line segment of both profiles. Put together a vector of coincident profile numbers (with no duplicates) for both profiles</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;   <span class="keywordtype">int</span> nCombinedLastSeg = 0;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;   vector&lt;pair&lt;int, int&gt; &gt;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      prVCombinedProfilesCoincidentProfilesLastSeg;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pFirstProfile = m_VCoast[nCoast].pGetProfile(nFirstProfile);</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pSecondProfile = m_VCoast[nCoast].pGetProfile(nSecondProfile);</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160; </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n = 0; n &lt; pFirstProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ab0146cd34539f41588924571dbfb2054">pprVGetPairedCoincidentProfilesForLineSegment</a>(nFirstProfileLineSegments-1)-&gt;size(); n++)</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;   {</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      pair&lt;int, int&gt; prTmp;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;      prTmp.first = pFirstProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ab0146cd34539f41588924571dbfb2054">pprVGetPairedCoincidentProfilesForLineSegment</a>(nFirstProfileLineSegments-1)-&gt;at(n).first;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      prTmp.second = pFirstProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ab0146cd34539f41588924571dbfb2054">pprVGetPairedCoincidentProfilesForLineSegment</a>(nFirstProfileLineSegments-1)-&gt;at(n).second;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160; </div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      <span class="keywordtype">bool</span> bFound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m = 0; m &lt; prVCombinedProfilesCoincidentProfilesLastSeg.size(); m++)</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      {</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;         <span class="keywordflow">if</span> (prVCombinedProfilesCoincidentProfilesLastSeg[m].first == prTmp.first)</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;         {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            bFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;         }</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      }</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160; </div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      <span class="keywordflow">if</span> (! bFound)</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      {</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;         prVCombinedProfilesCoincidentProfilesLastSeg.push_back(prTmp);</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;         nCombinedLastSeg++;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      }</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;   }</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160; </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n = 0; n &lt; pSecondProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ab0146cd34539f41588924571dbfb2054">pprVGetPairedCoincidentProfilesForLineSegment</a>(nSecondProfileLineSegments-1)-&gt;size(); n++)</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;   {</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      pair&lt;int, int&gt; prTmp;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      prTmp.first = pSecondProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ab0146cd34539f41588924571dbfb2054">pprVGetPairedCoincidentProfilesForLineSegment</a>(nSecondProfileLineSegments-1)-&gt;at(n).first;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      prTmp.second = pSecondProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ab0146cd34539f41588924571dbfb2054">pprVGetPairedCoincidentProfilesForLineSegment</a>(nSecondProfileLineSegments-1)-&gt;at(n).second;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160; </div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      <span class="keywordtype">bool</span> bFound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m = 0; m &lt; prVCombinedProfilesCoincidentProfilesLastSeg.size(); m++)</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      {</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;         <span class="keywordflow">if</span> (prVCombinedProfilesCoincidentProfilesLastSeg[m].first == prTmp.first)</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;         {</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;            bFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;         }</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      }</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160; </div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      <span class="keywordflow">if</span> (! bFound)</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;      {</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;         prVCombinedProfilesCoincidentProfilesLastSeg.push_back(prTmp);</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;         nCombinedLastSeg++;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      }</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;   }</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160; </div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;   <span class="comment">// Increment the number of each line segment</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt; nCombinedLastSeg; m++)</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      prVCombinedProfilesCoincidentProfilesLastSeg[m].second++;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160; </div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;   vector&lt;pair&lt;int, int&gt; &gt;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      prVFirstProfileCoincidentProfilesLastSeg = *pFirstProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ab0146cd34539f41588924571dbfb2054">pprVGetPairedCoincidentProfilesForLineSegment</a>(nFirstProfileLineSegments-1),</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      prVSecondProfileCoincidentProfilesLastSeg = *pSecondProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ab0146cd34539f41588924571dbfb2054">pprVGetPairedCoincidentProfilesForLineSegment</a>(nSecondProfileLineSegments-1);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;      nNumFirstProfileCoincidentProfilesLastSeg = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(prVFirstProfileCoincidentProfilesLastSeg.size()),</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      nNumSecondProfileCoincidentProfilesLastSeg = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(prVSecondProfileCoincidentProfilesLastSeg.size());</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160; </div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment">//   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: END-SEGMENT INTERSECTION between profiles {&quot; &lt;&lt; nFirstProfile &lt;&lt; &quot;} and {&quot; &lt;&lt; nSecondProfile &lt;&lt; &quot;} at line segment &quot; &lt;&lt; nFirstProfileLineSegments-1 &lt;&lt; &quot;/&quot; &lt;&lt; nFirstProfileLineSegments-1 &lt;&lt; &quot;, and line segment &quot; &lt;&lt; nSecondProfileLineSegments-1 &lt;&lt; &quot;/&quot; &lt;&lt; nSecondProfileLineSegments-1 &lt;&lt; &quot;, respectively. Both truncated at [&quot; &lt;&lt; dIntersectX &lt;&lt; &quot;, &quot; &lt;&lt; dIntersectY &lt;&lt; &quot;] then profiles {&quot; &lt;&lt; nFirstProfile &lt;&lt; &quot;} and {&quot; &lt;&lt; nSecondProfile &lt;&lt; &quot;} extended to [&quot; &lt;&lt; dAvgEndX &lt;&lt; &quot;, &quot; &lt;&lt; dAvgEndY &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160; </div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;   <span class="comment">// Truncate the first profile, and all co-incident profiles, at the point of intersection</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nNumFirstProfileCoincidentProfilesLastSeg; n++)</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;   {</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      <span class="keywordtype">int</span> nThisProfile = prVFirstProfileCoincidentProfilesLastSeg[n].first;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pThisProfile = m_VCoast[nCoast].pGetProfile(nThisProfile);</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <span class="keywordtype">int</span> nProfileLength = pThisProfile-&gt;<a class="code" href="class_c_geom_profile.html#abaf88697019588a2b0901bd19044aee4">nGetProfileSize</a>();</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160; </div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      <span class="comment">// NOTE this is the final line segment of the first &#39;main&#39; profile. We are assuming that it is also the final line segment of all co-incident profiles. This is fine, altho&#39; each profile may well have a different number of line segments landwards i.e. the number of the line segment may be different for each co-incident profile</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      pThisProfile-&gt;<a class="code" href="class_c_geom_profile.html#ab9adb1e70e847258501607c9b1330d18">SetPointInProfile</a>(nProfileLength-1, dIntersectX, dIntersectY);</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;   }</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160; </div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;   <span class="comment">// Truncate the second profile, and all co-incident profiles, at the point of intersection</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nNumSecondProfileCoincidentProfilesLastSeg; n++)</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;   {</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <span class="keywordtype">int</span> nThisProfile = prVSecondProfileCoincidentProfilesLastSeg[n].first;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pThisProfile = m_VCoast[nCoast].pGetProfile(nThisProfile);</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <span class="keywordtype">int</span> nProfileLength = pThisProfile-&gt;<a class="code" href="class_c_geom_profile.html#abaf88697019588a2b0901bd19044aee4">nGetProfileSize</a>();</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160; </div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      <span class="comment">// NOTE this is the final line segment of the second &#39;main&#39; profile. We are assuming that it is also the final line segment of all co-incident profiles. This is fine, altho&#39; each profile may well have a different number of line segments landwards i.e. the number of the line segment may be different for each co-incident profile</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      pThisProfile-&gt;<a class="code" href="class_c_geom_profile.html#ab9adb1e70e847258501607c9b1330d18">SetPointInProfile</a>(nProfileLength-1, dIntersectX, dIntersectY);</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;   }</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160; </div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;   <span class="comment">// Append a new straight line segment to the existing line segment(s) of the first profile, and to all co-incident profiles</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nThisLineSeg = 0; nThisLineSeg &lt; nNumFirstProfileCoincidentProfilesLastSeg; nThisLineSeg++)</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;   {</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      <span class="keywordtype">int</span> nThisProfile = prVFirstProfileCoincidentProfilesLastSeg[nThisLineSeg].first;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pThisProfile = m_VCoast[nCoast].pGetProfile(nThisProfile);</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160; </div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      <span class="comment">// Update this profile</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;      pThisProfile-&gt;<a class="code" href="class_c_geom_profile.html#a19aac71e045a17e2c6d98f020f2319fa">AppendPointInProfile</a>(dAvgEndX, dAvgEndY);</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160; </div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      <span class="comment">// Append details of the combined profiles</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;      pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a3f99a9c2ac66b75c432941ec88fc8538">AppendLineSegment</a>();</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt; nCombinedLastSeg; m++)</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;         pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a679d5893191ff6dc5ab6b9acd1f5c770">AppendCoincidentProfileToLineSegments</a>(prVCombinedProfilesCoincidentProfilesLastSeg[m]);</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;   }</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160; </div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;   <span class="comment">// Append a new straight line segment to the existing line segment(s) of the second profile, and to all co-incident profiles</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nThisLineSeg = 0; nThisLineSeg &lt; nNumSecondProfileCoincidentProfilesLastSeg; nThisLineSeg++)</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;   {</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      <span class="keywordtype">int</span> nThisProfile = prVSecondProfileCoincidentProfilesLastSeg[nThisLineSeg].first;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pThisProfile = m_VCoast[nCoast].pGetProfile(nThisProfile);</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160; </div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      <span class="comment">// Update this profile</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;      pThisProfile-&gt;<a class="code" href="class_c_geom_profile.html#a19aac71e045a17e2c6d98f020f2319fa">AppendPointInProfile</a>(dAvgEndX, dAvgEndY);</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160; </div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      <span class="comment">// Append details of the combined profiles</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a3f99a9c2ac66b75c432941ec88fc8538">AppendLineSegment</a>();</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt; nCombinedLastSeg; m++)</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;         pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a679d5893191ff6dc5ab6b9acd1f5c770">AppendCoincidentProfileToLineSegments</a>(prVCombinedProfilesCoincidentProfilesLastSeg[m]);</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;   }</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160; </div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160; </div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;   <span class="comment">// START: FOR CHECKING PURPOSES ****************************************************************</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="comment">//    int nFirstProfileLineSeg= pFirstProfile-&gt;nGetNumLineSegments();</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="comment">//    int nSecondProfileLineSeg = pSecondProfile-&gt;nGetNumLineSegments();</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment">//    LogStream &lt;&lt; &quot;\tProfile {&quot; &lt;&lt; nFirstProfile &lt;&lt; &quot;} now has &quot; &lt;&lt; nFirstProfileLineSeg &lt;&lt; &quot; line segments&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">//    for (int m = 0; m &lt; nFirstProfileLineSeg; m++)</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment">//       vector&lt;pair&lt;int, int&gt; &gt; prVCoincidentProfiles = *pFirstProfile-&gt;pprVGetPairedCoincidentProfilesForLineSegment(m);</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tCo-incident profiles and line segments for line segment &quot; &lt;&lt; m &lt;&lt; &quot; of profile {&quot; &lt;&lt; nFirstProfile &lt;&lt; &quot;} are {&quot;;</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment">//       for (int nn = 0; nn &lt; prVCoincidentProfiles.size(); nn++)</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot; &quot; &lt;&lt; prVCoincidentProfiles[nn].first &lt;&lt; &quot;[&quot; &lt;&lt; prVCoincidentProfiles[nn].second &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot; }&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment">//    LogStream &lt;&lt; &quot;\tProfile {&quot; &lt;&lt; nSecondProfile &lt;&lt; &quot;} now has &quot; &lt;&lt; nSecondProfileLineSeg &lt;&lt; &quot; line segments&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment">//    for (int m = 0; m &lt; nSecondProfileLineSeg; m++)</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="comment">//       vector&lt;pair&lt;int, int&gt; &gt; prVCoincidentProfiles = *pSecondProfile-&gt;pprVGetPairedCoincidentProfilesForLineSegment(m);</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tCo-incident profiles and line segments for line segment &quot; &lt;&lt; m &lt;&lt; &quot; of profile {&quot; &lt;&lt; nSecondProfile &lt;&lt; &quot;} are {&quot;;</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="comment">//       for (int nn = 0; nn &lt; prVCoincidentProfiles.size(); nn++)</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot; &quot; &lt;&lt; prVCoincidentProfiles[nn].first &lt;&lt; &quot;[&quot; &lt;&lt; prVCoincidentProfiles[nn].second &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot; }&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;   <span class="comment">// END: FOR CHECKING PURPOSES ******************************************************************</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;}</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160; </div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160; </div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment"> Truncates one intersecting profile at the point of intersection, and retains the other profile</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="keywordtype">void</span> CSimulation::TruncateOneProfileRetainOtherProfile(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileToTruncate, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileToRetain, <span class="keywordtype">double</span> <span class="keyword">const</span> dIntersectX, <span class="keywordtype">double</span> <span class="keyword">const</span> dIntersectY, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileToTruncateIntersectLineSeg, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileToRetainIntersectLineSeg, <span class="keywordtype">bool</span> <span class="keyword">const</span> bAlreadyPresent)</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;{</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;   <span class="comment">// Insert the intersection point into the main retain-profile if it is not already in the profile, and do the same for all co-incident profiles of the main retain-profile. Also add details of the to-truncate profile (and all its coincident profiles) to every line segment of the main to-retain profile which is seaward of the point of intersection</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;   <span class="keywordtype">int</span> nRet = nInsertPointIntoProfilesIfNeededThenUpdate(nCoast, nProfileToRetain, dIntersectX, dIntersectY, nProfileToRetainIntersectLineSeg, nProfileToTruncate, nProfileToTruncateIntersectLineSeg, bAlreadyPresent);</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;   <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;   {</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: error in nInsertPointIntoProfilesIfNeededThenUpdate()&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;   }</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160; </div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;   <span class="comment">// Get all profile points of the main retain-profile seawards from the intersection point, and do the same for the corresponding line segments (including coincident profiles). This also includes details of the main to-truncate profile (and all its coincident profiles)</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pProfileToRetain = m_VCoast[nCoast].pGetProfile(nProfileToRetain);</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;   vector&lt;CGeom2DPoint&gt; PtVProfileLastPart;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;   vector&lt;vector&lt;pair&lt;int, int&gt; &gt; &gt; prVLineSegLastPart;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;   <span class="keywordflow">if</span> (bAlreadyPresent)</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;   {</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      PtVProfileLastPart = pProfileToRetain-&gt;<a class="code" href="class_c_geom_profile.html#a72b3263ad5f64527b4c21307139b3c5f">PtVGetThisPointAndAllAfter</a>(nProfileToRetainIntersectLineSeg);</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;      prVLineSegLastPart = pProfileToRetain-&gt;<a class="code" href="class_c_geom_multi_line.html#a66541bcbd102c19829637e60f8fe7860">prVVGetAllLineSegAfter</a>(nProfileToRetainIntersectLineSeg);</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;   }</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;   {</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;      PtVProfileLastPart = pProfileToRetain-&gt;<a class="code" href="class_c_geom_profile.html#a72b3263ad5f64527b4c21307139b3c5f">PtVGetThisPointAndAllAfter</a>(nProfileToRetainIntersectLineSeg+1);</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;      prVLineSegLastPart = pProfileToRetain-&gt;<a class="code" href="class_c_geom_multi_line.html#a66541bcbd102c19829637e60f8fe7860">prVVGetAllLineSegAfter</a>(nProfileToRetainIntersectLineSeg+1);</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;   }</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160; </div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">//    assert(PtVProfileLastPart.size() &gt; 1);</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment">//    assert(prVLineSegLastPart.size() &gt; 0);</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160; </div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;   <span class="comment">// Truncate the truncate-profile at the point of intersection, and do the same for all its co-incident profiles. Then append the profile points of the main to-retain profile seaward from the intersection point, and do the same for the corresponding line segments (including coincident profiles)</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;   TruncateProfileAndAppendNew(nCoast, nProfileToTruncate, nProfileToTruncateIntersectLineSeg, &amp;PtVProfileLastPart, &amp;prVLineSegLastPart);</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160; </div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">//    assert(m_VCoast[nCoast].pGetProfile(nProfileToTruncate)-&gt;nGetProfileSize() &gt; 1);</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment">//    assert(pProfileToRetain-&gt;nGetNumLineSegments() &gt; 0);</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment">//    assert(m_VCoast[nCoast].pGetProfile(nProfileToTruncate)-&gt;nGetNumLineSegments() &gt; 0);</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;}</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160; </div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160; </div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment"> Inserts an intersection point into the profile that is to be retained, if that point is not already present in the profile, then does the same for all co-incident profiles. Finally adds the numbers of the to-truncate profile (and all its coincident profiles) to the seaward line segments of the to-retain profile and all its coincident profiles</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="keywordtype">int</span> CSimulation::nInsertPointIntoProfilesIfNeededThenUpdate(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nMainProfile, <span class="keywordtype">double</span> <span class="keyword">const</span> dIntersectX, <span class="keywordtype">double</span> <span class="keyword">const</span> dIntersectY, <span class="keywordtype">int</span> <span class="keyword">const</span> nMainProfileIntersectLineSeg, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileToTruncate, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileToTruncateIntersectLineSeg, <span class="keywordtype">bool</span> <span class="keyword">const</span> bAlreadyPresent)</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;{</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;   <span class="comment">// START: FOR CHECKING PURPOSES ****************************************************************</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;   <span class="comment">// Get the index numbers of all coincident profiles for the &#39;main&#39; to-retain profile for the line segment in which intersection occurred</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">//    vector&lt;pair&lt;int, int&gt; &gt; prVRetainCoincidentProfilesCHECK1 = *m_VCoast[nCoast].pGetProfile(nMainProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(nMainProfileIntersectLineSeg);</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">//    int nNumRetainCoincidentCHECK1 = prVRetainCoincidentProfilesCHECK1.size();</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment">//    for (int nn = 0; nn &lt; nNumRetainCoincidentCHECK1; nn++)</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment">//       int nThisProfile = prVRetainCoincidentProfilesCHECK1[nn].first;</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tBEFORE nInsertPointIntoProfilesIfNeededThenUpdate(): &quot; &lt;&lt; (nThisProfile == nMainProfile ? &quot;MAIN&quot; : &quot;COINCIDENT&quot;) &lt;&lt; &quot; to-retain profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} has &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize() &lt;&lt; &quot; points &quot;;</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment">//       for (int nn = 0; nn &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize(); nn++)</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;[&quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nn)-&gt;dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nn)-&gt;dGetY() &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;), and &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumLineSegments() &lt;&lt; &quot; line segments, co-incident profiles and their line segments are &quot;;</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="comment">//       for (int mm = 0; mm &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumLineSegments(); mm++)</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="comment">//          vector&lt;pair&lt;int, int&gt; &gt; prVTmp = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(mm);</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;{ &quot;;</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="comment">//          for (int nn = 0; nn &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumCoincidentProfilesInLineSegment(mm); nn++)</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="comment">//             LogStream &lt;&lt; prVTmp[nn].first &lt;&lt; &quot;[&quot; &lt;&lt; prVTmp[nn].second &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;} &quot;;</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="comment">//       LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment">//       for (int nPoint = 0; nPoint &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize()-1; nPoint++)</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment">//          CGeom2DPoint</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="comment">//             Pt1 = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nPoint),</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="comment">//             Pt2 = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nPoint+1);</span></div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="comment">//          if (Pt1 == Pt2)</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: IDENTICAL POINTS before changes, in profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} points = &quot; &lt;&lt; nPoint &lt;&lt; &quot; and &quot; &lt;&lt; nPoint+1 &lt;&lt; endl;</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment">//    // Get the index numbers of all coincident profiles for the &#39;main&#39; to-truncate profile for the line segment in which intersection occurred</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment">//    vector&lt;pair&lt;int, int&gt; &gt; prVTruncateCoincidentProfilesCHECK1 = *m_VCoast[nCoast].pGetProfile(nProfileToTruncate)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(nProfileToTruncateIntersectLineSeg);</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment">//    int nNumTruncateCoincidentCHECK1 = prVTruncateCoincidentProfilesCHECK1.size();</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment">//    for (int nn = 0; nn &lt; nNumTruncateCoincidentCHECK1; nn++)</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">//       int nThisProfile = prVTruncateCoincidentProfilesCHECK1[nn].first;</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tBEFORE nInsertPointIntoProfilesIfNeededThenUpdate(): &quot; &lt;&lt; (nThisProfile == nProfileToTruncate ? &quot;MAIN&quot; : &quot;COINCIDENT&quot;) &lt;&lt; &quot; to-truncate profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} has &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize() &lt;&lt; &quot; points &quot;;</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">//       for (int nn = 0; nn &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize(); nn++)</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;[&quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nn)-&gt;dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nn)-&gt;dGetY() &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;), and &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumLineSegments() &lt;&lt; &quot; line segments, co-incident profiles and their line segments are &quot;;</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment">//       for (int mm = 0; mm &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumLineSegments(); mm++)</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment">//          vector&lt;pair&lt;int, int&gt; &gt; prVTmp = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(mm);</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;{ &quot;;</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment">//          for (int nn = 0; nn &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumCoincidentProfilesInLineSegment(mm); nn++)</span></div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">//             LogStream &lt;&lt; prVTmp[nn].first &lt;&lt; &quot;[&quot; &lt;&lt; prVTmp[nn].second &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;} &quot;;</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">//       LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">//       for (int nPoint = 0; nPoint &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize()-1; nPoint++)</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">//          CGeom2DPoint</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">//             Pt1 = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nPoint),</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">//             Pt2 = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nPoint+1);</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment">//          if (Pt1 == Pt2)</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: IDENTICAL POINTS before changes, in profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} points = &quot; &lt;&lt; nPoint &lt;&lt; &quot; and &quot; &lt;&lt; nPoint+1 &lt;&lt; endl;</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;   <span class="comment">// END: FOR CHECKING PURPOSES ******************************************************************</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;   <span class="comment">// Get the index numbers of all coincident profiles for the &#39;main&#39; to-retain profile for the line segment in which intersection occurs</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;   vector&lt;pair&lt;int, int&gt; &gt; prVCoincidentProfiles = *m_VCoast[nCoast].pGetProfile(nMainProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(nMainProfileIntersectLineSeg);</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;   <span class="keywordtype">int</span> nNumCoincident = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(prVCoincidentProfiles.size());</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;   vector&lt;int&gt; nLineSegAfterIntersect(nNumCoincident, -1);           <span class="comment">// The line segment after the point of intersection, for each co-incident profile</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160; </div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;   <span class="comment">// Do this for the main profile and all profiles which are co-incident for this line segment</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = 0; nn &lt; nNumCoincident; nn++)</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;   {</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;         nThisProfile = prVCoincidentProfiles[nn].first,             <span class="comment">// The number of this profile</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;         nThisLineSeg = prVCoincidentProfiles[nn].second;            <span class="comment">// The line segment of this profile</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;      <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pThisProfile = m_VCoast[nCoast].pGetProfile(nThisProfile);</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;      <span class="comment">// Is the intersection point already present in the to-retain profile?</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      <span class="keywordflow">if</span> (! bAlreadyPresent)</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      {</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;         <span class="comment">// It is not already present, so insert it and also update the associated multi-line</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;         <span class="keywordflow">if</span> (! pThisProfile-&gt;<a class="code" href="class_c_geom_profile.html#a7928f1a673869c0fa0bef5ff894d75c2">bInsertIntersection</a>(dIntersectX, dIntersectY, nThisLineSeg))</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;         {</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;            <span class="comment">// Error</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;            <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code" href="cme_8h.html#aefc63c4bde02ca170b0e7bd038ba7702">WARN</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: cannot insert a line segment after the final line segment (&quot;</span> &lt;&lt; nThisLineSeg &lt;&lt; <span class="stringliteral">&quot;) for &quot;</span> &lt;&lt; (nThisProfile == nMainProfile ? <span class="stringliteral">&quot;main&quot;</span> : <span class="stringliteral">&quot;co-incident&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; profile (&quot;</span> &lt;&lt; nThisProfile &lt;&lt; <span class="stringliteral">&quot;), abandoning&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160; </div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#ae67ac38149ef18c0ae071e57b3464ad5">RTN_ERR_CANNOT_INSERT_POINT</a>;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;         }</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160; </div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;\tIntersection point NOT already in &quot; &lt;&lt; (nThisProfile == nMainProfile ? &quot;main&quot; : &quot;co-incident&quot;) &lt;&lt; &quot; profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;}, inserted it as point &quot; &lt;&lt; nThisLineSeg+1 &lt;&lt; endl;</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      }</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;      <span class="comment">// Get the line segment after intersection</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;      nLineSegAfterIntersect[nn] = nThisLineSeg+1;</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;   }</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160; </div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;<span class="comment">//    for (int nn = 0; nn &lt; nNumCoincident; nn++)</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tFor profile {&quot; &lt;&lt; prVCoincidentProfiles[nn].first &lt;&lt; &quot;} line segment [&quot; &lt;&lt; nLineSegAfterIntersect[nn] &lt;&lt; &quot;] is immediately after the intersection point&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160; </div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;   <span class="comment">// Get the coincident profiles for the to-truncate profile, at the line segment where intersection occurs</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;   vector&lt;pair&lt;int, int&gt; &gt; prVToTruncateCoincidentProfiles = *m_VCoast[nCoast].pGetProfile(nProfileToTruncate)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(nProfileToTruncateIntersectLineSeg);</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;   <span class="keywordtype">int</span> nNumToTruncateCoincident = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(prVToTruncateCoincidentProfiles.size());</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160; </div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;   <span class="comment">// Now add the number of the to-truncate profile, and all its coincident profiles, to all line segments which are seaward of the point of intersection. Do this for the main profile and all profiles which are co-incident for this line segment</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = 0; nn &lt; nNumCoincident; nn++)</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;   {</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      <span class="keywordtype">int</span> nThisProfile = prVCoincidentProfiles[nn].first;             <span class="comment">// The number of this profile</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pThisProfile = m_VCoast[nCoast].pGetProfile(nThisProfile);</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160; </div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      <span class="comment">// Get the number of line segments for this to-retain profile (will have just increased, if we just inserted a point)</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <span class="keywordtype">int</span> nNumLineSegs = pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ae22f845fd065108959610678de571cdb">nGetNumLineSegments</a>();</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160; </div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      <span class="comment">// Do for all line segments seaward of the point of intersection</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nLineSeg = nLineSegAfterIntersect[nn], nIncr = 0; nLineSeg &lt; nNumLineSegs; nLineSeg++, nIncr++)</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      {</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="comment">//         LogStream &lt;&lt; &quot;\tnThisProfile = &quot; &lt;&lt; nThisProfile &lt;&lt; &quot; nThisLineSeg = &quot; &lt;&lt; nThisLineSeg &lt;&lt; &quot; nLineSeg = &quot; &lt;&lt; nLineSeg &lt;&lt; &quot; nNumLineSegs = &quot; &lt;&lt; nNumLineSegs &lt;&lt; endl;</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160; </div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;         <span class="comment">// Have no idea how this can happen, but check for the moment</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment">//          if (nThisProfile == nProfileToTruncate)</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="comment">//          {</span></div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="comment">//             LogStream &lt;&lt; &quot;\t*** ERROR nThisProfile = &quot; &lt;&lt; nThisProfile &lt;&lt; &quot; nProfileToTruncate = &quot; &lt;&lt; nProfileToTruncate &lt;&lt; &quot;, ignoring&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment">//             continue;</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="comment">//          }</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160; </div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;         <span class="comment">// Add the number of the to-truncate profile, and all its coincident profiles, to this line segment</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt; nNumToTruncateCoincident; m++)</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;         {</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;               nProfileToAdd = prVToTruncateCoincidentProfiles[m].first,</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;               nProfileToAddLineSeg = prVToTruncateCoincidentProfiles[m].second;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160; </div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment">//            LogStream &lt;&lt; &quot;\tAdding &quot; &lt;&lt; (nProfileToAdd == nProfileToTruncate ? &quot;main&quot; : &quot;co-incident&quot;) &lt;&lt; &quot; truncate-profile number {&quot; &lt;&lt; nProfileToAdd &lt;&lt; &quot;}, line segment [&quot; &lt;&lt; nProfileToAddLineSeg + nIncr &lt;&lt; &quot;] to line segment &quot; &lt;&lt; nLineSeg &lt;&lt; &quot; of &quot; &lt;&lt; (nThisProfile == nMainProfile ? &quot;main&quot; : &quot;co-incident&quot;) &lt;&lt; &quot; to-retain profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160; </div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;            pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#add6b741fa71f3eae355876dcc4232ec8">AddCoincidentProfileToExistingLineSegment</a>(nLineSeg, nProfileToAdd, nProfileToAddLineSeg + nIncr);</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;         }</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      }</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;   }</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160; </div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160; </div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;   <span class="comment">// START: FOR CHECKING PURPOSES ****************************************************************</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;   <span class="comment">// Get the index numbers of all coincident profiles for the &#39;main&#39; profile for the line segment in which intersection occurred</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment">//    vector&lt;pair&lt;int, int&gt; &gt; prVCoincidentProfilesCHECK2 = *m_VCoast[nCoast].pGetProfile(nMainProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(nMainProfileIntersectLineSeg);</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">//    int nNumCoincidentCHECK2 = prVCoincidentProfilesCHECK2.size();</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment">//    for (int nn = 0; nn &lt; nNumCoincidentCHECK2; nn++)</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">//       int nThisProfile = prVCoincidentProfilesCHECK2[nn].first;</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tAFTER nInsertPointIntoProfilesIfNeededThenUpdate(): &quot; &lt;&lt; (nThisProfile == nMainProfile ? &quot;MAIN&quot; : &quot;COINCIDENT&quot;) &lt;&lt; &quot; to-retain profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} has &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize() &lt;&lt; &quot; points &quot;;</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">//       for (int nn = 0; nn &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize(); nn++)</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;[&quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nn)-&gt;dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nn)-&gt;dGetY() &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;), and &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumLineSegments() &lt;&lt; &quot; line segments, co-incident profiles and their line segments are &quot;;</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment">//       for (int nLineSeg = 0; nLineSeg &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumLineSegments(); nLineSeg++)</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment">//          vector&lt;pair&lt;int, int&gt; &gt; prVTmp = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(nLineSeg);</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;{ &quot;;</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment">//          for (int nn = 0; nn &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumCoincidentProfilesInLineSegment(nLineSeg); nn++)</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">//             LogStream &lt;&lt; prVTmp[nn].first &lt;&lt; &quot;[&quot; &lt;&lt; prVTmp[nn].second &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;} &quot;;</span></div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="comment">//       LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="comment">//       for (int nPoint = 0; nPoint &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize()-1; nPoint++)</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment">//          CGeom2DPoint</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="comment">//             Pt1 = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nPoint),</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="comment">//             Pt2 = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nPoint+1);</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="comment">//          if (Pt1 == Pt2)</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: IDENTICAL POINTS before changes, in profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} points = &quot; &lt;&lt; nPoint &lt;&lt; &quot; and &quot; &lt;&lt; nPoint+1 &lt;&lt; endl;</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;   <span class="comment">// END: FOR CHECKING PURPOSES ******************************************************************</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160; </div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;}</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160; </div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160; </div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment"> Truncate a profile at the point of intersection, and do the same for all its co-incident profiles</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="keywordtype">void</span> CSimulation::TruncateProfileAndAppendNew(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nMainProfile, <span class="keywordtype">int</span> <span class="keyword">const</span> nMainProfileIntersectLineSeg, vector&lt;CGeom2DPoint&gt; <span class="keyword">const</span>* pPtVProfileLastPart, vector&lt;vector&lt;pair&lt;int, int&gt; &gt; &gt; <span class="keyword">const</span>* pprVLineSegLastPart)</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;{</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;   <span class="comment">// START: FOR CHECKING PURPOSES ****************************************************************</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;   <span class="comment">// Get the index numbers of all coincident profiles for the &#39;main&#39; profile for the line segment in which intersection occurred</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment">//    vector&lt;pair&lt;int, int&gt; &gt; prVCoincidentProfilesCHECK1 = *m_VCoast[nCoast].pGetProfile(nMainProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(nMainProfileIntersectLineSeg);</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment">//    int nNumCoincidentCHECK1 = prVCoincidentProfilesCHECK1.size();</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment">//    LogStream &lt;&lt; &quot;\tTruncating profile {&quot; &lt;&lt; nMainProfile &lt;&lt; &quot;}, intersection is at [&quot; &lt;&lt; dIntersectX &lt;&lt; &quot;, &quot; &lt;&lt; dIntersectY &lt;&lt; &quot;] in line segment &quot; &lt;&lt; nMainProfileIntersectLineSeg &lt;&lt; endl;</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment">//    for (int nn = 0; nn &lt; nNumCoincidentCHECK1; nn++)</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment">//       int nThisProfile = prVCoincidentProfilesCHECK1[nn].first;</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tBEFORE TruncateProfileAndAppendNew(): &quot; &lt;&lt; (nThisProfile == nMainProfile ? &quot;MAIN&quot; : &quot;COINCIDENT&quot;) &lt;&lt; &quot; to-truncate profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} has &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize() &lt;&lt; &quot; points (&quot;;</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">//       for (int nn = 0; nn &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize(); nn++)</span></div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;[&quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nn)-&gt;dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nn)-&gt;dGetY() &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;), and &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumLineSegments() &lt;&lt; &quot; line segments, co-incident profiles are &quot;;</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="comment">//       for (int nLineSeg = 0; nLineSeg &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumLineSegments(); nLineSeg++)</span></div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">//          vector&lt;pair&lt;int, int&gt; &gt; prVTmp = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(nLineSeg);</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;{ &quot;;</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="comment">//          for (int nn = 0; nn &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumCoincidentProfilesInLineSegment(nLineSeg); nn++)</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="comment">//             LogStream &lt;&lt; prVTmp[nn].first &lt;&lt; &quot;[&quot; &lt;&lt; prVTmp[nn].second &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;} &quot;;</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="comment">//       LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment">//       for (int nPoint = 0; nPoint &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize()-1; nPoint++)</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="comment">//          CGeom2DPoint</span></div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="comment">//             Pt1 = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nPoint),</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="comment">//             Pt2 = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nPoint+1);</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">//          if (Pt1 == Pt2)</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: IDENTICAL POINTS before changes, in profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} points = &quot; &lt;&lt; nPoint &lt;&lt; &quot; and &quot; &lt;&lt; nPoint+1 &lt;&lt; endl;</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="comment">//    LogStream &lt;&lt; &quot;\tPart-profile to append is &quot;;</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">//    for (int mm = 0; mm &lt; pPtVProfileLastPart-&gt;size(); mm++)</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;[&quot; &lt;&lt; pPtVProfileLastPart-&gt;at(mm).dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; pPtVProfileLastPart-&gt;at(mm).dGetY() &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="comment">//    LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="comment">//    LogStream &lt;&lt; &quot;\tPart line-segment to append is &quot;;</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="comment">//    for (int mm = 0; mm &lt; pprVLineSegLastPart-&gt;size(); mm++)</span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="comment">//       vector&lt;pair&lt;int, int&gt; &gt; prVTmp = pprVLineSegLastPart-&gt;at(mm);</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;{ &quot;;</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="comment">//       for (int nn = 0; nn &lt; prVTmp.size(); nn++)</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment">//          LogStream &lt;&lt; prVTmp[nn].first &lt;&lt; &quot;[&quot; &lt;&lt; prVTmp[nn].second &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;} &quot;;</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="comment">//    LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;   <span class="comment">// END: FOR CHECKING PURPOSES ******************************************************************</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160; </div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160; </div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;   <span class="comment">// Get the index numbers of all coincident profiles for the &#39;main&#39; profile for the line segment in which intersection occurs</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;   vector&lt;pair&lt;int, int&gt; &gt; prVCoincidentProfiles = *m_VCoast[nCoast].pGetProfile(nMainProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(nMainProfileIntersectLineSeg);</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;   <span class="keywordtype">int</span> nNumCoincident = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(prVCoincidentProfiles.size());</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160; </div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = 0; nn &lt; nNumCoincident; nn++)</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;   {</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      <span class="comment">// Do this for the main to-truncate profile, and do the same for all its co-incident profiles</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;         nThisProfile = prVCoincidentProfiles[nn].first,</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;         nThisProfileLineSeg = prVCoincidentProfiles[nn].second;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pThisProfile = m_VCoast[nCoast].pGetProfile(nThisProfile);</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160; </div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment">//       if (nThisProfile == nMainProfile)</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;<span class="comment">//          assert(nThisProfileLineSeg == nMainProfileIntersectLineSeg);</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160; </div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="comment">// Truncate the profile</span></div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;<span class="comment">//      LogStream &lt;&lt; &quot;\tTruncating &quot; &lt;&lt; (nThisProfile == nMainProfile ? &quot;MAIN&quot; : &quot;COINCIDENT&quot;) &lt;&lt; &quot; to-truncate profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} at line segment &quot; &lt;&lt; nThisProfileLineSeg+1 &lt;&lt; endl;</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      pThisProfile-&gt;<a class="code" href="class_c_geom_profile.html#a0abde0df28990b1a8c20664d2bdcb07f">TruncateProfile</a>(nThisProfileLineSeg+1);</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160; </div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;      <span class="comment">// Reduce the number of line segments for this profile</span></div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;      pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a5b5c8a7d272d53dd98279480f7a6a976">TruncateLineSegments</a>(nThisProfileLineSeg+1);</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160; </div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      <span class="comment">// Append the profile points from the last part of the retain-profile</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mm = 0; mm &lt; pPtVProfileLastPart-&gt;size(); mm++)</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;      {</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;         <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> Pt = pPtVProfileLastPart-&gt;at(mm);</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;         pThisProfile-&gt;<a class="code" href="class_c_geom_profile.html#a19aac71e045a17e2c6d98f020f2319fa">AppendPointInProfile</a>(&amp;Pt);</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      }</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160; </div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      <span class="comment">// Append the line segments, and their co-incident profile numbers, from the last part of the retain-profile</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mm = 0; mm &lt; pprVLineSegLastPart-&gt;size(); mm++)</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      {</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;         vector&lt;pair&lt;int, int&gt; &gt; prVTmp = pprVLineSegLastPart-&gt;at(mm);</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160; </div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;         pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a3f99a9c2ac66b75c432941ec88fc8538">AppendLineSegment</a>(&amp;prVTmp);</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      }</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160; </div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      <span class="comment">// Fix the line seg numbers for this profile</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      vector&lt;int&gt;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;         nVProf,</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;         nVProfsLineSeg;</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nSeg = 0; nSeg &lt; pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#ae22f845fd065108959610678de571cdb">nGetNumLineSegments</a>(); nSeg++)</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;      {</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoinc = 0; nCoinc &lt; pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a3516022bd96ee15709653b3bb7cc0155">nGetNumCoincidentProfilesInLineSegment</a>(nSeg); nCoinc++)</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;         {</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;               nProf = pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a5682956da0d84c928fbafa6f4ff25201">nGetProf</a>(nSeg, nCoinc),</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;               nProfsLineSeg = pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#a0598f98c4103cde329147da13ded7c61">nGetProfsLineSeg</a>(nSeg, nCoinc);</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160; </div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;            <span class="keyword">auto</span> it = find(nVProf.begin(), nVProf.end(), nProf);</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;            <span class="keywordflow">if</span> (it == nVProf.end())</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;            {</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;               <span class="comment">// Not found</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;               nVProf.push_back(nProf);</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;               nVProfsLineSeg.push_back(nProfsLineSeg);</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;            }</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;            {</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;               <span class="comment">// Found</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;               <span class="keywordtype">int</span> nPos = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(it - nVProf.begin());</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;               <span class="keywordtype">int</span> nNewProfsLineSeg = nVProfsLineSeg[nPos];</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;               nNewProfsLineSeg++;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160; </div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;               nVProfsLineSeg[nPos] = nNewProfsLineSeg;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;               pThisProfile-&gt;<a class="code" href="class_c_geom_multi_line.html#aaf7c0ab9f64c31133be98ac87b114072">SetProfsLineSeg</a>(nSeg, nCoinc, nNewProfsLineSeg);</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;            }</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;         }</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;      }</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160; </div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;<span class="comment">//       assert(pThisProfile-&gt;nGetProfileSize() &gt; 1);</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;   }</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160; </div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160; </div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;   <span class="comment">// START: FOR CHECKING PURPOSES ****************************************************************</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;   <span class="comment">// Get the index numbers of all coincident profiles for the &#39;main&#39; to-truncate profile for the line segment in which intersection occurred</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="comment">//    vector&lt;pair&lt;int, int&gt; &gt; prVToTruncateCoincidentProfilesCHECK2 = *m_VCoast[nCoast].pGetProfile(nMainProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(nMainProfileIntersectLineSeg);</span></div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="comment">//    int nNumToTruncateCoincidentCHECK2 = prVToTruncateCoincidentProfilesCHECK2.size();</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="comment">//    for (int nn = 0; nn &lt; nNumToTruncateCoincidentCHECK2; nn++)</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;<span class="comment">//       int nThisProfile = prVToTruncateCoincidentProfilesCHECK2[nn].first;</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tAFTER TruncateProfileAndAppendNew(): &quot; &lt;&lt; (nThisProfile == nMainProfile ? &quot;MAIN&quot; : &quot;COINCIDENT&quot;) &lt;&lt; &quot; to-truncate profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} has &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize() &lt;&lt; &quot; points (&quot;;</span></div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="comment">//       for (int nn = 0; nn &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize(); nn++)</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;[&quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nn)-&gt;dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nn)-&gt;dGetY() &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;), and &quot; &lt;&lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumLineSegments() &lt;&lt; &quot; line segments, co-incident profiles are &quot;;</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;<span class="comment">//       for (int mm = 0; mm &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumLineSegments(); mm++)</span></div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="comment">//          vector&lt;pair&lt;int, int&gt; &gt; prVTmp = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pprVGetPairedCoincidentProfilesForLineSegment(mm);</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;{ &quot;;</span></div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="comment">//          for (int nn = 0; nn &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetNumCoincidentProfilesInLineSegment(mm); nn++)</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="comment">//             LogStream &lt;&lt; prVTmp[nn].first &lt;&lt; &quot;[&quot; &lt;&lt; prVTmp[nn].second &lt;&lt; &quot;] &quot;;</span></div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;} &quot;;</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="comment">//       LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="comment">//       for (int nPoint = 0; nPoint &lt; m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;nGetProfileSize()-1; nPoint++)</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="comment">//       {</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="comment">//          CGeom2DPoint</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="comment">//             Pt1 = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nPoint),</span></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;<span class="comment">//             Pt2 = *m_VCoast[nCoast].pGetProfile(nThisProfile)-&gt;pPtGetPointInProfile(nPoint+1);</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;<span class="comment">//          if (Pt1 == Pt2)</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: IDENTICAL POINTS before changes, in profile {&quot; &lt;&lt; nThisProfile &lt;&lt; &quot;} points = &quot; &lt;&lt; nPoint &lt;&lt; &quot; and &quot; &lt;&lt; nPoint+1 &lt;&lt; endl;</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="comment">//       }</span></div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;   <span class="comment">// END: FOR CHECKING PURPOSES ******************************************************************</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclass_c_geom_multi_line_html_a0598f98c4103cde329147da13ded7c61"><div class="ttname"><a href="class_c_geom_multi_line.html#a0598f98c4103cde329147da13ded7c61">CGeomMultiLine::nGetProfsLineSeg</a></div><div class="ttdeci">int nGetProfsLineSeg(int const, int const) const</div><div class="ttdoc">Returns the profile's own line segment, given a line segment and the index of the co-incident profile...</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00255">multi_line.cpp:255</a></div></div>
<div class="ttc" id="aclass_c_a2_d_shape_html_a20acae762de7cf6769eb938621f6a842"><div class="ttname"><a href="class_c_a2_d_shape.html#a20acae762de7cf6769eb938621f6a842">CA2DShape::pPtVGetPoints</a></div><div class="ttdeci">vector&lt; CGeom2DPoint &gt; * pPtVGetPoints(void)</div><div class="ttdef"><b>Definition:</b> <a href="2d__shape_8cpp_source.html#l00126">2d_shape.cpp:126</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a72b3263ad5f64527b4c21307139b3c5f"><div class="ttname"><a href="class_c_geom_profile.html#a72b3263ad5f64527b4c21307139b3c5f">CGeomProfile::PtVGetThisPointAndAllAfter</a></div><div class="ttdeci">vector&lt; CGeom2DPoint &gt; PtVGetThisPointAndAllAfter(int const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00245">profile.cpp:245</a></div></div>
<div class="ttc" id="acme_8h_html_a92f31bb0474b68983566237e1c9a0b8f"><div class="ttname"><a href="cme_8h.html#a92f31bb0474b68983566237e1c9a0b8f">ACCEPT_SHORT_PROFILES</a></div><div class="ttdeci">const bool ACCEPT_SHORT_PROFILES</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00160">cme.h:160</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html"><div class="ttname"><a href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with integer co-ordinates.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8h_source.html#l00029">2di_point.h:29</a></div></div>
<div class="ttc" id="acme_8h_html_a96e58f57ae0cc113e899eab923e8d395"><div class="ttname"><a href="cme_8h.html#a96e58f57ae0cc113e899eab923e8d395">LEFT_HANDED</a></div><div class="ttdeci">const int LEFT_HANDED</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00203">cme.h:203</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a7928f1a673869c0fa0bef5ff894d75c2"><div class="ttname"><a href="class_c_geom_profile.html#a7928f1a673869c0fa0bef5ff894d75c2">CGeomProfile::bInsertIntersection</a></div><div class="ttdeci">bool bInsertIntersection(double const, double const, int const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00197">profile.cpp:197</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html"><div class="ttname"><a href="class_c_geom2_d_point.html">CGeom2DPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with floating-point co-ordinates.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8h_source.html#l00029">2d_point.h:29</a></div></div>
<div class="ttc" id="acme_8h_html_a068017859403c0629d89f8d348f6c224"><div class="ttname"><a href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a></div><div class="ttdeci">T tMin(T a, T b)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00783">cme.h:783</a></div></div>
<div class="ttc" id="acme_8h_html_ad4c91de5db6eb59e27fe49d05080ca6b"><div class="ttname"><a href="cme_8h.html#ad4c91de5db6eb59e27fe49d05080ca6b">LF_CAT_INTERVENTION</a></div><div class="ttdeci">const int LF_CAT_INTERVENTION</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00230">cme.h:230</a></div></div>
<div class="ttc" id="acme_8h_html_a89311a98397f9d6967d2cb10d5152d77"><div class="ttname"><a href="cme_8h.html#a89311a98397f9d6967d2cb10d5152d77">TOLERANCE</a></div><div class="ttdeci">const double TOLERANCE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00462">cme.h:462</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_a1dff4e8adee61e6fe5c5062d6ba88f01"><div class="ttname"><a href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">CGeom2DPoint::SetY</a></div><div class="ttdeci">void SetY(double const)</div><div class="ttdoc">The double parameter sets a value for the CGeom2DIPoint object's Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00062">2d_point.cpp:62</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_a679d5893191ff6dc5ab6b9acd1f5c770"><div class="ttname"><a href="class_c_geom_multi_line.html#a679d5893191ff6dc5ab6b9acd1f5c770">CGeomMultiLine::AppendCoincidentProfileToLineSegments</a></div><div class="ttdeci">void AppendCoincidentProfileToLineSegments(pair&lt; int, int &gt; const)</div><div class="ttdoc">Appends a coincident profile pair to the CGeomMultiLine object's final line segment.</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00137">multi_line.cpp:137</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html"><div class="ttname"><a href="class_c_geom_profile.html">CGeomProfile</a></div><div class="ttdoc">Geometry class used to represent coast profile objects.</div><div class="ttdef"><b>Definition:</b> <a href="profile_8h_source.html#l00037">profile.h:37</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a6152817d6ec950e1474313ca9824da46"><div class="ttname"><a href="class_c_geom_profile.html#a6152817d6ec950e1474313ca9824da46">CGeomProfile::AppendCellInProfileExtCRS</a></div><div class="ttdeci">void AppendCellInProfileExtCRS(double const, double const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00410">profile.cpp:410</a></div></div>
<div class="ttc" id="acme_8h_html_a76a16f6df9c13923d6716d244bd47a76"><div class="ttname"><a href="cme_8h.html#a76a16f6df9c13923d6716d244bd47a76">RTN_ERR_BAD_INDEX</a></div><div class="ttdeci">const int RTN_ERR_BAD_INDEX</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00391">cme.h:391</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_adf6945cbe65da7210a2f5d49ef7f736e"><div class="ttname"><a href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">CGeomCell::bIsCoastline</a></div><div class="ttdeci">bool bIsCoastline(void) const</div><div class="ttdoc">Returns true if the cell is 'under' a coastline.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00176">cell.cpp:176</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_a66541bcbd102c19829637e60f8fe7860"><div class="ttname"><a href="class_c_geom_multi_line.html#a66541bcbd102c19829637e60f8fe7860">CGeomMultiLine::prVVGetAllLineSegAfter</a></div><div class="ttdeci">vector&lt; vector&lt; pair&lt; int, int &gt; &gt; &gt; prVVGetAllLineSegAfter(int const)</div><div class="ttdoc">Returns a vector of the line segments which succeed the specified line segment number.</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00120">multi_line.cpp:120</a></div></div>
<div class="ttc" id="acme_8h_html_a7b34b50ac1e09426c23c241109342f7f"><div class="ttname"><a href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a></div><div class="ttdeci">const int DIRECTION_DOWNCOAST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00197">cme.h:197</a></div></div>
<div class="ttc" id="acme_8h_html"><div class="ttname"><a href="cme_8h.html">cme.h</a></div><div class="ttdoc">This file contains global definitions for CoastalME.</div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a1d2e53161b9483dce3aaaf32d3287e51"><div class="ttname"><a href="class_c_geom_cell.html#a1d2e53161b9483dce3aaaf32d3287e51">CGeomCell::dGetDeepWaterWaveOrientation</a></div><div class="ttdeci">double dGetDeepWaterWaveOrientation(void) const</div><div class="ttdoc">Returns the deep water wave orientation on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00663">cell.cpp:663</a></div></div>
<div class="ttc" id="acme_8h_html_ac026ff30d27d6c48b3e3df84ce8c9aa5"><div class="ttname"><a href="cme_8h.html#ac026ff30d27d6c48b3e3df84ce8c9aa5">RTN_ERR_PROFILE_END_INSUFFICIENT_DEPTH</a></div><div class="ttdeci">const int RTN_ERR_PROFILE_END_INSUFFICIENT_DEPTH</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00379">cme.h:379</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a6f4767a0af009db7b04b3a160d6a2ef0"><div class="ttname"><a href="class_c_geom_cell.html#a6f4767a0af009db7b04b3a160d6a2ef0">CGeomCell::nGetProfile</a></div><div class="ttdeci">int nGetProfile(void) const</div><div class="ttdoc">If this cell is 'under' a coastline-normal profile, returns the number of the profile....</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00189">cell.cpp:189</a></div></div>
<div class="ttc" id="acreate__profiles_8cpp_html_ae04a8509dc0ab747823a37fe3bb91f26"><div class="ttname"><a href="create__profiles_8cpp.html#ae04a8509dc0ab747823a37fe3bb91f26">bCurvaturePairCompareDescending</a></div><div class="ttdeci">bool bCurvaturePairCompareDescending(const pair&lt; int, double &gt; &amp;prLeft, const pair&lt; int, double &gt; &amp;prRight)</div><div class="ttdef"><b>Definition:</b> <a href="create__profiles_8cpp_source.html#l00057">create_profiles.cpp:57</a></div></div>
<div class="ttc" id="acme_8h_html_a7e895b460cef877dec4d12ead0c74f15"><div class="ttname"><a href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a></div><div class="ttdeci">T tMax(T a, T b)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00772">cme.h:772</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a11548359d3db93535befcaf518468f64"><div class="ttname"><a href="class_c_geom_profile.html#a11548359d3db93535befcaf518468f64">CGeomProfile::SetEndOfCoast</a></div><div class="ttdeci">void SetEndOfCoast(bool const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00073">profile.cpp:73</a></div></div>
<div class="ttc" id="acme_8h_html_a2303d86363341c55f97e14a1066071e8"><div class="ttname"><a href="cme_8h.html#a2303d86363341c55f97e14a1066071e8">RTN_ERR_PROFILE_ENDPOINT_IS_INLAND</a></div><div class="ttdeci">const int RTN_ERR_PROFILE_ENDPOINT_IS_INLAND</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00377">cme.h:377</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_a5b5c8a7d272d53dd98279480f7a6a976"><div class="ttname"><a href="class_c_geom_multi_line.html#a5b5c8a7d272d53dd98279480f7a6a976">CGeomMultiLine::TruncateLineSegments</a></div><div class="ttdeci">void TruncateLineSegments(int const)</div><div class="ttdoc">Cuts short the number of line segments.</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00082">multi_line.cpp:82</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_a250f937d03cfdf6e0244b74ad2bf96a4"><div class="ttname"><a href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">CGeom2DPoint::dGetX</a></div><div class="ttdeci">double dGetX(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object's double X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00044">2d_point.cpp:44</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_ad253e6ede71402845e2ed5522a492efd"><div class="ttname"><a href="class_c_geom_profile.html#ad253e6ede71402845e2ed5522a492efd">CGeomProfile::SetDeepWaterWaveHeight</a></div><div class="ttdeci">void SetDeepWaterWaveHeight(double const)</div><div class="ttdoc">Set the deep-water wave height for this profile.</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00451">profile.cpp:451</a></div></div>
<div class="ttc" id="acme_8h_html_a6eb4dd0c67ed177ebe71b1c1adbe52ab"><div class="ttname"><a href="cme_8h.html#a6eb4dd0c67ed177ebe71b1c1adbe52ab">RIGHT_HANDED</a></div><div class="ttdeci">const int RIGHT_HANDED</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00202">cme.h:202</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_ad2c6f63894b9feea63d71d15932c0825"><div class="ttname"><a href="class_c_geom_cell.html#ad2c6f63894b9feea63d71d15932c0825">CGeomCell::bIsProfile</a></div><div class="ttdeci">bool bIsProfile(void) const</div><div class="ttdoc">Returns true if this cell is 'under' a coastline normal.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00195">cell.cpp:195</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_af84c687b2d0be01ab41cbcc0565f4f3f"><div class="ttname"><a href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">CGeom2DIPoint::nGetX</a></div><div class="ttdeci">int nGetX(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object's integer X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00044">2di_point.cpp:44</a></div></div>
<div class="ttc" id="acoast_8h_html"><div class="ttname"><a href="coast_8h.html">coast.h</a></div><div class="ttdoc">Contains CRWCoast definitions.</div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a4d89e6572d043fea4e19aaf251349c67"><div class="ttname"><a href="class_c_geom_profile.html#a4d89e6572d043fea4e19aaf251349c67">CGeomProfile::SetAllPointsInProfile</a></div><div class="ttdeci">void SetAllPointsInProfile(vector&lt; CGeom2DPoint &gt; const *)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00176">profile.cpp:176</a></div></div>
<div class="ttc" id="acme_8h_html_ad41fd6fa6c97a8a006f6f6e88b519e2a"><div class="ttname"><a href="cme_8h.html#ad41fd6fa6c97a8a006f6f6e88b519e2a">NUMBER_OF_INTERVENTION_CAPES</a></div><div class="ttdeci">const int NUMBER_OF_INTERVENTION_CAPES</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00181">cme.h:181</a></div></div>
<div class="ttc" id="aclass_c_simulation_html_a222962121613613a48f518e0c2110f21"><div class="ttname"><a href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">CSimulation::LogStream</a></div><div class="ttdeci">ofstream LogStream</div><div class="ttdef"><b>Definition:</b> <a href="simulation_8h_source.html#l00781">simulation.h:781</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_a216921dc2c592d9468e6430fee7c7719"><div class="ttname"><a href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">CGeom2DPoint::dGetY</a></div><div class="ttdeci">double dGetY(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object's double Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00050">2d_point.cpp:50</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_af5dfdef4b78c0703800049b064483278"><div class="ttname"><a href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">CGeom2DPoint::SetX</a></div><div class="ttdeci">void SetX(double const)</div><div class="ttdoc">The double parameter sets a value for the CGeom2DIPoint object's X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00056">2d_point.cpp:56</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a19aac71e045a17e2c6d98f020f2319fa"><div class="ttname"><a href="class_c_geom_profile.html#a19aac71e045a17e2c6d98f020f2319fa">CGeomProfile::AppendPointInProfile</a></div><div class="ttdeci">void AppendPointInProfile(double const, double const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00187">profile.cpp:187</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_ad03f0af5de19150fad5383f2e147c55e"><div class="ttname"><a href="class_c_geom_cell.html#ad03f0af5de19150fad5383f2e147c55e">CGeomCell::dGetDeepWaterWavePeriod</a></div><div class="ttdeci">double dGetDeepWaterWavePeriod(void) const</div><div class="ttdoc">Returns the deep water wave period on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00675">cell.cpp:675</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a6d4286ac64e3fe9aef428c93fdcd4230"><div class="ttname"><a href="class_c_geom_profile.html#a6d4286ac64e3fe9aef428c93fdcd4230">CGeomProfile::SetHitAnotherProfile</a></div><div class="ttdeci">void SetHitAnotherProfile(bool const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00123">profile.cpp:123</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a9afd0ac74169a81629bcbaa402be3009"><div class="ttname"><a href="class_c_geom_cell.html#a9afd0ac74169a81629bcbaa402be3009">CGeomCell::dGetDeepWaterWaveHeight</a></div><div class="ttdeci">double dGetDeepWaterWaveHeight(void) const</div><div class="ttdoc">Returns the deep water wave height on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00651">cell.cpp:651</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a45410879aaf7f8f9abc073fc54363d03"><div class="ttname"><a href="class_c_geom_profile.html#a45410879aaf7f8f9abc073fc54363d03">CGeomProfile::SetHitCoast</a></div><div class="ttdeci">void SetHitCoast(bool const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00093">profile.cpp:93</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_aac223e2610d50ca2c7eadaf8542e9498"><div class="ttname"><a href="class_c_geom_profile.html#aac223e2610d50ca2c7eadaf8542e9498">CGeomProfile::bOKIncStartAndEndOfCoast</a></div><div class="ttdeci">bool bOKIncStartAndEndOfCoast(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00148">profile.cpp:148</a></div></div>
<div class="ttc" id="acme_8h_html_ae67ac38149ef18c0ae071e57b3464ad5"><div class="ttname"><a href="cme_8h.html#ae67ac38149ef18c0ae071e57b3464ad5">RTN_ERR_CANNOT_INSERT_POINT</a></div><div class="ttdeci">const int RTN_ERR_CANNOT_INSERT_POINT</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00401">cme.h:401</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a753c1ed80d2ebd882faa4181b16aa8c0"><div class="ttname"><a href="class_c_geom_profile.html#a753c1ed80d2ebd882faa4181b16aa8c0">CGeomProfile::SetTruncated</a></div><div class="ttdeci">void SetTruncated(bool const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00113">profile.cpp:113</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_a3063e454f1e7ef2b32484cf8c7db0e97"><div class="ttname"><a href="class_c_geom_multi_line.html#a3063e454f1e7ef2b32484cf8c7db0e97">CGeomMultiLine::bFindProfileInCoincidentProfilesOfLastLineSegment</a></div><div class="ttdeci">bool bFindProfileInCoincidentProfilesOfLastLineSegment(int const)</div><div class="ttdoc">Returns true if the given profile number is amongst the coincident profiles of the CGeomMultiLine obj...</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00173">multi_line.cpp:173</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a4f702fc67f4f75ef648761cea136c079"><div class="ttname"><a href="class_c_geom_profile.html#a4f702fc67f4f75ef648761cea136c079">CGeomProfile::SetDeepWaterWavePeriod</a></div><div class="ttdeci">void SetDeepWaterWavePeriod(double const)</div><div class="ttdoc">Set the deep-water wave Period for this profile.</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00475">profile.cpp:475</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_aaf7c0ab9f64c31133be98ac87b114072"><div class="ttname"><a href="class_c_geom_multi_line.html#aaf7c0ab9f64c31133be98ac87b114072">CGeomMultiLine::SetProfsLineSeg</a></div><div class="ttdeci">void SetProfsLineSeg(int const, int const, int const)</div><div class="ttdoc">Sets a profile's own line segment number, given a line segment and the index of the co-incident profi...</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00261">multi_line.cpp:261</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_a5682956da0d84c928fbafa6f4ff25201"><div class="ttname"><a href="class_c_geom_multi_line.html#a5682956da0d84c928fbafa6f4ff25201">CGeomMultiLine::nGetProf</a></div><div class="ttdeci">int nGetProf(int const, int const) const</div><div class="ttdoc">Returns the profile number, given a line segment and the index of the co-incident profile for that li...</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00249">multi_line.cpp:249</a></div></div>
<div class="ttc" id="acme_8h_html_a71d8d6db0e41ed2022d0a95b9a70528c"><div class="ttname"><a href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a></div><div class="ttdeci">const int RTN_OK</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00351">cme.h:351</a></div></div>
<div class="ttc" id="acme_8h_html_aefc63c4bde02ca170b0e7bd038ba7702"><div class="ttname"><a href="cme_8h.html#aefc63c4bde02ca170b0e7bd038ba7702">WARN</a></div><div class="ttdeci">const string WARN</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00538">cme.h:538</a></div></div>
<div class="ttc" id="acme_8h_html_ab0094f1ece3facf8eb8afd210a7a7835"><div class="ttname"><a href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a></div><div class="ttdeci">const string ERR</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00537">cme.h:537</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_a5ffded2cbbf18f6f3e6595824476b727"><div class="ttname"><a href="class_c_geom2_d_i_point.html#a5ffded2cbbf18f6f3e6595824476b727">CGeom2DIPoint::SetXY</a></div><div class="ttdeci">void SetXY(int const, int const)</div><div class="ttdoc">The two integer parameters set values for the CGeom2DIPoint object's X and Y co-ordinates.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00080">2di_point.cpp:80</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_abaf88697019588a2b0901bd19044aee4"><div class="ttname"><a href="class_c_geom_profile.html#abaf88697019588a2b0901bd19044aee4">CGeomProfile::nGetProfileSize</a></div><div class="ttdeci">int nGetProfileSize(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00235">profile.cpp:235</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_ae22f845fd065108959610678de571cdb"><div class="ttname"><a href="class_c_geom_multi_line.html#ae22f845fd065108959610678de571cdb">CGeomMultiLine::nGetNumLineSegments</a></div><div class="ttdeci">int nGetNumLineSegments(void) const</div><div class="ttdoc">Appends a line segment which then inherits from the preceding line segments.</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00076">multi_line.cpp:76</a></div></div>
<div class="ttc" id="acme_8h_html_a3120fe2dad3cfe36a8e4fbf0231c19b6"><div class="ttname"><a href="cme_8h.html#a3120fe2dad3cfe36a8e4fbf0231c19b6">RTN_ERR_PROFILE_ENDPOINT_IS_OFFGRID</a></div><div class="ttdeci">const int RTN_ERR_PROFILE_ENDPOINT_IS_OFFGRID</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00376">cme.h:376</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_abd8d4a175fce062870745f66a1ee4299"><div class="ttname"><a href="class_c_geom_cell.html#abd8d4a175fce062870745f66a1ee4299">CGeomCell::SetProfile</a></div><div class="ttdeci">void SetProfile(int const)</div><div class="ttdoc">Marks this cell as 'under' a coastline-normal profile.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00182">cell.cpp:182</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_a397a6f2cc166220b5342cf3444e16753"><div class="ttname"><a href="class_c_geom_multi_line.html#a397a6f2cc166220b5342cf3444e16753">CGeomMultiLine::bFindProfileInCoincidentProfiles</a></div><div class="ttdeci">bool bFindProfileInCoincidentProfiles(int const)</div><div class="ttdoc">Returns true if the given profile number is one of the coincident profiles of the a specified line se...</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00203">multi_line.cpp:203</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a0abde0df28990b1a8c20664d2bdcb07f"><div class="ttname"><a href="class_c_geom_profile.html#a0abde0df28990b1a8c20664d2bdcb07f">CGeomProfile::TruncateProfile</a></div><div class="ttdeci">void TruncateProfile(int const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00215">profile.cpp:215</a></div></div>
<div class="ttc" id="acme_8h_html_a844aea83f4cb0eede0026a83e7e874d3"><div class="ttname"><a href="cme_8h.html#a844aea83f4cb0eede0026a83e7e874d3">RTN_ERR_NO_PROFILES_2</a></div><div class="ttdeci">const int RTN_ERR_NO_PROFILES_2</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00381">cme.h:381</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_ab9adb1e70e847258501607c9b1330d18"><div class="ttname"><a href="class_c_geom_profile.html#ab9adb1e70e847258501607c9b1330d18">CGeomProfile::SetPointInProfile</a></div><div class="ttdeci">void SetPointInProfile(int const, double const, double const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00181">profile.cpp:181</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_ac591314b290b032ffc8a70d22df64ec0"><div class="ttname"><a href="class_c_geom_profile.html#ac591314b290b032ffc8a70d22df64ec0">CGeomProfile::bStartOfCoast</a></div><div class="ttdeci">bool bStartOfCoast(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00068">profile.cpp:68</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_aec35bc03fc47a65349def96364c99bbd"><div class="ttname"><a href="class_c_geom_profile.html#aec35bc03fc47a65349def96364c99bbd">CGeomProfile::bEndOfCoast</a></div><div class="ttdeci">bool bEndOfCoast(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00078">profile.cpp:78</a></div></div>
<div class="ttc" id="acme_8h_html_aae7f73171ead1e885d69fc389e3353d8"><div class="ttname"><a href="cme_8h.html#aae7f73171ead1e885d69fc389e3353d8">strNumToStr</a></div><div class="ttdeci">string strNumToStr(const T &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00805">cme.h:805</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a5bb5e15188369a41d0ae784e6a9ed044"><div class="ttname"><a href="class_c_geom_profile.html#a5bb5e15188369a41d0ae784e6a9ed044">CGeomProfile::SetStartOfCoast</a></div><div class="ttdeci">void SetStartOfCoast(bool const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00063">profile.cpp:63</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_ab0146cd34539f41588924571dbfb2054"><div class="ttname"><a href="class_c_geom_multi_line.html#ab0146cd34539f41588924571dbfb2054">CGeomMultiLine::pprVGetPairedCoincidentProfilesForLineSegment</a></div><div class="ttdeci">vector&lt; pair&lt; int, int &gt; &gt; * pprVGetPairedCoincidentProfilesForLineSegment(int const)</div><div class="ttdoc">Returns a vector of pairs (a line segment)</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00152">multi_line.cpp:152</a></div></div>
<div class="ttc" id="autils__global_8cpp_html_a20842d0a19d0ca952c91f3e1eb175fee"><div class="ttname"><a href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a></div><div class="ttdeci">int nRound(double const d)</div><div class="ttdef"><b>Definition:</b> <a href="utils__global_8cpp_source.html#l00054">utils_global.cpp:54</a></div></div>
<div class="ttc" id="acme_8h_html_acdd64b7170fa6e0b8b42193b48eb2bbc"><div class="ttname"><a href="cme_8h.html#acdd64b7170fa6e0b8b42193b48eb2bbc">RTN_ERR_NO_PROFILES_1</a></div><div class="ttdeci">const int RTN_ERR_NO_PROFILES_1</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00380">cme.h:380</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_a3f99a9c2ac66b75c432941ec88fc8538"><div class="ttname"><a href="class_c_geom_multi_line.html#a3f99a9c2ac66b75c432941ec88fc8538">CGeomMultiLine::AppendLineSegment</a></div><div class="ttdeci">void AppendLineSegment(void)</div><div class="ttdoc">Appends a new empty line segment.</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00043">multi_line.cpp:43</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a8dc4e3ce21668f7149ca11aeb7efadf7"><div class="ttname"><a href="class_c_geom_profile.html#a8dc4e3ce21668f7149ca11aeb7efadf7">CGeomProfile::bProfileOK</a></div><div class="ttdeci">bool bProfileOK(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00133">profile.cpp:133</a></div></div>
<div class="ttc" id="asimulation_8h_html"><div class="ttname"><a href="simulation_8h.html">simulation.h</a></div><div class="ttdoc">Contains CSimulation definitions.</div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a442e3a6584e1a5b76e7ace39828f2bfc"><div class="ttname"><a href="class_c_geom_profile.html#a442e3a6584e1a5b76e7ace39828f2bfc">CGeomProfile::bIsPointInProfile</a></div><div class="ttdeci">bool bIsPointInProfile(double const, double const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00256">profile.cpp:256</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_a3516022bd96ee15709653b3bb7cc0155"><div class="ttname"><a href="class_c_geom_multi_line.html#a3516022bd96ee15709653b3bb7cc0155">CGeomMultiLine::nGetNumCoincidentProfilesInLineSegment</a></div><div class="ttdeci">int nGetNumCoincidentProfilesInLineSegment(int const)</div><div class="ttdoc">Returns the number of coincident profiles in a specified line segment.</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00167">multi_line.cpp:167</a></div></div>
<div class="ttc" id="acme_8h_html_a939ab6434091cd4e82b7a512991f8bef"><div class="ttname"><a href="cme_8h.html#a939ab6434091cd4e82b7a512991f8bef">RTN_ERR_COAST_CANT_FIND_EDGE_CELL</a></div><div class="ttdeci">const int RTN_ERR_COAST_CANT_FIND_EDGE_CELL</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00410">cme.h:410</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_afef14f6eea8432a83715ec8eb68eac14"><div class="ttname"><a href="class_c_geom_profile.html#afef14f6eea8432a83715ec8eb68eac14">CGeomProfile::SetTooShort</a></div><div class="ttdeci">void SetTooShort(bool const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00103">profile.cpp:103</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_af4ec7ad9bc2379688a31d49db5a049f7"><div class="ttname"><a href="class_c_geom_profile.html#af4ec7ad9bc2379688a31d49db5a049f7">CGeomProfile::SetDeepWaterWaveOrientation</a></div><div class="ttdeci">void SetDeepWaterWaveOrientation(double const)</div><div class="ttdoc">Set the deep-water wave orientation for this profile.</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00463">profile.cpp:463</a></div></div>
<div class="ttc" id="acme_8h_html_ac3bceeea03f34d120a475e78f82f07c7"><div class="ttname"><a href="cme_8h.html#ac3bceeea03f34d120a475e78f82f07c7">RTN_ERR_NO_SOLUTION_FOR_ENDPOINT</a></div><div class="ttdeci">const int RTN_ERR_NO_SOLUTION_FOR_ENDPOINT</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00378">cme.h:378</a></div></div>
<div class="ttc" id="acme_8h_html_af803adbfdc053cf78880fc2425db1f1d"><div class="ttname"><a href="cme_8h.html#af803adbfdc053cf78880fc2425db1f1d">DIRECTION_UPCOAST</a></div><div class="ttdeci">const int DIRECTION_UPCOAST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00198">cme.h:198</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_aaa8ddb9c775927bdb7940f7826f90a74"><div class="ttname"><a href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">CGeomProfile::pPtGetPointInProfile</a></div><div class="ttdeci">CGeom2DPoint * pPtGetPointInProfile(int const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00240">profile.cpp:240</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_a4d9c20bcca90dcb9d519b664aba09cbd"><div class="ttname"><a href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">CGeom2DIPoint::nGetY</a></div><div class="ttdeci">int nGetY(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object's integer Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00050">2di_point.cpp:50</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_aafb35166293c29d0492621850d5d06d4"><div class="ttname"><a href="class_c_geom_profile.html#aafb35166293c29d0492621850d5d06d4">CGeomProfile::AppendCellInProfile</a></div><div class="ttdeci">void AppendCellInProfile(CGeom2DIPoint const *)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00366">profile.cpp:366</a></div></div>
<div class="ttc" id="aclass_c_geom_multi_line_html_add6b741fa71f3eae355876dcc4232ec8"><div class="ttname"><a href="class_c_geom_multi_line.html#add6b741fa71f3eae355876dcc4232ec8">CGeomMultiLine::AddCoincidentProfileToExistingLineSegment</a></div><div class="ttdeci">void AddCoincidentProfileToExistingLineSegment(int const, int const, int const)</div><div class="ttdoc">Adds a coincident profile to a pre-existing line segment of the CGeomMultiLine object.</div><div class="ttdef"><b>Definition:</b> <a href="multi__line_8cpp_source.html#l00145">multi_line.cpp:145</a></div></div>
<div class="ttc" id="acme_8h_html_ae3b6dc50cfc97050529faa5e0bd66136"><div class="ttname"><a href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a></div><div class="ttdeci">T tAbs(T a)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00793">cme.h:793</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a28b760b0a9e63afd01e29610888fc7bc"><div class="ttname"><a href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">CGeomCell::bIsInContiguousSea</a></div><div class="ttdeci">bool bIsInContiguousSea(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00102">cell.cpp:102</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a3a378431e2f6095792582989f50fb435"><div class="ttname"><a href="class_c_geom_cell.html#a3a378431e2f6095792582989f50fb435">CGeomCell::dGetSeaDepth</a></div><div class="ttdeci">double dGetSeaDepth(void) const</div><div class="ttdoc">Returns the depth of seawater on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00296">cell.cpp:296</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Dec 9 2020 19:46:12 for CoastalME (Coastal Modelling Environment) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
