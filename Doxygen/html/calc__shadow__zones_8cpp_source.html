<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CoastalME (Coastal Modelling Environment): calc_shadow_zones.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CoastalME (Coastal Modelling Environment)
   </div>
   <div id="projectbrief">Simulates the long-term behaviour of complex coastlines</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">calc_shadow_zones.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="calc__shadow__zones_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> This file is part of CoastalME, the Coastal Modelling Environment.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> CoastalME is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">using</span> std::cout;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using</span> std::endl;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;stack&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">using</span> std::stack;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;deque&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">using</span> std::deque;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &lt;numeric&gt;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">using</span> std::accumulate;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cme_8h.html">cme.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="coast_8h.html">coast.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="simulation_8h.html">simulation.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> Determines whether the wave orientation at this point on a coast is onshore or offshore, and up-coast or down-coast</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keywordtype">bool</span> CSimulation::bOnOrOffShoreAndUpOrDownCoast(<span class="keywordtype">double</span> <span class="keyword">const</span> dCoastAngle, <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveAngle, <span class="keywordtype">int</span> <span class="keyword">const</span> nSeaHand, <span class="keywordtype">bool</span>&amp; bDownCoast)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;{</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   <span class="keywordtype">bool</span> bOnShore;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   <span class="keywordtype">double</span> dWaveToCoastAngle = fmod((dWaveAngle - dCoastAngle + 360), 360);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   bDownCoast = ((dWaveToCoastAngle &gt; 270) || (dWaveToCoastAngle &lt; 90)) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   <span class="keywordflow">if</span> (nSeaHand == <a class="code" href="cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a>)</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <span class="comment">// The sea is on the RHS travelling down-coast</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      bOnShore = dWaveToCoastAngle &gt; 180 ? true : <span class="keyword">false</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;   }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <span class="comment">// The sea is on the LHS travelling down-coast</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      bOnShore = dWaveToCoastAngle &gt; 180 ? false : <span class="keyword">true</span>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   }</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;   <span class="keywordflow">return</span> bOnShore;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> Given a cell and a wave orientation, finds the &#39;upwave&#39; cell</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> CSimulation::PtiFollowWaveAngle(<a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiLast, <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveAngleIn, <span class="keywordtype">double</span>&amp; dCorrection)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;{</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      nXLast = pPtiLast-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      nYLast = pPtiLast-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>(),</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      nXNext = nXLast,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      nYNext = nYLast;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;   <span class="keywordtype">double</span> dWaveAngle = dWaveAngleIn - dCorrection;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   <span class="keywordflow">if</span> (dWaveAngle &lt; 22.5)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;   {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      nYNext--;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      dCorrection = 22.5 - dWaveAngle;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 67.5)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      nYNext--;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      nXNext++;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      dCorrection = 67.5 - dWaveAngle;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;   }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 112.5)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;   {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      nXNext++;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      dCorrection = 112.5 - dWaveAngle;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 157.5)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;   {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      nXNext++;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      nYNext++;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      dCorrection = 157.5 - dWaveAngle;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 202.5)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;   {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      nYNext++;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      dCorrection = 202.5 - dWaveAngle;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 247.5)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;   {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      nXNext--;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      nYNext++;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      dCorrection = 247.5 - dWaveAngle;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 292.5)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;   {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      nXNext--;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      dCorrection = 292.5 - dWaveAngle;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dWaveAngle &lt; 337.5)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;   {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      nXNext--;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      nYNext--;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      dCorrection = 337.5 - dWaveAngle;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;   }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;   {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      nYNext--;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      dCorrection = 22.5 - dWaveAngle;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;   }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;   dCorrection = dKeepWithin360(dCorrection);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a>(nXNext, nYNext);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"> Finds wave shadow zones and modifies waves in and near them. Note that where up-coast and down-coast shadow zones overlap, the effects on wave values in the overlap area is an additive decrease in wave energy. Changes to wave energy in any down-drift increased-energy zones are also additive.</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="keywordtype">int</span> CSimulation::nDoAllShadowZones(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;{</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   <span class="comment">// Do this once for each coastline</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(m_VCoast.size()); nCoast++)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="comment">// =========================================================================================================================</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="comment">// The first stage: find coastline start points for possible shadow zone boundaries by sweeping the coastline: first down-coast then up-coast</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;         nSeaHand = m_VCoast[nCoast].nGetSeaHandedness(),</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;         nCoastSize = m_VCoast[nCoast].nGetCoastlineSize();</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      vector&lt;int&gt; VnPossibleShadowBoundaryCoastPoint;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">bool</span> bDownCoast : {<span class="keyword">true</span>, <span class="keyword">false</span>})</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;         <span class="keywordflow">if</span> (bDownCoast)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;         {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <span class="keywordtype">bool</span> bLastDownCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="comment">// Work along coast in down-coast direction</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nShadowZoneBoundaryEndPoint = 0; nShadowZoneBoundaryEndPoint &lt; nCoastSize; nShadowZoneBoundaryEndPoint++)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;               <span class="comment">// Get the coast&#39;s smoothed curvature at this point</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;               <span class="keywordtype">double</span> dCurvature = m_VCoast[nCoast].dGetSmoothCurvature(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;               <span class="keywordflow">if</span> (dCurvature &lt; 0)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;               {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                  <span class="comment">// OK, the coast is convex here, now get the flux orientation (a tangent to the coastline)</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                  <span class="keywordtype">double</span> dFluxOrientation = m_VCoast[nCoast].dGetFluxOrientation(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                  <span class="comment">// If this coast point is in the active zone, use the breaking wave orientation, otherwise use the deep water wave orientation</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                  <span class="keywordtype">double</span> dWaveAngle;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                  <span class="keywordflow">if</span> (m_VCoast[nCoast].dGetDepthOfBreaking(nShadowZoneBoundaryEndPoint) == <a class="code" href="cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                     <span class="comment">// Not in active zone</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                     dWaveAngle = m_VCoast[nCoast].dGetCoastDeepWaterWaveAngle(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                     <span class="comment">// In active zone</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                     dWaveAngle = m_VCoast[nCoast].dGetBreakingWaveAngle(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                  <span class="comment">// At this point on the coast, are waves on- or off-shore, and up- or down-coast?</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                  bDownCoast = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                  <span class="keywordtype">bool</span> bOnShore = bOnOrOffShoreAndUpOrDownCoast(dFluxOrientation, dWaveAngle, nSeaHand, bDownCoast);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">//                   CGeom2DPoint PtTmp1 = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nShadowZoneBoundaryEndPoint);</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">//                   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: going down-coast, coast point (&quot; &lt;&lt; nShadowZoneBoundaryEndPoint &lt;&lt; &quot;) at {&quot; &lt;&lt; PtTmp1.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtTmp1.dGetY() &lt;&lt; &quot;} has &quot; &lt;&lt; (bDownCoast ? &quot;down-coast &quot; : &quot;up-coast &quot;) &lt;&lt; (bOnShore ? &quot;on-shore&quot; : &quot;off-shore&quot;) &lt;&lt; &quot; waves, dWaveAngle = &quot; &lt;&lt; dWaveAngle &lt;&lt; &quot; dFluxOrientation = &quot; &lt;&lt; dFluxOrientation &lt;&lt; endl;</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                  <span class="keywordflow">if</span> (bDownCoast &amp;&amp; (! bOnShore))</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                  {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                     <span class="comment">// Waves are down-coast and off-shore</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">//                      CGeom2DPoint PtTmp1 = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nShadowZoneBoundaryEndPoint);</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">//                      LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: going down-coast, waves have off-shore and down-coast component at coast point (&quot; &lt;&lt; nShadowZoneBoundaryEndPoint &lt;&lt; &quot;) at {&quot; &lt;&lt; PtTmp1.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtTmp1.dGetY() &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                     <span class="comment">// If the previous coast point had waves which were down-coast and on-shore, then this could be the boundary of a shadow zone</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                     <span class="keywordflow">if</span> (bLastDownCoastAndOnshore)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                     {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                        VnPossibleShadowBoundaryCoastPoint.push_back(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                        bLastDownCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                        <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtTmp = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                        <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                           <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; has possible shadow boundary start at {&quot;</span> &lt;&lt; PtTmp.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; PtTmp.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() &lt;&lt; <span class="stringliteral">&quot;}. Found while going down-coast, this is coast point &quot;</span> &lt;&lt; nShadowZoneBoundaryEndPoint &lt;&lt; endl;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                     }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                  }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bDownCoast &amp;&amp; bOnShore)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                  {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                     bLastDownCoastAndOnshore = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                  }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                  {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                     bLastDownCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                  }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;               }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;         }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;         {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="comment">// Moving up-coast</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="keywordtype">bool</span> bLastUpCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="comment">// Work along coast in up-coast direction</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nShadowZoneBoundaryEndPoint = nCoastSize-1; nShadowZoneBoundaryEndPoint &gt;= 0; nShadowZoneBoundaryEndPoint--)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;               <span class="comment">// Get the coast&#39;s smoothed curvature at this point</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;               <span class="keywordtype">double</span> dCurvature = m_VCoast[nCoast].dGetSmoothCurvature(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;               <span class="keywordflow">if</span> (dCurvature &lt; 0)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;               {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                  <span class="comment">// OK, the coast is convex here, now get the flux orientation (a tangent to the coastline)</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                  <span class="keywordtype">double</span> dFluxOrientation = m_VCoast[nCoast].dGetFluxOrientation(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                  <span class="comment">// If this coast point is in the active zone, use the breaking wave orientation, otherwise use the deep water wave orientation</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                  <span class="keywordtype">double</span> dWaveAngle;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                  <span class="keywordflow">if</span> (m_VCoast[nCoast].dGetDepthOfBreaking(nShadowZoneBoundaryEndPoint) == <a class="code" href="cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                     <span class="comment">// Not in active zone</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                     dWaveAngle = m_VCoast[nCoast].dGetCoastDeepWaterWaveAngle(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                     <span class="comment">// In active zone</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                     dWaveAngle = m_VCoast[nCoast].dGetBreakingWaveAngle(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                  <span class="comment">// At this point on the coast, are waves on- or off-shore, and up- or down-coast?</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                  bDownCoast = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                  <span class="keywordtype">bool</span> bOnShore = bOnOrOffShoreAndUpOrDownCoast(dFluxOrientation, dWaveAngle, nSeaHand, bDownCoast);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">//                   CGeom2DPoint PtTmp1 = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nShadowZoneBoundaryEndPoint);</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">//                   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: going up-coast, coast point (&quot; &lt;&lt; nShadowZoneBoundaryEndPoint &lt;&lt; &quot;) at {&quot; &lt;&lt; PtTmp1.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtTmp1.dGetY() &lt;&lt; &quot;} has &quot; &lt;&lt; (bDownCoast ? &quot;down-coast &quot; : &quot;up-coast &quot;) &lt;&lt; (bOnShore ? &quot;on-shore&quot; : &quot;off-shore&quot;) &lt;&lt; &quot; waves, dWaveAngle = &quot; &lt;&lt; dWaveAngle &lt;&lt; &quot; dFluxOrientation = &quot; &lt;&lt; dFluxOrientation &lt;&lt; endl;</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                  <span class="keywordflow">if</span> ((! bDownCoast) &amp;&amp; (! bOnShore))</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                  {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                     <span class="comment">// Waves are up-coast and off-shore</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">//                      CGeom2DPoint PtTmp1 = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nShadowZoneBoundaryEndPoint);</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">//                      LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: going up-coast, waves have off-shore and down-coast component at coast point (&quot; &lt;&lt; nShadowZoneBoundaryEndPoint &lt;&lt; &quot;) at {&quot; &lt;&lt; PtTmp1.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtTmp1.dGetY() &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                     <span class="comment">// If the previous coast point had waves which were up-coast and on-shore, then this could be the boundary of a shadow zone</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                     <span class="keywordflow">if</span> (bLastUpCoastAndOnshore)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                     {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        VnPossibleShadowBoundaryCoastPoint.push_back(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                        bLastUpCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                        <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtTmp = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nShadowZoneBoundaryEndPoint);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                           <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; has possible shadow boundary start at {&quot;</span> &lt;&lt; PtTmp.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; PtTmp.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() &lt;&lt; <span class="stringliteral">&quot;}. Found while going up-coast, this is coast point &quot;</span> &lt;&lt; nShadowZoneBoundaryEndPoint &lt;&lt; endl;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                     }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                  }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((! bDownCoast) &amp;&amp; bOnShore)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                  {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                     bLastUpCoastAndOnshore = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                  }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                  {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                     bLastUpCoastAndOnshore = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                  }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;               }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;         }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">if</span> (VnPossibleShadowBoundaryCoastPoint.size() == 0)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;         <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: no shadow boundary start points found&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="comment">// =========================================================================================================================</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="comment">// The second stage: we have a list of possible shadow zone start points, trace each of these &#39;up-wave&#39; to identify valid shadow zones</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      vector&lt;CGeomILine&gt; VILShadowBoundary;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      vector&lt;int&gt;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;         VnShadowBoundaryStartCoastPoint,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;         VnShadowBoundaryEndCoastPoint;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nStartPoint = 0; nStartPoint &lt; static_cast&lt;int&gt;(VnPossibleShadowBoundaryCoastPoint.size()); nStartPoint++)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;         <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a>)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, processing possible shadow boundary start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; of &quot;</span> &lt;&lt; VnPossibleShadowBoundaryCoastPoint.size() &lt;&lt; endl;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;         <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            bHitEdge = <span class="keyword">false</span>,</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            bHitCoast = <span class="keyword">false</span>,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            bHitSea = <span class="keyword">false</span>,</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            bInLoop = <span class="keyword">false</span>,</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            bStillInland = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;         <span class="comment">// From each start point, follow the wave direction</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;         <a class="code" href="class_c_geom_i_line.html">CGeomILine</a> ILShadowBoundary;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;         <span class="comment">// If this coast point is in the active zone, start with the breaking wave orientation, otherwise use the deep water wave orientation</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;         <span class="keywordtype">double</span> dPrevWaveAngle;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;         <span class="keywordflow">if</span> (m_VCoast[nCoast].dGetDepthOfBreaking(nStartPoint) == <a class="code" href="cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;         {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="comment">// Not in active zone</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            dPrevWaveAngle = m_VCoast[nCoast].dGetCoastDeepWaterWaveAngle(nStartPoint);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;         }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;         {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="comment">// In active zone</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            dPrevWaveAngle = m_VCoast[nCoast].dGetBreakingWaveAngle(nStartPoint);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;         }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;         <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiPrev = *m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(VnPossibleShadowBoundaryCoastPoint[nStartPoint]);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;         ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#ab181578766d0cacb30c7ad0d695bf595">Append</a>(&amp;PtiPrev);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;         <span class="keywordtype">int</span> nDist = 0;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;         <span class="keywordtype">double</span> dCorrection = 0;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;         deque&lt;double&gt; DQdPrevOrientations;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;         <span class="keywordflow">while</span> ((! bHitEdge) &amp;&amp; (! bHitCoast))</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;         {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">//             int nShadowBoundaryCoastPoint = -1;</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="keywordflow">if</span> (nDist &gt; 0)</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;               <span class="keywordtype">int</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                  nXPrev = PtiPrev.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                  nYPrev = PtiPrev.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;               <span class="keywordflow">if</span> (! m_pRasterGrid-&gt;m_Cell[nXPrev][nYPrev].<a class="code" href="class_c_geom_cell.html#a657a6ebbff5ffe37aedad0d26281eb03">bIsInActiveZone</a>())</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;               {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                  <span class="comment">// The previous cell was outside the active zone, so use its wave orientation value</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                  dPrevWaveAngle = m_pRasterGrid-&gt;m_Cell[nXPrev][nYPrev].<a class="code" href="class_c_geom_cell.html#a782684d4d435c36a1a2d364a5e1ed33c">dGetWaveAngle</a>();</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;               }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;               {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                  <span class="comment">// The previous cell was in the active zone</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                  <span class="keywordflow">if</span> (bHitSea)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                  {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                     <span class="comment">// If this shadow boundary has already hit sea, then we must be getting near a coast: use the average-so-far wave orientation</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                     <span class="keywordtype">double</span> dAvgOrientationSoFar = accumulate(DQdPrevOrientations.begin(), DQdPrevOrientations.end(), 0.0) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(DQdPrevOrientations.size());</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                     dPrevWaveAngle = dAvgOrientationSoFar;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                  }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                  {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                     <span class="comment">// This shadow boundary has not already hit sea, just use the wave orientation from the previous cell</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                     dPrevWaveAngle = m_pRasterGrid-&gt;m_Cell[nXPrev][nYPrev].<a class="code" href="class_c_geom_cell.html#a782684d4d435c36a1a2d364a5e1ed33c">dGetWaveAngle</a>();</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">//                      LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: not already hit sea, using previous cell&#39;s wave orientation for cell [&quot; &lt;&lt; nXPrev &lt;&lt; &quot;][&quot; &lt;&lt; nYPrev &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPrev) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nYPrev) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                  }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;               }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;               <span class="keywordflow">if</span> (dPrevWaveAngle == <a class="code" href="cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;               {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">//                   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: dPrevWaveAngle == DBL_NODATA for cell [&quot; &lt;&lt; nXPrev &lt;&lt; &quot;][&quot; &lt;&lt; nYPrev &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPrev) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nYPrev) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                  <span class="keywordflow">if</span> (! m_pRasterGrid-&gt;m_Cell[nXPrev][nYPrev].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>())</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                  {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                     <span class="comment">// The previous cell was an inland cell, so use the deep water wave orientation</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                     dPrevWaveAngle = m_pRasterGrid-&gt;m_Cell[nXPrev][nYPrev].<a class="code" href="class_c_geom_cell.html#a25d985b5c6cec28ded1634131128a547">dGetCellDeepWaterWaveAngle</a>();</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                  }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                  {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                     <span class="keywordtype">double</span> dAvgOrientationSoFar = accumulate(DQdPrevOrientations.begin(), DQdPrevOrientations.end(), 0.0) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(DQdPrevOrientations.size());</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                     dPrevWaveAngle = dAvgOrientationSoFar;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                  }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;               }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;               <span class="keywordflow">if</span> (DQdPrevOrientations.size() == <a class="code" href="cme_8h.html#a44a80b23b966b8f1aa8a620bceb50b2b">MAX_NUM_PREV_ORIENTATION_VALUES</a>)</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                  DQdPrevOrientations.pop_front();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;               DQdPrevOrientations.push_back(dPrevWaveAngle);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <span class="comment">// Go upwave along the previous cell&#39;s wave orientation to find the new boundary cell</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiNew = PtiFollowWaveAngle(&amp;PtiPrev, dPrevWaveAngle, dCorrection);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="comment">// Get the co-ordinates of &#39;this&#39; cell</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;               nX = PtiNew.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;               nY = PtiNew.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="comment">// Have we hit the edge of the valid part of the grid?</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordflow">if</span> ((! bIsWithinValidGrid(&amp;PtiNew)) || (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a31dd44509b9f8bfcc39726a391507109">bIsBoundingBoxEdge</a>()))</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;               <span class="comment">// Yes we have</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;               bHitEdge = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">//                LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: shadow boundary &quot; &lt;&lt; nStartPoint &lt;&lt; &quot; hit edge cell at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;               <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            <span class="comment">// Have we been to this cell before?</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <span class="keywordflow">if</span> (ILShadowBoundary.<a class="code" href="class_c_geom_i_line.html#a5129fc96323c094fe52487ad428ce546">bIsPresent</a>(nX, nY))</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;               <span class="comment">// We have, so we are in a loop. Abandon this shadow line</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;               bInLoop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="comment">// OK so far. Have we hit a sea cell yet?</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="keywordflow">if</span> ((nDist &gt; <a class="code" href="cme_8h.html#ac45b8f6cf8276514853c55bb394a10b5">MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE</a>) &amp;&amp; (! bHitSea))</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;               <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>())</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                  bHitSea = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;               {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                  <span class="keywordflow">if</span> (nDist &gt;= <a class="code" href="cme_8h.html#ac45b8f6cf8276514853c55bb394a10b5">MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE</a>)</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                  {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                     <span class="comment">// If we have travelled MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE cells without hitting sea, then abandon this shadow boundary</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                     bStillInland = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                  }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;               }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="comment">// Store the co-ords of every cell which we cross</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#ab181578766d0cacb30c7ad0d695bf595">Append</a>(&amp;PtiNew);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <span class="comment">// Having hit sea, have we now hit we hit a coast point? Note that two diagonal(ish) raster lines can cross each other without any intersection, so must also test an adjacent cell for intersection (does not matter which adjacent cell)</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <span class="keywordflow">if</span> (bHitSea)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;               <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">bIsCoastline</a>() || (bIsWithinValidGrid(nX, nY+1) &amp;&amp; m_pRasterGrid-&gt;m_Cell[nX][nY+1].<a class="code" href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">bIsCoastline</a>()))</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;               {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                  bHitCoast = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                  <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a>)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                     <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, the possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; hit the coast at [&quot;</span> &lt;&lt; nX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nY &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;               }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="comment">// For next time</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            PtiPrev = PtiNew;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            nDist++;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;         }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;         <span class="keywordflow">if</span> (bInLoop)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;         {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="comment">// Shadow line loops, so abandon it</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a>)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;               <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, the possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; forms a loop, abandoning. It starts at [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary[0].nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary[0].nGetY()) &lt;&lt; <span class="stringliteral">&quot;} and was abandoned at [&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;         }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;         <span class="keywordflow">if</span> (bStillInland)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;         {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="comment">// Shadow line is still inland after crossing MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE calls</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a>)</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;               <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, the possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; is still inland after crossing &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#ac45b8f6cf8276514853c55bb394a10b5">MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE</a> &lt;&lt; <span class="stringliteral">&quot; cells, abandoning. It starts at [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary[0].nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary[0].nGetY()) &lt;&lt; <span class="stringliteral">&quot;} and was abandoned at [&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;         }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;         <span class="keywordflow">if</span> (bHitCoast)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;         {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="comment">// The shadow zone boundary has hit a coast, but is the shadow zone line trivially short?</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="keywordtype">double</span> dShadowLen = dGetDistanceBetween(&amp;ILShadowBoundary[0], &amp;ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>()) * m_dCellSide;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <span class="keywordflow">if</span> (dShadowLen &lt; <a class="code" href="cme_8h.html#a93ac0c692cfeb8082f10c7b5064a4c6a">MIN_LENGTH_OF_SHADOW_ZONE_LINE</a>)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;               <span class="comment">// Too short, so forget about it</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;               <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a>)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                  <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, the possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; is too short, has length &quot;</span> &lt;&lt; dShadowLen &lt;&lt; <span class="stringliteral">&quot; m but the minimum length is &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#a93ac0c692cfeb8082f10c7b5064a4c6a">MIN_LENGTH_OF_SHADOW_ZONE_LINE</a> &lt;&lt; <span class="stringliteral">&quot; m. It starts at [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary[0].nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary[0].nGetY()) &lt;&lt; <span class="stringliteral">&quot;} and hits coast at [&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;               <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            <span class="comment">// We&#39;ve found a valid shadow zone. Check the last point in the shadow boundary. Note that occasionally this last cell is not &#39;above&#39; a cell but is above one of its neighbouring cells is: in which case, replace the last point in the shadow boundary with the co-ords of this neighbouring cell</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="keywordtype">int</span> nShadowBoundaryCoastPoint = m_VCoast[nCoast].nGetCoastPointGivenCell(&amp;ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>());</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="keywordflow">if</span> (nShadowBoundaryCoastPoint == <a class="code" href="cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;               <span class="comment">// Could not find a neighbouring cell which is &#39;under&#39; the coastline</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;               <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a>)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                  <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, no coast point under {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;               <span class="comment">// TODO Need to fix this, for the moment just abandon this shadow zone and carry on</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;               <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">//                return RTN_ERR_NO_CELL_UNDER_COASTLINE;</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            }</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="comment">// Now store the shadow zone boundary information</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            VILShadowBoundary.push_back(ILShadowBoundary);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            VnShadowBoundaryStartCoastPoint.push_back(VnPossibleShadowBoundaryCoastPoint[nStartPoint]);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            VnShadowBoundaryEndCoastPoint.push_back(nShadowBoundaryCoastPoint);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;               <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, the possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; defines a valid shadow zone. Start point [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary[0].nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary[0].nGetY()) &lt;&lt; <span class="stringliteral">&quot;}, hits coast at [&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} which is coast point (&quot;</span> &lt;&lt; nShadowBoundaryCoastPoint &lt;&lt; <span class="stringliteral">&quot;). Will be shadow zone &quot;</span> &lt;&lt; VnShadowBoundaryEndCoastPoint.size()-1 &lt;&lt; endl;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;         }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;         <span class="keywordflow">if</span> (bHitEdge)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;         {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="cme_8h.html#a2f39c393cbe19710d077797fdf2a843d">CREATE_SHADOW_ZONE_IF_HITS_GRID_EDGE</a>)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;               <span class="comment">// We are creating shadow zones if we hit the grid edge. But is the shadow zone line trivially short?</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;               <span class="keywordtype">double</span> dShadowLen = dGetDistanceBetween(&amp;ILShadowBoundary[0], &amp;ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>()) * m_dCellSide;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;               <span class="keywordflow">if</span> (dShadowLen &lt; <a class="code" href="cme_8h.html#a93ac0c692cfeb8082f10c7b5064a4c6a">MIN_LENGTH_OF_SHADOW_ZONE_LINE</a>)</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;               {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                  <span class="comment">// Too short, so forget about it</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                  <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a>)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                     <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: the possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; is too short, has length &quot;</span> &lt;&lt; dShadowLen &lt;&lt; <span class="stringliteral">&quot; m but the minimum length is &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#a93ac0c692cfeb8082f10c7b5064a4c6a">MIN_LENGTH_OF_SHADOW_ZONE_LINE</a> &lt;&lt; <span class="stringliteral">&quot; m. It starts at [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary[0].nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary[0].nGetY()) &lt;&lt; <span class="stringliteral">&quot;} and hits the grid edge at [&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;               }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;               <span class="comment">// We&#39;ve found a valid grid-edge shadow zone, but we need a distance (in cells) between the shadow boundary start and the &#39;virtual&#39; shadow boundary end: this is the off-grid point where the shadow boundary would have intersected the coastline, if the grid were big enough. This is of course unknowable. So as a best guess, we choose the shorter of the two distances between the point where the shadow boundary hits the valid edge of the grid, and the start or end of the coast</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;               <span class="comment">// int nCoastSize = m_VCoast[nCoast].nGetCoastlineSize();</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;               <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiCoastStart = *m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(0);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;               <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiCoastEnd = *m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize-1);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;               <span class="keywordtype">int</span> nDistance = <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(<a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dGetDistanceBetween(&amp;ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>(), &amp;PtiCoastStart), dGetDistanceBetween(&amp;ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>(), &amp;PtiCoastEnd)));</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;               <span class="comment">// Now store the shadow zone boundary information</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;               VILShadowBoundary.push_back(ILShadowBoundary);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;               VnShadowBoundaryStartCoastPoint.push_back(VnPossibleShadowBoundaryCoastPoint[nStartPoint]);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;               VnShadowBoundaryEndCoastPoint.push_back(nDistance);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;               <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                  <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, the possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; defines a valid shadow zone. Start point [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary[0].nGetX()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary[0].nGetY()) &lt;&lt; <span class="stringliteral">&quot;}, hit the grid edge at [&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(ILShadowBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">Back</a>().<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}. Best-guess length of the shadow boundary is &quot;</span> &lt;&lt; nDistance &lt;&lt; <span class="stringliteral">&quot; cells. Will be shadow zone &quot;</span> &lt;&lt; VnShadowBoundaryEndCoastPoint.size()-1 &lt;&lt; endl;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;               <span class="comment">// We are not creating shadow zones if we hit the grid edge</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;               <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>) <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, the possible shadow boundary from start point &quot;</span> &lt;&lt; nStartPoint &lt;&lt; <span class="stringliteral">&quot; hits a grid edge: ignored. It starts at [&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetX() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; ILShadowBoundary[0].nGetY() &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;         }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="comment">// =========================================================================================================================</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="comment">// The third stage: store the shadow zone boundary, flood fill the shadow zone, then change wave properties by sweeping the shadow zone and the area downdrift from the shadow zone</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nZone = 0; nZone &lt; VILShadowBoundary.size(); nZone++)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;         <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>) <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, processing shadow zone &quot;</span> &lt;&lt; nZone &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; VILShadowBoundary.size() &lt;&lt; <span class="stringliteral">&quot; total)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;         <span class="keywordtype">int</span> nShadowLineLen = VILShadowBoundary[nZone].nGetSize();</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;         <span class="comment">// The vector shadow boundary (external CRS)</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;         <a class="code" href="class_c_geom_line.html">CGeomLine</a> LBoundary;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;         <span class="comment">// And the same with grid CRS</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;         <a class="code" href="class_c_geom_i_line.html">CGeomILine</a> LIBoundary;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = 0; nn &lt; nShadowLineLen; nn++)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;         {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;               nTmpX = VILShadowBoundary[nZone][nn].nGetX(),</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;               nTmpY = VILShadowBoundary[nZone][nn].nGetY();</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <span class="comment">// Mark the cells as shadow zone boundary</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            m_pRasterGrid-&gt;m_Cell[nTmpX][nTmpY].<a class="code" href="class_c_geom_cell.html#aca6ca09523f23efe7077ecaaedbfce5d">SetShadowZoneBoundary</a>();</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <span class="comment">// If this is a sea cell, mark the shadow zone boundary cell as being in the shadow zone, but not yet processed (a -ve number)</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nTmpX][nTmpY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>())</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;               m_pRasterGrid-&gt;m_Cell[nTmpX][nTmpY].<a class="code" href="class_c_geom_cell.html#ab47e7d28ef537f73698efadd12a33c56">SetShadowZoneNumber</a>(-(nZone+1));</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="comment">// If not already there, append this values to the two shadow boundary vectors</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            LBoundary.<a class="code" href="class_c_a2_d_shape.html#aaa15397a5761d17635afdaddbec35c8a">AppendIfNotAlready</a>(dGridCentroidXToExtCRSX(nTmpX), dGridCentroidYToExtCRSY(nTmpY));</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            LIBoundary.<a class="code" href="class_c_a2_d_i_shape.html#a9d97e2e53a6e13b56664cced2d6e4f6a">AppendIfNotAlready</a>(nTmpX, nTmpY);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot; shadow zone &quot; &lt;&lt; nZone &lt;&lt; &quot;, which starts at [&quot; &lt;&lt; nTmpX &lt;&lt; &quot;][&quot; &lt;&lt; nTmpY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nTmpX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nTmpY) &lt;&lt; &quot;} has cell [&quot; &lt;&lt; nTmpX &lt;&lt; &quot;][&quot; &lt;&lt; nTmpY &lt;&lt; &quot;] marked as shadow zone boundary&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;         }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;         <span class="comment">// Put the ext CRS vector shadow boundary into reverse sequence (i.e. start point is last)</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;         LBoundary.<a class="code" href="class_c_a2_d_shape.html#a54eb0a2ab77aa22b8d1af5f8f1f40383">Reverse</a>();</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;         <span class="comment">// Store the reversed ext CRS shadow zone boundary</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;         m_VCoast[nCoast].AppendShadowBoundary(&amp;LBoundary);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;         <span class="keywordtype">int</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            nStartX = VILShadowBoundary[nZone][0].nGetX(),</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            nStartY = VILShadowBoundary[nZone][0].nGetY(),</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            nEndX = VILShadowBoundary[nZone][nShadowLineLen-1].nGetX(),</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            nEndY = VILShadowBoundary[nZone][nShadowLineLen-1].nGetY();</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;         <span class="comment">// Grid CRS</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;         <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            PtiStart(nStartX, nStartY),</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            PtiEnd(nEndX, nEndY);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;         <span class="comment">// Flood fill the shadow zone: start by finding the centroid</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;         <span class="keywordflow">if</span> (VnShadowBoundaryEndCoastPoint[nZone] &gt; VnShadowBoundaryStartCoastPoint[nZone])</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;         {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <span class="comment">// The shadow boundary endpoint is downcoast from the shadow boundary start point</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;               nStart = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(VnShadowBoundaryStartCoastPoint[nZone], 0),</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;               nEnd = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(VnShadowBoundaryEndCoastPoint[nZone], m_VCoast[nCoast].nGetCoastlineSize());</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = nStart; nn &lt; nEnd; nn++)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;               <span class="comment">// Append the coastal portion of the shadow zone boundary to the grid CRS vector</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;               LIBoundary.<a class="code" href="class_c_a2_d_i_shape.html#ab181578766d0cacb30c7ad0d695bf595">Append</a>(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nn));</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">//                LogStream &lt;&lt; &quot;Coast point A &quot; &lt;&lt; nn &lt;&lt; &quot; [&quot; &lt;&lt; m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nn)-&gt;nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nn)-&gt;nGetY() &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;         }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;         {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="comment">// The shadow boundary endpoint is upcoast from the shadow boundary start point</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;               nStart = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(VnShadowBoundaryEndCoastPoint[nZone], m_VCoast[nCoast].nGetCoastlineSize()-1),</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;               nEnd = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(VnShadowBoundaryStartCoastPoint[nZone], 0);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160; </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nn = nStart; nn &gt;= nEnd; nn--)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;               <span class="comment">// Append the coastal portion of the shadow zone boundary to the grid CRS vector</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;               LIBoundary.<a class="code" href="class_c_a2_d_i_shape.html#ab181578766d0cacb30c7ad0d695bf595">Append</a>(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nn));</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">//                LogStream &lt;&lt; &quot;Coast point B &quot; &lt;&lt; nn &lt;&lt; &quot; [&quot; &lt;&lt; m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nn)-&gt;nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nn)-&gt;nGetY() &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;         }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">//          // DEBUG CODE =======================================================</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;FIRST&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">//          for (int k = 0; k &lt; LIBoundary.nGetSize(); k++)</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">//          {</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">//             CGeom2DIPoint PtiTmp = *LIBoundary.pPtiGetAt(k);</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">//             LogStream &lt;&lt; k &lt;&lt; &quot; [&quot; &lt;&lt; PtiTmp.nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; PtiTmp.nGetY() &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">//          }</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">//          LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">//          // DEBUG CODE =======================================================</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;         <span class="comment">// Calculate the centroid</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;         <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiCentroid = PtiPolygonCentroid(LIBoundary.<a class="code" href="class_c_a2_d_i_shape.html#ae149d229c6313db4f4435fa104f40a90">pPtiVGetPoints</a>());</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;         <span class="keywordflow">if</span> (bIsWithinValidGrid(&amp;PtiCentroid))        <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;         {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <span class="keywordtype">int</span> nRet = nFloodFillShadowZone(nZone, &amp;PtiCentroid, &amp;PtiStart, &amp;PtiEnd);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;               <span class="comment">// Could not find start point for flood fill. How serious we judge this to be depends on the length of the shadow zone line</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;               <span class="keywordflow">if</span> (nShadowLineLen &lt; <a class="code" href="cme_8h.html#a052095c3f746a887244b9818d181696c">MAX_LEN_SHADOW_LINE_TO_IGNORE</a>)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;               {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                  <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                     <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a> &lt;&lt; <span class="stringliteral">&quot;could not find start point for flood fill of shadow zone &quot;</span> &lt;&lt; nZone &lt;&lt; <span class="stringliteral">&quot; but continuing simulation because this is a small shadow zone (shadow line length = &quot;</span> &lt;&lt; nShadowLineLen &lt;&lt; <span class="stringliteral">&quot; cells)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                  <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;               }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;               {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                  <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;could not find start point for flood fill of shadow zone &quot;</span> &lt;&lt; nZone &lt;&lt; <span class="stringliteral">&quot; (shadow line length = &quot;</span> &lt;&lt; nShadowLineLen &lt;&lt; <span class="stringliteral">&quot; cells)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                  <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;               }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <span class="comment">// Sweep the shadow zone, changing wave orientation and height</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            nRet = nDoShadowZoneAndDownDriftZone(nCoast, nZone, VnShadowBoundaryStartCoastPoint[nZone], VnShadowBoundaryEndCoastPoint[nZone]);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;               <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;         }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;   }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;}</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment"> Flood fills a shadow zone from the centroid</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="keywordtype">int</span> CSimulation::nFloodFillShadowZone(<span class="keywordtype">int</span> <span class="keyword">const</span> nZone, <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiCentroid, <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiShadowBoundaryStart, <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiShadowBoundaryEnd)</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;{</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;   <span class="comment">// Is the centroid a sea cell?</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;   <span class="keywordtype">bool</span> bStartPointOK = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;   <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiFloodFillStart = *pPtiCentroid;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;   <span class="keywordflow">if</span> (! m_pRasterGrid-&gt;m_Cell[PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()][PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>())</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   {</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="comment">// No it isn&#39;t: so try to find a cell that is</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      bStartPointOK = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keywordtype">double</span> dWeight = 0.05;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="keywordflow">while</span> ((! bStartPointOK) &amp;&amp; (dWeight &lt; 1))</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;         <span class="comment">// Find a start point for the flood fill. Because shadow zones are generally triangular, start by choosing a low weighting so that the start point is close to the centroid, but a bit towards the coast. If this doesn&#39;t work, go further coastwards</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;         PtiFloodFillStart = PtiWeightedAverage(pPtiShadowBoundaryEnd, pPtiCentroid, dWeight);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;         <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;         <span class="keywordflow">if</span> (PtiFloodFillStart == *pPtiCentroid)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;         {</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            dWeight += 0.05;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;         }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;         <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;         <span class="keywordflow">if</span> (! bIsWithinValidGrid(&amp;PtiFloodFillStart))</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;         {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;               <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;start point [&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} for flood fill of shadow zone is outside grid&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a4c7934393517cd814fe5ead496fa15b9">RTN_ERR_SHADOW_ZONE_FLOOD_FILL_NOGRID</a>;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;         }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;         <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()][PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>())</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;         {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="comment">// Start point is a sea cell, all OK</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            bStartPointOK = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;         }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;         {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            <span class="comment">// Start point is not a sea cell</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;               <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: shadow zone flood fill start point [&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} is NOT a sea cell for shadow boundary from cape point [&quot;</span> &lt;&lt; pPtiShadowBoundaryStart-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; pPtiShadowBoundaryStart-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(pPtiShadowBoundaryStart-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(pPtiShadowBoundaryStart-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} to [&quot;</span> &lt;&lt; pPtiShadowBoundaryEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; pPtiShadowBoundaryEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(pPtiShadowBoundaryEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(pPtiShadowBoundaryEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}, dWeight = &quot;</span> &lt;&lt; dWeight &lt;&lt; endl;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            dWeight += 0.05;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;         }</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      }</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;   }</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;   <span class="keywordflow">if</span> (! bStartPointOK)</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;   {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot;could not find shadow zone flood fill start point&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a368ba64a15504bd62f1711a5d11d78a6">RTN_ERR_SHADOW_ZONE_FLOOD_START_POINT</a>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;   }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;   <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: shadow zone flood fill start point [&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(PtiFloodFillStart.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} is OK for shadow boundary from [&quot;</span> &lt;&lt; pPtiShadowBoundaryStart-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; pPtiShadowBoundaryStart-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(pPtiShadowBoundaryStart-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(pPtiShadowBoundaryStart-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;} to [&quot;</span> &lt;&lt; pPtiShadowBoundaryEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>() &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; pPtiShadowBoundaryEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>() &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(pPtiShadowBoundaryEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(pPtiShadowBoundaryEnd-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()) &lt;&lt; <span class="stringliteral">&quot;}&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160; </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;   <span class="comment">// All OK, so create an empty stack</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;   stack&lt;CGeom2DIPoint&gt; PtiStack;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;   <span class="comment">// We have a flood fill start point so push this point onto the stack</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   PtiStack.push(PtiFloodFillStart);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; </div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;   <span class="comment">// Then do the flood fill: loop until there are no more cell co-ords on the stack</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   <span class="keywordflow">while</span> (! PtiStack.empty())</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> Pti = PtiStack.top();</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      PtiStack.pop();</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;         nX = Pti.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;         nY = Pti.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="keywordflow">while</span> ((nX &gt;= 0) &amp;&amp; m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>() &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#abe71e786629cf4cbb2dbbf219decdde2">bIsinThisShadowZone</a>(-nZone-1)) &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a2255f2e80624d34d39e0797f2108618d">bIsShadowZoneBoundary</a>()) &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">bIsCoastline</a>()))</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;         nX--;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      nX++;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;         bSpanAbove = <span class="keyword">false</span>,</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;         bSpanBelow = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <span class="keywordflow">while</span> ((nX &lt; m_nXGridMax) &amp;&amp; m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>() &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#abe71e786629cf4cbb2dbbf219decdde2">bIsinThisShadowZone</a>(-nZone-1)) &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a2255f2e80624d34d39e0797f2108618d">bIsShadowZoneBoundary</a>()) &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">bIsCoastline</a>()))</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      {</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;         <span class="comment">// Mark the cell as being in the shadow zone but not yet processed (a -ve number, with -1 being zone 1)</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ab47e7d28ef537f73698efadd12a33c56">SetShadowZoneNumber</a>(-nZone-1);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">//          LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} marked as shadow zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;         <span class="keywordflow">if</span> ((! bSpanAbove) &amp;&amp; (nY &gt; 0) &amp;&amp; m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>() &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY-1].<a class="code" href="class_c_geom_cell.html#abe71e786629cf4cbb2dbbf219decdde2">bIsinThisShadowZone</a>(-nZone-1)) &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY-1].<a class="code" href="class_c_geom_cell.html#a2255f2e80624d34d39e0797f2108618d">bIsShadowZoneBoundary</a>()) &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY-1].<a class="code" href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">bIsCoastline</a>()))</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;         {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            PtiStack.push(<a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a>(nX, nY-1));</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            bSpanAbove = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;         }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bSpanAbove &amp;&amp; (nY &gt; 0) &amp;&amp; ((! m_pRasterGrid-&gt;m_Cell[nX][nY-1].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>()) || m_pRasterGrid-&gt;m_Cell[nX][nY-1].<a class="code" href="class_c_geom_cell.html#abe71e786629cf4cbb2dbbf219decdde2">bIsinThisShadowZone</a>(-nZone-1) || m_pRasterGrid-&gt;m_Cell[nX][nY-1].<a class="code" href="class_c_geom_cell.html#a2255f2e80624d34d39e0797f2108618d">bIsShadowZoneBoundary</a>() || m_pRasterGrid-&gt;m_Cell[nX][nY-1].<a class="code" href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">bIsCoastline</a>()))</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;         {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            bSpanAbove = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;         }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;         <span class="keywordflow">if</span> ((! bSpanBelow) &amp;&amp; m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>() &amp;&amp; (nY &lt; m_nYGridMax-1) &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY+1].<a class="code" href="class_c_geom_cell.html#abe71e786629cf4cbb2dbbf219decdde2">bIsinThisShadowZone</a>(-nZone-1)) &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY+1].<a class="code" href="class_c_geom_cell.html#a2255f2e80624d34d39e0797f2108618d">bIsShadowZoneBoundary</a>()) &amp;&amp; (! m_pRasterGrid-&gt;m_Cell[nX][nY+1].<a class="code" href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">bIsCoastline</a>()))</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;         {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            PtiStack.push(<a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a>(nX, nY+1));</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            bSpanBelow = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;         }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bSpanBelow &amp;&amp; (nY &lt; m_nYGridMax-1) &amp;&amp; ((! m_pRasterGrid-&gt;m_Cell[nX][nY+1].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>()) || m_pRasterGrid-&gt;m_Cell[nX][nY+1].<a class="code" href="class_c_geom_cell.html#abe71e786629cf4cbb2dbbf219decdde2">bIsinThisShadowZone</a>(-nZone-1) || m_pRasterGrid-&gt;m_Cell[nX][nY+1].<a class="code" href="class_c_geom_cell.html#a2255f2e80624d34d39e0797f2108618d">bIsShadowZoneBoundary</a>() || m_pRasterGrid-&gt;m_Cell[nX][nY+1].<a class="code" href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">bIsCoastline</a>()))</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;         {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            bSpanBelow = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;         }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;         nX++;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;   }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;}</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"> Traverse the shadow zone, changing wave orientation and height, and the down-drift zone, changing only wave height. Do this by following the coast between the shadow boundary start point and end point, and following the downdrift boundary between the same points. At each step, trace a linking line, then move along this line and change wave properties</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="keywordtype">int</span> CSimulation::nDoShadowZoneAndDownDriftZone(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nZone, <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowBoundaryStartPoint, <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowBoundaryEndPoint)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;{</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      nCoastSeaHand = m_VCoast[nCoast].nGetSeaHandedness(),</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      nShadowZoneCoastToCapeSeaHand;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160; </div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   <span class="keywordflow">if</span> (nCoastSeaHand == <a class="code" href="cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>)</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      nShadowZoneCoastToCapeSeaHand = <a class="code" href="cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      nShadowZoneCoastToCapeSeaHand = <a class="code" href="cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160; </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   <span class="comment">// We will traverse the coastline from the start point of the shadow zone line, going toward the end point. Which direction is this?</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;   <span class="keywordtype">bool</span> bSweepDownCoast = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;   <span class="keywordflow">if</span> (nShadowBoundaryEndPoint &lt; nShadowBoundaryStartPoint)</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      bSweepDownCoast = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;   <span class="comment">// Get the distance (in cells) from the shadow boundary start point to the shadow boundary end point, going along the coast</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;   <span class="keywordtype">int</span> nAlongCoastDistanceToShadowEndpoint = <a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(nShadowBoundaryEndPoint - nShadowBoundaryStartPoint - 1);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;   <span class="comment">// Calculate the point on the coastline which is 2 * nAlongCoastDistanceToShadowEndpoint from the shadow boundary start point, this will be the end point of the downdrift zone. This point may be beyond the end of the coastline in either direction</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      nDownDriftEndPoint,</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      nTotAlongCoastDistanceToDownDriftEndpoint = 2 * nAlongCoastDistanceToShadowEndpoint;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   <span class="keywordflow">if</span> (bSweepDownCoast)</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      nDownDriftEndPoint = nShadowBoundaryStartPoint + nTotAlongCoastDistanceToDownDriftEndpoint;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      nDownDriftEndPoint = nShadowBoundaryStartPoint - nTotAlongCoastDistanceToDownDriftEndpoint;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;   <span class="comment">// Next find the actual (i.e. within-grid) end of the downdrift line</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;   <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiDownDriftEndPoint;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;   <span class="comment">// Is the downdrift end point beyond the start or end of the coastline?</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;   <span class="keywordflow">if</span> (nDownDriftEndPoint &lt; 0)</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;   {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="comment">// Is beyond the start of the coastline</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keywordtype">int</span> nStartEdge = m_VCoast[nCoast].nGetStartEdge();</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <span class="keywordflow">if</span> (nStartEdge == <a class="code" href="cme_8h.html#af8f1a513adfc4d40f536ff45f704e654">NORTH</a>)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(0)-&gt;nGetX());</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(nDownDriftEndPoint);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      }</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nStartEdge == <a class="code" href="cme_8h.html#aa0ace1cae356bfb79245b65c0ae979d0">SOUTH</a>)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(0)-&gt;nGetX());</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(m_nYGridMax - nDownDriftEndPoint - 1);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nStartEdge == <a class="code" href="cme_8h.html#afeb3cef570a9344c7074258f3601b582">WEST</a>)</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(nDownDriftEndPoint);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(0)-&gt;nGetY());</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nStartEdge == <a class="code" href="cme_8h.html#aa5fa4b2d0efc2ff0f4e02e27ea50208a">EAST</a>)</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(m_nXGridMax - nDownDriftEndPoint - 1);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(0)-&gt;nGetY());</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;   }</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDownDriftEndPoint &gt;= m_VCoast[nCoast].nGetCoastlineSize())</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;   {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="comment">// Is beyond the end of the coastline</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;         nEndEdge = m_VCoast[nCoast].nGetEndEdge(),</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;         nCoastSize = m_VCoast[nCoast].nGetCoastlineSize();</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">if</span> (nEndEdge == <a class="code" href="cme_8h.html#af8f1a513adfc4d40f536ff45f704e654">NORTH</a>)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize-1)-&gt;nGetX());</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(-nDownDriftEndPoint);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nEndEdge == <a class="code" href="cme_8h.html#aa0ace1cae356bfb79245b65c0ae979d0">SOUTH</a>)</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize-1)-&gt;nGetX());</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(m_nYGridMax + nDownDriftEndPoint);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nEndEdge == <a class="code" href="cme_8h.html#afeb3cef570a9344c7074258f3601b582">WEST</a>)</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(-nDownDriftEndPoint);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize-1)-&gt;nGetY());</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nEndEdge == <a class="code" href="cme_8h.html#aa5fa4b2d0efc2ff0f4e02e27ea50208a">EAST</a>)</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      {</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a84c27fdfdfca1e5222a141717ab8f6e4">SetX</a>(m_nXGridMax + nDownDriftEndPoint);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;         PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a4350a3410e098a2cb27fbeaa6b12b5e5">SetY</a>(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nCoastSize-1)-&gt;nGetY());</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;   }</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;   {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="comment">// Is on the coastline, so get the location (grid CRS)</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      PtiDownDriftEndPoint = *m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nDownDriftEndPoint);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;   }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   <span class="comment">// Get the location (grid CRS) of the shadow boundary start point: this is also the start point of the downdrift boundary</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;   <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a>* pPtiDownDriftBoundaryStartPoint = m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nShadowBoundaryStartPoint);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   <span class="comment">// Now trace the down-drift boundary line: interpolate between cells by a simple DDA line algorithm, see http://en.wikipedia.org/wiki/Digital_differential_analyzer_(graphics_algorithm) Note that Bresenham&#39;s algorithm gave occasional gaps</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      nXStart = pPtiDownDriftBoundaryStartPoint-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      nYStart = pPtiDownDriftBoundaryStartPoint-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      dXStart = dGridCentroidXToExtCRSX(nXStart),</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      dYStart = dGridCentroidYToExtCRSY(nYStart),</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      dXEnd = dGridCentroidXToExtCRSX(PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>()),</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      dYEnd = dGridCentroidYToExtCRSY(PtiDownDriftEndPoint.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>()),</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      dXInc = dXEnd - dXStart,</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      dYInc = dYEnd - dYStart,</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      dLength = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(<a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dXInc), <a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dYInc));</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;   dXInc /= dLength;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   dYInc /= dLength;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;   <span class="keywordtype">int</span> nTotDownDriftBoundaryDistance = 0;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      dX = nXStart,</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      dY = nYStart;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160; </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;   <a class="code" href="class_c_geom_line.html">CGeomLine</a> LDownDriftBoundary;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   <span class="comment">// Process each interpolated point</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt;= <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dLength); m++)</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;   {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;         nX = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(dX),</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;         nY = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(dY);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keywordflow">if</span> (! bIsWithinValidGrid(nX, nY))</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;         <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="comment">// OK, this is part of the downdrift boundary so store this co-ordinate and mark the cell</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtThis(dGridCentroidXToExtCRSX(nX), dGridCentroidYToExtCRSY(nY));</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <span class="comment">// Make sure we have not already stored this co-ordinate (can happen, due to rounding)</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <span class="keywordflow">if</span> ((LDownDriftBoundary.<a class="code" href="class_c_a2_d_shape.html#ac220b8554a95ebe15b345ef2bd04177b">nGetSize</a>() == 0) || (PtThis != LDownDriftBoundary.<a class="code" href="class_c_a2_d_shape.html#a7f8d2942affd69f8de65e36f9c6acd3c">pPtBack</a>()))</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      {</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;         <span class="comment">// Store this co-ordinate</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;         LDownDriftBoundary.<a class="code" href="class_c_a2_d_shape.html#a089f43fb767f120e2bffbfc40b8dc0ac">Append</a>(&amp;PtThis);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;         <span class="comment">// Mark the cell (a +ve number, same as the associated shadow zone number i.e. starting from 1)</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a743ead8c46d80aff75ebc4f1297d4f64">SetDownDriftZoneNumber</a>(nZone+1);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;         <span class="comment">// Increment the boundary length</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;         nTotDownDriftBoundaryDistance++;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;DownDrift boundary [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160; </div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;         <span class="comment">// And increment for next time</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;         <span class="keywordflow">if</span> (dXEnd &gt; dXStart)</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            dX -= dXInc;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;            dX += dXInc;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160; </div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;         <span class="keywordflow">if</span> (dYEnd &gt; dYStart)</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            dY += dYInc;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            dY -= dYInc;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;   }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   <span class="comment">// Store the downdrift boundary (external CRS), with the start point first</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;   m_VCoast[nCoast].AppendShadowDowndriftBoundary(&amp;LDownDriftBoundary);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160; </div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;   <span class="comment">// Compare the lengths of the along-coast and the along-downdrift boundaries. The increment will be 1 for the smaller of the two, will be &gt; 1 for the larger of the two</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="keywordtype">int</span> nMaxDistance;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      dAlongCoastIncrement = 1,</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      dDownDriftBoundaryIncrement = 1;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   <span class="keywordflow">if</span> (nTotAlongCoastDistanceToDownDriftEndpoint &lt; nTotDownDriftBoundaryDistance)</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;   {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="comment">// The downdrift boundary distance is the larger, so change it</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      dDownDriftBoundaryIncrement = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(nTotDownDriftBoundaryDistance) / nTotAlongCoastDistanceToDownDriftEndpoint;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      nMaxDistance = nTotDownDriftBoundaryDistance;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   }</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;   {</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      <span class="comment">// The along-coast distance is the larger, so change it</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      dAlongCoastIncrement = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(nTotAlongCoastDistanceToDownDriftEndpoint) / nTotDownDriftBoundaryDistance;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      nMaxDistance = nTotAlongCoastDistanceToDownDriftEndpoint;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;   }</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      dCoastDistSoFar = 0,</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      dDownDriftBoundaryDistSoFar = 0;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;   <span class="comment">// Now traverse the along-coast line and the down-drift boundary line, but with different increments for each</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 1; n &lt; nMaxDistance-1; n++)</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   {</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      dCoastDistSoFar += dAlongCoastIncrement;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      dDownDriftBoundaryDistSoFar += dDownDriftBoundaryIncrement;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; endl;</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="keywordflow">if</span> ((dCoastDistSoFar &gt;= nTotAlongCoastDistanceToDownDriftEndpoint) || (dDownDriftBoundaryDistSoFar &gt;= nTotDownDriftBoundaryDistance))</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="keywordtype">bool</span> bPastShadowEnd = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="keywordtype">int</span> nAlongCoast;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      <span class="keywordflow">if</span> (bSweepDownCoast)</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      {</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;         nAlongCoast = nShadowBoundaryStartPoint + <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dCoastDistSoFar);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;         <span class="keywordflow">if</span> (nAlongCoast &gt;= m_VCoast[nCoast].nGetCoastlineSize())</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160; </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;         <span class="keywordflow">if</span> (nAlongCoast &gt;= nShadowBoundaryEndPoint)</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            bPastShadowEnd = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      }</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;         nAlongCoast = nShadowBoundaryStartPoint - <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dCoastDistSoFar);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;         <span class="keywordflow">if</span> (nAlongCoast &lt; 0)</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160; </div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;         <span class="keywordflow">if</span> (nAlongCoast &lt;= nShadowBoundaryEndPoint)</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            bPastShadowEnd = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keywordtype">int</span> nAlongDownDriftBoundary = <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dDownDriftBoundaryDistSoFar);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">//       LogStream &lt;&lt; endl &lt;&lt; m_ulIter &lt;&lt; &quot;: dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;) dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160; </div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="comment">// nAlongCoast = &quot; &lt;&lt; nAlongCoast &lt;&lt; &quot;, nShadowBoundaryEndPoint = &quot; &lt;&lt; nShadowBoundaryEndPoint &lt;&lt; &quot;,  &lt;&lt; &quot;, nAlongDownDriftBoundary = &quot; &lt;&lt; nAlongDownDriftBoundary &lt;&lt; &quot;, &lt;&lt; endl;</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160; </div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="comment">// Get the two endpoints of the linking line</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a>* pPtiCoast = m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nAlongCoast);</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;         nCoastX = pPtiCoast-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;         nCoastY = pPtiCoast-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;         nDownDriftX = <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dExtCRSXToGridX(LDownDriftBoundary[nAlongDownDriftBoundary].dGetX())),</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;         nDownDriftY = <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dExtCRSYToGridY(LDownDriftBoundary[nAlongDownDriftBoundary].dGetY()));</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160; </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="comment">// Safety check, in case the two points are identical (can happen due to rounding)</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="keywordflow">if</span> ((nCoastX == nDownDriftX) &amp;&amp; (nCoastY == nDownDriftY))</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      {</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;         <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a>)</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast point and downdrift boundary point [&quot;</span> &lt;&lt; nCoastX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nCoastY &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nCoastX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nCoastY) &lt;&lt; <span class="stringliteral">&quot;} are identical, ignoring&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;         <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      }</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      <span class="comment">// Traverse the linking line, interpolating between cells by a simple DDA line algorithm, see http://en.wikipedia.org/wiki/Digital_differential_analyzer_(graphics_algorithm)</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      dXInc = nDownDriftX - nCoastX;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      dYInc = nDownDriftY - nCoastY;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <span class="keywordtype">double</span> dLinkingLineLength = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(<a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dXInc), <a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dYInc));</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160; </div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      dXInc /= dLinkingLineLength;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      dYInc /= dLinkingLineLength;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160; </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      dX = nCoastX,</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      dY = nCoastY;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160; </div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="comment">// Process each interpolated point along the linking line</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;         nXLast = -1,</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;         nYLast = -1,</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;         nShadowZoneLength = 0;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      vector&lt;int&gt; VnShadowCellX, VnShadowCellY;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt; dLinkingLineLength; m++)</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      {</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;         <span class="keywordtype">int</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;            nX = <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dX),</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;            nY = <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dY);</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;         <span class="comment">// Check to see if we just processed this point, can happen due to rounding</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;         <span class="keywordflow">if</span> ((nX == nXLast) &amp;&amp; (nY == nYLast))</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;         {</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: n = &quot; &lt;&lt; n &lt;&lt; &quot;, m = &quot; &lt;&lt; m &lt;&lt; &quot;, dLinkingLineLength = &quot; &lt;&lt; dLinkingLineLength &lt;&lt; &quot;, dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;), dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;) same as last point at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            <span class="comment">// Set for next time</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            nXLast = nX;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            nYLast = nY;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            dX += dXInc;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            dY += dYInc;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160; </div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;         }</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160; </div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;         <span class="comment">// Outside valid grid?</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;         <span class="keywordflow">if</span> (! bIsWithinValidGrid(nX, nY))</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;         {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: n = &quot; &lt;&lt; n &lt;&lt; &quot;, m = &quot; &lt;&lt; m &lt;&lt; &quot;, dLinkingLineLength = &quot; &lt;&lt; dLinkingLineLength &lt;&lt; &quot;, dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;), dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;) outside valid grid at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160; </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            <span class="comment">// Set for next time</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            nXLast = nX;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            nYLast = nY;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            dX += dXInc;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            dY += dYInc;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;         }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;         <span class="comment">// Not a sea cell?</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;         <span class="keywordflow">if</span> (! m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>())</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;         {</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            <span class="comment">// Not a sea cell</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: n = &quot; &lt;&lt; n &lt;&lt; &quot;, m = &quot; &lt;&lt; m &lt;&lt; &quot;, dLinkingLineLength = &quot; &lt;&lt; dLinkingLineLength &lt;&lt; &quot;, dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;), dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;) not a sea cell at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            <span class="comment">// Set for next time</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;            nXLast = nX;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            nYLast = nY;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            dX += dXInc;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            dY += dYInc;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160; </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;         }</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160; </div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;         <span class="comment">// Have we gone past the point where the shadow boundary meets the coast (i.e. the shadow boundary end point)?</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;         <span class="keywordflow">if</span> (! bPastShadowEnd)</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;         {</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            <span class="comment">// We have not, so the linking line has two parts: one between the coast and the shadow boundary, one between the shadow boundary and the downdrift boundary</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            <span class="keywordtype">bool</span> bInShadowZone = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            <span class="keywordflow">if</span> (! m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a164c51a1e98183be0e8fd5513eea496f">bIsinAnyShadowZone</a>())</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            {</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;               <span class="comment">// We have left the shadow zone</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">//                LogStream &lt;&lt; &quot;[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} LEFT SHADOW ZONE&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;               bInShadowZone = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160; </div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;               <span class="comment">// Go back over stored cell coords and set their wave properties</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;               <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mm = 0; mm &lt; VnShadowCellX.size(); mm++)</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;               {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                  <span class="comment">// Process this shadow zone cell</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                  ProcessShadowZoneCell(VnShadowCellX[mm], VnShadowCellY[mm], nShadowZoneCoastToCapeSeaHand, pPtiCoast, VnShadowCellX.back(), VnShadowCellY.back(), nZone);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160; </div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                  <span class="comment">// Also process adjacent cells</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                  <span class="keywordflow">if</span> (mm &gt; 0)</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                  {</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                     <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                        PtiLeft = PtiGetPerpendicular(VnShadowCellX[mm], VnShadowCellY[mm], VnShadowCellX[mm-1], VnShadowCellY[mm-1], 1, <a class="code" href="cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a>),</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                        PtiRight = PtiGetPerpendicular(VnShadowCellX[mm], VnShadowCellY[mm], VnShadowCellX[mm-1], VnShadowCellY[mm-1], 1, <a class="code" href="cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                     <span class="keywordflow">if</span> (bIsWithinValidGrid(&amp;PtiLeft))</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                        ProcessShadowZoneCell(PtiLeft.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(), PtiLeft.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>(), nShadowZoneCoastToCapeSeaHand, pPtiCoast, VnShadowCellX.back(), VnShadowCellY.back(), nZone);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                     <span class="keywordflow">if</span> (bIsWithinValidGrid(&amp;PtiRight))</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                        ProcessShadowZoneCell(PtiRight.nGetX(), PtiRight.nGetY(), nShadowZoneCoastToCapeSeaHand, pPtiCoast, VnShadowCellX.back(), VnShadowCellY.back(), nZone);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                  }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;               }</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            }</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            <span class="keywordflow">if</span> (bInShadowZone)</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            {</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;               <span class="comment">// Save coords for later</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;               VnShadowCellX.push_back(nX);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;               VnShadowCellY.push_back(nY);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160; </div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;               nShadowZoneLength++;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            {</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;               <span class="comment">// In downdrift zone</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">//                LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: n = &quot; &lt;&lt; n &lt;&lt; &quot;, m = &quot; &lt;&lt; m &lt;&lt; &quot;, dLinkingLineLength = &quot; &lt;&lt; dLinkingLineLength &lt;&lt; &quot;, dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;), dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;) has [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} in downdrift zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;               <span class="comment">// Process this downdrift cell</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;               ProcessDownDriftCell(nX, nY, (m - nShadowZoneLength), (dLinkingLineLength - nShadowZoneLength), nZone);</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;               <span class="comment">// Also process adjacent cells</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;               <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                  PtiLeft = PtiGetPerpendicular(nX, nY, nXLast, nYLast, 1, <a class="code" href="cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a>),</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                  PtiRight = PtiGetPerpendicular(nX, nY, nXLast, nYLast, 1, <a class="code" href="cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>);</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160; </div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;               <span class="keywordflow">if</span> (bIsWithinValidGrid(&amp;PtiLeft))</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                  ProcessDownDriftCell(PtiLeft.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(), PtiLeft.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>(), (m - nShadowZoneLength), (dLinkingLineLength - nShadowZoneLength), nZone);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160; </div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;               <span class="keywordflow">if</span> (bIsWithinValidGrid(&amp;PtiRight))</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                  ProcessDownDriftCell(PtiRight.nGetX(), PtiRight.nGetY(), (m - nShadowZoneLength), (dLinkingLineLength - nShadowZoneLength), nZone);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            }</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;         }</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;         {</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            <span class="comment">// We have, so the linking line has only one part: between the coast and the downdrift boundary.</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: n = &quot; &lt;&lt; n &lt;&lt; &quot;, m = &quot; &lt;&lt; m &lt;&lt; &quot;, dLinkingLineLength = &quot; &lt;&lt; dLinkingLineLength &lt;&lt; &quot;, dCoastDistSoFar = &quot; &lt;&lt; dCoastDistSoFar &lt;&lt; &quot; (nTotAlongCoastDistanceToDownDriftEndpoint = &quot; &lt;&lt; nTotAlongCoastDistanceToDownDriftEndpoint &lt;&lt; &quot;), dDownDriftBoundaryDistSoFar = &quot; &lt;&lt; dDownDriftBoundaryDistSoFar &lt;&lt; &quot; (nTotDownDriftBoundaryDistance = &quot; &lt;&lt; nTotDownDriftBoundaryDistance &lt;&lt; &quot;) has [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} in downdrift zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            <span class="comment">// Process this downdrift cell</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            ProcessDownDriftCell(nX, nY, m, dLinkingLineLength, nZone);</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160; </div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;            <span class="comment">// Also process adjacent cells</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            <span class="keywordflow">if</span> ((nXLast != -1) &amp;&amp; (nYLast != -1))</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;            {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;               <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                  PtiLeft = PtiGetPerpendicular(nX, nY, nXLast, nYLast, 1, <a class="code" href="cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a>),</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                  PtiRight = PtiGetPerpendicular(nX, nY, nXLast, nYLast, 1, <a class="code" href="cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>);</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;               <span class="keywordflow">if</span> (bIsWithinValidGrid(&amp;PtiLeft))</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                  ProcessDownDriftCell(PtiLeft.<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(), PtiLeft.<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>(), m, dLinkingLineLength, nZone);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;               <span class="keywordflow">if</span> (bIsWithinValidGrid(&amp;PtiRight))</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                  ProcessDownDriftCell(PtiRight.nGetX(), PtiRight.nGetY(), m, dLinkingLineLength, nZone);</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            }</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;         }</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;         <span class="comment">// Set for next time</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;         nXLast = nX;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;         nYLast = nY;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;         dX += dXInc;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;         dY += dYInc;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;   }</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160; </div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;}</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment"> Process a single cell which is in the downdrift zone, changing its wave height</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="comment"> ===============================================================================================================================*/</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="keywordtype">void</span> CSimulation::ProcessDownDriftCell(<span class="keywordtype">int</span> <span class="keyword">const</span> nX, <span class="keywordtype">int</span> <span class="keyword">const</span> nY, <span class="keywordtype">int</span> <span class="keyword">const</span> nTraversed, <span class="keywordtype">double</span> <span class="keyword">const</span> dTotalToTraverse, <span class="keywordtype">int</span> <span class="keyword">const</span> nZone)</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;{</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;   <span class="comment">// Get the pre-existing (i.e. shore-parallel) wave height</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;   <span class="keywordtype">double</span> dWaveHeight = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a770135e779cf4e4d74c9e78f19429d3c">dGetWaveHeight</a>();</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;   <span class="keywordflow">if</span> (dWaveHeight == <a class="code" href="cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a>)</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;   {</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="comment">// Is not a sea cell</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} ignored, not a sea cell&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;   }</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160; </div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   <span class="keywordtype">int</span> nZoneCode = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a206e79e2d10e831a8464079870bd547b">nGetShadowZoneNumber</a>();</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;   <span class="keywordflow">if</span> (nZoneCode == (nZone+1))</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   {</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <span class="comment">// This cell is in the associated shadow zone, so don&#39;t change it</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} ignored, is in associated shadow zone (&quot; &lt;&lt; nZone+1 &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160; </div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;   }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160; </div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;   <span class="keywordflow">if</span> (nZoneCode &lt; 0)</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;   {</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <span class="comment">// This cell is in a shadow zone but is not yet processed, so don&#39;t change it</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} ignored, is an unprocessed cell in shadow zone &quot; &lt;&lt; nZoneCode &lt;&lt; endl;</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160; </div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;   }</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160; </div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;   nZoneCode = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a9a5321cb6c2accfb287f60f7ca1011cd">nGetDownDriftZoneNumber</a>();</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;   <span class="keywordflow">if</span> (nZoneCode == (nZone+1))</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   {</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <span class="comment">// We have already processed this cell for this downdrift zone</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} ignored, already done for this down-drift zone &quot; &lt;&lt; nZone+1 &lt;&lt; endl;</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160; </div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;   }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   <span class="comment">// OK, we are downdrift of the shadow zone area and have not yet processed this cell for this zone, so mark it</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a743ead8c46d80aff75ebc4f1297d4f64">SetDownDriftZoneNumber</a>(nZone+1);</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   <span class="comment">// Equation 14 from Hurst et al. NOTE could not get this to work (typo in paper?), so used the equation below instead</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;   <span class="comment">// double dKp = 0.5 * (1.0 - sin((PI * 90.0 * nSweep) / (180.0 * nSweepLength)));</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;   <span class="keywordtype">double</span> dKp = 0.5 + (0.5 * sin((<a class="code" href="cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> * nTraversed) / (2.0 * dTotalToTraverse)));</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160; </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;   <span class="comment">// Set the modified wave height</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;   m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a213153422f9420825faafb87281e9f64">SetWaveHeight</a>(dKp * dWaveHeight);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160; </div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}, nTraversed = &quot; &lt;&lt; nTraversed &lt;&lt; &quot; dTotalToTraverse = &quot; &lt;&lt; dTotalToTraverse &lt;&lt; &quot; fraction traversed = &quot; &lt;&lt; nTraversed / dTotalToTraverse &lt;&lt; endl &lt;&lt; &quot;m_pRasterGrid-&gt;m_Cell[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;].dGetCellDeepWaterWaveHeight() = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetCellDeepWaterWaveHeight() &lt;&lt; &quot; m, original dWaveHeight = &quot; &lt;&lt; dWaveHeight &lt;&lt; &quot; m, dKp = &quot; &lt;&lt; dKp &lt;&lt; &quot;, modified wave height = &quot; &lt;&lt; dKp * dWaveHeight &lt;&lt; &quot; m&quot; &lt;&lt; endl &lt;&lt; endl;</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;}</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160; </div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment"> Process a single cell which is in the shadow zone, changing its wave height and orientation</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment"> ===============================================================================================================================*/</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="keywordtype">void</span> CSimulation::ProcessShadowZoneCell(<span class="keywordtype">int</span> <span class="keyword">const</span> nX, <span class="keywordtype">int</span> <span class="keyword">const</span> nY, <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowZoneCoastToCapeSeaHand, <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> <span class="keyword">const</span>* pPtiCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowEndX, <span class="keywordtype">int</span> <span class="keyword">const</span> nShadowEndY, <span class="keywordtype">int</span> <span class="keyword">const</span> nZone)</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;{</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;   <span class="keywordtype">int</span> nZoneCode = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a206e79e2d10e831a8464079870bd547b">nGetShadowZoneNumber</a>();</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;   <span class="keywordflow">if</span> (nZoneCode == (-nZone-1))</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;   {</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="comment">// OK, we are in the shadow zone and have not already processed this cell, so mark it (a +ve number, starting from 1)</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ab47e7d28ef537f73698efadd12a33c56">SetShadowZoneNumber</a>(nZone+1);</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160; </div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <span class="comment">// Next calculate wave angle here: first calculate dOmega, the signed angle subtended between this end point and the start point, and this end point and the end of the shadow boundary</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;         PtiThis(nX, nY),</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;         PtiShadowBoundary(nShadowEndX, nShadowEndY);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="keywordtype">double</span> dOmega = 180 * dAngleSubtended(pPtiCoast, &amp;PtiThis, &amp;PtiShadowBoundary) / <a class="code" href="cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a>;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160; </div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <span class="comment">// If dOmega is 90 degrees or more in either direction, set both wave angle and wave height to zero</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dOmega) &gt;= 90)</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      {</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ac90e70d353979a2f6ec2ccafa7304341">SetWaveAngle</a>(0);</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a213153422f9420825faafb87281e9f64">SetWaveHeight</a>(0);</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160; </div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">//          LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: on shadow linking line with coast end [&quot; &lt;&lt; pPtiCoast-&gt;nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; pPtiCoast-&gt;nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(pPtiCoast-&gt;nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(pPtiCoast-&gt;nGetY()) &lt;&lt; &quot;} and shadow boundary end [&quot; &lt;&lt; PtiShadowBoundary.nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; PtiShadowBoundary.nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(PtiShadowBoundary.nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(PtiShadowBoundary.nGetY()) &lt;&lt; &quot;}, this point [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl &lt;&lt; &quot;angle subtended = &quot; &lt;&lt; dOmega &lt;&lt; &quot; degrees, m_pRasterGrid-&gt;m_Cell[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;].dGetCellDeepWaterWaveHeight() = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetCellDeepWaterWaveHeight() &lt;&lt; &quot; degrees, wave orientation = 0 degrees, wave height = 0 m&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      }</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      {</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;         <span class="comment">// Adapted from equation 12 in Hurst et al.</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;         <span class="keywordtype">double</span> dDeltaShadowWaveAngle = 1.5 * dOmega;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160; </div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;         <span class="comment">// Get the pre-existing (i.e. shore-parallel) wave orientation</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;         <span class="keywordtype">double</span> dWaveAngle = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a782684d4d435c36a1a2d364a5e1ed33c">dGetWaveAngle</a>();</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160; </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;         <span class="keywordtype">double</span> dShadowWaveAngle;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;         <span class="keywordflow">if</span> (nShadowZoneCoastToCapeSeaHand == <a class="code" href="cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a>)</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            dShadowWaveAngle = dWaveAngle + dDeltaShadowWaveAngle;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            dShadowWaveAngle = dWaveAngle - dDeltaShadowWaveAngle;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160; </div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;         <span class="comment">// Set the shadow zone wave orientation</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ac90e70d353979a2f6ec2ccafa7304341">SetWaveAngle</a>(dKeepWithin360(dShadowWaveAngle));</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160; </div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;         <span class="comment">// Now calculate wave height within the shadow zone, use equation 13 from Hurst et al.</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;         <span class="keywordtype">double</span> dKp = 0.5 * cos(dOmega * <a class="code" href="cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a> / 180);</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160; </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;         <span class="comment">// Get the pre-existing (i.e. shore-parallel) wave height</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;         <span class="keywordtype">double</span> dWaveHeight = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a770135e779cf4e4d74c9e78f19429d3c">dGetWaveHeight</a>();</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160; </div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;         <span class="comment">// Set the shadow zone wave height</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a213153422f9420825faafb87281e9f64">SetWaveHeight</a>(dKp * dWaveHeight);</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; </div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">//          LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: on shadow linking line with coast end [&quot; &lt;&lt; pPtiCoast-&gt;nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; pPtiCoast-&gt;nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(pPtiCoast-&gt;nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(pPtiCoast-&gt;nGetY()) &lt;&lt; &quot;} and shadow boundary end [&quot; &lt;&lt; PtiShadowBoundary.nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; PtiShadowBoundary.nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(PtiShadowBoundary.nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(PtiShadowBoundary.nGetY()) &lt;&lt; &quot;}, this point [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}, angle subtended = &quot; &lt;&lt; dOmega &lt;&lt; &quot; degrees, m_pRasterGrid-&gt;m_Cell[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;].dGetCellDeepWaterWaveHeight() = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetCellDeepWaterWaveHeight() &lt;&lt; &quot; m, dDeltaShadowWaveAngle = &quot; &lt;&lt; dDeltaShadowWaveAngle &lt;&lt; &quot; degrees, dWaveAngle = &quot; &lt;&lt; dWaveAngle &lt;&lt; &quot; degrees, dShadowWaveAngle = &quot; &lt;&lt; dShadowWaveAngle &lt;&lt; &quot; degrees, dWaveHeight = &quot; &lt;&lt; dWaveHeight &lt;&lt; &quot; m, dKp = &quot; &lt;&lt; dKp &lt;&lt; &quot;, shadow zone wave height = &quot; &lt;&lt; dKp * dWaveHeight &lt;&lt; &quot; m&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      }</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;   }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;}</div>
<div class="ttc" id="aclass_c_a2_d_i_shape_html_a704d22f3d9c5b553861947c6500e6fb7"><div class="ttname"><a href="class_c_a2_d_i_shape.html#a704d22f3d9c5b553861947c6500e6fb7">CA2DIShape::Back</a></div><div class="ttdeci">CGeom2DIPoint &amp; Back(void)</div><div class="ttdef"><b>Definition:</b> <a href="2di__shape_8cpp_source.html#l00047">2di_shape.cpp:47</a></div></div>
<div class="ttc" id="aclass_c_a2_d_i_shape_html_a9d97e2e53a6e13b56664cced2d6e4f6a"><div class="ttname"><a href="class_c_a2_d_i_shape.html#a9d97e2e53a6e13b56664cced2d6e4f6a">CA2DIShape::AppendIfNotAlready</a></div><div class="ttdeci">void AppendIfNotAlready(int const, int const)</div><div class="ttdef"><b>Definition:</b> <a href="2di__shape_8cpp_source.html#l00089">2di_shape.cpp:89</a></div></div>
<div class="ttc" id="aclass_c_a2_d_i_shape_html_ab181578766d0cacb30c7ad0d695bf595"><div class="ttname"><a href="class_c_a2_d_i_shape.html#ab181578766d0cacb30c7ad0d695bf595">CA2DIShape::Append</a></div><div class="ttdeci">void Append(CGeom2DIPoint const *)</div><div class="ttdef"><b>Definition:</b> <a href="2di__shape_8cpp_source.html#l00079">2di_shape.cpp:79</a></div></div>
<div class="ttc" id="aclass_c_a2_d_i_shape_html_ae149d229c6313db4f4435fa104f40a90"><div class="ttname"><a href="class_c_a2_d_i_shape.html#ae149d229c6313db4f4435fa104f40a90">CA2DIShape::pPtiVGetPoints</a></div><div class="ttdeci">vector&lt; CGeom2DIPoint &gt; * pPtiVGetPoints(void)</div><div class="ttdef"><b>Definition:</b> <a href="2di__shape_8cpp_source.html#l00052">2di_shape.cpp:52</a></div></div>
<div class="ttc" id="aclass_c_a2_d_shape_html_a089f43fb767f120e2bffbfc40b8dc0ac"><div class="ttname"><a href="class_c_a2_d_shape.html#a089f43fb767f120e2bffbfc40b8dc0ac">CA2DShape::Append</a></div><div class="ttdeci">void Append(CGeom2DPoint const *)</div><div class="ttdef"><b>Definition:</b> <a href="2d__shape_8cpp_source.html#l00065">2d_shape.cpp:65</a></div></div>
<div class="ttc" id="aclass_c_a2_d_shape_html_a54eb0a2ab77aa22b8d1af5f8f1f40383"><div class="ttname"><a href="class_c_a2_d_shape.html#a54eb0a2ab77aa22b8d1af5f8f1f40383">CA2DShape::Reverse</a></div><div class="ttdeci">void Reverse(void)</div><div class="ttdoc">Reverses the sequence of pointsw in this 2D polygon.</div><div class="ttdef"><b>Definition:</b> <a href="2d__shape_8cpp_source.html#l00166">2d_shape.cpp:166</a></div></div>
<div class="ttc" id="aclass_c_a2_d_shape_html_a7f8d2942affd69f8de65e36f9c6acd3c"><div class="ttname"><a href="class_c_a2_d_shape.html#a7f8d2942affd69f8de65e36f9c6acd3c">CA2DShape::pPtBack</a></div><div class="ttdeci">CGeom2DPoint * pPtBack(void)</div><div class="ttdef"><b>Definition:</b> <a href="2d__shape_8cpp_source.html#l00087">2d_shape.cpp:87</a></div></div>
<div class="ttc" id="aclass_c_a2_d_shape_html_aaa15397a5761d17635afdaddbec35c8a"><div class="ttname"><a href="class_c_a2_d_shape.html#aaa15397a5761d17635afdaddbec35c8a">CA2DShape::AppendIfNotAlready</a></div><div class="ttdeci">void AppendIfNotAlready(double const, double const)</div><div class="ttdef"><b>Definition:</b> <a href="2d__shape_8cpp_source.html#l00075">2d_shape.cpp:75</a></div></div>
<div class="ttc" id="aclass_c_a2_d_shape_html_ac220b8554a95ebe15b345ef2bd04177b"><div class="ttname"><a href="class_c_a2_d_shape.html#ac220b8554a95ebe15b345ef2bd04177b">CA2DShape::nGetSize</a></div><div class="ttdeci">int nGetSize(void) const</div><div class="ttdef"><b>Definition:</b> <a href="2d__shape_8cpp_source.html#l00054">2d_shape.cpp:54</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html"><div class="ttname"><a href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with integer co-ordinates.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8h_source.html#l00029">2di_point.h:30</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_a4350a3410e098a2cb27fbeaa6b12b5e5"><div class="ttname"><a href="class_c_geom2_d_i_point.html#a4350a3410e098a2cb27fbeaa6b12b5e5">CGeom2DIPoint::SetY</a></div><div class="ttdeci">void SetY(int const)</div><div class="ttdoc">The integer parameter sets a value for the CGeom2DIPoint object's Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00074">2di_point.cpp:74</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_a4d9c20bcca90dcb9d519b664aba09cbd"><div class="ttname"><a href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">CGeom2DIPoint::nGetY</a></div><div class="ttdeci">int nGetY(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object's integer Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00050">2di_point.cpp:50</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_a84c27fdfdfca1e5222a141717ab8f6e4"><div class="ttname"><a href="class_c_geom2_d_i_point.html#a84c27fdfdfca1e5222a141717ab8f6e4">CGeom2DIPoint::SetX</a></div><div class="ttdeci">void SetX(int const)</div><div class="ttdoc">The integer parameter sets a value for the CGeom2DIPoint object's X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00068">2di_point.cpp:68</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_af84c687b2d0be01ab41cbcc0565f4f3f"><div class="ttname"><a href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">CGeom2DIPoint::nGetX</a></div><div class="ttdeci">int nGetX(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object's integer X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00044">2di_point.cpp:44</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html"><div class="ttname"><a href="class_c_geom2_d_point.html">CGeom2DPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with floating-point co-ordinates.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8h_source.html#l00029">2d_point.h:30</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_a216921dc2c592d9468e6430fee7c7719"><div class="ttname"><a href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">CGeom2DPoint::dGetY</a></div><div class="ttdeci">double dGetY(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object's double Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00050">2d_point.cpp:50</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_a250f937d03cfdf6e0244b74ad2bf96a4"><div class="ttname"><a href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">CGeom2DPoint::dGetX</a></div><div class="ttdeci">double dGetX(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object's double X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00044">2d_point.cpp:44</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a164c51a1e98183be0e8fd5513eea496f"><div class="ttname"><a href="class_c_geom_cell.html#a164c51a1e98183be0e8fd5513eea496f">CGeomCell::bIsinAnyShadowZone</a></div><div class="ttdeci">bool bIsinAnyShadowZone(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00234">cell.cpp:234</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a206e79e2d10e831a8464079870bd547b"><div class="ttname"><a href="class_c_geom_cell.html#a206e79e2d10e831a8464079870bd547b">CGeomCell::nGetShadowZoneNumber</a></div><div class="ttdeci">int nGetShadowZoneNumber(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00221">cell.cpp:221</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a213153422f9420825faafb87281e9f64"><div class="ttname"><a href="class_c_geom_cell.html#a213153422f9420825faafb87281e9f64">CGeomCell::SetWaveHeight</a></div><div class="ttdeci">void SetWaveHeight(double const)</div><div class="ttdoc">Sets the wave height on this cell, also increments the total wave height.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00604">cell.cpp:604</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a2255f2e80624d34d39e0797f2108618d"><div class="ttname"><a href="class_c_geom_cell.html#a2255f2e80624d34d39e0797f2108618d">CGeomCell::bIsShadowZoneBoundary</a></div><div class="ttdeci">bool bIsShadowZoneBoundary(void) const</div><div class="ttdoc">Returns a flag which shows whether this cell is a shadow zone boundary.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00139">cell.cpp:139</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a25d985b5c6cec28ded1634131128a547"><div class="ttname"><a href="class_c_geom_cell.html#a25d985b5c6cec28ded1634131128a547">CGeomCell::dGetCellDeepWaterWaveAngle</a></div><div class="ttdeci">double dGetCellDeepWaterWaveAngle(void) const</div><div class="ttdoc">Returns the deep water wave orientation on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00663">cell.cpp:663</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a28b760b0a9e63afd01e29610888fc7bc"><div class="ttname"><a href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">CGeomCell::bIsInContiguousSea</a></div><div class="ttdeci">bool bIsInContiguousSea(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00102">cell.cpp:102</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a31dd44509b9f8bfcc39726a391507109"><div class="ttname"><a href="class_c_geom_cell.html#a31dd44509b9f8bfcc39726a391507109">CGeomCell::bIsBoundingBoxEdge</a></div><div class="ttdeci">bool bIsBoundingBoxEdge(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00091">cell.cpp:91</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a657a6ebbff5ffe37aedad0d26281eb03"><div class="ttname"><a href="class_c_geom_cell.html#a657a6ebbff5ffe37aedad0d26281eb03">CGeomCell::bIsInActiveZone</a></div><div class="ttdeci">bool bIsInActiveZone(void) const</div><div class="ttdoc">Returns a flag which shows whether this cell is in the active zone.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00126">cell.cpp:126</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a743ead8c46d80aff75ebc4f1297d4f64"><div class="ttname"><a href="class_c_geom_cell.html#a743ead8c46d80aff75ebc4f1297d4f64">CGeomCell::SetDownDriftZoneNumber</a></div><div class="ttdeci">void SetDownDriftZoneNumber(int const)</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00242">cell.cpp:242</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a770135e779cf4e4d74c9e78f19429d3c"><div class="ttname"><a href="class_c_geom_cell.html#a770135e779cf4e4d74c9e78f19429d3c">CGeomCell::dGetWaveHeight</a></div><div class="ttdeci">double dGetWaveHeight(void) const</div><div class="ttdoc">Returns the wave height on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00614">cell.cpp:614</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a782684d4d435c36a1a2d364a5e1ed33c"><div class="ttname"><a href="class_c_geom_cell.html#a782684d4d435c36a1a2d364a5e1ed33c">CGeomCell::dGetWaveAngle</a></div><div class="ttdeci">double dGetWaveAngle(void) const</div><div class="ttdoc">Returns the wave orientation on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00633">cell.cpp:633</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a9a5321cb6c2accfb287f60f7ca1011cd"><div class="ttname"><a href="class_c_geom_cell.html#a9a5321cb6c2accfb287f60f7ca1011cd">CGeomCell::nGetDownDriftZoneNumber</a></div><div class="ttdeci">int nGetDownDriftZoneNumber(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00247">cell.cpp:247</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_ab47e7d28ef537f73698efadd12a33c56"><div class="ttname"><a href="class_c_geom_cell.html#ab47e7d28ef537f73698efadd12a33c56">CGeomCell::SetShadowZoneNumber</a></div><div class="ttdeci">void SetShadowZoneNumber(int const)</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00216">cell.cpp:216</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_abe71e786629cf4cbb2dbbf219decdde2"><div class="ttname"><a href="class_c_geom_cell.html#abe71e786629cf4cbb2dbbf219decdde2">CGeomCell::bIsinThisShadowZone</a></div><div class="ttdeci">bool bIsinThisShadowZone(int const) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00226">cell.cpp:226</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_ac90e70d353979a2f6ec2ccafa7304341"><div class="ttname"><a href="class_c_geom_cell.html#ac90e70d353979a2f6ec2ccafa7304341">CGeomCell::SetWaveAngle</a></div><div class="ttdeci">void SetWaveAngle(double const)</div><div class="ttdoc">Sets the wave orientation on this cell, also increments the total wave orientation.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00626">cell.cpp:626</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_aca6ca09523f23efe7077ecaaedbfce5d"><div class="ttname"><a href="class_c_geom_cell.html#aca6ca09523f23efe7077ecaaedbfce5d">CGeomCell::SetShadowZoneBoundary</a></div><div class="ttdeci">void SetShadowZoneBoundary(void)</div><div class="ttdoc">Sets a flag to show that this cell is a shadow zone boundary.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00133">cell.cpp:133</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_adf6945cbe65da7210a2f5d49ef7f736e"><div class="ttname"><a href="class_c_geom_cell.html#adf6945cbe65da7210a2f5d49ef7f736e">CGeomCell::bIsCoastline</a></div><div class="ttdeci">bool bIsCoastline(void) const</div><div class="ttdoc">Returns true if the cell is 'under' a coastline.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00176">cell.cpp:176</a></div></div>
<div class="ttc" id="aclass_c_geom_i_line_html"><div class="ttname"><a href="class_c_geom_i_line.html">CGeomILine</a></div><div class="ttdoc">Geometry class used to represent 2D vector integer line objects.</div><div class="ttdef"><b>Definition:</b> <a href="i__line_8h_source.html#l00033">i_line.h:34</a></div></div>
<div class="ttc" id="aclass_c_geom_i_line_html_a5129fc96323c094fe52487ad428ce546"><div class="ttname"><a href="class_c_geom_i_line.html#a5129fc96323c094fe52487ad428ce546">CGeomILine::bIsPresent</a></div><div class="ttdeci">bool bIsPresent(int const, int const)</div><div class="ttdef"><b>Definition:</b> <a href="i__line_8cpp_source.html#l00071">i_line.cpp:71</a></div></div>
<div class="ttc" id="aclass_c_geom_line_html"><div class="ttname"><a href="class_c_geom_line.html">CGeomLine</a></div><div class="ttdoc">Geometry class used to represent 2D vector line objects.</div><div class="ttdef"><b>Definition:</b> <a href="line_8h_source.html#l00033">line.h:34</a></div></div>
<div class="ttc" id="aclass_c_simulation_html_a222962121613613a48f518e0c2110f21"><div class="ttname"><a href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">CSimulation::LogStream</a></div><div class="ttdeci">ofstream LogStream</div><div class="ttdef"><b>Definition:</b> <a href="simulation_8h_source.html#l00806">simulation.h:806</a></div></div>
<div class="ttc" id="acme_8h_html"><div class="ttname"><a href="cme_8h.html">cme.h</a></div><div class="ttdoc">This file contains global definitions for CoastalME.</div></div>
<div class="ttc" id="acme_8h_html_a01aa8b423260b337ddff2016107b51a0"><div class="ttname"><a href="cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a></div><div class="ttdeci">int const INT_NODATA</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00188">cme.h:188</a></div></div>
<div class="ttc" id="acme_8h_html_a052095c3f746a887244b9818d181696c"><div class="ttname"><a href="cme_8h.html#a052095c3f746a887244b9818d181696c">MAX_LEN_SHADOW_LINE_TO_IGNORE</a></div><div class="ttdeci">int const MAX_LEN_SHADOW_LINE_TO_IGNORE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00173">cme.h:173</a></div></div>
<div class="ttc" id="acme_8h_html_a068017859403c0629d89f8d348f6c224"><div class="ttname"><a href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a></div><div class="ttdeci">T tMin(T a, T b)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00852">cme.h:852</a></div></div>
<div class="ttc" id="acme_8h_html_a292fc90846543ca4814daa9f759feb05"><div class="ttname"><a href="cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a></div><div class="ttdeci">string const ERR</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00543">cme.h:543</a></div></div>
<div class="ttc" id="acme_8h_html_a2f39c393cbe19710d077797fdf2a843d"><div class="ttname"><a href="cme_8h.html#a2f39c393cbe19710d077797fdf2a843d">CREATE_SHADOW_ZONE_IF_HITS_GRID_EDGE</a></div><div class="ttdeci">bool const CREATE_SHADOW_ZONE_IF_HITS_GRID_EDGE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00155">cme.h:155</a></div></div>
<div class="ttc" id="acme_8h_html_a368ba64a15504bd62f1711a5d11d78a6"><div class="ttname"><a href="cme_8h.html#a368ba64a15504bd62f1711a5d11d78a6">RTN_ERR_SHADOW_ZONE_FLOOD_START_POINT</a></div><div class="ttdeci">int const RTN_ERR_SHADOW_ZONE_FLOOD_START_POINT</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00410">cme.h:410</a></div></div>
<div class="ttc" id="acme_8h_html_a44a80b23b966b8f1aa8a620bceb50b2b"><div class="ttname"><a href="cme_8h.html#a44a80b23b966b8f1aa8a620bceb50b2b">MAX_NUM_PREV_ORIENTATION_VALUES</a></div><div class="ttdeci">int const MAX_NUM_PREV_ORIENTATION_VALUES</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00175">cme.h:175</a></div></div>
<div class="ttc" id="acme_8h_html_a4c7934393517cd814fe5ead496fa15b9"><div class="ttname"><a href="cme_8h.html#a4c7934393517cd814fe5ead496fa15b9">RTN_ERR_SHADOW_ZONE_FLOOD_FILL_NOGRID</a></div><div class="ttdeci">int const RTN_ERR_SHADOW_ZONE_FLOOD_FILL_NOGRID</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00409">cme.h:409</a></div></div>
<div class="ttc" id="acme_8h_html_a540d8a94fc09b0b14fd8ab657445b67a"><div class="ttname"><a href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a></div><div class="ttdeci">int const LOG_FILE_MIDDLE_DETAIL</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00180">cme.h:180</a></div></div>
<div class="ttc" id="acme_8h_html_a5d502a06fdd71825be49e07c95496b16"><div class="ttname"><a href="cme_8h.html#a5d502a06fdd71825be49e07c95496b16">PI</a></div><div class="ttdeci">double const PI</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00451">cme.h:451</a></div></div>
<div class="ttc" id="acme_8h_html_a7e895b460cef877dec4d12ead0c74f15"><div class="ttname"><a href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a></div><div class="ttdeci">T tMax(T a, T b)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00839">cme.h:839</a></div></div>
<div class="ttc" id="acme_8h_html_a93ac0c692cfeb8082f10c7b5064a4c6a"><div class="ttname"><a href="cme_8h.html#a93ac0c692cfeb8082f10c7b5064a4c6a">MIN_LENGTH_OF_SHADOW_ZONE_LINE</a></div><div class="ttdeci">double const MIN_LENGTH_OF_SHADOW_ZONE_LINE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00473">cme.h:473</a></div></div>
<div class="ttc" id="acme_8h_html_a957ca99e98618160534cafb0929f743d"><div class="ttname"><a href="cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a></div><div class="ttdeci">string const WARN</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00544">cme.h:544</a></div></div>
<div class="ttc" id="acme_8h_html_aa0ace1cae356bfb79245b65c0ae979d0"><div class="ttname"><a href="cme_8h.html#aa0ace1cae356bfb79245b65c0ae979d0">SOUTH</a></div><div class="ttdeci">int const SOUTH</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00195">cme.h:195</a></div></div>
<div class="ttc" id="acme_8h_html_aa5fa4b2d0efc2ff0f4e02e27ea50208a"><div class="ttname"><a href="cme_8h.html#aa5fa4b2d0efc2ff0f4e02e27ea50208a">EAST</a></div><div class="ttdeci">int const EAST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00193">cme.h:193</a></div></div>
<div class="ttc" id="acme_8h_html_aa768cb14b5c6123ee95e6e4ebd9fe331"><div class="ttname"><a href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a></div><div class="ttdeci">int const RTN_OK</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00358">cme.h:358</a></div></div>
<div class="ttc" id="acme_8h_html_ac003bdff958dca839f5d274f15786e07"><div class="ttname"><a href="cme_8h.html#ac003bdff958dca839f5d274f15786e07">DBL_NODATA</a></div><div class="ttdeci">double const DBL_NODATA</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00476">cme.h:476</a></div></div>
<div class="ttc" id="acme_8h_html_ac45b8f6cf8276514853c55bb394a10b5"><div class="ttname"><a href="cme_8h.html#ac45b8f6cf8276514853c55bb394a10b5">MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE</a></div><div class="ttdeci">double const MAX_LAND_LENGTH_OF_SHADOW_ZONE_LINE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00474">cme.h:474</a></div></div>
<div class="ttc" id="acme_8h_html_adc384b5f75dbfc8d278db8084d25a8eb"><div class="ttname"><a href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a></div><div class="ttdeci">int const LOG_FILE_MOST_DETAIL</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00181">cme.h:181</a></div></div>
<div class="ttc" id="acme_8h_html_ade186989e07cd54874887cd10d4a8465"><div class="ttname"><a href="cme_8h.html#ade186989e07cd54874887cd10d4a8465">RIGHT_HANDED</a></div><div class="ttdeci">int const RIGHT_HANDED</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00205">cme.h:205</a></div></div>
<div class="ttc" id="acme_8h_html_ae3b6dc50cfc97050529faa5e0bd66136"><div class="ttname"><a href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a></div><div class="ttdeci">T tAbs(T a)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00864">cme.h:864</a></div></div>
<div class="ttc" id="acme_8h_html_af8f1a513adfc4d40f536ff45f704e654"><div class="ttname"><a href="cme_8h.html#af8f1a513adfc4d40f536ff45f704e654">NORTH</a></div><div class="ttdeci">int const NORTH</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00191">cme.h:191</a></div></div>
<div class="ttc" id="acme_8h_html_afdd3411d0fa60c62522af14ea2a90570"><div class="ttname"><a href="cme_8h.html#afdd3411d0fa60c62522af14ea2a90570">LEFT_HANDED</a></div><div class="ttdeci">int const LEFT_HANDED</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00206">cme.h:206</a></div></div>
<div class="ttc" id="acme_8h_html_afeb3cef570a9344c7074258f3601b582"><div class="ttname"><a href="cme_8h.html#afeb3cef570a9344c7074258f3601b582">WEST</a></div><div class="ttdeci">int const WEST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00197">cme.h:197</a></div></div>
<div class="ttc" id="acoast_8h_html"><div class="ttname"><a href="coast_8h.html">coast.h</a></div><div class="ttdoc">Contains CRWCoast definitions.</div></div>
<div class="ttc" id="asimulation_8h_html"><div class="ttname"><a href="simulation_8h.html">simulation.h</a></div><div class="ttdoc">Contains CSimulation definitions.</div></div>
<div class="ttc" id="autils__global_8cpp_html_a20842d0a19d0ca952c91f3e1eb175fee"><div class="ttname"><a href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a></div><div class="ttdeci">int nRound(double const d)</div><div class="ttdef"><b>Definition:</b> <a href="utils__global_8cpp_source.html#l00054">utils_global.cpp:54</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 29 2021 15:52:59 for CoastalME (Coastal Modelling Environment) by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
