<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CoastalME (Coastal Modelling Environment): do_cliff_collapse.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CoastalME (Coastal Modelling Environment)
   </div>
   <div id="projectbrief">Simulates the long-term behaviour of complex coastlines</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">do_cliff_collapse.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="do__cliff__collapse_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> This file is part of CoastalME, the Coastal Modelling Environment.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> CoastalME is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// #include &lt;assert.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using</span> std::cout;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">using</span> std::cerr;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">using</span> std::endl;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">using</span> std::ios;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cme_8h.html">cme.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="simulation_8h.html">simulation.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cliff_8h.html">cliff.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> Update accumulated wave energy in coastal landform objects</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keywordtype">int</span> CSimulation::nDoAllWaveEnergyToCoastLandforms(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;   <span class="keywordtype">int</span> nRet;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;   <span class="comment">// First go along each coastline and update the total wave energy which it has experienced</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; static_cast&lt;int&gt;(m_VCoast.size()); i++)</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; m_VCoast[i].nGetCoastlineSize(); j++)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;         <a class="code" href="class_c_a_coast_landform.html">CACoastLandform</a>* pCoastLandform = m_VCoast[i].pGetCoastLandform(j);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;         <span class="comment">// Update accumulated wave energy for the coastal landform object</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            dWaveHeightAtCoast = m_VCoast[i].dGetCoastWaveHeight(j),</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            dDeepWaterWavePeriod = m_VCoast[i].dGetCoastDeepWaterWavePeriod(j),</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            dWaveErosiveForce = pow(dWaveHeightAtCoast, <a class="code" href="cme_8h.html#add30b59022abb07bc55b76b57f1a60fb">WALKDEN_HALL_PARAM_1</a>) * pow(dDeepWaterWavePeriod, <a class="code" href="cme_8h.html#a65a71870b31deafaa61220aa9b6fc9cb">WALKDEN_HALL_PARAM_2</a>),</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            dWaveEnergy = dWaveErosiveForce * m_dTimeStep * 3600;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">//          assert(isfinite(dWaveEnergy));</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;         pCoastLandform-&gt;<a class="code" href="class_c_a_coast_landform.html#ac850dc100a259660040b3b29c86a5057">IncTotAccumWaveEnergy</a>(dWaveEnergy);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;         <span class="comment">// Now simulate how the coastal landform responds to this wave energy</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;         <span class="keywordtype">int</span> nCategory = pCoastLandform-&gt;<a class="code" href="class_c_a_coast_landform.html#ac161cb56a83d653b651aa08173a1f1ca">nGetLandFormCategory</a>();</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;         <span class="keywordflow">if</span> (nCategory == <a class="code" href="cme_8h.html#ad6be96d3be217d31a74c2412d7e6cbbb">LF_CAT_CLIFF</a>)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;         {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="comment">// This is a cliff</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            <a class="code" href="class_c_r_w_cliff.html">CRWCliff</a>* pCliff = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="class_c_r_w_cliff.html">CRWCliff</a>*<span class="keyword">&gt;</span>(pCoastLandform);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="comment">// Calculate this-timestep cliff notch erosion (is a length in external CRS units)</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordtype">double</span> dNotchExtension = dWaveEnergy / m_dCliffErosionResistance;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <span class="comment">// Constrain this-timestep notch extension if it is more than the length of one cell side (in external CRS units), since the most we can remove in a single timestep is one coastal cell</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            dNotchExtension = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(m_dCellSide, dNotchExtension);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            <span class="comment">// Extend the cliff object&#39;s erosional notch as a result of wave energy during this timestep. Note that extension may be constrained, since this-timestep extension cannot exceed the depth of sediment remaining on the cell</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            dNotchExtension = pCliff-&gt;<a class="code" href="class_c_r_w_cliff.html#a51192ae84cf9469ac21d716dc7869905">dErodeNotch</a>(dNotchExtension);        <span class="comment">// Constrain</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <span class="comment">// OK, is the notch now extended enough to cause collapse (either because the overhang is greater than the threshold overhang, or because there is no sediment remaining)?</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="keywordflow">if</span> (pCliff-&gt;<a class="code" href="class_c_r_w_cliff.html#a230895c26a89fb53f0160d59e156137c">bReadyToCollapse</a>(m_dNotchOverhangAtCollapse))</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;               <span class="comment">// It is ready to collapse</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;               <span class="keywordtype">double</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                  dFineCollapse = 0,</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                  dSandCollapse = 0,</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                  dCoarseCollapse = 0;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;               <span class="comment">// So do the cliff collapse</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;               nRet = nDoCliffCollapse(pCliff, dNotchExtension, dFineCollapse, dSandCollapse, dCoarseCollapse);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;               <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;               {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                  <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                     <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <a class="code" href="cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a> &lt;&lt; <span class="stringliteral">&quot; problem with cliff collapse, continuing however&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;               }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;               <span class="comment">// And put fine sediment into suspension, and deposit sand and/or coarse sediment as unconsolidated sediment</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;               nRet = nDoCliffCollapseDeposition(pCliff, dFineCollapse, dSandCollapse, dCoarseCollapse);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;               <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                  <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;         }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;   <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a>)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; endl &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: cliff collapse (m^3) = &quot;</span> &lt;&lt; (m_dThisIterCliffCollapseErosionFine + m_dThisIterCliffCollapseErosionSand + m_dThisIterCliffCollapseErosionCoarse) * m_dCellArea &lt;&lt; <span class="stringliteral">&quot; (fine = &quot;</span> &lt;&lt; m_dThisIterCliffCollapseErosionFine * m_dCellArea &lt;&lt; <span class="stringliteral">&quot;, sand = &quot;</span> &lt;&lt; m_dThisIterCliffCollapseErosionSand * m_dCellArea &lt;&lt; <span class="stringliteral">&quot;, coarse = &quot;</span> &lt;&lt; m_dThisIterCliffCollapseErosionCoarse * m_dCellArea &lt;&lt; <span class="stringliteral">&quot;), talus deposition (m^3) = &quot;</span> &lt;&lt; (m_dThisIterCliffDepositionSand + m_dThisIterCliffDepositionCoarse) * m_dCellArea &lt;&lt; <span class="stringliteral">&quot; (sand = &quot;</span> &lt;&lt; m_dThisIterCliffDepositionSand * m_dCellArea &lt;&lt; <span class="stringliteral">&quot;, coarse = &quot;</span> &lt;&lt; m_dThisIterCliffDepositionSand * m_dCellArea &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"> Simulates cliff collapse on a single cliff object: it updates both the cliff object and the cell &#39;under&#39; the cliff object</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keywordtype">int</span> CSimulation::nDoCliffCollapse(<a class="code" href="class_c_r_w_cliff.html">CRWCliff</a>* pCliff, <span class="keywordtype">double</span> <span class="keyword">const</span> dNotchDeepen, <span class="keywordtype">double</span>&amp; dFineCollapse, <span class="keywordtype">double</span>&amp; dSandCollapse, <span class="keywordtype">double</span>&amp; dCoarseCollapse)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;{</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   <span class="comment">// Get the cliff cell&#39;s grid coords</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      nX = pCliff-&gt;<a class="code" href="class_c_a_coast_landform.html#afd4b936869e33c47d2a741ff6404abf3">pPtiGetCellMarkedAsLF</a>()-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      nY = pCliff-&gt;<a class="code" href="class_c_a_coast_landform.html#afd4b936869e33c47d2a741ff6404abf3">pPtiGetCellMarkedAsLF</a>()-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <span class="comment">// Then get the elevation of the base of the notch from the cliff object</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   <span class="keywordtype">double</span> dNotchElev = pCliff-&gt;<a class="code" href="class_c_r_w_cliff.html#a70151d708b933a25eb7836d63cea7f8b">dGetNotchBaseElev</a>() - m_dNotchBaseBelowSWL;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;   <span class="comment">// Get the index of the layer containing the notch (layer 0 being just above basement)</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   <span class="keywordtype">int</span> nNotchLayer = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a861c4641b31bb1f920daa863a98ea35c">nGetLayerAtElev</a>(dNotchElev);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   <span class="keywordflow">if</span> (nNotchLayer == <a class="code" href="cme_8h.html#a1a0f3745fbc2e50a9f483893339c9f75">ELEV_ABOVE_SEDIMENT_TOP</a>)</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;   {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="keywordflow">if</span> (m_nLogFileDetail &gt;= <a class="code" href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a>)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; endl &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a> &lt;&lt; <span class="stringliteral">&quot; cell [&quot;</span> &lt;&lt; nX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nY &lt;&lt; <span class="stringliteral">&quot;] has dNotchElev (&quot;</span> &lt;&lt; dNotchElev &lt;&lt; <span class="stringliteral">&quot;) above sediment top elevation (&quot;</span> &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a6387aaac391af63a9f2be1c809ce169c">dGetSedimentTopElev</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a073ffbb4921531737dc0dee04bdcbe11">RTN_ERR_CLIFFNOTCH</a>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;   }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">//    else</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">//       LogStream &lt;&lt; endl &lt;&lt; m_ulIter &lt;&lt; &quot;: for cell [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] dNotchElev = &quot; &lt;&lt; dNotchElev &lt;&lt; &quot; sediment top elevation = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetSedimentTopElev() &lt;&lt; endl;</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   <span class="comment">// Flag the coastline cliff object as having collapsed</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;   pCliff-&gt;<a class="code" href="class_c_r_w_cliff.html#ae80ec1b39d4d0ecebe47197b81660399">SetCliffCollapse</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;   <span class="keywordtype">int</span> nTopLayer = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a1ecc8e7cd32f168781ff206f19c7615e">nGetTopLayerAboveBasement</a>();</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;   <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   <span class="keywordflow">if</span> (nTopLayer == <a class="code" href="cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a0af2b64c1c33dbf4d223944b0bf234e6">RTN_ERR_NO_TOP_LAYER</a>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;   <span class="keywordtype">double</span> dRemaining = pCliff-&gt;<a class="code" href="class_c_r_w_cliff.html#abdce12006e217f4d250bf00a95026264">dGetRemaining</a>();</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   <span class="keywordflow">if</span> (dRemaining &lt;= 0)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="comment">// No cliff sediment left on this cliff object, so the cell which it occupies will no longer be a cliff in the next timestep</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      pCliff-&gt;<a class="code" href="class_c_r_w_cliff.html#a289d564dca89392aed96da9734f41267">SetAllSedimentGone</a>();</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="comment">// Set the base of the collapse (see above)</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      pCliff-&gt;<a class="code" href="class_c_r_w_cliff.html#a73acc82455562b794d027455c1b8c3d5">SetNotchBaseElev</a>(dNotchElev);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="comment">// Set flags to say that the top layer has changed</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      m_bConsChangedThisIter[nTopLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      m_bUnconsChangedThisIter[nTopLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">//      int nX = pCliff-&gt;pPtiGetCellMarkedAsLF()-&gt;nGetX();</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">//      int nY = pCliff-&gt;pPtiGetCellMarkedAsLF()-&gt;nGetY();</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">//      LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: all sediment removed from cliff object after cliff collapse on [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;], dNotchElev = &quot; &lt;&lt; dNotchElev &lt;&lt; endl;</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;   }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;   <span class="comment">// Now calculate the vertical depth of sediment lost in this cliff collapse</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;   <span class="keywordtype">double</span> dAboveNotch = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#aa6b63898439e574ee70f4598f65afe8a">dGetVolEquivSedTopElev</a>() - dNotchElev;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;   <span class="comment">// In CoastalME, all depth equivalents are assumed to be a depth upon the whole of a cell i.e. upon the area of a whole cell. The vertical depth of sediment lost in each cliff collapse is a depth upon only part of a cell, i.e. upon a fraction of a cell&#39;s area. To keep the depth of cliff collapse consistent with all other depth equivalents, weight it by the fraction of the cell&#39;s area which is being removed</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      dNotchAreaFrac = dNotchDeepen / m_dCellSide,</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      dCollapseDepth = dAboveNotch * dNotchAreaFrac;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;   <span class="comment">// Update the cell&#39;s totals for cliff collapse</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#aae2df06db776f3152f79097fdc1fed70">IncrCliffCollapse</a>(dCollapseDepth);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      dAvailable = 0,</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      dLost;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">//   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: cell [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] before removing sediment, dGetVolEquivSedTopElev() = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetVolEquivSedTopElev() &lt;&lt; &quot;, dGetSedimentTopElev() = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetSedimentTopElev() &lt;&lt; endl;</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;   <span class="comment">// Now update the cell&#39;s sediment. If there are sediment layers above the notched layer, we must remove sediment from the whole depth of each layer. Again, weight the depth lost by the fraction of the cell&#39;s area which is being removed</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nTopLayer; n &gt; nNotchLayer; n--)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="comment">// Add in this layer&#39;s sediment, both consolidated and unconsolidated, and adjust what is left</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7b908b50af702464be628e8b96c54542">dGetFine</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a1cc290e93cd71771941e8fb8b77bba1c">dGetNotchFineLost</a>();</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;         dLost = dAvailable * dNotchAreaFrac;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;         dFineCollapse += dLost;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a2847af8b4324b05ae56d0b33bfc28fcb">IncrNotchFineLost</a>(dLost);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a55ec8f411beef4c724da8da17f9532b1">dGetSand</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a38cfd2959e3a245879c28acda01d3bc1">dGetNotchSandLost</a>();</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;         dLost = dAvailable * dNotchAreaFrac;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;         dSandCollapse += dLost;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7e2941dfdbccae9bb38dc80227d6d009">IncrNotchSandLost</a>(dLost);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7f2edac8db7d8e47ec400f4b06efd1a5">dGetCoarse</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#ac96207eb3a1e11ae0e48e71eb89a13ef">dGetNotchCoarseLost</a>();</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;         dLost = dAvailable * dNotchAreaFrac;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;         dCoarseCollapse += dLost;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#aa04835e6620e8cffe3893aeaab77b123">IncrNotchCoarseLost</a>(dLost);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7b908b50af702464be628e8b96c54542">dGetFine</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a1cc290e93cd71771941e8fb8b77bba1c">dGetNotchFineLost</a>();</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;         dLost = dAvailable * dNotchAreaFrac;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;         dFineCollapse += dLost;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a2847af8b4324b05ae56d0b33bfc28fcb">IncrNotchFineLost</a>(dLost);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a55ec8f411beef4c724da8da17f9532b1">dGetSand</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a38cfd2959e3a245879c28acda01d3bc1">dGetNotchSandLost</a>();</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;         dLost = dAvailable * dNotchAreaFrac;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;         dSandCollapse += dLost;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7e2941dfdbccae9bb38dc80227d6d009">IncrNotchSandLost</a>(dLost);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7f2edac8db7d8e47ec400f4b06efd1a5">dGetCoarse</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#ac96207eb3a1e11ae0e48e71eb89a13ef">dGetNotchCoarseLost</a>();</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;         dLost = dAvailable * dNotchAreaFrac;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;         dCoarseCollapse += dLost;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(n)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#aa04835e6620e8cffe3893aeaab77b123">IncrNotchCoarseLost</a>(dLost);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;   <span class="comment">// For the layer which contains the notch, remove only part of the sediment depth</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      dNotchLayerTop = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a1fa43f030ac91e5eae2c560e8cfa7099">dCalcLayerElev</a>(nNotchLayer),</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      dNotchLayerThickness = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a894e1b3d51a02c4dd798df7c4b06edb3">dGetTotalThickness</a>(),</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      dNotchLayerVertFracRemoved = (dNotchLayerTop - dNotchElev ) / dNotchLayerThickness;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   <span class="comment">// Now calculate the fraction of the volume which is removed</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   <span class="keywordtype">double</span> dNotchLayerFracRemoved = dNotchLayerVertFracRemoved * dNotchAreaFrac;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;   <span class="comment">// Sort out the notched layer&#39;s sediment, both consolidated and unconsolidated, for this cell</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;   dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7b908b50af702464be628e8b96c54542">dGetFine</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a1cc290e93cd71771941e8fb8b77bba1c">dGetNotchFineLost</a>();</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;   <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      dLost = dAvailable * dNotchLayerFracRemoved;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      dFineCollapse += dLost;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a2847af8b4324b05ae56d0b33bfc28fcb">IncrNotchFineLost</a>(dLost);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a55ec8f411beef4c724da8da17f9532b1">dGetSand</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a38cfd2959e3a245879c28acda01d3bc1">dGetNotchSandLost</a>();</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      dLost = dAvailable * dNotchLayerFracRemoved;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      dSandCollapse += dLost;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7e2941dfdbccae9bb38dc80227d6d009">IncrNotchSandLost</a>(dLost);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7f2edac8db7d8e47ec400f4b06efd1a5">dGetCoarse</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#ac96207eb3a1e11ae0e48e71eb89a13ef">dGetNotchCoarseLost</a>();</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      dLost = dAvailable * dNotchLayerFracRemoved;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      dCoarseCollapse += dLost;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#aa04835e6620e8cffe3893aeaab77b123">IncrNotchCoarseLost</a>(dLost);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;   }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7b908b50af702464be628e8b96c54542">dGetFine</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a1cc290e93cd71771941e8fb8b77bba1c">dGetNotchFineLost</a>();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      dLost = dAvailable * dNotchLayerFracRemoved;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      dFineCollapse += dLost;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a2847af8b4324b05ae56d0b33bfc28fcb">IncrNotchFineLost</a>(dLost);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;   dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a55ec8f411beef4c724da8da17f9532b1">dGetSand</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a38cfd2959e3a245879c28acda01d3bc1">dGetNotchSandLost</a>();</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      dLost = dAvailable * dNotchLayerFracRemoved;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      dSandCollapse += dLost;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7e2941dfdbccae9bb38dc80227d6d009">IncrNotchSandLost</a>(dLost);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;   }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;   dAvailable = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7f2edac8db7d8e47ec400f4b06efd1a5">dGetCoarse</a>() - m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#ac96207eb3a1e11ae0e48e71eb89a13ef">dGetNotchCoarseLost</a>();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;   <span class="keywordflow">if</span> (dAvailable &gt; 0)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      dLost = dAvailable * dNotchLayerFracRemoved;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      dCoarseCollapse += dLost;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nNotchLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#aa04835e6620e8cffe3893aeaab77b123">IncrNotchCoarseLost</a>(dLost);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;   }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;   <span class="comment">// Update the cell&#39;s layer elevations</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a1b6c61362ff510fc5b45f10e9ad10be7">CalcAllLayerElevsAndD50</a>();</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;   <span class="comment">// And update the cell&#39;s sea depth</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ab445c2aab1f807824fc4dc432fabfb72">SetSeaDepth</a>();</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   <span class="comment">// The notch has gone</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   pCliff-&gt;<a class="code" href="class_c_r_w_cliff.html#adfd463ca3137f081a5d90e9085dd8bb8">SetNotchOverhang</a>(0);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">//   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: cell [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] after removing sediment, dGetVolEquivSedTopElev() = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetVolEquivSedTopElev() &lt;&lt; &quot;, dGetSedimentTopElev() = &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nX][nY].dGetSedimentTopElev() &lt;&lt; endl &lt;&lt; endl;</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   <span class="comment">// And update the this-timestep totals and the grand totals for collapse</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   m_nNThisIterCliffCollapse++;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   m_nNTotCliffCollapse++;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;   m_dThisIterCliffCollapseErosionFine += dFineCollapse;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;   m_dThisIterCliffCollapseErosionSand += dSandCollapse;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   m_dThisIterCliffCollapseErosionCoarse += dCoarseCollapse;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"> Puts the fine sediment from a cliff collapse into suspension, and redistributes the sand-sized and coarse-sized sediment from a cliff collapse onto the foreshore, as unconsolidated talus</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"> The talus is added to the existing beach volume (i.e. to the unconsolidated sediment). The shoreline is iteratively advanced seaward until all this volume is accommodated under a Dean equilibrium profile. This equilibrium beach profile is h(y) = A * y^(2/3) where h(y) is the water depth at a distance y from the shoreline and A is a sediment-dependent scale parameter</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="keywordtype">int</span> CSimulation::nDoCliffCollapseDeposition(<a class="code" href="class_c_r_w_cliff.html">CRWCliff</a>* pCliff, <span class="keywordtype">double</span> <span class="keyword">const</span> dFineCollapse, <span class="keywordtype">double</span> <span class="keyword">const</span> dSandCollapse, <span class="keywordtype">double</span> <span class="keyword">const</span> dCoarseCollapse)</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;{</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="comment">// Fine sediment goes into suspension</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="keywordflow">if</span> (dFineCollapse &gt; <a class="code" href="cme_8h.html#a992c7916632c97c6c1fa25fd5a788282">SEDIMENT_ELEV_TOLERANCE</a>)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      m_dThisIterFineSedimentToSuspension += dFineCollapse;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   <span class="comment">// Do we have any sand- or coarse-sized sediment to deposit?</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <span class="keywordtype">double</span> dTotFromCollapse = dSandCollapse + dCoarseCollapse;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;   <span class="keywordflow">if</span> (dTotFromCollapse &lt; <a class="code" href="cme_8h.html#a992c7916632c97c6c1fa25fd5a788282">SEDIMENT_ELEV_TOLERANCE</a>)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <span class="comment">// OK, we have some sand- and/or coarse-sized sediment to deposit</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      nCoast = pCliff-&gt;<a class="code" href="class_c_a_coast_landform.html#a48cad916a3fb1156ce1f84d12adf23e7">nGetCoast</a>(),</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      nStartPoint = pCliff-&gt;<a class="code" href="class_c_a_coast_landform.html#a6a0284350c5965932c7cc74156ceadec">nGetPointOnCoast</a>(),</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      nCoastSize = m_VCoast[nCoast].nGetCoastlineSize();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      dTotSandToDeposit = dSandCollapse,</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      dTotCoarseToDeposit = dCoarseCollapse,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      dSandProp = dSandCollapse / dTotFromCollapse,</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      dCoarseProp = 1 - dSandProp;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">//    LogStream &lt;&lt; &quot;=====================================================================================================&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast = &quot; &lt;&lt; nCoast &lt;&lt; &quot;, point = &quot; &lt;&lt; nStartPoint &lt;&lt; endl;</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="comment">// Calculate the proportion per planview collapse profile</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   vector&lt;int&gt;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      nVWidthDistSigned(m_nCliffCollapseTalusPlanviewWidth),</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      nVProfileLength(m_nCliffCollapseTalusPlanviewWidth);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      dVToDepositPerProfile(m_nCliffCollapseTalusPlanviewWidth);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;   <span class="comment">// TODO IMPROVE LATER, at present all planview profiles are the same length</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <span class="keywordtype">int</span> nSigned = - (m_nCliffCollapseTalusPlanviewWidth - 1) / 2;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; m_nCliffCollapseTalusPlanviewWidth; n++)</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;   {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      nVWidthDistSigned[n] = nSigned++;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      nVProfileLength[n] = <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(m_dCliffDepositionPlanviewLength);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      dVToDepositPerProfile[n] = (dTotSandToDeposit + dTotCoarseToDeposit) / m_nCliffCollapseTalusPlanviewWidth;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;   }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">//    LogStream &lt;&lt; &quot;Width offsets = &quot;;</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">//    for (int n = 0; n &lt; m_nCliffCollapseTalusPlanviewWidth; n++)</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">//       LogStream &lt;&lt; nVWidthDistSigned[n] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">//    LogStream &lt;&lt; endl &lt;&lt; &quot;Profile lengths = &quot;;</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">//    for (int n = 0; n &lt; m_nCliffCollapseTalusPlanviewWidth; n++)</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">//       LogStream &lt;&lt; nVProfileLength[n] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">//    LogStream &lt;&lt; endl &lt;&lt; &quot;Deposition per profile = &quot;;</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">//    for (int n = 0; n &lt; m_nCliffCollapseTalusPlanviewWidth; n++)</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">//       LogStream &lt;&lt; dVToDepositPerProfile[n] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">//    LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">//   LogStream &lt;&lt; &quot;dSandCollapse = &quot; &lt;&lt; dSandCollapse &lt;&lt; &quot; dCoarseCollapse = &quot; &lt;&lt; dCoarseCollapse &lt;&lt; &quot; m_nCliffCollapseTalusPlanviewWidth = &quot; &lt;&lt; m_nCliffCollapseTalusPlanviewWidth &lt;&lt; endl;</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">//    int nX = pCliff-&gt;pPtiGetCellMarkedAsLF()-&gt;nGetX();</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">//    int nY = pCliff-&gt;pPtiGetCellMarkedAsLF()-&gt;nGetY();</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">//   LogStream &lt;&lt; &quot;Cliff object is at cell[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] which is &quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; endl;</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nAcross = 0; nAcross &lt; m_nCliffCollapseTalusPlanviewWidth; nAcross++)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordtype">int</span> nWidthDistSigned = nVWidthDistSigned[nAcross];</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="comment">// Get the start point of the deposition collapse profile</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordtype">int</span> nThisPoint = nStartPoint + nWidthDistSigned;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="comment">// Is this start point valid?</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">if</span> ((nThisPoint &lt; 0) || (nThisPoint &gt; (nCoastSize-1)))</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">//          LogStream &lt;&lt; endl &lt;&lt; m_ulIter &lt;&lt; &quot;: ABANDONING PROFILE with nWidthDistSigned = &quot; &lt;&lt; nWidthDistSigned &lt;&lt; endl;</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;START point &quot; &lt;&lt; nThisPoint &lt;&lt; &quot; of profile would have been outside the grid, so &quot; &lt;&lt; dVToDepositPerProfile[nAcross] &lt;&lt; &quot; exported from grid&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;dTotSandToDeposit WAS = &quot; &lt;&lt; dTotSandToDeposit &lt;&lt; &quot; dTotCoarseToDeposit WAS = &quot; &lt;&lt; dTotCoarseToDeposit &lt;&lt; endl;</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;         <span class="comment">// The start point of the profile would have been outside the grid, so just add this profile&#39;s sediment to the volume exported from the grid this timestep</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;         m_dThisIterSandSedLostCliffCollapse += (dVToDepositPerProfile[nAcross] * dSandProp);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;         m_dThisIterCoarseSedLostCliffCollapse += (dVToDepositPerProfile[nAcross] * dCoarseProp);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;         <span class="comment">// Remove this volume from the total still to be deposited</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;         dTotSandToDeposit -= (dVToDepositPerProfile[nAcross] * dSandProp);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;         dTotCoarseToDeposit -= (dVToDepositPerProfile[nAcross] * dCoarseProp);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;dTotSandToDeposit NOW = &quot; &lt;&lt; dTotSandToDeposit &lt;&lt; &quot; dTotCoarseToDeposit NOW = &quot; &lt;&lt; dTotCoarseToDeposit &lt;&lt; endl;</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;         <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;         PtStart,</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;         PtEnd;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="comment">// Make the start of the deposition profile the cliff cell that is marked as coast (not the cell under the smoothed vector coast, they may well be different)</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      PtStart.<a class="code" href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">SetX</a>(dGridCentroidXToExtCRSX(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nThisPoint)-&gt;nGetX()));</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      PtStart.<a class="code" href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">SetY</a>(dGridCentroidYToExtCRSY(m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nThisPoint)-&gt;nGetY()));</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="comment">// The seaward offset, in cells</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordtype">int</span> nSeawardOffset = -1;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">do</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">//         LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;         nSeawardOffset++;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">//          if (nSeawardOffset &gt; 20)</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">//          {</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">//             // Arbitrary safety check, if we can&#39;t store sufficient sediment with an offset of this size then move to the next point along the coast</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">//             LogStream &lt;&lt; &quot;*** PROFILE TOO LONG WITH nSeawardOffset = &quot; &lt;&lt; nSeawardOffset &lt;&lt; &quot; MOVING TO NEXT POINT ALONG COAST&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">//             break;</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">//          }</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;         <span class="comment">// Now construct a deposition collapse profile from the start point, it is one longer than the specified length because it includes the cliff point in the profile. Calculate its length in external CRS units, the way it is done here is approximate but probably OK</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;         <span class="keywordtype">double</span> dThisProfileLength = (nVProfileLength[nAcross] + nSeawardOffset + 1) * m_dCellSide;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;         <span class="comment">// Get the end point of this coastline-normal line</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;         <a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a> PtiEnd;                                     <span class="comment">// In grid CRS</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;         <span class="keywordtype">int</span> nRtn = nGetCoastNormalEndPoint(nCoast, nThisPoint, nCoastSize, &amp;PtStart, dThisProfileLength, &amp;PtEnd, &amp;PtiEnd);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;         <span class="keywordflow">if</span> (nRtn != <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;         {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="comment">// Could not find an end point so forget this profile</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">//            LogStream &lt;&lt; endl &lt;&lt; m_ulIter &lt;&lt; &quot;: ABANDONING PROFILE with nWidthDistSigned = &quot; &lt;&lt; nWidthDistSigned &lt;&lt; endl;</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="keywordflow">if</span> (nRtn == <a class="code" href="cme_8h.html#a2271e87528b5e82505284ec3a37c27f2">RTN_ERR_PROFILE_ENDPOINT_IS_OFFGRID</a>)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">//                LogStream &lt;&lt; &quot;dTotSandToDeposit WAS = &quot; &lt;&lt; dTotSandToDeposit &lt;&lt; &quot; dTotCoarseToDeposit WAS = &quot; &lt;&lt; dTotCoarseToDeposit &lt;&lt; endl;</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">//                LogStream &lt;&lt; &quot;END point of profile would have been outside the grid, so &quot; &lt;&lt; dVToDepositPerProfile[nAcross] &lt;&lt; &quot; exported from grid&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;               <span class="comment">// The end point of the profile would have been outside the grid, so just add this profile&#39;s sediment to the volume exported from the grid this timestep</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;               m_dThisIterSandSedLostCliffCollapse += (dVToDepositPerProfile[nAcross] * dSandProp);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;               m_dThisIterCoarseSedLostCliffCollapse += (dVToDepositPerProfile[nAcross] * dCoarseProp);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;               <span class="comment">// Remove this volume from the total still to be deposited</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;               dTotSandToDeposit -= (dVToDepositPerProfile[nAcross] * dSandProp);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;               dTotCoarseToDeposit -= (dVToDepositPerProfile[nAcross] * dCoarseProp);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">//                LogStream &lt;&lt; &quot;dTotSandToDeposit NOW = &quot; &lt;&lt; dTotSandToDeposit &lt;&lt; &quot; dTotCoarseToDeposit NOW = &quot; &lt;&lt; dTotCoarseToDeposit &lt;&lt; endl;</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <span class="keywordflow">if</span> (nRtn == <a class="code" href="cme_8h.html#ace82416ca7fb524bd4da49c3d402b082">RTN_ERR_NO_SOLUTION_FOR_ENDPOINT</a>)</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;               <span class="comment">// The profile has a different problem, so (if possible) move one point along the coast and try again. Must add this profile&#39;s sediment to the amount remaining per profile however</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">//                for (int n = 0; n &lt; m_nCliffCollapseTalusPlanviewWidth; n++)</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">//                {</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">//                   LogStream &lt;&lt; dVToDepositPerProfile[n] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">//                }</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">//                LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">//                LogStream &lt;&lt; &quot;Deposition per profile WAS = &quot;;</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;               <span class="keywordtype">int</span> nWidthRemaining = m_nCliffCollapseTalusPlanviewWidth - nAcross - 1;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nAcross+1; n &lt; m_nCliffCollapseTalusPlanviewWidth; n++)</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                  dVToDepositPerProfile[n] = (dTotSandToDeposit + dTotCoarseToDeposit) / nWidthRemaining;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">//                LogStream &lt;&lt; &quot;Deposition per profile NOW = &quot;;</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">//                for (int n = 0; n &lt; m_nCliffCollapseTalusPlanviewWidth; n++)</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">//                {</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">//                   LogStream &lt;&lt; dVToDepositPerProfile[n] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">//                }</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">//                LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;         }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nWidthDistSigned = &quot; &lt;&lt; nWidthDistSigned &lt;&lt; &quot; cliff collapse profile from &quot; &lt;&lt; PtStart.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtStart.dGetY() &lt;&lt; &quot; to &quot; &lt;&lt; PtEnd.dGetX() &lt;&lt; &quot;, &quot; &lt;&lt; PtEnd.dGetY() &lt;&lt; &quot; with length (inc. cliff point) = &quot; &lt;&lt; dThisProfileLength &lt;&lt; endl;</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;         vector&lt;CGeom2DPoint&gt; VTmpProfile;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;         VTmpProfile.push_back(PtStart);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;         VTmpProfile.push_back(PtEnd);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;         vector&lt;CGeom2DIPoint&gt; VCellsUnderProfile;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;         <span class="comment">// Now get the raster cells under this profile</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;         <span class="keywordflow">if</span> (nRasterizeCliffCollapseProfile(&amp;VTmpProfile, &amp;VCellsUnderProfile) != <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;         {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            cout &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: error when rasterizing cells during cliff collapse&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#af57d19c8f0c3205c6713d5f9b0dddec4">RTN_ERR_LINETOGRID</a>;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;         }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;         <span class="keywordtype">int</span> nRasterProfileLength = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VCellsUnderProfile.size());</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;         vector&lt;double&gt; dVProfileNow(nRasterProfileLength, 0);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;         vector&lt;bool&gt; bVProfileValid(nRasterProfileLength, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">//         LogStream &lt;&lt; &quot;RASTER PROFILE LENGTH = &quot; &lt;&lt; nRasterProfileLength &lt;&lt; endl;</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">//         if (nRasterProfileLength != dThisProfileLength)</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">//            LogStream &lt;&lt; &quot;*************************&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nRasterProfileLength; n++)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;         {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;               nX = VCellsUnderProfile[n].nGetX(),</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;               nY = VCellsUnderProfile[n].nGetY();</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            dVProfileNow[n] = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a6387aaac391af63a9f2be1c809ce169c">dGetSedimentTopElev</a>();</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            <span class="comment">// Don&#39;t allow cliff collapse onto intervention cells</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#af1321d6f96845f7933e6d7167267ed41">pGetLandform</a>()-&gt;<a class="code" href="class_c_r_w_cell_landform.html#a5350a7ac48d1eef3a78bef9bcf041b45">nGetLFCategory</a>() == <a class="code" href="cme_8h.html#afb9499d46447e0115ed3abc66ce28a7d">LF_CAT_INTERVENTION</a>)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;               bVProfileValid[n] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;         }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;         <span class="comment">// Calculate the elevation of the talus top</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            dCliffTopElev = dVProfileNow[0],</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            dCliffBaseElev = dVProfileNow[1],</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            dCliffHeight = dCliffTopElev - dCliffBaseElev,</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            dTalusTopElev = dCliffBaseElev + (dCliffHeight * m_dCliffDepositionHeightFrac);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">//         LogStream &lt;&lt; &quot;Elevations: cliff top = &quot; &lt;&lt; dCliffTopElev &lt;&lt; &quot; cliff base = &quot; &lt;&lt; dCliffBaseElev &lt;&lt; &quot; talus top = &quot; &lt;&lt; dTalusTopElev &lt;&lt; endl;</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">//          if (dCliffTopElev &lt; dCliffBaseElev)</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">//             LogStream &lt;&lt; &quot;*** ERROR, cliff top is lower than cliff base&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;         <span class="comment">// The talus slope length in external CRS units, this is approximate but probably OK</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;         <span class="keywordtype">double</span> dTalusSlopeLength = dThisProfileLength - ((nSeawardOffset - 1) * m_dCellSide);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;         <span class="comment">// If user has not supplied a value for m_dCliffDepositionA, then solve for dA so that the elevations at end of the existing profile, and at the end of the Dean equilibrium profile, are the same</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;         <span class="keywordtype">double</span> dA = 0;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;         <span class="keywordflow">if</span> (m_dCliffDepositionA != 0)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            dA = m_dCliffDepositionA;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            dA = (dTalusTopElev - dVProfileNow[nRasterProfileLength-1]) /  pow(dTalusSlopeLength, <a class="code" href="cme_8h.html#ac5c14eafd96860d3f562e9c7f23a4104">DEAN_POWER</a>);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;         <span class="keywordtype">double</span> dInc = dTalusSlopeLength / (nRasterProfileLength - nSeawardOffset - 2);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;         vector&lt;double&gt; dVDeanProfile(nRasterProfileLength);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;         <span class="comment">// Calculate the Dean equilibrium profile of the talus h(y) = A * y^(2/3) where h(y) is the distance below the talus-top elevation (the highest point in the Dean profile) at a distance y from the cliff (the landward start of the profile)</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;         CalcDeanProfile(&amp;dVDeanProfile, dInc, dTalusTopElev, dA, <span class="keyword">true</span>, nSeawardOffset, dCliffTopElev);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;         <span class="comment">// Get the total difference in elevation between the two profiles (present profile - Dean profile)</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;         <span class="keywordtype">double</span> dTotElevDiff = dSubtractProfiles(&amp;dVProfileNow, &amp;dVDeanProfile, &amp;bVProfileValid);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">//          // DEBUG STUFF -----------------------------------------------------</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">//          LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;dTalusSlopeLength = &quot; &lt;&lt; dTalusSlopeLength &lt;&lt; &quot; dA = &quot; &lt;&lt; dA &lt;&lt; endl;</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;dDistFromTalusStart - dInc = &quot; &lt;&lt; dDistFromTalusStart - dInc &lt;&lt; &quot; dThisProfileLength - nSeawardOffset - 2 = &quot; &lt;&lt; dThisProfileLength - nSeawardOffset - 2 &lt;&lt; endl;</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;Profile now (inc. cliff cell) = &quot;;</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">//          for (int n = 0; n &lt; nRasterProfileLength; n++)</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">//          {</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">//             int</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">//                nX = VCellsUnderProfile[n].nGetX(),</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">//                nY = VCellsUnderProfile[n].nGetY();</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">//             dVProfileNow[n] = m_pRasterGrid-&gt;m_Cell[nX][nY].dGetSedimentTopElev();</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">//             LogStream &lt;&lt; dVProfileNow[n] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">//          }</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">//          LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;Dean equilibrium profile (inc. cliff cell) = &quot;;</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">//          for (int n = 0; n &lt; nRasterProfileLength; n++)</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">//          {</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">//             LogStream &lt;&lt; dVDeanProfile[n] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">//          }</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">//          LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">//          LogStream &lt;&lt; &quot;Difference (inc. cliff cell) = &quot;;</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">//          for (int n = 0; n &lt; nRasterProfileLength; n++)</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">//          {</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">//             LogStream &lt;&lt; dVDeanProfile[n] - dVProfileNow[n] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">//          }</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">//          LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">//          // DEBUG STUFF -----------------------------------------------------</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;         <span class="comment">// For this planview profile, does the Dean equilibrium profile allow us to deposit all the talus sediment which we need to get rid of?</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;         <span class="keywordflow">if</span> (dTotElevDiff &lt; dVToDepositPerProfile[nAcross])</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="comment">// No it doesn&#39;t, so try again with a larger seaward offset</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;         <span class="comment">// Yes it does</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">//          LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: cliff collapse at [&quot; &lt;&lt; VCellsUnderProfile[0].nGetX() &lt;&lt; &quot;][&quot; &lt;&lt; VCellsUnderProfile[0].nGetY() &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(VCellsUnderProfile[0].nGetX()) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(VCellsUnderProfile[0].nGetY()) &lt;&lt; &quot;} offset SUFFICIENT with nSeawardOffset = &quot; &lt;&lt; nSeawardOffset &lt;&lt; endl;</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">//          LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: dTotElevDiff = &quot; &lt;&lt; dTotElevDiff &lt;&lt; &quot; dVToDepositPerProfile[nAcross] = &quot; &lt;&lt; dVToDepositPerProfile[nAcross] &lt;&lt; endl;</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;         <span class="keywordtype">double</span> dPropToDeposit = dVToDepositPerProfile[nAcross] / dTotElevDiff;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">//         LogStream &lt;&lt; &quot;dPropToDeposit = &quot; &lt;&lt; dPropToDeposit &lt;&lt; endl;</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">//          double</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">//             dDepositedCheck = 0,</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">//             dRemovedCheck = 0;</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;         <span class="comment">// Adjust all cells in this profile</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nRasterProfileLength; n++)</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;         {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;               nX = VCellsUnderProfile[n].nGetX(),</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;               nY = VCellsUnderProfile[n].nGetY();</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160; </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="comment">// Don&#39;t do anything to intervention cells</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#af1321d6f96845f7933e6d7167267ed41">pGetLandform</a>()-&gt;<a class="code" href="class_c_r_w_cell_landform.html#a5350a7ac48d1eef3a78bef9bcf041b45">nGetLFCategory</a>() == <a class="code" href="cme_8h.html#afb9499d46447e0115ed3abc66ce28a7d">LF_CAT_INTERVENTION</a>)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;               <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <span class="keywordtype">int</span> nTopLayer = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a43434d6fd45da697ae17f7b274ba9a83">nGetTopNonZeroLayerAboveBasement</a>();</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <span class="keywordflow">if</span> (nTopLayer == <a class="code" href="cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a>)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;               <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a0af2b64c1c33dbf4d223944b0bf234e6">RTN_ERR_NO_TOP_LAYER</a>;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="keywordflow">if</span> (nTopLayer == <a class="code" href="cme_8h.html#a01522c1e8423c6586193dd5ca0c76171">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;               <span class="comment">// TODO improve this</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;               cerr &lt;&lt; <span class="stringliteral">&quot;All layers have zero thickness&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;               <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#ac35a5105cdbbb00d8c809eee7c72a0f8">RTN_ERR_CLIFFDEPOSIT</a>;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="comment">// Only do deposition on this cell if its elevation is below the Dean elevation, and the cell is either a sea cell or a drift cell</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            <span class="keywordflow">if</span> ((dVDeanProfile[n] &gt; dVProfileNow[n]) &amp;&amp; ((m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>()) || (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#af1321d6f96845f7933e6d7167267ed41">pGetLandform</a>()-&gt;<a class="code" href="class_c_r_w_cell_landform.html#a5350a7ac48d1eef3a78bef9bcf041b45">nGetLFCategory</a>() == <a class="code" href="cme_8h.html#a48ef8882a05bbb7c4fe8e35065e06ee4">LF_CAT_DRIFT</a>)))</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">//               LogStream &lt;&lt; &quot;DEPOSIT &quot;;</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;               <span class="comment">// At this point along the profile, the equilibrium profile is higher than the present profile. So we can deposit some sediment here</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;               <span class="keywordtype">double</span> dPotentialSandToDeposit = 0;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;               <span class="keywordflow">if</span> (dTotSandToDeposit &gt; 0)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;               {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                  dPotentialSandToDeposit = (dVDeanProfile[n] - dVProfileNow[n]) * dSandProp * dPropToDeposit;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                  dPotentialSandToDeposit = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dPotentialSandToDeposit, dTotSandToDeposit);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                  <span class="keywordtype">double</span> dSandNow = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nTopLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a55ec8f411beef4c724da8da17f9532b1">dGetSand</a>();</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                  m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nTopLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a166bd3ef8eb44ae4c6eff329e04bd3c0">SetSand</a>(dSandNow + dPotentialSandToDeposit);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                  <span class="comment">// Set the changed-this-timestep switch</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                  m_bUnconsChangedThisIter[nTopLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                  dTotSandToDeposit -= dPotentialSandToDeposit;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">//                  dDepositedCheck += dPotentialSandToDeposit;</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;               }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;               <span class="keywordtype">double</span> dPotentialCoarseToDeposit = 0;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;               <span class="keywordflow">if</span> (dTotCoarseToDeposit &gt; 0)</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;               {</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                  dPotentialCoarseToDeposit = (dVDeanProfile[n] - dVProfileNow[n]) * dCoarseProp * dPropToDeposit;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                  dPotentialCoarseToDeposit = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dPotentialCoarseToDeposit, dTotCoarseToDeposit);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                  <span class="keywordtype">double</span> dCoarseNow = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nTopLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7f2edac8db7d8e47ec400f4b06efd1a5">dGetCoarse</a>();</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                  m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nTopLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a930fdd5219ba9971cdbd256e1d5cc62a">SetCoarse</a>(dCoarseNow + dPotentialCoarseToDeposit);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                  <span class="comment">// Set the changed-this-timestep switch</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                  m_bUnconsChangedThisIter[nTopLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160; </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                  dTotCoarseToDeposit -= dPotentialCoarseToDeposit;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">//                  dDepositedCheck += dPotentialCoarseToDeposit;</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;               }</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;               <span class="comment">// Now update the cell&#39;s layer elevations</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;               m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a1b6c61362ff510fc5b45f10e9ad10be7">CalcAllLayerElevsAndD50</a>();</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;               <span class="comment">// Update the cell&#39;s sea depth</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;               m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ab445c2aab1f807824fc4dc432fabfb72">SetSeaDepth</a>();</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;               <span class="comment">// Update the cell&#39;s collapse deposition, and total collapse deposition, values</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;               m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a9ee63a32283251116539dee1ff822e4f">IncrCliffCollapseDeposition</a>(dPotentialSandToDeposit + dPotentialCoarseToDeposit);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;               <span class="comment">// And set the landform category</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;               m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#af1321d6f96845f7933e6d7167267ed41">pGetLandform</a>()-&gt;<a class="code" href="class_c_r_w_cell_landform.html#af53d3fe69c297cfb0b41d03e55ed6467">SetLFSubCategory</a>(<a class="code" href="cme_8h.html#a8a73c1e3b62bdc03aeb0be69f0fa018b">LF_SUBCAT_DRIFT_TALUS</a>);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dVDeanProfile[n] &lt; dVProfileNow[n])</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;               <span class="comment">// The Dean equilibrium profile is lower than the present profile, so we must remove some some sediment from here</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">//               LogStream &lt;&lt; &quot;REMOVE &quot;;</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;               <span class="keywordtype">double</span> dThisLowering = dVProfileNow[n] - dVDeanProfile[n];</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;               <span class="comment">// Find out how much sediment we have available on this cell</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;               <span class="keywordtype">double</span> dExistingAvailableFine = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nTopLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7b908b50af702464be628e8b96c54542">dGetFine</a>();</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;               <span class="keywordtype">double</span> dExistingAvailableSand = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nTopLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a55ec8f411beef4c724da8da17f9532b1">dGetSand</a>();</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;               <span class="keywordtype">double</span> dExistingAvailableCoarse = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nTopLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7f2edac8db7d8e47ec400f4b06efd1a5">dGetCoarse</a>();</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;               <span class="comment">// Now partition the total lowering for this cell between the three size fractions: do this by relative erodibility</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;               <span class="keywordtype">int</span> nFineWeight = (dExistingAvailableFine &gt; 0 ? 1 : 0);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;               <span class="keywordtype">int</span> nSandWeight = (dExistingAvailableSand &gt; 0 ? 1 : 0);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;               <span class="keywordtype">int</span> nCoarseWeight = (dExistingAvailableCoarse &gt; 0 ? 1 : 0);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;               <span class="keywordtype">double</span> dTotErodibility = (nFineWeight * m_dFineErodibilityNormalized) + (nSandWeight * m_dSandErodibilityNormalized) + (nCoarseWeight * m_dCoarseErodibilityNormalized);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">//              double dTotActualErosion = 0;</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;               <span class="keywordflow">if</span> (nFineWeight)</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;               {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                  <span class="comment">// Erode some fine-sized sediment</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                  <span class="keywordtype">double</span> dFineLowering = (m_dFineErodibilityNormalized * dThisLowering) / dTotErodibility;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                  <span class="comment">// Make sure we don&#39;t get -ve amounts left on the cell</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                  <span class="keywordtype">double</span> dFine = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dExistingAvailableFine, dFineLowering);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                  <span class="keywordtype">double</span> dRemaining = dExistingAvailableFine - dFine;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">//                 dTotActualErosion += dFine;</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">//                 dRemovedCheck += dFine;</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                  <span class="comment">// Set the value for this layer</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                  m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nTopLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a520b31404bb1c3dd30d9c84fe84e11e8">SetFine</a>(dRemaining);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                  <span class="comment">// And set the changed-this-timestep switch</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                  m_bUnconsChangedThisIter[nTopLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                  <span class="comment">// And increment the per-timestep talus erosion total</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                  m_dThisIterCliffErosionFine += dFine;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;               }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;               <span class="keywordflow">if</span> (nSandWeight)</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;               {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                  <span class="comment">// Erode some sand-sized sediment</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                  <span class="keywordtype">double</span> dSandLowering = (m_dSandErodibilityNormalized * dThisLowering) / dTotErodibility;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                  <span class="comment">// Make sure we don&#39;t get -ve amounts left on the source cell</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                  <span class="keywordtype">double</span> dSand = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dExistingAvailableSand, dSandLowering);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                  <span class="keywordtype">double</span> dRemaining = dExistingAvailableSand - dSand;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">//                 dTotActualErosion += dSand;</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">//                 dRemovedCheck += dSand;</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160; </div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                  <span class="comment">// Set the value for this layer</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                  m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nTopLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a166bd3ef8eb44ae4c6eff329e04bd3c0">SetSand</a>(dRemaining);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                  <span class="comment">// Set the changed-this-timestep switch</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                  m_bUnconsChangedThisIter[nTopLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                  <span class="comment">// And increment the per-timestep talus erosion total</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                  m_dThisIterCliffTalusSandErosion += dSand;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;               }</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;               <span class="keywordflow">if</span> (nCoarseWeight)</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;               {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                  <span class="comment">// Erode some coarse-sized sediment</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                  <span class="keywordtype">double</span> dCoarseLowering = (m_dCoarseErodibilityNormalized * dThisLowering) / dTotErodibility;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                  <span class="comment">// Make sure we don&#39;t get -ve amounts left on the source cell</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                  <span class="keywordtype">double</span> dCoarse = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dExistingAvailableCoarse, dCoarseLowering);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                  <span class="keywordtype">double</span> dRemaining = dExistingAvailableCoarse - dCoarse;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">//                 dTotActualErosion += dCoarse;</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">//                 dRemovedCheck += dCoarse;</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                  <span class="comment">// Set the value for this layer</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                  m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nTopLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">pGetUnconsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a930fdd5219ba9971cdbd256e1d5cc62a">SetCoarse</a>(dRemaining);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                  <span class="comment">// Set the changed-this-timestep switch</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                  m_bUnconsChangedThisIter[nTopLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                  <span class="comment">// And increment the per-timestep talus erosion total</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                  m_dThisIterCliffTalusCoarseErosion += dCoarse;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;               }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;               <span class="comment">// Set the actual erosion value for this cell</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">//               m_pRasterGrid-&gt;m_Cell[nX][nY].SetActualPlatformErosion(dTotActualErosion);</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;               <span class="comment">// Recalculate the elevation of every layer</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;               m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a1b6c61362ff510fc5b45f10e9ad10be7">CalcAllLayerElevsAndD50</a>();</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;               <span class="comment">// And update the cell&#39;s sea depth</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;               m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ab445c2aab1f807824fc4dc432fabfb72">SetSeaDepth</a>();</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">//                // Update per-timestep totals</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">//                if (dTotActualErosion &gt; 0)</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">//                {</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">//                   m_ulThisIterNumActualPlatformErosionCells++;</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment">//                   m_dThisIterActualPlatformErosion += dTotActualErosion;</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">//                }</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;         }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">//        LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">//        LogStream &lt;&lt; &quot;Profile done, dDepositedCheck = &quot; &lt;&lt; dDepositedCheck &lt;&lt; &quot; dRemovedCheck = &quot; &lt;&lt; dRemovedCheck &lt;&lt; endl;</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160; </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="keywordflow">while</span> (<span class="keyword">true</span>);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment">//     LogStream &lt;&lt; &quot;REMAINING dTotSandToDeposit = &quot; &lt;&lt; dTotSandToDeposit &lt;&lt; &quot; dTotCoarseToDeposit = &quot; &lt;&lt; dTotCoarseToDeposit &lt;&lt; endl;</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;   }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;   <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">//   if (! bFPIsEqual(dTotSandToDeposit, 0, TOLERANCE))</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">//   {</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">//      LogStream &lt;&lt; ERR &lt;&lt; m_ulIter &lt;&lt; &quot;: dTotSandToDeposit = &quot; &lt;&lt; dTotSandToDeposit &lt;&lt; &quot; SET TO ZERO&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">//      dTotSandToDeposit = 0;</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">//   }</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;   <span class="comment">// Ditto</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment">//   if (! bFPIsEqual(dTotCoarseToDeposit, 0, TOLERANCE))</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">//   {</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">//      LogStream &lt;&lt; ERR &lt;&lt; m_ulIter &lt;&lt; &quot;: dTotCoarseToDeposit = &quot; &lt;&lt; dTotCoarseToDeposit &lt;&lt; &quot; SET TO ZERO&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">//      dTotCoarseToDeposit = 0;</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">//   }</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160; </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;   <span class="comment">// Increment this-timestep totals for cliff collapse deposition</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   m_dThisIterCliffDepositionSand += dSandCollapse;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   m_dThisIterCliffDepositionCoarse += dCoarseCollapse;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;}</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment"> Given the start and end points of a cliff-collapse normal profile, returns an output vector of cells which are &#39;under&#39; the vector line</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="keywordtype">int</span> CSimulation::nRasterizeCliffCollapseProfile(vector&lt;CGeom2DPoint&gt; <span class="keyword">const</span>* pVPointsIn, vector&lt;CGeom2DIPoint&gt;* pVIPointsOut)<span class="keyword"> const</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;   pVIPointsOut-&gt;clear();</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; </div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;   <span class="comment">// The start point of the normal is the centroid of a coastline cell. Convert from the external CRS to grid CRS</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      dXStart = dExtCRSXToGridX(pVPointsIn-&gt;at(0).dGetX()),</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      dYStart = dExtCRSYToGridY(pVPointsIn-&gt;at(0).dGetY());</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;   <span class="comment">// The end point of the normal, again convert from the external CRS to grid CRS. Note too that it could be off the grid</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      dXEnd = dExtCRSXToGridX(pVPointsIn-&gt;at(1).dGetX()),</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      dYEnd = dExtCRSYToGridY(pVPointsIn-&gt;at(1).dGetY());</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160; </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;   <span class="comment">// Interpolate between cells by a simple DDA line algorithm, see http://en.wikipedia.org/wiki/Digital_differential_analyzer_(graphics_algorithm) Note that Bresenham&#39;s algorithm gave occasional gaps</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      dXInc = dXEnd - dXStart,</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      dYInc = dYEnd - dYStart,</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      dLength = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(<a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dXInc), <a class="code" href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a>(dYInc));</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;   dXInc /= dLength;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;   dYInc /= dLength;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      dX = dXStart,</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      dY = dYStart;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;   <span class="comment">// Process each interpolated point</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;   <span class="keywordtype">int</span> nLength = <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dLength);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt;= nLength; m++)</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;   {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;         nX = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(dX),</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;         nY = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(dY);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <span class="comment">// Make sure the interpolated point is within the raster grid (can get this kind of problem due to rounding)</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="keywordflow">if</span> (! bIsWithinValidGrid(nX, nY))</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;         KeepWithinValidGrid(<a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dXStart), <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dYStart), nX, nY);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="comment">// This point is fine, so append it to the output vector</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      pVIPointsOut-&gt;push_back(<a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a>(nX, nY));         <span class="comment">// In raster-grid co-ordinates</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="comment">// And increment for next time</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      dX += dXInc;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      dY += dYInc;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;   }</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a>;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;}</div>
<div class="ttc" id="aclass_c_a_coast_landform_html"><div class="ttname"><a href="class_c_a_coast_landform.html">CACoastLandform</a></div><div class="ttdoc">Abstract class, used as a base class for landform objects on the coastline.</div><div class="ttdef"><b>Definition:</b> <a href="coast__landform_8h_source.html#l00035">coast_landform.h:36</a></div></div>
<div class="ttc" id="aclass_c_a_coast_landform_html_a48cad916a3fb1156ce1f84d12adf23e7"><div class="ttname"><a href="class_c_a_coast_landform.html#a48cad916a3fb1156ce1f84d12adf23e7">CACoastLandform::nGetCoast</a></div><div class="ttdeci">int nGetCoast(void) const</div><div class="ttdef"><b>Definition:</b> <a href="coast__landform_8cpp_source.html#l00042">coast_landform.cpp:42</a></div></div>
<div class="ttc" id="aclass_c_a_coast_landform_html_a6a0284350c5965932c7cc74156ceadec"><div class="ttname"><a href="class_c_a_coast_landform.html#a6a0284350c5965932c7cc74156ceadec">CACoastLandform::nGetPointOnCoast</a></div><div class="ttdeci">int nGetPointOnCoast(void) const</div><div class="ttdef"><b>Definition:</b> <a href="coast__landform_8cpp_source.html#l00047">coast_landform.cpp:47</a></div></div>
<div class="ttc" id="aclass_c_a_coast_landform_html_ac161cb56a83d653b651aa08173a1f1ca"><div class="ttname"><a href="class_c_a_coast_landform.html#ac161cb56a83d653b651aa08173a1f1ca">CACoastLandform::nGetLandFormCategory</a></div><div class="ttdeci">int nGetLandFormCategory(void) const</div><div class="ttdef"><b>Definition:</b> <a href="coast__landform_8cpp_source.html#l00057">coast_landform.cpp:57</a></div></div>
<div class="ttc" id="aclass_c_a_coast_landform_html_ac850dc100a259660040b3b29c86a5057"><div class="ttname"><a href="class_c_a_coast_landform.html#ac850dc100a259660040b3b29c86a5057">CACoastLandform::IncTotAccumWaveEnergy</a></div><div class="ttdeci">void IncTotAccumWaveEnergy(double const)</div><div class="ttdef"><b>Definition:</b> <a href="coast__landform_8cpp_source.html#l00072">coast_landform.cpp:72</a></div></div>
<div class="ttc" id="aclass_c_a_coast_landform_html_afd4b936869e33c47d2a741ff6404abf3"><div class="ttname"><a href="class_c_a_coast_landform.html#afd4b936869e33c47d2a741ff6404abf3">CACoastLandform::pPtiGetCellMarkedAsLF</a></div><div class="ttdeci">CGeom2DIPoint * pPtiGetCellMarkedAsLF(void) const</div><div class="ttdef"><b>Definition:</b> <a href="coast__landform_8cpp_source.html#l00062">coast_landform.cpp:62</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html"><div class="ttname"><a href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with integer co-ordinates.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8h_source.html#l00029">2di_point.h:30</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_a4d9c20bcca90dcb9d519b664aba09cbd"><div class="ttname"><a href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">CGeom2DIPoint::nGetY</a></div><div class="ttdeci">int nGetY(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object's integer Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00050">2di_point.cpp:50</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_af84c687b2d0be01ab41cbcc0565f4f3f"><div class="ttname"><a href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">CGeom2DIPoint::nGetX</a></div><div class="ttdeci">int nGetX(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object's integer X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00044">2di_point.cpp:44</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html"><div class="ttname"><a href="class_c_geom2_d_point.html">CGeom2DPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with floating-point co-ordinates.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8h_source.html#l00029">2d_point.h:30</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_a1dff4e8adee61e6fe5c5062d6ba88f01"><div class="ttname"><a href="class_c_geom2_d_point.html#a1dff4e8adee61e6fe5c5062d6ba88f01">CGeom2DPoint::SetY</a></div><div class="ttdeci">void SetY(double const)</div><div class="ttdoc">The double parameter sets a value for the CGeom2DIPoint object's Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00062">2d_point.cpp:62</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_af5dfdef4b78c0703800049b064483278"><div class="ttname"><a href="class_c_geom2_d_point.html#af5dfdef4b78c0703800049b064483278">CGeom2DPoint::SetX</a></div><div class="ttdeci">void SetX(double const)</div><div class="ttdoc">The double parameter sets a value for the CGeom2DIPoint object's X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00056">2d_point.cpp:56</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a1b6c61362ff510fc5b45f10e9ad10be7"><div class="ttname"><a href="class_c_geom_cell.html#a1b6c61362ff510fc5b45f10e9ad10be7">CGeomCell::CalcAllLayerElevsAndD50</a></div><div class="ttdeci">void CalcAllLayerElevsAndD50(void)</div><div class="ttdoc">For this cell: calculates the elevation of the top of every layer, and the d50 for the topmost uncons...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00465">cell.cpp:465</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a1ecc8e7cd32f168781ff206f19c7615e"><div class="ttname"><a href="class_c_geom_cell.html#a1ecc8e7cd32f168781ff206f19c7615e">CGeomCell::nGetTopLayerAboveBasement</a></div><div class="ttdeci">int nGetTopLayerAboveBasement(void) const</div><div class="ttdoc">Returns the index of the topmost sediment layer (layer 0 being the one just above basement),...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00342">cell.cpp:342</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a1fa43f030ac91e5eae2c560e8cfa7099"><div class="ttname"><a href="class_c_geom_cell.html#a1fa43f030ac91e5eae2c560e8cfa7099">CGeomCell::dCalcLayerElev</a></div><div class="ttdeci">double dCalcLayerElev(const int)</div><div class="ttdoc">For this cell, calculates the elevation of the top of a given layer.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00514">cell.cpp:514</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a28b760b0a9e63afd01e29610888fc7bc"><div class="ttname"><a href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">CGeomCell::bIsInContiguousSea</a></div><div class="ttdeci">bool bIsInContiguousSea(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00102">cell.cpp:102</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a43434d6fd45da697ae17f7b274ba9a83"><div class="ttname"><a href="class_c_geom_cell.html#a43434d6fd45da697ae17f7b274ba9a83">CGeomCell::nGetTopNonZeroLayerAboveBasement</a></div><div class="ttdeci">int nGetTopNonZeroLayerAboveBasement(void) const</div><div class="ttdoc">Returns the index of the topmost sediment layer (layer 0 being the one just above basement) with non-...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00326">cell.cpp:326</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a6387aaac391af63a9f2be1c809ce169c"><div class="ttname"><a href="class_c_geom_cell.html#a6387aaac391af63a9f2be1c809ce169c">CGeomCell::dGetSedimentTopElev</a></div><div class="ttdeci">double dGetSedimentTopElev(void) const</div><div class="ttdoc">Returns the true elevation of the sediment's top surface for this cell (if there is a cliff notch,...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00389">cell.cpp:389</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a65dc08df7cf712555b94d91157431965"><div class="ttname"><a href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">CGeomCell::pGetLayerAboveBasement</a></div><div class="ttdeci">CRWCellLayer * pGetLayerAboveBasement(int const)</div><div class="ttdoc">Return a reference to the Nth sediment layer (layer 0 being just above basement)</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00369">cell.cpp:369</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a861c4641b31bb1f920daa863a98ea35c"><div class="ttname"><a href="class_c_geom_cell.html#a861c4641b31bb1f920daa863a98ea35c">CGeomCell::nGetLayerAtElev</a></div><div class="ttdeci">int nGetLayerAtElev(double const) const</div><div class="ttdoc">Given an elevation, this finds the index of the layer that contains that elevation (layer 0 being the...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00498">cell.cpp:498</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a9ee63a32283251116539dee1ff822e4f"><div class="ttname"><a href="class_c_geom_cell.html#a9ee63a32283251116539dee1ff822e4f">CGeomCell::IncrCliffCollapseDeposition</a></div><div class="ttdeci">void IncrCliffCollapseDeposition(double const)</div><div class="ttdoc">Increments the depth of this-timestep cliff deposition collapse on this cell, also increments the tot...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00722">cell.cpp:722</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_aa6b63898439e574ee70f4598f65afe8a"><div class="ttname"><a href="class_c_geom_cell.html#aa6b63898439e574ee70f4598f65afe8a">CGeomCell::dGetVolEquivSedTopElev</a></div><div class="ttdeci">double dGetVolEquivSedTopElev(void) const</div><div class="ttdoc">Returns the volume-equivalent elevation of the sediment's top surface for this cell (if there is a cl...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00376">cell.cpp:376</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_aae2df06db776f3152f79097fdc1fed70"><div class="ttname"><a href="class_c_geom_cell.html#aae2df06db776f3152f79097fdc1fed70">CGeomCell::IncrCliffCollapse</a></div><div class="ttdeci">void IncrCliffCollapse(double const)</div><div class="ttdoc">Increments the depth of this-timestep cliff collapse on this cell, also increments the total.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00703">cell.cpp:703</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_ab445c2aab1f807824fc4dc432fabfb72"><div class="ttname"><a href="class_c_geom_cell.html#ab445c2aab1f807824fc4dc432fabfb72">CGeomCell::SetSeaDepth</a></div><div class="ttdeci">void SetSeaDepth(void)</div><div class="ttdoc">Returns the depth of seawater on this cell if the sediment top is &lt; SWL, or zero.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00565">cell.cpp:565</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_af1321d6f96845f7933e6d7167267ed41"><div class="ttname"><a href="class_c_geom_cell.html#af1321d6f96845f7933e6d7167267ed41">CGeomCell::pGetLandform</a></div><div class="ttdeci">CRWCellLandform * pGetLandform(void)</div><div class="ttdoc">Returns a pointer to this cell's CRWCellLandform object.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00254">cell.cpp:254</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_landform_html_a5350a7ac48d1eef3a78bef9bcf041b45"><div class="ttname"><a href="class_c_r_w_cell_landform.html#a5350a7ac48d1eef3a78bef9bcf041b45">CRWCellLandform::nGetLFCategory</a></div><div class="ttdeci">int nGetLFCategory(void) const</div><div class="ttdoc">Get the landform category.</div><div class="ttdef"><b>Definition:</b> <a href="cell__landform_8cpp_source.html#l00050">cell_landform.cpp:50</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_landform_html_af53d3fe69c297cfb0b41d03e55ed6467"><div class="ttname"><a href="class_c_r_w_cell_landform.html#af53d3fe69c297cfb0b41d03e55ed6467">CRWCellLandform::SetLFSubCategory</a></div><div class="ttdeci">void SetLFSubCategory(int const)</div><div class="ttdoc">Set the both the landform sub-category, and the landform category.</div><div class="ttdef"><b>Definition:</b> <a href="cell__landform_8cpp_source.html#l00056">cell_landform.cpp:56</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_layer_html_a30800b5cd971976ffec36381d4e54342"><div class="ttname"><a href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">CRWCellLayer::pGetConsolidatedSediment</a></div><div class="ttdeci">CRWCellSediment * pGetConsolidatedSediment(void)</div><div class="ttdef"><b>Definition:</b> <a href="cell__layer_8cpp_source.html#l00041">cell_layer.cpp:41</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_layer_html_a6ee086df697edf497ddb97fe2f4adf53"><div class="ttname"><a href="class_c_r_w_cell_layer.html#a6ee086df697edf497ddb97fe2f4adf53">CRWCellLayer::pGetUnconsolidatedSediment</a></div><div class="ttdeci">CRWCellSediment * pGetUnconsolidatedSediment(void)</div><div class="ttdef"><b>Definition:</b> <a href="cell__layer_8cpp_source.html#l00036">cell_layer.cpp:36</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_layer_html_a894e1b3d51a02c4dd798df7c4b06edb3"><div class="ttname"><a href="class_c_r_w_cell_layer.html#a894e1b3d51a02c4dd798df7c4b06edb3">CRWCellLayer::dGetTotalThickness</a></div><div class="ttdeci">double dGetTotalThickness(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__layer_8cpp_source.html#l00094">cell_layer.cpp:94</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a166bd3ef8eb44ae4c6eff329e04bd3c0"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a166bd3ef8eb44ae4c6eff329e04bd3c0">CRWCellSediment::SetSand</a></div><div class="ttdeci">void SetSand(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00091">cell_sediment.cpp:91</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a1cc290e93cd71771941e8fb8b77bba1c"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a1cc290e93cd71771941e8fb8b77bba1c">CRWCellSediment::dGetNotchFineLost</a></div><div class="ttdeci">double dGetNotchFineLost(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00143">cell_sediment.cpp:143</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a2847af8b4324b05ae56d0b33bfc28fcb"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a2847af8b4324b05ae56d0b33bfc28fcb">CRWCellSediment::IncrNotchFineLost</a></div><div class="ttdeci">void IncrNotchFineLost(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00136">cell_sediment.cpp:136</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a38cfd2959e3a245879c28acda01d3bc1"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a38cfd2959e3a245879c28acda01d3bc1">CRWCellSediment::dGetNotchSandLost</a></div><div class="ttdeci">double dGetNotchSandLost(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00162">cell_sediment.cpp:162</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a520b31404bb1c3dd30d9c84fe84e11e8"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a520b31404bb1c3dd30d9c84fe84e11e8">CRWCellSediment::SetFine</a></div><div class="ttdeci">void SetFine(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00072">cell_sediment.cpp:72</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a55ec8f411beef4c724da8da17f9532b1"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a55ec8f411beef4c724da8da17f9532b1">CRWCellSediment::dGetSand</a></div><div class="ttdeci">double dGetSand(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00098">cell_sediment.cpp:98</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a7b908b50af702464be628e8b96c54542"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a7b908b50af702464be628e8b96c54542">CRWCellSediment::dGetFine</a></div><div class="ttdeci">double dGetFine(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00078">cell_sediment.cpp:78</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a7e2941dfdbccae9bb38dc80227d6d009"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a7e2941dfdbccae9bb38dc80227d6d009">CRWCellSediment::IncrNotchSandLost</a></div><div class="ttdeci">void IncrNotchSandLost(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00155">cell_sediment.cpp:155</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a7f2edac8db7d8e47ec400f4b06efd1a5"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a7f2edac8db7d8e47ec400f4b06efd1a5">CRWCellSediment::dGetCoarse</a></div><div class="ttdeci">double dGetCoarse(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00117">cell_sediment.cpp:117</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a930fdd5219ba9971cdbd256e1d5cc62a"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a930fdd5219ba9971cdbd256e1d5cc62a">CRWCellSediment::SetCoarse</a></div><div class="ttdeci">void SetCoarse(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00111">cell_sediment.cpp:111</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_aa04835e6620e8cffe3893aeaab77b123"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#aa04835e6620e8cffe3893aeaab77b123">CRWCellSediment::IncrNotchCoarseLost</a></div><div class="ttdeci">void IncrNotchCoarseLost(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00174">cell_sediment.cpp:174</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_ac96207eb3a1e11ae0e48e71eb89a13ef"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#ac96207eb3a1e11ae0e48e71eb89a13ef">CRWCellSediment::dGetNotchCoarseLost</a></div><div class="ttdeci">double dGetNotchCoarseLost(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00181">cell_sediment.cpp:181</a></div></div>
<div class="ttc" id="aclass_c_r_w_cliff_html"><div class="ttname"><a href="class_c_r_w_cliff.html">CRWCliff</a></div><div class="ttdoc">Real-world class used to represent the 'cliff' category of coastal landform object.</div><div class="ttdef"><b>Definition:</b> <a href="cliff_8h_source.html#l00035">cliff.h:36</a></div></div>
<div class="ttc" id="aclass_c_r_w_cliff_html_a230895c26a89fb53f0160d59e156137c"><div class="ttname"><a href="class_c_r_w_cliff.html#a230895c26a89fb53f0160d59e156137c">CRWCliff::bReadyToCollapse</a></div><div class="ttdeci">bool bReadyToCollapse(double const) const</div><div class="ttdoc">Returns true if the notch has reached the edge of the cell, or if the notch overhang exceeds the crit...</div><div class="ttdef"><b>Definition:</b> <a href="cliff_8cpp_source.html#l00111">cliff.cpp:111</a></div></div>
<div class="ttc" id="aclass_c_r_w_cliff_html_a289d564dca89392aed96da9734f41267"><div class="ttname"><a href="class_c_r_w_cliff.html#a289d564dca89392aed96da9734f41267">CRWCliff::SetAllSedimentGone</a></div><div class="ttdeci">void SetAllSedimentGone(void)</div><div class="ttdef"><b>Definition:</b> <a href="cliff_8cpp_source.html#l00075">cliff.cpp:75</a></div></div>
<div class="ttc" id="aclass_c_r_w_cliff_html_a51192ae84cf9469ac21d716dc7869905"><div class="ttname"><a href="class_c_r_w_cliff.html#a51192ae84cf9469ac21d716dc7869905">CRWCliff::dErodeNotch</a></div><div class="ttdeci">double dErodeNotch(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cliff_8cpp_source.html#l00120">cliff.cpp:120</a></div></div>
<div class="ttc" id="aclass_c_r_w_cliff_html_a70151d708b933a25eb7836d63cea7f8b"><div class="ttname"><a href="class_c_r_w_cliff.html#a70151d708b933a25eb7836d63cea7f8b">CRWCliff::dGetNotchBaseElev</a></div><div class="ttdeci">double dGetNotchBaseElev(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cliff_8cpp_source.html#l00080">cliff.cpp:80</a></div></div>
<div class="ttc" id="aclass_c_r_w_cliff_html_a73acc82455562b794d027455c1b8c3d5"><div class="ttname"><a href="class_c_r_w_cliff.html#a73acc82455562b794d027455c1b8c3d5">CRWCliff::SetNotchBaseElev</a></div><div class="ttdeci">void SetNotchBaseElev(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cliff_8cpp_source.html#l00085">cliff.cpp:85</a></div></div>
<div class="ttc" id="aclass_c_r_w_cliff_html_abdce12006e217f4d250bf00a95026264"><div class="ttname"><a href="class_c_r_w_cliff.html#abdce12006e217f4d250bf00a95026264">CRWCliff::dGetRemaining</a></div><div class="ttdeci">double dGetRemaining(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cliff_8cpp_source.html#l00095">cliff.cpp:95</a></div></div>
<div class="ttc" id="aclass_c_r_w_cliff_html_adfd463ca3137f081a5d90e9085dd8bb8"><div class="ttname"><a href="class_c_r_w_cliff.html#adfd463ca3137f081a5d90e9085dd8bb8">CRWCliff::SetNotchOverhang</a></div><div class="ttdeci">void SetNotchOverhang(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cliff_8cpp_source.html#l00100">cliff.cpp:100</a></div></div>
<div class="ttc" id="aclass_c_r_w_cliff_html_ae80ec1b39d4d0ecebe47197b81660399"><div class="ttname"><a href="class_c_r_w_cliff.html#ae80ec1b39d4d0ecebe47197b81660399">CRWCliff::SetCliffCollapse</a></div><div class="ttdeci">void SetCliffCollapse(bool const)</div><div class="ttdef"><b>Definition:</b> <a href="cliff_8cpp_source.html#l00065">cliff.cpp:65</a></div></div>
<div class="ttc" id="aclass_c_simulation_html_a222962121613613a48f518e0c2110f21"><div class="ttname"><a href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">CSimulation::LogStream</a></div><div class="ttdeci">ofstream LogStream</div><div class="ttdef"><b>Definition:</b> <a href="simulation_8h_source.html#l00806">simulation.h:806</a></div></div>
<div class="ttc" id="acliff_8h_html"><div class="ttname"><a href="cliff_8h.html">cliff.h</a></div><div class="ttdoc">Contains CRWCliff definitions.</div></div>
<div class="ttc" id="acme_8h_html"><div class="ttname"><a href="cme_8h.html">cme.h</a></div><div class="ttdoc">This file contains global definitions for CoastalME.</div></div>
<div class="ttc" id="acme_8h_html_a01522c1e8423c6586193dd5ca0c76171"><div class="ttname"><a href="cme_8h.html#a01522c1e8423c6586193dd5ca0c76171">NO_NONZERO_THICKNESS_LAYERS</a></div><div class="ttdeci">int const NO_NONZERO_THICKNESS_LAYERS</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00428">cme.h:428</a></div></div>
<div class="ttc" id="acme_8h_html_a01aa8b423260b337ddff2016107b51a0"><div class="ttname"><a href="cme_8h.html#a01aa8b423260b337ddff2016107b51a0">INT_NODATA</a></div><div class="ttdeci">int const INT_NODATA</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00188">cme.h:188</a></div></div>
<div class="ttc" id="acme_8h_html_a068017859403c0629d89f8d348f6c224"><div class="ttname"><a href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a></div><div class="ttdeci">T tMin(T a, T b)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00852">cme.h:852</a></div></div>
<div class="ttc" id="acme_8h_html_a073ffbb4921531737dc0dee04bdcbe11"><div class="ttname"><a href="cme_8h.html#a073ffbb4921531737dc0dee04bdcbe11">RTN_ERR_CLIFFNOTCH</a></div><div class="ttdeci">int const RTN_ERR_CLIFFNOTCH</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00395">cme.h:395</a></div></div>
<div class="ttc" id="acme_8h_html_a0af2b64c1c33dbf4d223944b0bf234e6"><div class="ttname"><a href="cme_8h.html#a0af2b64c1c33dbf4d223944b0bf234e6">RTN_ERR_NO_TOP_LAYER</a></div><div class="ttdeci">int const RTN_ERR_NO_TOP_LAYER</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00404">cme.h:404</a></div></div>
<div class="ttc" id="acme_8h_html_a1a0f3745fbc2e50a9f483893339c9f75"><div class="ttname"><a href="cme_8h.html#a1a0f3745fbc2e50a9f483893339c9f75">ELEV_ABOVE_SEDIMENT_TOP</a></div><div class="ttdeci">int const ELEV_ABOVE_SEDIMENT_TOP</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00427">cme.h:427</a></div></div>
<div class="ttc" id="acme_8h_html_a2271e87528b5e82505284ec3a37c27f2"><div class="ttname"><a href="cme_8h.html#a2271e87528b5e82505284ec3a37c27f2">RTN_ERR_PROFILE_ENDPOINT_IS_OFFGRID</a></div><div class="ttdeci">int const RTN_ERR_PROFILE_ENDPOINT_IS_OFFGRID</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00383">cme.h:383</a></div></div>
<div class="ttc" id="acme_8h_html_a292fc90846543ca4814daa9f759feb05"><div class="ttname"><a href="cme_8h.html#a292fc90846543ca4814daa9f759feb05">ERR</a></div><div class="ttdeci">string const ERR</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00543">cme.h:543</a></div></div>
<div class="ttc" id="acme_8h_html_a48ef8882a05bbb7c4fe8e35065e06ee4"><div class="ttname"><a href="cme_8h.html#a48ef8882a05bbb7c4fe8e35065e06ee4">LF_CAT_DRIFT</a></div><div class="ttdeci">int const LF_CAT_DRIFT</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00232">cme.h:232</a></div></div>
<div class="ttc" id="acme_8h_html_a540d8a94fc09b0b14fd8ab657445b67a"><div class="ttname"><a href="cme_8h.html#a540d8a94fc09b0b14fd8ab657445b67a">LOG_FILE_MIDDLE_DETAIL</a></div><div class="ttdeci">int const LOG_FILE_MIDDLE_DETAIL</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00180">cme.h:180</a></div></div>
<div class="ttc" id="acme_8h_html_a65a71870b31deafaa61220aa9b6fc9cb"><div class="ttname"><a href="cme_8h.html#a65a71870b31deafaa61220aa9b6fc9cb">WALKDEN_HALL_PARAM_2</a></div><div class="ttdeci">double const WALKDEN_HALL_PARAM_2</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00459">cme.h:459</a></div></div>
<div class="ttc" id="acme_8h_html_a7e895b460cef877dec4d12ead0c74f15"><div class="ttname"><a href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a></div><div class="ttdeci">T tMax(T a, T b)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00839">cme.h:839</a></div></div>
<div class="ttc" id="acme_8h_html_a8a73c1e3b62bdc03aeb0be69f0fa018b"><div class="ttname"><a href="cme_8h.html#a8a73c1e3b62bdc03aeb0be69f0fa018b">LF_SUBCAT_DRIFT_TALUS</a></div><div class="ttdeci">int const LF_SUBCAT_DRIFT_TALUS</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00241">cme.h:241</a></div></div>
<div class="ttc" id="acme_8h_html_a957ca99e98618160534cafb0929f743d"><div class="ttname"><a href="cme_8h.html#a957ca99e98618160534cafb0929f743d">WARN</a></div><div class="ttdeci">string const WARN</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00544">cme.h:544</a></div></div>
<div class="ttc" id="acme_8h_html_a992c7916632c97c6c1fa25fd5a788282"><div class="ttname"><a href="cme_8h.html#a992c7916632c97c6c1fa25fd5a788282">SEDIMENT_ELEV_TOLERANCE</a></div><div class="ttdeci">double const SEDIMENT_ELEV_TOLERANCE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00470">cme.h:470</a></div></div>
<div class="ttc" id="acme_8h_html_aa768cb14b5c6123ee95e6e4ebd9fe331"><div class="ttname"><a href="cme_8h.html#aa768cb14b5c6123ee95e6e4ebd9fe331">RTN_OK</a></div><div class="ttdeci">int const RTN_OK</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00358">cme.h:358</a></div></div>
<div class="ttc" id="acme_8h_html_ac35a5105cdbbb00d8c809eee7c72a0f8"><div class="ttname"><a href="cme_8h.html#ac35a5105cdbbb00d8c809eee7c72a0f8">RTN_ERR_CLIFFDEPOSIT</a></div><div class="ttdeci">int const RTN_ERR_CLIFFDEPOSIT</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00396">cme.h:396</a></div></div>
<div class="ttc" id="acme_8h_html_ac5c14eafd96860d3f562e9c7f23a4104"><div class="ttname"><a href="cme_8h.html#ac5c14eafd96860d3f562e9c7f23a4104">DEAN_POWER</a></div><div class="ttdeci">double const DEAN_POWER</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00463">cme.h:463</a></div></div>
<div class="ttc" id="acme_8h_html_ace82416ca7fb524bd4da49c3d402b082"><div class="ttname"><a href="cme_8h.html#ace82416ca7fb524bd4da49c3d402b082">RTN_ERR_NO_SOLUTION_FOR_ENDPOINT</a></div><div class="ttdeci">int const RTN_ERR_NO_SOLUTION_FOR_ENDPOINT</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00385">cme.h:385</a></div></div>
<div class="ttc" id="acme_8h_html_ad6be96d3be217d31a74c2412d7e6cbbb"><div class="ttname"><a href="cme_8h.html#ad6be96d3be217d31a74c2412d7e6cbbb">LF_CAT_CLIFF</a></div><div class="ttdeci">int const LF_CAT_CLIFF</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00231">cme.h:231</a></div></div>
<div class="ttc" id="acme_8h_html_adc384b5f75dbfc8d278db8084d25a8eb"><div class="ttname"><a href="cme_8h.html#adc384b5f75dbfc8d278db8084d25a8eb">LOG_FILE_MOST_DETAIL</a></div><div class="ttdeci">int const LOG_FILE_MOST_DETAIL</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00181">cme.h:181</a></div></div>
<div class="ttc" id="acme_8h_html_add30b59022abb07bc55b76b57f1a60fb"><div class="ttname"><a href="cme_8h.html#add30b59022abb07bc55b76b57f1a60fb">WALKDEN_HALL_PARAM_1</a></div><div class="ttdeci">double const WALKDEN_HALL_PARAM_1</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00458">cme.h:458</a></div></div>
<div class="ttc" id="acme_8h_html_ae3b6dc50cfc97050529faa5e0bd66136"><div class="ttname"><a href="cme_8h.html#ae3b6dc50cfc97050529faa5e0bd66136">tAbs</a></div><div class="ttdeci">T tAbs(T a)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00864">cme.h:864</a></div></div>
<div class="ttc" id="acme_8h_html_af57d19c8f0c3205c6713d5f9b0dddec4"><div class="ttname"><a href="cme_8h.html#af57d19c8f0c3205c6713d5f9b0dddec4">RTN_ERR_LINETOGRID</a></div><div class="ttdeci">int const RTN_ERR_LINETOGRID</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00381">cme.h:381</a></div></div>
<div class="ttc" id="acme_8h_html_afb9499d46447e0115ed3abc66ce28a7d"><div class="ttname"><a href="cme_8h.html#afb9499d46447e0115ed3abc66ce28a7d">LF_CAT_INTERVENTION</a></div><div class="ttdeci">int const LF_CAT_INTERVENTION</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00233">cme.h:233</a></div></div>
<div class="ttc" id="asimulation_8h_html"><div class="ttname"><a href="simulation_8h.html">simulation.h</a></div><div class="ttdoc">Contains CSimulation definitions.</div></div>
<div class="ttc" id="autils__global_8cpp_html_a20842d0a19d0ca952c91f3e1eb175fee"><div class="ttname"><a href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a></div><div class="ttdeci">int nRound(double const d)</div><div class="ttdef"><b>Definition:</b> <a href="utils__global_8cpp_source.html#l00054">utils_global.cpp:54</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 29 2021 15:52:59 for CoastalME (Coastal Modelling Environment) by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
