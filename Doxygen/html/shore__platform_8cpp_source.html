<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CoastalME (Coastal Modelling Environment): shore_platform.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CoastalME (Coastal Modelling Environment)
   </div>
   <div id="projectbrief">Simulates the long-term behaviour of complex coastlines</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">shore_platform.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="shore__platform_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> This file is part of CoastalME, the Coastal Modelling Environment.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> CoastalME is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">using</span> std::cout;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using</span> std::cerr;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">using</span> std::endl;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">using</span> std::ios;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">using</span> std::setiosflags;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cme_8h.html">cme.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hermite__cubic_8h.html">hermite_cubic.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="interpolate_8h.html">interpolate.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="simulation_8h.html">simulation.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="coast_8h.html">coast.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> Does platform erosion on all coastlines by first calculating platform erosion on coastline-normal profiles, then extrapolating this to cells between the profiles</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keywordtype">int</span> CSimulation::nDoAllShorePlatFormErosion(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;{</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   <span class="comment">// TODO Only do potential erosion if cell is in a polygon</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;   <span class="keyword">static</span> <span class="keywordtype">bool</span> bForward = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   <span class="comment">// Do this for each coast</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(m_VCoast.size()); nCoast++)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <span class="keywordtype">int</span> <span class="keyword">const</span> nNumProfiles = m_VCoast[nCoast].nGetNumProfiles();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <span class="comment">// Calculate potential erosion on every coastline-normal profile. Can do this in the original, curvature-related, sequence of profiles</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <span class="keywordtype">int</span> nProfile = 0;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <span class="keywordflow">for</span> ((bForward ? nProfile = 0 : nProfile = (nNumProfiles-1)); (bForward ? nProfile &lt; nNumProfiles : nProfile &gt;= 0); (bForward ? nProfile++ : nProfile--))</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;         <span class="comment">// Calculate potential platform erosion along the length of this profile</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;         <span class="keywordtype">int</span> <span class="keyword">const</span> nRet = nCalcPotentialPlatformErosionOnProfile(nCoast, nProfile);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;         <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="comment">// Calculate potential platform erosion between the coastline-normal profiles. Do this in along-coastline sequence</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="keywordtype">int</span> nProfIndex = 0;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="keywordflow">for</span> ((bForward ? nProfIndex = 0 : nProfIndex = (nNumProfiles-1)); (bForward ? nProfIndex &lt; nNumProfiles : nProfIndex &gt;= 0); (bForward ? nProfIndex++ : nProfIndex--))</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;         <span class="comment">// Calculate potential erosion for sea cells between this profile and the next profile (or up to the edge of the grid) on these cells</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;         <span class="keywordtype">int</span> nRet = nCalcPotentialPlatformErosionBetweenProfiles(nCoast, nProfIndex, <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;         <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;         nRet = nCalcPotentialPlatformErosionBetweenProfiles(nCoast, nProfIndex, <a class="code" href="cme_8h.html#af803adbfdc053cf78880fc2425db1f1d">DIRECTION_UPCOAST</a>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;         <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;   }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;   <span class="comment">// If desired, swap direction for next timestep</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;   <span class="keywordflow">if</span> (m_bErodeShorePlatformAlternateDirection)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      bForward = !bForward;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;   <span class="comment">// Fills in &#39;holes&#39; in the potential platform erosion i.e. orphan cells which get omitted because of rounding problems</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   FillPotentialPlatformErosionHoles();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   <span class="comment">// Do the same for beach protection</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   FillInBeachProtectionHoles();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   <span class="comment">// Finally calculate actual platform erosion on all sea cells (both on profiles, and between profiles)</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nX = 0; nX &lt; m_nXGridMax; nX++)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nY = 0; nY &lt; m_nYGridMax; nY++)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;         <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a3ba9a139b838c676b85a6b065326aeb4">bPotentialPlatformErosion</a>())</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="comment">// Calculate actual (supply-limited) shore platform erosion on each cell that has potential platform erosion, also add the eroded sand/coarse sediment to that cells&#39;s polygon, ready to be redistributed within the polygon during beach erosion/deposition</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            DoActualShorePlatformErosionOnCell(nX, nY);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; endl &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: potential shore platform erosion (m^3) = &quot;</span> &lt;&lt; m_dThisTimestepPotentialPlatformErosion * m_dCellArea &lt;&lt; <span class="stringliteral">&quot; (on profiles = &quot;</span> &lt;&lt; m_dTotPotentialPlatformErosionOnProfiles * m_dCellArea &lt;&lt; <span class="stringliteral">&quot;, between profiles = &quot;</span> &lt;&lt; m_dTotPotentialPlatformErosionBetweenProfiles * m_dCellArea &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;   <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: actual shore platform erosion (m^3) = &quot;</span> &lt;&lt; (m_dThisTimestepActualPlatformErosionFine + m_dThisTimestepActualPlatformErosionSand + m_dThisTimestepActualPlatformErosionCoarse) * m_dCellArea &lt;&lt; <span class="stringliteral">&quot; (fine = &quot;</span> &lt;&lt; m_dThisTimestepActualPlatformErosionFine * m_dCellArea &lt;&lt; <span class="stringliteral">&quot;, sand = &quot;</span> &lt;&lt; m_dThisTimestepActualPlatformErosionSand * m_dCellArea &lt;&lt; <span class="stringliteral">&quot;, coarse = &quot;</span> &lt;&lt; m_dThisTimestepActualPlatformErosionCoarse * m_dCellArea &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"> Calculates potential (i.e. unconstrained by available sediment) erosional lowering of the shore platform for a single coastline-normal profile, due to wave action. This routine uses a behavioural rule to modify the original surface elevation profile geometry, in which erosion rate/slope = f(d/Db) based on Walkden &amp; Hall (2005). Originally coded in Matlab, by Andres Payo</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordtype">int</span> CSimulation::nCalcPotentialPlatformErosionOnProfile(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfile)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;{</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* <span class="keyword">const</span> pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   <span class="comment">// Only work on this profile if it is problem-free TODO ANDRES Or if it has just hit dry land?</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;   <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aac223e2610d50ca2c7eadaf8542e9498">bOKIncStartAndEndOfCoast</a>())    <span class="comment">//  || (pProfile-&gt;nGetProblemCode() == PROFILE_DRYLAND))</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   <span class="comment">// Get the length of the profile (in cells) and the index of the coast point at which this profile starts</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <span class="keywordtype">int</span> <span class="keyword">const</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      nProfSize = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">nGetNumCellsInProfile</a>(),</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      nCoastPoint = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a0aead517e2105d6c1a14c27126b1fe92">nGetNumCoastPoint</a>();</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   <span class="comment">// Get the breaking depth for this profile from the coastline point</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   <span class="keywordtype">double</span> dDepthOfBreaking = m_VCoast[nCoast].dGetDepthOfBreaking(nCoastPoint);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;   <span class="keywordflow">if</span> (dDepthOfBreaking == <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="comment">// This profile is not in the active zone, so no platform erosion here</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">//   LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: ON PROFILE nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot; dDepthOfBreaking = &quot; &lt;&lt; dDepthOfBreaking &lt;&lt; endl;</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;   <span class="comment">// Get the height of the associated breaking wave from the coast point: this height is used in beach protection calcs</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;   <span class="keywordtype">double</span> <span class="keyword">const</span> dBreakingWaveHeight =  m_VCoast[nCoast].dGetBreakingWaveHeight(nCoastPoint);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   <span class="comment">// Calculate the length of the profile in external CRS units</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;   <span class="keywordtype">int</span> <span class="keyword">const</span> nSegments = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#abaf88697019588a2b0901bd19044aee4">nGetProfileSize</a>()-1;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;   <span class="keywordtype">double</span> dProfileLenXY = 0;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nSeg = 0; nSeg &lt; nSegments; nSeg++)</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="comment">// Do once for every line segment</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;         dSegStartX = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg)-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>(),</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;         dSegStartY = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg)-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>(),</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;         dSegEndX = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg+1)-&gt;<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>(),     <span class="comment">// Is OK</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;         dSegEndY = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">pPtGetPointInProfile</a>(nSeg+1)-&gt;<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>();</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> dSegLen = hypot(dSegStartX - dSegEndX, dSegStartY - dSegEndY);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      dProfileLenXY += dSegLen;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;   <span class="comment">// Next calculate the average distance between profile points, again in external CRS units. Assume that the sample points are equally spaced along the profile (not quite true)</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;   <span class="keywordtype">double</span> <span class="keyword">const</span> dSpacingXY = dProfileLenXY / (nProfSize-1);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;   <span class="comment">// Set up vectors for the coastline-normal profile elevations. The length of this vector line is given by the number of cells &#39;under&#39; the profile. Thus each point on the vector relates to a single cell in the grid. This assumes that all points on the profile vector are equally spaced (not quite true, depends on the orientation of the line segments which comprise the profile)</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;   <span class="comment">// The elevation of each of these profile points is the elevation of the centroid of the cell that is &#39;under&#39; the point. However we cannot always be confident that this is the &#39;true&#39; elevation of the point on the vector since (unless the profile runs planview N-S or W-E) the vector does not always run exactly through the centroid of the cell</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      VdProfileZ(nProfSize, 0),                 <span class="comment">// Initial (pre-erosion) elevation of both consolidated and unconsolidated sediment for cells &#39;under&#39; the profile</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      VdProfileDistXY(nProfSize,  0),           <span class="comment">// Along-profile distance measured from the coast, in external CRS units</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      dVConsProfileZ(nProfSize, 0),             <span class="comment">// Initial (pre-erosion) elevation of consolidated sediment only for cells &#39;under&#39; the profile</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      dVConsZDiff(nProfSize, 0),</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      dVConsSlope(nProfSize, 0);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfSize; i++)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;   {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keywordtype">int</span> <span class="keyword">const</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;         nX = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetX(),</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;         nY = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetY();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="comment">// Get the number of the highest layer with non-zero thickness</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="keywordtype">int</span> <span class="keyword">const</span> nTopLayer = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a43434d6fd45da697ae17f7b274ba9a83">nGetTopNonZeroLayerAboveBasement</a>();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">if</span> (nTopLayer == <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#ac8de8e3c8f526683cf8a372e00bdcde3">RTN_ERR_NO_TOP_LAYER</a>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="keywordflow">if</span> (nTopLayer == <a class="code" href="cme_8h.html#a6da5abe13cf250e9663012ef6633d92a">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;         <span class="comment">// TODO we are down to basement, check with Andres what to do</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="comment">// Get the elevation for consolidated sediment only on this cell</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      dVConsProfileZ[i] = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#af81bd1114fb19617a232c7a901366301">dGetConsSedTopForLayerAboveBasement</a>(nTopLayer);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="comment">// Get the elevation for both consolidated and unconsolidated sediment on this cell</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      VdProfileZ[i] = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a6387aaac391af63a9f2be1c809ce169c">dGetSedimentTopElev</a>();</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="comment">// And store the X-Y plane distance from the start of the profile</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      VdProfileDistXY[i] = i * dSpacingXY;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfSize-1; i++)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="comment">// For the consolidated-only profile, get the Z differences (already in external CRS units)</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      dVConsZDiff[i] = dVConsProfileZ[i] - dVConsProfileZ[i+1];</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="comment">// Calculate dZ/dXY, the Z slope (i.e. rise over run) in the XY direction. Note that we use the elevation difference on the seaward side of &#39;this&#39; point</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      dVConsSlope[i] = dVConsZDiff[i] / dSpacingXY;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   <span class="comment">// Sort out the final value</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   dVConsSlope[nProfSize-1] = dVConsSlope[nProfSize-2];</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   <span class="keywordflow">if</span> (m_nProfileSmoothWindow &gt; 0)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;   {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="comment">// Smooth the vector of slopes for the consolidated-only profile</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      dVConsSlope = dVSmoothProfileSlope(&amp;dVConsSlope);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      dVProfileDepthOverDB(nProfSize, 0),          <span class="comment">// Depth over wave breaking depth at the coastline-normal sample points</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      dVProfileErosionPotential(nProfSize, 0);     <span class="comment">// Erosion potential at the coastline-normal sample points</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   <span class="comment">// Calculate the erosion potential along this profile using the shape function</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   <span class="keywordtype">double</span> dTotalErosionPotential = 0;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfSize; i++)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="comment">// Use the actual depth of water here (i.e. the depth to the top of the unconsolidated sediment, including the thickness of consolidated sediment beneath it)</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      dVProfileDepthOverDB[i] = m_dThisTimestepSWL - VdProfileZ[i];</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      dVProfileDepthOverDB[i] /= dDepthOfBreaking;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="comment">// Constrain dDepthOverDB[i] to be between 0 (can get small -ve values due to rounding errors) and m_dDepthOverDBMax</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      dVProfileDepthOverDB[i] = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(dVProfileDepthOverDB[i], 0.0);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      dVProfileDepthOverDB[i] = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dVProfileDepthOverDB[i], m_dDepthOverDBMax);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="comment">// And then use the look-up table to find the value of erosion potential at this point on the profile</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      dVProfileErosionPotential[i] = dLookUpErosionPotential(dVProfileDepthOverDB[i]);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="comment">// If erosion potential (a -ve value) is tiny, set it to zero</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="keywordflow">if</span> (dVProfileErosionPotential[i] &gt; -<a class="code" href="cme_8h.html#ab63e5883f26dfad0f0c3b7cccce87c71">SEDIMENT_ELEV_TOLERANCE</a>)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;         dVProfileErosionPotential[i] = 0;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="comment">// Keep track of the total erosion potential for this profile</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      dTotalErosionPotential += dVProfileErosionPotential[i];</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   <span class="comment">// Constrain erosion potential at every point on the profile, so that the integral of erosion potential on the whole profile is unity (Walkden and Hall 2005). Note that here, erosion potential is -ve so we must constrain to -1</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfSize; i++)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">if</span> (dTotalErosionPotential &lt; 0)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;         dVProfileErosionPotential[i] /= (-dTotalErosionPotential);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      dVRecessionXY(nProfSize, 0),</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      dVSCAPEXY(nProfSize, 0);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   <span class="comment">// Calculate recession at every point on the coastline-normal profile</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nProfSize; i++)</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="comment">// dRecession = dForce * (dBeachProtection / dR) * dErosionPotential * dSlope * dTime</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="comment">// where:</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="comment">//     dVRecession [m] is the landward migration distance defined in the profile relative (XY) CRS</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="comment">//     dForce is given by Equation 4 in Walkden &amp; Hall, 2005</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="comment">//     dVBeachProtection [1] is beach protection factor [1, 0] = [no protection, fully protected]. (This is calculated later, see dCalcBeachProtectionFactor())</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="comment">//     dVR  [m^(9/4)s^(2/3)] is the material strength and some hydrodynamic constant</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="comment">//     dVProfileErosionPotential [?] is the erosion potential at each point along the profile</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="comment">//     dVSlope [1] is the along-profile slope</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="comment">//     m_dTimeStep * 3600 [s] is the time interval in seconds</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="comment">// dRecession is horizontal recession (along the XY direction):</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="comment">// dVRecessionXY[i] = (dForce * dVBeachProtection[i] * dVErosionPotentialFunc[i] * dVSlope[i] * m_dTimeStep * 3600) / dVR[i]</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="comment">// XY recession must be -ve or zero. If it is +ve then it represents accretion not erosion, which must be described by a different set of equations. So we also need to constrain XY recession to be &lt;= 0</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      dVRecessionXY[i] = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(m_VCoast[nCoast].dGetWaveEnergyatBreaking(nCoastPoint) * dVProfileErosionPotential[i] * dVConsSlope[i] / m_dR, 0.0);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      dVSCAPEXY[i] = VdProfileDistXY[i] - dVRecessionXY[i];</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   vector&lt;double&gt; dVChangeElevZ(nProfSize, 0);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   <span class="comment">// We have calculated the XY-plane recession at every point on the profile, so now convert this to a change in Z-plane elevation at every inundated point on the profile (not the coast point). Again we use the elevation difference on the seaward side of &#39;this&#39; point</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; nProfSize-1; i++)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="comment">// Vertical lowering dZ = dXY * tan(a), where tan(a) is the slope of the SCAPE profile in the XY direction</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;         dSCAPEHorizDist = dVSCAPEXY[i+1] - dVSCAPEXY[i],</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;         dSCAPEVertDist = dVConsProfileZ[i] - dVConsProfileZ[i+1],</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;         dSCAPESlope = dSCAPEVertDist / dSCAPEHorizDist,</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;         dDeltaZ = dVRecessionXY[i] * dSCAPESlope;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keywordtype">int</span> <span class="keyword">const</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;         nX = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetX(),</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;         nY = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetY();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="comment">// Store the local slope of the consolidated sediment, this is just for output display purposes</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a740baf31197e977b3f534fbafe2dfb7e">SetLocalConsSlope</a>(dVConsSlope[i]);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="comment">// dDeltaZ is zero or -ve: if dDeltaZ is zero then do nothing, if -ve then remove some sediment from this cell</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">if</span> (dDeltaZ &lt; 0)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;         <span class="comment">// If there has already been potential erosion on this cell, then it must be a shared line segment (i.e. has co-incident profiles)</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;         <span class="keywordtype">double</span> dPrevPotentialErosion = -m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>();</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;         <span class="keywordflow">if</span> (dPrevPotentialErosion &lt; 0)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;         {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="comment">// Average the two values</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">//               LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] under profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; has previous potential platform erosion = &quot; &lt;&lt; dPrevPotentialErosion &lt;&lt; endl;</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            dDeltaZ = ((dDeltaZ + dPrevPotentialErosion) / 2);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;         }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;         <span class="comment">// Constrain the lowering so we don&#39;t get negative slopes or +ve erosion amounts (dDeltaZ must be -ve), this is implicit in SCAPE</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;         dDeltaZ = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(dDeltaZ, -dVConsZDiff[i]);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;         dDeltaZ = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dDeltaZ, 0.0);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;         dVChangeElevZ[i] = dDeltaZ;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;         <span class="comment">// Set the potential (unconstrained) erosion for this cell, is a +ve value</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;         m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a961fbff61a3e1655927367f90a5111ed">SetPotentialPlatformErosion</a>(-dDeltaZ);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;         <span class="comment">// Update this-timestep totals</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;         m_ulThisTimestepNumPotentialPlatformErosionCells++;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;         m_dThisTimestepPotentialPlatformErosion -= dDeltaZ;       <span class="comment">// Since dDeltaZ is a -ve value</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;         assert(<a class="code" href="utils__global_8cpp.html#a3caffa5ba0bac0bca723d7d0247d0844">bIsDoubleNotNaN</a>(m_dThisTimestepPotentialPlatformErosion));</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">//             assert(m_dThisTimestepPotentialPlatformErosion &gt;= 0);</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;         <span class="comment">// Increment the check values</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;         m_ulTotPotentialPlatformErosionOnProfiles++;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;         m_dTotPotentialPlatformErosionOnProfiles -= dDeltaZ;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="comment">// Finally, calculate the beach protection factor, this will be used in estimating actual (supply-limited) erosion</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keywordtype">double</span> dBeachProtectionFactor = dCalcBeachProtectionFactor(nX, nY, dBreakingWaveHeight);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#af18c6e0d8ffa6e1298bcc6964534af08">SetBeachProtectionFactor</a>(dBeachProtectionFactor);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="comment">// If desired, save this coastline-normal profile data for checking purposes</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   <span class="keywordflow">if</span> (m_bOutputProfileData)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordtype">int</span> nRet = nSaveProfile(nProfile, nCoast, nProfSize, &amp;VdProfileDistXY, &amp;dVConsProfileZ, &amp;dVProfileDepthOverDB, &amp;dVProfileErosionPotential, &amp;dVConsSlope, &amp;dVRecessionXY, &amp;dVChangeElevZ, pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>(), &amp;dVSCAPEXY);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"> Calculates potential platform erosion on cells to one side of a given coastline-normal profile, up to the next profile</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keywordtype">int</span> CSimulation::nCalcPotentialPlatformErosionBetweenProfiles(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfIndex, <span class="keywordtype">int</span> <span class="keyword">const</span> nDirection)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;{</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   <span class="comment">// Get the number of the coastline-normal profile</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <span class="keywordtype">int</span> <span class="keyword">const</span> nProfile = m_VCoast[nCoast].nGetProfileFromAlongCoastProfileIndex(nProfIndex);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* <span class="keyword">const</span> pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <span class="comment">// Only work on this profile if it is problem-free</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aac223e2610d50ca2c7eadaf8542e9498">bOKIncStartAndEndOfCoast</a>())</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <span class="keywordtype">int</span> <span class="keyword">const</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      nProfSize = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">nGetNumCellsInProfile</a>(),</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      nCoastProfileStart = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a0aead517e2105d6c1a14c27126b1fe92">nGetNumCoastPoint</a>(),</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      nProfileStartX = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(0).nGetX(),</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      nProfileStartY = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(0).nGetY(),</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      nCoastMax = m_VCoast[nCoast].nGetCoastlineSize();</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      nDistFromProfile = 0,</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      nParCoastXLast = nProfileStartX,</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      nParCoastYLast = nProfileStartY;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;   <span class="comment">// Start at the coast end of this coastline-normal profile, then move one cell forward along the coast, then construct a parallel profile from this new coastline start cell. Calculate erosion along this parallel profile in the same way as above. Move another cell forward along the coastline, do the same. Keep going until hit another profile</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;   <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;   {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="comment">// Increment the distance from the start coast-normal profile</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      nDistFromProfile++;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="comment">// Start the parallel profile nDistFromProfile cells along the coastline from the coastline-normal profile, direction depending on nDirection</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="keywordtype">int</span> nThisPointOnCoast = nCoastProfileStart;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordflow">if</span> (nDirection == <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;         nThisPointOnCoast += nDistFromProfile;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;         nThisPointOnCoast -= nDistFromProfile;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="comment">// Have we reached the beginning of the coast?</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">if</span> ((nDirection == <a class="code" href="cme_8h.html#af803adbfdc053cf78880fc2425db1f1d">DIRECTION_UPCOAST</a>) &amp;&amp; (nThisPointOnCoast &lt; 0))</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: LEAVING LOOP since hit nThisPointOnCoast = &quot; &lt;&lt; nThisPointOnCoast &lt;&lt; &quot; while doing potential platform erosion &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast from profile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, dist from profile = &quot; &lt;&lt;  nDistFromProfile &lt;&lt; endl;</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="comment">// Have we reached the end of the coast?</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keywordflow">if</span> ((nDirection == <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a>) &amp;&amp; (nThisPointOnCoast &gt;= nCoastMax))</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: LEAVING LOOP since hit nThisPointOnCoast = &quot; &lt;&lt; nThisPointOnCoast &lt;&lt; &quot; while doing potential platform erosion &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast from profile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, dist from profile = &quot; &lt;&lt;  nDistFromProfile &lt;&lt; endl;</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: from profile &quot; &lt;&lt; nProfile &lt;&lt; &quot;, doing potential platform erosion &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast, dist from profile = &quot; &lt;&lt;  nDistFromProfile &lt;&lt; endl;</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> dDepthOfBreaking = m_VCoast[nCoast].dGetDepthOfBreaking(nThisPointOnCoast);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordflow">if</span> (dDepthOfBreaking == <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>)</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;         <span class="comment">// This parallel profile is not in the active zone, so no platform erosion here. Move on to the next point along the coastline in this direction</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: not in active zone at coastline &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; coast point &quot;</span> &lt;&lt; nThisPointOnCoast &lt;&lt; <span class="stringliteral">&quot; when constructing parallel profile for potential platform erosion. Working from profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; (nDirection == <a class="code" href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a> ? <span class="stringliteral">&quot;down&quot;</span> : <span class="stringliteral">&quot;up&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;-coast, dist from profile = &quot;</span> &lt;&lt;  nDistFromProfile &lt;&lt; endl;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;         <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="comment">// All is OK, so get the grid co-ordinates of this point, which is the coastline start point for the parallel profile</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordtype">int</span> <span class="keyword">const</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;         nParCoastX = m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nThisPointOnCoast)-&gt;nGetX(),</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;         nParCoastY = m_VCoast[nCoast].pPtiGetCellMarkedAsCoastline(nThisPointOnCoast)-&gt;nGetY();</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="keywordflow">if</span> ((nParCoastX == nParCoastXLast) &amp;&amp; (nParCoastY == nParCoastYLast))</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;         <span class="comment">// Should not happen, but could do due to rounding errors</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; <a class="code" href="cme_8h.html#aefc63c4bde02ca170b0e7bd038ba7702">WARN</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: rounding problem on coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; at [&quot;</span> &lt;&lt; nParCoastX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nParCoastY &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;         <span class="comment">// So move on to the next point along the coastline in this direction</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;         <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="comment">// Is this coastline start point the start point of an adjacent coastline-normal vector?</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nParCoastX][nParCoastY].<a class="code" href="class_c_geom_cell.html#ad2c6f63894b9feea63d71d15932c0825">bIsProfile</a>())</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;         <span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast &quot; &lt;&lt; nCoast &lt;&lt; &quot;, LEAVING LOOP since hit another profile at nThisPointOnCoast = &quot; &lt;&lt; nThisPointOnCoast &lt;&lt; &quot; while doing potential platform erosion &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast from profile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, dist from profile = &quot; &lt;&lt;  nDistFromProfile &lt;&lt; endl;</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="comment">// Get the height of the associated breaking wave from the coast point: this height is used in beach protection calcs. Note that it will be DBL_NODATA if not in active zone</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> dBreakingWaveHeight =  m_VCoast[nCoast].dGetBreakingWaveHeight(nThisPointOnCoast);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="comment">// OK, now construct a parallel profile</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      vector&lt;CGeom2DIPoint&gt;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;         PtiVGridParProfile;        <span class="comment">// Integer coords (grid CRS) of cells under the parallel profile</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      vector&lt;CGeom2DPoint&gt;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;         PtVExtCRSParProfile;        <span class="comment">// Co-ords (external CRS) of cells under the parallel profile</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      ConstructParallelProfile(nProfileStartX, nProfileStartY, nParCoastX, nParCoastY, nProfSize, pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>(), &amp;PtiVGridParProfile, &amp;PtVExtCRSParProfile);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keywordtype">int</span> <span class="keyword">const</span> nParProfSize = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(PtiVGridParProfile.size());</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="comment">// We have a parallel profile which starts at the coast, but is it long enough to be useful? May have been cut short because it extended outside the grid, or we hit an adjacent profile</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">if</span> (nParProfSize &lt; 3)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;         <span class="comment">// We cannot use this parallel profile, it is too short to calculate along-profile slope, so abandon it and move on to the next parallel profile in this direction</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;         nParCoastXLast = nParCoastX;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;         nParCoastYLast = nParCoastY;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: parallel profile abandoned since too short, starts at [&quot; &lt;&lt; nParCoastX &lt;&lt; &quot;][&quot; &lt;&lt; nParCoastY &lt;&lt; &quot;] coastline point &quot; &lt;&lt; nThisPointOnCoast &lt;&lt; &quot;, length = &quot; &lt;&lt; nParProfSize &lt;&lt; endl;</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;         <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="comment">// This parallel profile is OK, so calculate potential erosion along it. First calculate the length of the parallel profile in external CRS units</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> dParProfileLenXY = dGetDistanceBetween(&amp;PtVExtCRSParProfile[0], &amp;PtVExtCRSParProfile[nParProfSize-1]);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <span class="comment">// Next calculate the distance between profile points, again in external CRS units. Assume that the sample points are equally spaced along the parallel profile (not quite true)</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="keywordtype">double</span> <span class="keyword">const</span> dParSpacingXY = dParProfileLenXY / (nParProfSize - 1);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">//      LogStream &lt;&lt; &quot;dParSpacingXY = &quot; &lt;&lt; dParSpacingXY &lt;&lt; endl;</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      vector&lt;double&gt;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;         dVParProfileZ(nParProfSize, 0),                 <span class="comment">// Initial (pre-erosion) elevation of both consolidated and unconsolidated sediment for cells &#39;under&#39; the parallel profile</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;         dVParProfileDistXY(nParProfSize,  0),           <span class="comment">// Along-profile distance measured from the coast, in external CRS units</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;         dVParConsProfileZ(nParProfSize, 0),             <span class="comment">// Initial (pre-erosion) elevation of consolidated sediment only for cells &#39;under&#39; the parallel profile</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;         dVParConsZDiff(nParProfSize, 0),</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;         dVParConsSlope(nParProfSize, 0);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nParProfSize; i++)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;         <span class="keywordtype">int</span> <span class="keyword">const</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            nXPar = PtiVGridParProfile[i].nGetX(),</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            nYPar = PtiVGridParProfile[i].nGetY();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;         <span class="comment">// Is this a sea cell?</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;         <span class="keywordflow">if</span> (! m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#a54949735a3e7fefed49704f7a9a50fff">bIsInundated</a>())</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;         {</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="comment">// It isn&#39;t so move along, nothing to do here</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot; : [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] is not inundated&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;         }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;         <span class="comment">// Is this cell in a polygon?</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;         <span class="keywordtype">int</span> nPolyID = m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;         <span class="keywordflow">if</span> (nPolyID == <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;         {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="comment">// It isn&#39;t. This can happen at the seaward end of polygons TODO Is it a problem?</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot; : [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPar) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nYPar) &lt;&lt; &quot;} is not in a polygon&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;         }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;         <span class="comment">// Get the number of the highest layer with non-zero thickness</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;         <span class="keywordtype">int</span> <span class="keyword">const</span> nTopLayer = m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#a43434d6fd45da697ae17f7b274ba9a83">nGetTopNonZeroLayerAboveBasement</a>();</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;         <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;         <span class="keywordflow">if</span> (nTopLayer == <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#ac8de8e3c8f526683cf8a372e00bdcde3">RTN_ERR_NO_TOP_LAYER</a>;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;         <span class="keywordflow">if</span> (nTopLayer == <a class="code" href="cme_8h.html#a6da5abe13cf250e9663012ef6633d92a">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="comment">// TODO we are down to basement, check with Andres what to do</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;         <span class="comment">// Get the elevation for consolidated sediment only on this cell</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;         dVParConsProfileZ[i] = m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#af81bd1114fb19617a232c7a901366301">dGetConsSedTopForLayerAboveBasement</a>(nTopLayer);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;         <span class="comment">// Get the elevation for both consolidated and unconsolidated sediment on this cell</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;         dVParProfileZ[i] = m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#a6387aaac391af63a9f2be1c809ce169c">dGetSedimentTopElev</a>();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;         <span class="comment">// And store the X-Y plane distance from the start of the profile</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;         dVParProfileDistXY[i] = i * dParSpacingXY;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nParProfSize-1; i++)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;         <span class="comment">// For the consolidated-only profile, get the Z differences (already in external CRS units)</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;         dVParConsZDiff[i] = dVParConsProfileZ[i] - dVParConsProfileZ[i+1];</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;         <span class="comment">// Calculate dZ/dXY, the Z slope (i.e. rise over run) in the XY direction. Note that we use the elevation difference on the seaward side of &#39;this&#39; point</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;         dVParConsSlope[i] = dVParConsZDiff[i] / dParSpacingXY;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="comment">// Sort out the final slope value</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      dVParConsSlope[nParProfSize-1] = dVParConsSlope[nParProfSize-2];</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">if</span> (m_nProfileSmoothWindow &gt; 0)</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;         <span class="comment">// Smooth the vector of slopes for the consolidated-only profile</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;         dVParConsSlope = dVSmoothProfileSlope(&amp;dVParConsSlope);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="comment">// Initialize the parallel profile vector with depth / m_dWaveBreakingDepth</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      vector&lt;double&gt;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;         dVParProfileDepthOverDB(nParProfSize, 0),          <span class="comment">// Depth / wave breaking depth at the parallel profile sample points</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;         dVParProfileErosionPotential(nParProfSize, 0);     <span class="comment">// Erosion potential at the parallel profile sample points</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="comment">// Calculate the erosion potential along this profile using the shape function which we read in earlier</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keywordtype">double</span> dTotalErosionPotential = 0;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nParProfSize; i++)</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;         <span class="comment">// Use the actual depth of water here (i.e. the depth to the top of the unconsolidated sediment, including the thickness of consolidated sediment beneath it)</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;         dVParProfileDepthOverDB[i] = m_dThisTimestepSWL - dVParProfileZ[i];</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;         dVParProfileDepthOverDB[i] /= dDepthOfBreaking;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;         <span class="comment">// Constrain dDepthOverDB[i] to be between 0 (can get small -ve due to rounding errors) and m_dDepthOverDBMax</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;         dVParProfileDepthOverDB[i] = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(dVParProfileDepthOverDB[i], 0.0);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;         dVParProfileDepthOverDB[i] = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dVParProfileDepthOverDB[i], m_dDepthOverDBMax);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;         <span class="comment">// And then use the look-up table to find the value of erosion potential at this point on the profile</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;         dVParProfileErosionPotential[i] = dLookUpErosionPotential(dVParProfileDepthOverDB[i]);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;         <span class="comment">// If erosion potential (a -ve value) is tiny, set it to zero</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;         <span class="keywordflow">if</span> (dVParProfileErosionPotential[i] &gt; -<a class="code" href="cme_8h.html#ab63e5883f26dfad0f0c3b7cccce87c71">SEDIMENT_ELEV_TOLERANCE</a>)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            dVParProfileErosionPotential[i] = 0;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;         <span class="comment">// Keep track of the total erosion potential for this profile</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;         dTotalErosionPotential += dVParProfileErosionPotential[i];</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="comment">// Constrain erosion potential at every point on the profile, so that the integral of erosion potential on the whole profile is unity (Walkden and Hall 2005). Note that here, erosion potential is -ve so we must constrain to -1</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nParProfSize; i++)</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;         <span class="keywordflow">if</span> (dTotalErosionPotential &lt; 0)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            dVParProfileErosionPotential[i] /= (-dTotalErosionPotential);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      vector&lt;double&gt;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;         dVParRecessionXY(nParProfSize, 0),</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;         dVParSCAPEXY(nParProfSize, 0);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="comment">// Calculate recession at every point on the parallel profile</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nParProfSize; i++)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;         <span class="comment">// dRecession = dForce * (dBeachProtection / dR) * dErosionPotential * dSlope * dTime</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;         <span class="comment">// where:</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;         <span class="comment">//     dVRecession [m] is the landward migration distance defined in the profile relative (XY) CRS</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;         <span class="comment">//     dForce is given by Equation 4 in Walkden &amp; Hall, 2005</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;         <span class="comment">//     dVBeachProtection [1] is beach protection factor [1, 0] = [no protection, fully protected] (This is calculated later, see dCalcBeachProtectionFactor())</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;         <span class="comment">//     dVR  [m^(9/4)s^(2/3)] is the material strength and some hydrodynamic constant</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;         <span class="comment">//     dVProfileErosionPotential [?] is the erosion potential at each point along the profile</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;         <span class="comment">//     dVSlope [1] is the along-profile slope</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;         <span class="comment">//     m_dTimeStep * 3600 [s] is the time interval in seconds</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;         <span class="comment">//</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;         <span class="comment">// dRecession is horizontal recession (along the XY direction):</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;         <span class="comment">//</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;         <span class="comment">// dVRecessionXY[i] = (dForce * dVBeachProtection[i] * dVErosionPotentialFunc[i] * dVSlope[i] * m_dTimeStep * 3600) / dVR[i]</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;         <span class="comment">//</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;         <span class="comment">//</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;         <span class="comment">// XY recession must be -ve or zero. If it is +ve then it represents accretion not erosion, which must be described by a different set of equations. So we also need to constrain XY recession to be &lt;= 0</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;         dVParRecessionXY[i] = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(m_VCoast[nCoast].dGetWaveEnergyatBreaking(nThisPointOnCoast) * dVParProfileErosionPotential[i] * dVParConsSlope[i] / m_dR, 0.0);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;         dVParSCAPEXY[i] = dVParProfileDistXY[i] - dVParRecessionXY[i];</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">//         LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPar) &lt;&lt; &quot;, &quot; &lt;&lt;  dGridCentroidYToExtCRSY(nYPar) &lt;&lt; &quot;} wave energy = &quot; &lt;&lt; m_VCoast[nCoast].dGetWaveEnergyatBreaking(nThisPointOnCoast) &lt;&lt; &quot; erosion potential = &quot; &lt;&lt; dVParProfileErosionPotential[i] &lt;&lt; &quot; slope = &quot; &lt;&lt; dVParProfileSlope[i] &lt;&lt; &quot; dVParZDiff[i] = &quot; &lt;&lt; dVParZDiff[i] &lt;&lt; &quot; nParProfSize = &quot; &lt;&lt; nParProfSize &lt;&lt; endl;</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      vector&lt;double&gt; dVParDeltaZ(nParProfSize, 0);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="comment">// We have calculated the XY-plane recession at every point on the profile, so now convert this to a change in Z-plane elevation at every inundated point on the profile (not the coast point). Again we use the elevation difference on the seaward side of &#39;this&#39; point</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; nParProfSize-1; i++)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;         <span class="comment">// Vertical lowering dZ = dXY * tan(a), where tan(a) is the slope of the SCAPE profile in the XY direction</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            dSCAPEHorizDist = dVParSCAPEXY[i+1] - dVParSCAPEXY[i],</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            dSCAPEVertDist = dVParConsProfileZ[i] - dVParConsProfileZ[i+1],</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            dSCAPESlope = dSCAPEVertDist / dSCAPEHorizDist,</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            dDeltaZ = dVParRecessionXY[i] * dSCAPESlope;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;         <span class="keywordtype">int</span> <span class="keyword">const</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            nXPar = PtiVGridParProfile[i].nGetX(),</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            nYPar = PtiVGridParProfile[i].nGetY();</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;         <span class="comment">// Store the local slope of the consolidated sediment, this is just for output display purposes</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;         m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#a740baf31197e977b3f534fbafe2dfb7e">SetLocalConsSlope</a>(dVParConsSlope[i]);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;         <span class="comment">// dDeltaZ is zero or -ve: if dDeltaZ is zero then do nothing, if -ve then remove some sediment from this cell</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;         <span class="keywordflow">if</span> (dDeltaZ &lt; 0)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;         {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="comment">// Has this cell already been eroded during this timestep?</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#a3ba9a139b838c676b85a6b065326aeb4">bPotentialPlatformErosion</a>())</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;               <span class="comment">// It has</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;               <span class="keywordtype">double</span> <span class="keyword">const</span> dPrevPotentialErosion = -m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>();</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160; </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">//                  LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] parallel profile &quot; &lt;&lt; nDistFromProfile &lt;&lt; &quot; coast points &quot; &lt;&lt; (nDirection == DIRECTION_DOWNCOAST ? &quot;down&quot; : &quot;up&quot;) &lt;&lt; &quot;-coast from profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; has previous potential platform erosion = &quot; &lt;&lt; dPrevPotentialErosion &lt;&lt; &quot;, current potential platform erosion = &quot; &lt;&lt; dDeltaZ &lt;&lt; &quot;, max value = &quot; &lt;&lt; tMin(dPrevPotentialErosion, dDeltaZ) &lt;&lt; endl;</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;               <span class="comment">// Use the larger of the two -ve values</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;               dDeltaZ = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dPrevPotentialErosion, dDeltaZ);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;               <span class="comment">// Adjust this-timestep totals, since this cell has already been eroded</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;               m_ulThisTimestepNumPotentialPlatformErosionCells--;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;               m_dThisTimestepPotentialPlatformErosion += dPrevPotentialErosion;          <span class="comment">// Since dPrevPotentialErosion is +ve</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;               assert(<a class="code" href="utils__global_8cpp.html#a3caffa5ba0bac0bca723d7d0247d0844">bIsDoubleNotNaN</a>(m_dThisTimestepPotentialPlatformErosion));</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">//                   assert(m_dThisTimestepPotentialPlatformErosion &gt;= 0);</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160; </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;               <span class="comment">// And also adjust the check values</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;               m_ulTotPotentialPlatformErosionBetweenProfiles--;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;               m_dTotPotentialPlatformErosionBetweenProfiles += dPrevPotentialErosion;    <span class="comment">// Since -ve</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="comment">// Constrain the lowering so we don&#39;t get negative slopes or +ve erosion amounts (dDeltaZ must be -ve), this is implicit in SCAPE</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            dDeltaZ = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(dDeltaZ, -dVParConsZDiff[i]);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            dDeltaZ = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dDeltaZ, 0.0);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            dVParDeltaZ[i] = dDeltaZ;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            <span class="comment">// Set the potential (unconstrained) erosion for this cell, it is a +ve value</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#a961fbff61a3e1655927367f90a5111ed">SetPotentialPlatformErosion</a>(-dDeltaZ);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">//               LogStream &lt;&lt; &quot;[&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPar) &lt;&lt; &quot;, &quot; &lt;&lt;  dGridCentroidYToExtCRSY(nYPar) &lt;&lt; &quot;} has potential platform erosion = &quot; &lt;&lt; -dDeltaZ &lt;&lt; endl;</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <span class="comment">// Update this-timestep totals</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            m_ulThisTimestepNumPotentialPlatformErosionCells++;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            m_dThisTimestepPotentialPlatformErosion -= dDeltaZ;                <span class="comment">// Since dDeltaZ is a -ve value</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            assert(<a class="code" href="utils__global_8cpp.html#a3caffa5ba0bac0bca723d7d0247d0844">bIsDoubleNotNaN</a>(m_dThisTimestepPotentialPlatformErosion));</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">//                assert(m_dThisTimestepPotentialPlatformErosion &gt;= 0);</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            <span class="comment">// Increment the check values</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            m_ulTotPotentialPlatformErosionBetweenProfiles++;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            m_dTotPotentialPlatformErosionBetweenProfiles -= dDeltaZ;                    <span class="comment">// Since -ve</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;         }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;         <span class="comment">// Finally, calculate the beach protection factor, this will be used in estimating actual (supply-limited) erosion</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;         <span class="keywordtype">double</span> <span class="keyword">const</span> dBeachProtectionFactor = dCalcBeachProtectionFactor(nXPar, nYPar, dBreakingWaveHeight);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;         m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#af18c6e0d8ffa6e1298bcc6964534af08">SetBeachProtectionFactor</a>(dBeachProtectionFactor);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="comment">// If desired, save this parallel coastline-normal profile for checking purposes</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">if</span> (m_bOutputParallelProfileData)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;         <span class="keywordtype">int</span> <span class="keyword">const</span> nRet = nSaveParProfile(nCoast, nProfile, nParProfSize, nDirection, nDistFromProfile, &amp;dVParProfileDistXY, &amp;dVParConsProfileZ, &amp;dVParProfileDepthOverDB, &amp;dVParProfileErosionPotential, &amp;dVParConsSlope, &amp;dVParRecessionXY, &amp;dVParDeltaZ, pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>(), &amp;dVParSCAPEXY);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;         <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="comment">// Update for next time round the loop</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      nParCoastXLast = nParCoastX;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      nParCoastYLast = nParCoastY;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;   }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;}</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment"> Calculates actual (constrained by available sediment) erosion of the consolidated shore platform on a single sea cell</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="keywordtype">void</span> CSimulation::DoActualShorePlatformErosionOnCell(<span class="keywordtype">int</span> <span class="keyword">const</span> nX, <span class="keywordtype">int</span> <span class="keyword">const</span> nY)</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;{</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: doing platform erosion on cell [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   <span class="comment">// Get the beach protection factor, which quantifies the extent to which unconsolidated sediment on the shore platform (beach) protects the shore platform</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   <span class="keywordtype">double</span> <span class="keyword">const</span> dBeachProtectionFactor = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>();</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;   <span class="keywordflow">if</span> (dBeachProtectionFactor == 0)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="comment">// The beach is sufficiently thick to prevent any platform erosion (or we are down to basement)</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;   <span class="comment">// Get the potential depth of potential erosion, considering beach protection</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;   <span class="keywordtype">double</span> dThisPotentialErosion = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>() * dBeachProtectionFactor;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;   <span class="comment">// We will be eroding the topmost layer that has non-zero thickness</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;   <span class="keywordtype">int</span> nThisLayer = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a43434d6fd45da697ae17f7b274ba9a83">nGetTopNonZeroLayerAboveBasement</a>();</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160; </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;   <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;   <span class="keywordflow">if</span> (nThisLayer == <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;   {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      cerr &lt;&lt; <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> &lt;&lt; <span class="stringliteral">&quot;no sediment layer in DoActualShorePlatformErosionOnCell()&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;   }</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;   <span class="keywordflow">if</span> (nThisLayer == <a class="code" href="cme_8h.html#a6da5abe13cf250e9663012ef6633d92a">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="comment">// No layer with non-zero thickness left, we are down to basement</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;   <span class="comment">// OK, we have a layer that can be eroded so find out how much consolidated sediment we have available on this cell</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      dExistingAvailableFine = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nThisLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7b908b50af702464be628e8b96c54542">dGetFine</a>(),</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      dExistingAvailableSand = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nThisLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a55ec8f411beef4c724da8da17f9532b1">dGetSand</a>(),</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      dExistingAvailableCoarse = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nThisLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a7f2edac8db7d8e47ec400f4b06efd1a5">dGetCoarse</a>();</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;   <span class="comment">// Now partition the total lowering for this cell between the three size fractions: do this by relative erodibility</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      nFineWeight = (dExistingAvailableFine &gt; 0 ? 1 : 0),</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      nSandWeight = (dExistingAvailableSand &gt; 0 ? 1 : 0),</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      nCoarseWeight = (dExistingAvailableCoarse &gt; 0 ? 1 : 0);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      dTotErodibility = (nFineWeight * m_dFineErodibilityNormalized) + (nSandWeight * m_dSandErodibilityNormalized) + (nCoarseWeight * m_dCoarseErodibilityNormalized),</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      dTotActualErosion = 0,</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      dSandEroded = 0,</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      dCoarseEroded = 0;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;   <span class="keywordflow">if</span> (nFineWeight)</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;   {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="comment">// Erode some fine-sized consolidated sediment</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordtype">double</span> dFineLowering = (m_dFineErodibilityNormalized * dThisPotentialErosion) / dTotErodibility;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="comment">// Make sure we don&#39;t get -ve amounts left on the cell</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordtype">double</span> dFineEroded = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dExistingAvailableFine, dFineLowering);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="keywordtype">double</span> dRemaining = dExistingAvailableFine - dFineEroded;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      dTotActualErosion += dFineEroded;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="comment">// Set the value for this layer</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nThisLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a520b31404bb1c3dd30d9c84fe84e11e8">SetFine</a>(dRemaining);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; </div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="comment">// And set the changed-this-timestep switch</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      m_bConsChangedThisTimestep[nThisLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="comment">// And increment the per-timestep total</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      m_dThisTimestepActualPlatformErosionFine += dFineEroded;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;   }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;   <span class="keywordflow">if</span> (nSandWeight)</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;   {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="comment">// Erode some sand-sized consolidated sediment</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="keywordtype">double</span> dSandLowering = (m_dSandErodibilityNormalized * dThisPotentialErosion) / dTotErodibility;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="comment">// Make sure we don&#39;t get -ve amounts left on the source cell</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      dSandEroded = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dExistingAvailableSand, dSandLowering);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <span class="keywordtype">double</span> dRemaining = dExistingAvailableSand - dSandEroded;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      dTotActualErosion += dSandEroded;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="comment">// Set the value for this layer</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nThisLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a166bd3ef8eb44ae4c6eff329e04bd3c0">SetSand</a>(dRemaining);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <span class="comment">// Set the changed-this-timestep switch</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      m_bConsChangedThisTimestep[nThisLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <span class="comment">// And increment the per-timestep total</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      m_dThisTimestepActualPlatformErosionSand += dSandEroded;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;   }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   <span class="keywordflow">if</span> (nCoarseWeight)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;   {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="comment">// Erode some coarse-sized consolidated sediment</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordtype">double</span> dCoarseLowering = (m_dCoarseErodibilityNormalized * dThisPotentialErosion) / dTotErodibility;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="comment">// Make sure we don&#39;t get -ve amounts left on the source cell</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      dCoarseEroded = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dExistingAvailableCoarse, dCoarseLowering);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="keywordtype">double</span> dRemaining = dExistingAvailableCoarse - dCoarseEroded;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160; </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      dTotActualErosion += dCoarseEroded;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160; </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="comment">// Set the value for this layer</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nThisLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">pGetConsolidatedSediment</a>()-&gt;<a class="code" href="class_c_r_w_cell_sediment.html#a930fdd5219ba9971cdbd256e1d5cc62a">SetCoarse</a>(dRemaining);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="comment">// Set the changed-this-timestep switch</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      m_bConsChangedThisTimestep[nThisLayer] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <span class="comment">// And increment the per-timestep total</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      m_dThisTimestepActualPlatformErosionCoarse += dCoarseEroded;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160; </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;   <span class="comment">// Did we erode anything?</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;   <span class="keywordflow">if</span> (dTotActualErosion &gt; 0)</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;   {</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="comment">// We did, so set the actual erosion value for this cell</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a39c3113ce1ecec6f6401a7cffc7b330e">SetActualPlatformErosion</a>(dTotActualErosion);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      <span class="comment">// Recalculate the elevation of every layer</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a1b6c61362ff510fc5b45f10e9ad10be7">CalcAllLayerElevsAndD50</a>();</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      <span class="comment">// And update the cell&#39;s sea depth</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ab445c2aab1f807824fc4dc432fabfb72">SetSeaDepth</a>();</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="comment">// Update per-timestep totals</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      m_ulThisTimestepNumActualPlatformErosionCells++;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="comment">// Eroded fine sediment goes onto suspension</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="comment">// Add eroded sand/coarse sediment for this cell to the polygon that contains the cell, ready for redistribution during beach erosion/deposition</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordtype">int</span> nPolyID = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordflow">if</span> (nPolyID == <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;         <span class="comment">// Can get occasional problems with polygon rasterization near the coastline, so also search the eight adjacent cells</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;         <span class="keywordtype">int</span> nDirection[] = {<a class="code" href="cme_8h.html#aa5969c5b17a9d72b077efdfd1addcca8">NORTH</a>, <a class="code" href="cme_8h.html#a0261de45d0c03470b5d6ba772ce02191">NORTH_EAST</a>, <a class="code" href="cme_8h.html#a2599c6272328075d83bf3ec2e2ac61f0">EAST</a>, <a class="code" href="cme_8h.html#a6fa28d322c7137b6b18dcfd62f1d9363">SOUTH_EAST</a>, <a class="code" href="cme_8h.html#aa2f8a49263c41d9d53170a3d2dee27c5">SOUTH</a>, <a class="code" href="cme_8h.html#ae38dfea9bbc4f5481346b1d1387f90da">SOUTH_WEST</a>, <a class="code" href="cme_8h.html#a7e58a8bcaedcb87e1fdd169edd6105a8">WEST</a>, <a class="code" href="cme_8h.html#a7fe974939e47eb55d95cb6cc26678eb7">NORTH_WEST</a>};</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;         Rand1Shuffle(nDirection, 8);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; 8; n++)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;         {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <span class="keywordflow">if</span> (nDirection[n] == <a class="code" href="cme_8h.html#aa5969c5b17a9d72b077efdfd1addcca8">NORTH</a>)</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;               <span class="keywordtype">int</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                  nXAdj = nX,</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                  nYAdj = nY-1;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;               <span class="keywordflow">if</span> (nYAdj &gt;= 0)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;               {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                  nPolyID = m_pRasterGrid-&gt;m_Cell[nXAdj][nYAdj].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                  <span class="keywordflow">if</span> (nPolyID != <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;               }</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            }</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code" href="cme_8h.html#a0261de45d0c03470b5d6ba772ce02191">NORTH_EAST</a>)</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;               <span class="keywordtype">int</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                  nXAdj = nX+1,</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                  nYAdj = nY-1;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;               <span class="keywordflow">if</span> ((nXAdj &lt; m_nXGridMax) &amp;&amp; (nYAdj &gt;= 0))</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;               {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                  nPolyID = m_pRasterGrid-&gt;m_Cell[nXAdj][nYAdj].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                  <span class="keywordflow">if</span> (nPolyID != <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;               }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code" href="cme_8h.html#a2599c6272328075d83bf3ec2e2ac61f0">EAST</a>)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;               <span class="keywordtype">int</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                  nXAdj = nX+1,</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                  nYAdj = nY;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;               <span class="keywordflow">if</span> (nXAdj &lt; m_nXGridMax)</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;               {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                  nPolyID = m_pRasterGrid-&gt;m_Cell[nXAdj][nYAdj].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                  <span class="keywordflow">if</span> (nPolyID != <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;               }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code" href="cme_8h.html#a6fa28d322c7137b6b18dcfd62f1d9363">SOUTH_EAST</a>)</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;               <span class="keywordtype">int</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                  nXAdj = nX+1,</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                  nYAdj = nY+1;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;               <span class="keywordflow">if</span> ((nXAdj &lt; m_nXGridMax) &amp;&amp; (nYAdj &lt; m_nYGridMax))</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;               {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                  nPolyID = m_pRasterGrid-&gt;m_Cell[nXAdj][nYAdj].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                  <span class="keywordflow">if</span> (nPolyID != <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;               }</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            }</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code" href="cme_8h.html#aa2f8a49263c41d9d53170a3d2dee27c5">SOUTH</a>)</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;               <span class="keywordtype">int</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                  nXAdj = nX,</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                  nYAdj = nY+1;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;               <span class="keywordflow">if</span> (nYAdj &lt; m_nYGridMax)</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;               {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                  nPolyID = m_pRasterGrid-&gt;m_Cell[nXAdj][nYAdj].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                  <span class="keywordflow">if</span> (nPolyID != <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;               }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            }</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code" href="cme_8h.html#ae38dfea9bbc4f5481346b1d1387f90da">SOUTH_WEST</a>)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;               <span class="keywordtype">int</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                  nXAdj = nX-1,</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                  nYAdj = nY+1;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;               <span class="keywordflow">if</span> ((nXAdj &gt;= 0) &amp;&amp; (nXAdj &lt; m_nXGridMax))</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;               {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                  nPolyID = m_pRasterGrid-&gt;m_Cell[nXAdj][nYAdj].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                  <span class="keywordflow">if</span> (nPolyID != <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;               }</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            }</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code" href="cme_8h.html#a7e58a8bcaedcb87e1fdd169edd6105a8">WEST</a>)</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            {</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;               <span class="keywordtype">int</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                  nXAdj = nX-1,</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                  nYAdj = nY;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;               <span class="keywordflow">if</span> (nXAdj &gt;= 0)</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;               {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                  nPolyID = m_pRasterGrid-&gt;m_Cell[nXAdj][nYAdj].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                  <span class="keywordflow">if</span> (nPolyID != <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;               }</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nDirection[n] == <a class="code" href="cme_8h.html#a7fe974939e47eb55d95cb6cc26678eb7">NORTH_WEST</a>)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;               <span class="keywordtype">int</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                  nXAdj = nX-1,</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                  nYAdj = nY-1;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;               <span class="keywordflow">if</span> ((nXAdj &gt;= 0) &amp;&amp; (nYAdj &gt;= 0))</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;               {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                  nPolyID = m_pRasterGrid-&gt;m_Cell[nXAdj][nYAdj].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                  <span class="keywordflow">if</span> (nPolyID != <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;               }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;         }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordflow">if</span> (nPolyID != <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;         <span class="comment">// Add this to the polygon&#39;s total of unconsolidated sand/coarse sediment, to be deposited later. These values are +ve (deposition)</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;         m_pVCoastPolygon[nPolyID]-&gt;AddDeltaActualUnconsSand(dSandEroded);</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;         m_pVCoastPolygon[nPolyID]-&gt;AddDeltaActualUnconsCoarse(dCoarseEroded);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;         <span class="comment">// Uh-oh, we have a problem</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#aefc63c4bde02ca170b0e7bd038ba7702">WARN</a> &lt;&lt; <span class="stringliteral">&quot;platform erosion on cell [&quot;</span> &lt;&lt; nX &lt;&lt; <span class="stringliteral">&quot;][&quot;</span> &lt;&lt; nY &lt;&lt; <span class="stringliteral">&quot;] = {&quot;</span> &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; <span class="stringliteral">&quot;} but this is not in a polygon&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160; </div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;         m_dThisTimestepMassBalanceDepositionError += (dSandEroded + dCoarseEroded);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;   }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;}</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment"> Creates a look-up table for erosion potential, given depth over DB</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="keywordtype">bool</span> CSimulation::bCreateErosionPotentialLookUp(vector&lt;double&gt; *VdDepthOverDBIn, vector&lt;double&gt; *VdErosionPotentialIn, vector&lt;double&gt;  *VdErosionPotentialFirstDerivIn)</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;{</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;   <span class="comment">// Set up a temporary vector to hold the incremental DepthOverDB values</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;   vector&lt;double&gt; VdDepthOverDB;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;   <span class="keywordtype">double</span> dTempDOverDB = 0;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160; </div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   <span class="keywordflow">while</span> (dTempDOverDB &lt;= 1.1)   <span class="comment">// Arbitrary max value, we will adjust this later</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;   {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      VdDepthOverDB.push_back(dTempDOverDB);          <span class="comment">// These are the incremental sample values of DepthOverDB</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      dTempDOverDB += <a class="code" href="cme_8h.html#a7f37a64f35b0138874f34d52119398cf">DEPTH_OVER_DB_INCREMENT</a>;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      m_VdErosionPotential.push_back(0);              <span class="comment">// This will hold the corresponding value of erosion potential for each sample point</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   }</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;   <span class="keywordtype">int</span> nSize = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VdDepthOverDB.size());</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;   VdDeriv(nSize, 0),         <span class="comment">// First derivative at the sample points: calculated by the spline function but not subsequently used</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;           VdDeriv2(nSize, 0.),       <span class="comment">// Second derivative at the sample points, ditto</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;           VdDeriv3(nSize, 0.);       <span class="comment">// Third derivative at the sample points, ditto</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;   <span class="comment">// Calculate the value of erosion potential (is a -ve value) for each of the sample values of DepthOverDB, and store it for use in the look-up function</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;   <a class="code" href="hermite__cubic_8cpp.html#ad696aa5baaf487b32cc0c3afdecd2b4b">hermite_cubic_spline_value</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VdDepthOverDBIn-&gt;size()), &amp;(VdDepthOverDBIn-&gt;at(0)), &amp;(VdErosionPotentialIn-&gt;at(0)), &amp;(VdErosionPotentialFirstDerivIn-&gt;at(0)), nSize, &amp;(VdDepthOverDB[0]), &amp;(m_VdErosionPotential[0]), &amp;(VdDeriv[0]), &amp;(VdDeriv2[0]), &amp;(VdDeriv3[0]));</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160; </div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;   <span class="comment">// Tidy the erosion potential look-up data: cut off values (after the first) for which erosion potential is no longer -ve</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   <span class="keywordtype">int</span> nLastVal = -1;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 1; n &lt; nSize - 1; n++)</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="keywordflow">if</span> (m_VdErosionPotential[n] &gt; 0)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;         nLastVal = n;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   <span class="keywordflow">if</span> (nLastVal &gt; 0)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="comment">// Erosion potential is no longer -ve at this value of DepthOverDB, so set the maximum value of DepthOverDB that will be used in the simulation (any DepthOverDB value greater than this produces zero erosion potential)</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      m_dDepthOverDBMax = VdDepthOverDB[nLastVal];</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      m_VdErosionPotential.erase(m_VdErosionPotential.begin() + nLastVal + 1, m_VdErosionPotential.end());</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      m_VdErosionPotential.back() = 0;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;   }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160; </div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="comment">// Erosion potential is unbounded, i.e. it is still -ve when we have reached the end of the look-up vector</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160; </div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;   <span class="comment">// All OK</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;   <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;}</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160; </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160; </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment"> The erosion potential lookup: it returns a value for erosion potential given a value of Depth Over DB</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="keywordtype">double</span> CSimulation::dLookUpErosionPotential(<span class="keywordtype">double</span> <span class="keyword">const</span> dDepthOverDB)<span class="keyword"> const</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   <span class="comment">// If dDepthOverDB exceeds the maximum value which we calculated earlier, erosion potential is zero</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;   <span class="keywordflow">if</span> (dDepthOverDB &gt; m_dDepthOverDBMax)</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160; </div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;   <span class="comment">// OK, dDepthOverDB is less than the maximum so look up a corresponding value for erosion potential. The look-up index is dDepthOverDB divided by (the Depth Over DB increment used when creating the look-up vector). But since this look-up index may not be an integer, split the look-up index into integer and fractional parts and deal with each separately</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;   <span class="keywordtype">double</span> dErosionPotential = <a class="code" href="interpolate_8cpp.html#a1b021853eedf579935a6bd2bfe054961">interpolate</a>( m_VdDepthOverDB, m_VdErosionPotential, dDepthOverDB, <span class="keyword">false</span> );</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160; </div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;   <span class="keywordflow">return</span> dErosionPotential;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;}</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160; </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment"> Calculates the (inverse) beach protection factor as in SCAPE: 0 is fully protected, 1 = no protection</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="keywordtype">double</span> CSimulation::dCalcBeachProtectionFactor(<span class="keywordtype">int</span> <span class="keyword">const</span> nX, <span class="keywordtype">int</span> <span class="keyword">const</span> nY, <span class="keywordtype">double</span> <span class="keyword">const</span> dBreakingWaveHeight)</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;{</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   <span class="comment">// Safety check</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;   <span class="keywordflow">if</span> (dBreakingWaveHeight == <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>)</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;   <span class="comment">// We are considering the unconsolidated sediment (beach) of the topmost layer that has non-zero thickness</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;   <span class="keywordtype">int</span> nThisLayer = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a43434d6fd45da697ae17f7b274ba9a83">nGetTopNonZeroLayerAboveBasement</a>();</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;   <span class="comment">// Safety check</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;   <span class="keywordflow">if</span> (nThisLayer == <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;   {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      cerr &lt;&lt; <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> &lt;&lt; <span class="stringliteral">&quot;no sediment layer in dCalcBeachProtectionFactor()&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;   }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;   <span class="keywordflow">if</span> (nThisLayer == <a class="code" href="cme_8h.html#a6da5abe13cf250e9663012ef6633d92a">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="comment">// There are no layers with non-zero thickness left (i.e. we are down to basement) so no beach protection</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160; </div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;   <span class="comment">// In SCAPE, 0.23 * the significant breaking wave height is assumed to be the maximum depth of beach that waves can penetrate to erode a platform. For depths less than this, the beach protective ability is assumed to vary linearly</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      dBeachDepth = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">pGetLayerAboveBasement</a>(nThisLayer)-&gt;<a class="code" href="class_c_r_w_cell_layer.html#a968b7fbdc65a6e0a230ce25e9a59e129">dGetUnconsolidatedThickness</a>(),</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      dMaxPenetrationDepth = <a class="code" href="cme_8h.html#a7fbce79a0c8c98e83a830285dcdbb943">BEACH_PROTECTION_HB_RATIO</a> * dBreakingWaveHeight,</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      dFactor = 0;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160; </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;   <span class="keywordflow">if</span> (dMaxPenetrationDepth &gt; 0)</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      dFactor = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(1 - (dBeachDepth / dMaxPenetrationDepth), 0.0);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: cell[&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] has beach protection factor = &quot; &lt;&lt; dFactor &lt;&lt; endl;</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keywordflow">return</span> dFactor;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;}</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment"> Fills in &#39;holes&#39; in the beach protection i.e. orphan cells which get omitted because of rounding problems</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="keywordtype">void</span> CSimulation::FillInBeachProtectionHoles(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;{</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nX = 0; nX &lt; m_nXGridMax; nX++)</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;   {</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nY = 0; nY &lt; m_nYGridMax; nY++)</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      {</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;         <span class="keywordflow">if</span> ((m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>()) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>() == <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>))</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;         {</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            <span class="comment">// This is a sea cell, and it has an initialized beach protection value. So look at its N-S and W-E neighbours</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;               nXTmp,</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;               nYTmp,</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;               nAdjacent = 0;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            <span class="keywordtype">double</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;               dBeachProtection = 0;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            <span class="comment">// North</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            nXTmp = nX;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            nYTmp = nY-1;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;            <span class="keywordflow">if</span> ((bIsWithinValidGrid(nXTmp, nYTmp)) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>() != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>))</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;               nAdjacent++;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;               dBeachProtection += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>();</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            }</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160; </div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="comment">// East</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            nXTmp = nX+1;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            nYTmp = nY;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <span class="keywordflow">if</span> ((bIsWithinValidGrid(nXTmp, nYTmp)) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>() != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>))</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            {</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;               nAdjacent++;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;               dBeachProtection += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>();</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            }</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160; </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <span class="comment">// South</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            nXTmp = nX;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            nYTmp = nY+1;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            <span class="keywordflow">if</span> ((bIsWithinValidGrid(nXTmp, nYTmp)) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>() != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>))</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;               nAdjacent++;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;               dBeachProtection += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>();</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <span class="comment">// West</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            nXTmp = nX-1;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            nYTmp = nY;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            <span class="keywordflow">if</span> ((bIsWithinValidGrid(nXTmp, nYTmp)) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>() != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>))</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            {</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;               nAdjacent++;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;               dBeachProtection += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>();</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;            }</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;            <span class="comment">// If this sea cell has four neighbours with initialized beach protection values, then assume that it should not have an uninitialized beach protection value. Set it to the average of its neighbours</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            <span class="keywordflow">if</span> (nAdjacent == 4)</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            {</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;               m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#af18c6e0d8ffa6e1298bcc6964534af08">SetBeachProtectionFactor</a>(dBeachProtection / 4);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            }</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;         }</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      }</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;   }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;}</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160; </div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment"> Fills in &#39;holes&#39; in the potential platform erosion i.e. orphan cells which get omitted because of rounding problems</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="keywordtype">void</span> CSimulation::FillPotentialPlatformErosionHoles(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;{</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nX = 0; nX &lt; m_nXGridMax; nX++)</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;   {</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nY = 0; nY &lt; m_nYGridMax; nY++)</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      {</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;         <span class="keywordflow">if</span> ((m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>()) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>() == 0))</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;         {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;            <span class="comment">// This is a sea cell, it has a zero potential platform erosion value. So look at its N-S and W-E neighbours</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            <span class="keywordtype">int</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;               nXTmp,</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;               nYTmp,</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;               nAdjacent = 0;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            <span class="keywordtype">double</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;               dPotentialPlatformErosion = 0;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160; </div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;            <span class="comment">// North</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            nXTmp = nX;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            nYTmp = nY-1;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            <span class="keywordflow">if</span> ((bIsWithinValidGrid(nXTmp, nYTmp)) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>() != 0))</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            {</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;               nAdjacent++;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;               dPotentialPlatformErosion += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>();</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160; </div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            <span class="comment">// East</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;            nXTmp = nX+1;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            nYTmp = nY;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            <span class="keywordflow">if</span> ((bIsWithinValidGrid(nXTmp, nYTmp)) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>() != 0))</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;               nAdjacent++;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;               dPotentialPlatformErosion += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>();</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160; </div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            <span class="comment">// South</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            nXTmp = nX;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            nYTmp = nY+1;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            <span class="keywordflow">if</span> ((bIsWithinValidGrid(nXTmp, nYTmp)) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>() != 0))</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            {</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;               nAdjacent++;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;               dPotentialPlatformErosion += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>();</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;            }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            <span class="comment">// West</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;            nXTmp = nX-1;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;            nYTmp = nY;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;            <span class="keywordflow">if</span> ((bIsWithinValidGrid(nXTmp, nYTmp)) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">dGetBeachProtectionFactor</a>() != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>))</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;            <span class="keywordflow">if</span> ((bIsWithinValidGrid(nXTmp, nYTmp)) &amp;&amp; (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>() != 0))</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;            {</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;               nAdjacent++;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;               dPotentialPlatformErosion += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].<a class="code" href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">dGetPotentialPlatformErosion</a>();</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;            }</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160; </div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            <span class="comment">// If this sea cell has four neighbours with non-zero potential platform erosion values, then assume that it should not have a zero potential platform erosion value. Set it to the average of its neighbours</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            <span class="keywordflow">if</span> (nAdjacent == 4)</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            {</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;               <span class="keywordtype">double</span> dThisPotentialPlatformErosion = dPotentialPlatformErosion / 4;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160; </div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;               m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a961fbff61a3e1655927367f90a5111ed">SetPotentialPlatformErosion</a>(dThisPotentialPlatformErosion);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;               <span class="comment">// Update this-timestep totals</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;               m_ulThisTimestepNumPotentialPlatformErosionCells++;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;               m_dThisTimestepPotentialPlatformErosion += dThisPotentialPlatformErosion;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;               assert(<a class="code" href="utils__global_8cpp.html#a3caffa5ba0bac0bca723d7d0247d0844">bIsDoubleNotNaN</a>(m_dThisTimestepPotentialPlatformErosion));</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160; </div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;               <span class="comment">// Increment the check values</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;               m_ulTotPotentialPlatformErosionBetweenProfiles++;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;               m_dTotPotentialPlatformErosionBetweenProfiles += dThisPotentialPlatformErosion;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            }</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;         }</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      }</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;}</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160; </div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment"> Construct a parallel coastline-normal profile</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="keywordtype">void</span> CSimulation::ConstructParallelProfile(<span class="keywordtype">int</span> <span class="keyword">const</span> nProfileStartX, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfileStartY, <span class="keywordtype">int</span> <span class="keyword">const</span> nParCoastX, <span class="keywordtype">int</span> <span class="keyword">const</span> nParCoastY, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfSize, vector&lt;CGeom2DIPoint&gt;* <span class="keyword">const</span> pPtViGridProfile, vector&lt;CGeom2DIPoint&gt;* pPtiVGridParProfile, vector&lt;CGeom2DPoint&gt;* pPtVExtCRSParProfile)</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;{</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   <span class="comment">// OK, we have the coastline start point for the parallel profile. Now construct a temporary profile, parallel to the coastline-normal profile, starting from this point</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      nXOffset = nParCoastX - nProfileStartX,</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      nYOffset = nParCoastY - nProfileStartY;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;   <span class="comment">// Append co-ord values for the temporary profile</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfileStartPoint = 0; nProfileStartPoint &lt; nProfSize; nProfileStartPoint++)</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;   {</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      <span class="comment">// Get the grid co-ordinates of the cell which is this distance seaward, from the coastline-normal profile</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;         nXProf = pPtViGridProfile-&gt;at(nProfileStartPoint).nGetX(),</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;         nYProf = pPtViGridProfile-&gt;at(nProfileStartPoint).nGetY();</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160; </div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <span class="comment">// Now calculate the grid co-ordinates of this cell, which is potentially in the parallel profile</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;         nXPar = nXProf + nXOffset,</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;         nYPar = nYProf + nYOffset;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <span class="comment">// Is this cell within the grid? If not, cut short the profile</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      <span class="keywordflow">if</span> (! bIsWithinValidGrid(nXPar, nYPar))</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      {</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">//         LogStream &lt;&lt; &quot;NOT WITHIN GRID [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;         <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      }</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="comment">// Have we hit an adjacent coastline-normal profile? If so, cut short</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].<a class="code" href="class_c_geom_cell.html#ad2c6f63894b9feea63d71d15932c0825">bIsProfile</a>())</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      {</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment">//         LogStream &lt;&lt; &quot;HIT PROFILE &quot; &lt;&lt; m_pRasterGrid-&gt;m_Cell[nXPar][nYPar].nGetProfile() &lt;&lt; &quot; at [&quot; &lt;&lt; nXPar &lt;&lt; &quot;][&quot; &lt;&lt; nYPar &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nXPar) &lt;&lt; &quot;, &quot; &lt;&lt;  dGridCentroidYToExtCRSY(nYPar) &lt;&lt; &quot;}&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;         <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      }</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      <span class="comment">// OK, append the cell details</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      pPtiVGridParProfile-&gt;push_back(<a class="code" href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a>(nXPar, nYPar));</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      pPtVExtCRSParProfile-&gt;push_back(<a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a>(dGridCentroidXToExtCRSX(nXPar), dGridCentroidYToExtCRSY(nYPar)));</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;   }</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;}</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="acme_8h_html_a2599c6272328075d83bf3ec2e2ac61f0"><div class="ttname"><a href="cme_8h.html#a2599c6272328075d83bf3ec2e2ac61f0">EAST</a></div><div class="ttdeci">const int EAST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00190">cme.h:190</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a166bd3ef8eb44ae4c6eff329e04bd3c0"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a166bd3ef8eb44ae4c6eff329e04bd3c0">CRWCellSediment::SetSand</a></div><div class="ttdeci">void SetSand(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00082">cell_sediment.cpp:82</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html"><div class="ttname"><a href="class_c_geom2_d_i_point.html">CGeom2DIPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with integer co-ordinates.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8h_source.html#l00029">2di_point.h:29</a></div></div>
<div class="ttc" id="acme_8h_html_aa2f8a49263c41d9d53170a3d2dee27c5"><div class="ttname"><a href="cme_8h.html#aa2f8a49263c41d9d53170a3d2dee27c5">SOUTH</a></div><div class="ttdeci">const int SOUTH</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00192">cme.h:192</a></div></div>
<div class="ttc" id="ahermite__cubic_8h_html"><div class="ttname"><a href="hermite__cubic_8h.html">hermite_cubic.h</a></div><div class="ttdoc">Definitions of some routines from the hermite_cubic library.</div></div>
<div class="ttc" id="acme_8h_html_a6fa28d322c7137b6b18dcfd62f1d9363"><div class="ttname"><a href="cme_8h.html#a6fa28d322c7137b6b18dcfd62f1d9363">SOUTH_EAST</a></div><div class="ttdeci">const int SOUTH_EAST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00191">cme.h:191</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html"><div class="ttname"><a href="class_c_geom2_d_point.html">CGeom2DPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with floating-point co-ordinates.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8h_source.html#l00029">2d_point.h:29</a></div></div>
<div class="ttc" id="acme_8h_html_a068017859403c0629d89f8d348f6c224"><div class="ttname"><a href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a></div><div class="ttdeci">T tMin(T a, T b)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00783">cme.h:783</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a3ba9a139b838c676b85a6b065326aeb4"><div class="ttname"><a href="class_c_geom_cell.html#a3ba9a139b838c676b85a6b065326aeb4">CGeomCell::bPotentialPlatformErosion</a></div><div class="ttdeci">bool bPotentialPlatformErosion(void) const</div><div class="ttdoc">Returns true if this cell has had potential erosion this timestep.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00159">cell.cpp:159</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a8a29c3fa364ab1f7b3930b7a9c83f45f"><div class="ttname"><a href="class_c_geom_profile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">CGeomProfile::nGetNumCellsInProfile</a></div><div class="ttdeci">int nGetNumCellsInProfile(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00396">profile.cpp:396</a></div></div>
<div class="ttc" id="acme_8h_html_a7fbce79a0c8c98e83a830285dcdbb943"><div class="ttname"><a href="cme_8h.html#a7fbce79a0c8c98e83a830285dcdbb943">BEACH_PROTECTION_HB_RATIO</a></div><div class="ttdeci">const double BEACH_PROTECTION_HB_RATIO</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00450">cme.h:450</a></div></div>
<div class="ttc" id="acme_8h_html_aee2e0742555937187504ee86b95bc29c"><div class="ttname"><a href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a></div><div class="ttdeci">const int INT_NODATA</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00185">cme.h:185</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_af18c6e0d8ffa6e1298bcc6964534af08"><div class="ttname"><a href="class_c_geom_cell.html#af18c6e0d8ffa6e1298bcc6964534af08">CGeomCell::SetBeachProtectionFactor</a></div><div class="ttdeci">void SetBeachProtectionFactor(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00690">cell.cpp:690</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html"><div class="ttname"><a href="class_c_geom_profile.html">CGeomProfile</a></div><div class="ttdoc">Geometry class used to represent coast profile objects.</div><div class="ttdef"><b>Definition:</b> <a href="profile_8h_source.html#l00037">profile.h:37</a></div></div>
<div class="ttc" id="acme_8h_html_a7b34b50ac1e09426c23c241109342f7f"><div class="ttname"><a href="cme_8h.html#a7b34b50ac1e09426c23c241109342f7f">DIRECTION_DOWNCOAST</a></div><div class="ttdeci">const int DIRECTION_DOWNCOAST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00197">cme.h:197</a></div></div>
<div class="ttc" id="acme_8h_html"><div class="ttname"><a href="cme_8h.html">cme.h</a></div><div class="ttdoc">This file contains global definitions for CoastalME.</div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a961fbff61a3e1655927367f90a5111ed"><div class="ttname"><a href="class_c_geom_cell.html#a961fbff61a3e1655927367f90a5111ed">CGeomCell::SetPotentialPlatformErosion</a></div><div class="ttdeci">void SetPotentialPlatformErosion(double const)</div><div class="ttdoc">Set potential (unconstrained) shore platform erosion and increment total shore platform potential ero...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00526">cell.cpp:526</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_layer_html_a30800b5cd971976ffec36381d4e54342"><div class="ttname"><a href="class_c_r_w_cell_layer.html#a30800b5cd971976ffec36381d4e54342">CRWCellLayer::pGetConsolidatedSediment</a></div><div class="ttdeci">CRWCellSediment * pGetConsolidatedSediment(void)</div><div class="ttdef"><b>Definition:</b> <a href="cell__layer_8cpp_source.html#l00041">cell_layer.cpp:41</a></div></div>
<div class="ttc" id="acme_8h_html_a7e895b460cef877dec4d12ead0c74f15"><div class="ttname"><a href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a></div><div class="ttdeci">T tMax(T a, T b)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00772">cme.h:772</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_ada96aa991d179ac71f4523de7a4be560"><div class="ttname"><a href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">CGeomProfile::pPtiVGetCellsInProfile</a></div><div class="ttdeci">vector&lt; CGeom2DIPoint &gt; * pPtiVGetCellsInProfile(void)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00384">profile.cpp:384</a></div></div>
<div class="ttc" id="acme_8h_html_a0261de45d0c03470b5d6ba772ce02191"><div class="ttname"><a href="cme_8h.html#a0261de45d0c03470b5d6ba772ce02191">NORTH_EAST</a></div><div class="ttdeci">const int NORTH_EAST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00189">cme.h:189</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_ab1edaa0b2009bddaf19f844ac7ea51bd"><div class="ttname"><a href="class_c_geom_cell.html#ab1edaa0b2009bddaf19f844ac7ea51bd">CGeomCell::dGetPotentialPlatformErosion</a></div><div class="ttdeci">double dGetPotentialPlatformErosion(void) const</div><div class="ttdoc">Get potential (unconstrained) shore platform erosion.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00533">cell.cpp:533</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_a250f937d03cfdf6e0244b74ad2bf96a4"><div class="ttname"><a href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">CGeom2DPoint::dGetX</a></div><div class="ttdeci">double dGetX(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object's double X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00044">2d_point.cpp:44</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_ad2c6f63894b9feea63d71d15932c0825"><div class="ttname"><a href="class_c_geom_cell.html#ad2c6f63894b9feea63d71d15932c0825">CGeomCell::bIsProfile</a></div><div class="ttdeci">bool bIsProfile(void) const</div><div class="ttdoc">Returns true if this cell is 'under' a coastline normal.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00195">cell.cpp:195</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a0aead517e2105d6c1a14c27126b1fe92"><div class="ttname"><a href="class_c_geom_profile.html#a0aead517e2105d6c1a14c27126b1fe92">CGeomProfile::nGetNumCoastPoint</a></div><div class="ttdeci">int nGetNumCoastPoint(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00057">profile.cpp:57</a></div></div>
<div class="ttc" id="acoast_8h_html"><div class="ttname"><a href="coast_8h.html">coast.h</a></div><div class="ttdoc">Contains CRWCoast definitions.</div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a39c3113ce1ecec6f6401a7cffc7b330e"><div class="ttname"><a href="class_c_geom_cell.html#a39c3113ce1ecec6f6401a7cffc7b330e">CGeomCell::SetActualPlatformErosion</a></div><div class="ttdeci">void SetActualPlatformErosion(double const)</div><div class="ttdoc">Set this-timestep actual (constrained) shore platform erosion and increment total actual shore platfo...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00545">cell.cpp:545</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_af81bd1114fb19617a232c7a901366301"><div class="ttname"><a href="class_c_geom_cell.html#af81bd1114fb19617a232c7a901366301">CGeomCell::dGetConsSedTopForLayerAboveBasement</a></div><div class="ttdeci">double dGetConsSedTopForLayerAboveBasement(int const) const</div><div class="ttdoc">Returns the elevation of the top of the consolidated sediment only, for a given layer (layer 0 being ...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00352">cell.cpp:352</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a740baf31197e977b3f534fbafe2dfb7e"><div class="ttname"><a href="class_c_geom_cell.html#a740baf31197e977b3f534fbafe2dfb7e">CGeomCell::SetLocalConsSlope</a></div><div class="ttdeci">void SetLocalConsSlope(double const)</div><div class="ttdoc">Sets the local slope of the consolidated sediment only.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00261">cell.cpp:261</a></div></div>
<div class="ttc" id="aclass_c_simulation_html_a222962121613613a48f518e0c2110f21"><div class="ttname"><a href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">CSimulation::LogStream</a></div><div class="ttdeci">ofstream LogStream</div><div class="ttdef"><b>Definition:</b> <a href="simulation_8h_source.html#l00781">simulation.h:781</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a585c23948156db68c888874f27bab13d"><div class="ttname"><a href="class_c_geom_cell.html#a585c23948156db68c888874f27bab13d">CGeomCell::dGetBeachProtectionFactor</a></div><div class="ttdeci">double dGetBeachProtectionFactor(void) const</div><div class="ttdoc">Returns this cell's beach protection factor.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00696">cell.cpp:696</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_a216921dc2c592d9468e6430fee7c7719"><div class="ttname"><a href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">CGeom2DPoint::dGetY</a></div><div class="ttdeci">double dGetY(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object's double Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00050">2d_point.cpp:50</a></div></div>
<div class="ttc" id="acme_8h_html_ac8de8e3c8f526683cf8a372e00bdcde3"><div class="ttname"><a href="cme_8h.html#ac8de8e3c8f526683cf8a372e00bdcde3">RTN_ERR_NO_TOP_LAYER</a></div><div class="ttdeci">const int RTN_ERR_NO_TOP_LAYER</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00398">cme.h:398</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_layer_html_a968b7fbdc65a6e0a230ce25e9a59e129"><div class="ttname"><a href="class_c_r_w_cell_layer.html#a968b7fbdc65a6e0a230ce25e9a59e129">CRWCellLayer::dGetUnconsolidatedThickness</a></div><div class="ttdeci">double dGetUnconsolidatedThickness(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__layer_8cpp_source.html#l00084">cell_layer.cpp:84</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a7f2edac8db7d8e47ec400f4b06efd1a5"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a7f2edac8db7d8e47ec400f4b06efd1a5">CRWCellSediment::dGetCoarse</a></div><div class="ttdeci">double dGetCoarse(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00102">cell_sediment.cpp:102</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_aac223e2610d50ca2c7eadaf8542e9498"><div class="ttname"><a href="class_c_geom_profile.html#aac223e2610d50ca2c7eadaf8542e9498">CGeomProfile::bOKIncStartAndEndOfCoast</a></div><div class="ttdeci">bool bOKIncStartAndEndOfCoast(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00148">profile.cpp:148</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a55ec8f411beef4c724da8da17f9532b1"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a55ec8f411beef4c724da8da17f9532b1">CRWCellSediment::dGetSand</a></div><div class="ttdeci">double dGetSand(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00089">cell_sediment.cpp:89</a></div></div>
<div class="ttc" id="acme_8h_html_aa5969c5b17a9d72b077efdfd1addcca8"><div class="ttname"><a href="cme_8h.html#aa5969c5b17a9d72b077efdfd1addcca8">NORTH</a></div><div class="ttdeci">const int NORTH</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00188">cme.h:188</a></div></div>
<div class="ttc" id="acme_8h_html_a71d8d6db0e41ed2022d0a95b9a70528c"><div class="ttname"><a href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a></div><div class="ttdeci">const int RTN_OK</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00351">cme.h:351</a></div></div>
<div class="ttc" id="acme_8h_html_aefc63c4bde02ca170b0e7bd038ba7702"><div class="ttname"><a href="cme_8h.html#aefc63c4bde02ca170b0e7bd038ba7702">WARN</a></div><div class="ttdeci">const string WARN</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00538">cme.h:538</a></div></div>
<div class="ttc" id="acme_8h_html_ab0094f1ece3facf8eb8afd210a7a7835"><div class="ttname"><a href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a></div><div class="ttdeci">const string ERR</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00537">cme.h:537</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_abaf88697019588a2b0901bd19044aee4"><div class="ttname"><a href="class_c_geom_profile.html#abaf88697019588a2b0901bd19044aee4">CGeomProfile::nGetProfileSize</a></div><div class="ttdeci">int nGetProfileSize(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00235">profile.cpp:235</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a930fdd5219ba9971cdbd256e1d5cc62a"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a930fdd5219ba9971cdbd256e1d5cc62a">CRWCellSediment::SetCoarse</a></div><div class="ttdeci">void SetCoarse(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00096">cell_sediment.cpp:96</a></div></div>
<div class="ttc" id="acme_8h_html_a7e58a8bcaedcb87e1fdd169edd6105a8"><div class="ttname"><a href="cme_8h.html#a7e58a8bcaedcb87e1fdd169edd6105a8">WEST</a></div><div class="ttdeci">const int WEST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00194">cme.h:194</a></div></div>
<div class="ttc" id="ahermite__cubic_8cpp_html_ad696aa5baaf487b32cc0c3afdecd2b4b"><div class="ttname"><a href="hermite__cubic_8cpp.html#ad696aa5baaf487b32cc0c3afdecd2b4b">hermite_cubic_spline_value</a></div><div class="ttdeci">void hermite_cubic_spline_value(int const nn, double *const xn, double *const fn, double *const dn, int const n, double *const x, double *f, double *d, double *s, double *t)</div><div class="ttdef"><b>Definition:</b> <a href="hermite__cubic_8cpp_source.html#l00345">hermite_cubic.cpp:345</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a65dc08df7cf712555b94d91157431965"><div class="ttname"><a href="class_c_geom_cell.html#a65dc08df7cf712555b94d91157431965">CGeomCell::pGetLayerAboveBasement</a></div><div class="ttdeci">CRWCellLayer * pGetLayerAboveBasement(int const)</div><div class="ttdoc">Return a reference to the Nth sediment layer (layer 0 being just above basement)</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00369">cell.cpp:369</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a7b908b50af702464be628e8b96c54542"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a7b908b50af702464be628e8b96c54542">CRWCellSediment::dGetFine</a></div><div class="ttdeci">double dGetFine(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00075">cell_sediment.cpp:75</a></div></div>
<div class="ttc" id="ainterpolate_8cpp_html_a1b021853eedf579935a6bd2bfe054961"><div class="ttname"><a href="interpolate_8cpp.html#a1b021853eedf579935a6bd2bfe054961">interpolate</a></div><div class="ttdeci">double interpolate(vector&lt; double &gt; xData, vector&lt; double &gt; yData, double x, bool extrapolate)</div><div class="ttdef"><b>Definition:</b> <a href="interpolate_8cpp_source.html#l00031">interpolate.cpp:31</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a43434d6fd45da697ae17f7b274ba9a83"><div class="ttname"><a href="class_c_geom_cell.html#a43434d6fd45da697ae17f7b274ba9a83">CGeomCell::nGetTopNonZeroLayerAboveBasement</a></div><div class="ttdeci">int nGetTopNonZeroLayerAboveBasement(void) const</div><div class="ttdoc">Returns the index of the topmost sediment layer (layer 0 being the one just above basement) with non-...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00326">cell.cpp:326</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_ab445c2aab1f807824fc4dc432fabfb72"><div class="ttname"><a href="class_c_geom_cell.html#ab445c2aab1f807824fc4dc432fabfb72">CGeomCell::SetSeaDepth</a></div><div class="ttdeci">void SetSeaDepth(void)</div><div class="ttdoc">Returns the depth of seawater on this cell if the sediment top is &lt; SWL, or zero.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00565">cell.cpp:565</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a1b6c61362ff510fc5b45f10e9ad10be7"><div class="ttname"><a href="class_c_geom_cell.html#a1b6c61362ff510fc5b45f10e9ad10be7">CGeomCell::CalcAllLayerElevsAndD50</a></div><div class="ttdeci">void CalcAllLayerElevsAndD50(void)</div><div class="ttdoc">For this cell: calculates the elevation of the top of every layer, and the d50 for the topmost uncons...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00465">cell.cpp:465</a></div></div>
<div class="ttc" id="acme_8h_html_ab63e5883f26dfad0f0c3b7cccce87c71"><div class="ttname"><a href="cme_8h.html#ab63e5883f26dfad0f0c3b7cccce87c71">SEDIMENT_ELEV_TOLERANCE</a></div><div class="ttdeci">const double SEDIMENT_ELEV_TOLERANCE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00463">cme.h:463</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a622387009a4fcb864bfdab627389ea84"><div class="ttname"><a href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">CGeomCell::nGetPolygonID</a></div><div class="ttdeci">int nGetPolygonID(void) const</div><div class="ttdoc">Returns the global ID number of the polygon which 'contains' this cell (returns INT_NODATA if the cel...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00210">cell.cpp:210</a></div></div>
<div class="ttc" id="acme_8h_html_a7f37a64f35b0138874f34d52119398cf"><div class="ttname"><a href="cme_8h.html#a7f37a64f35b0138874f34d52119398cf">DEPTH_OVER_DB_INCREMENT</a></div><div class="ttdeci">const double DEPTH_OVER_DB_INCREMENT</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00454">cme.h:454</a></div></div>
<div class="ttc" id="acme_8h_html_ae38dfea9bbc4f5481346b1d1387f90da"><div class="ttname"><a href="cme_8h.html#ae38dfea9bbc4f5481346b1d1387f90da">SOUTH_WEST</a></div><div class="ttdeci">const int SOUTH_WEST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00193">cme.h:193</a></div></div>
<div class="ttc" id="autils__global_8cpp_html_a3caffa5ba0bac0bca723d7d0247d0844"><div class="ttname"><a href="utils__global_8cpp.html#a3caffa5ba0bac0bca723d7d0247d0844">bIsDoubleNotNaN</a></div><div class="ttdeci">bool bIsDoubleNotNaN(double const dX)</div><div class="ttdef"><b>Definition:</b> <a href="utils__global_8cpp_source.html#l00072">utils_global.cpp:72</a></div></div>
<div class="ttc" id="acme_8h_html_a7fe974939e47eb55d95cb6cc26678eb7"><div class="ttname"><a href="cme_8h.html#a7fe974939e47eb55d95cb6cc26678eb7">NORTH_WEST</a></div><div class="ttdeci">const int NORTH_WEST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00195">cme.h:195</a></div></div>
<div class="ttc" id="acme_8h_html_a01a70d7ac0aaa506ffa66e0e93d348b5"><div class="ttname"><a href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a></div><div class="ttdeci">const double DBL_NODATA</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00469">cme.h:469</a></div></div>
<div class="ttc" id="asimulation_8h_html"><div class="ttname"><a href="simulation_8h.html">simulation.h</a></div><div class="ttdoc">Contains CSimulation definitions.</div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a6387aaac391af63a9f2be1c809ce169c"><div class="ttname"><a href="class_c_geom_cell.html#a6387aaac391af63a9f2be1c809ce169c">CGeomCell::dGetSedimentTopElev</a></div><div class="ttdeci">double dGetSedimentTopElev(void) const</div><div class="ttdoc">Returns the true elevation of the sediment's top surface for this cell (if there is a cliff notch,...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00389">cell.cpp:389</a></div></div>
<div class="ttc" id="aclass_c_r_w_cell_sediment_html_a520b31404bb1c3dd30d9c84fe84e11e8"><div class="ttname"><a href="class_c_r_w_cell_sediment.html#a520b31404bb1c3dd30d9c84fe84e11e8">CRWCellSediment::SetFine</a></div><div class="ttdeci">void SetFine(double const)</div><div class="ttdef"><b>Definition:</b> <a href="cell__sediment_8cpp_source.html#l00069">cell_sediment.cpp:69</a></div></div>
<div class="ttc" id="ainterpolate_8h_html"><div class="ttname"><a href="interpolate_8h.html">interpolate.h</a></div><div class="ttdoc">Definitions of Linear interpolation routines.</div></div>
<div class="ttc" id="acme_8h_html_af803adbfdc053cf78880fc2425db1f1d"><div class="ttname"><a href="cme_8h.html#af803adbfdc053cf78880fc2425db1f1d">DIRECTION_UPCOAST</a></div><div class="ttdeci">const int DIRECTION_UPCOAST</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00198">cme.h:198</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_aaa8ddb9c775927bdb7940f7826f90a74"><div class="ttname"><a href="class_c_geom_profile.html#aaa8ddb9c775927bdb7940f7826f90a74">CGeomProfile::pPtGetPointInProfile</a></div><div class="ttdeci">CGeom2DPoint * pPtGetPointInProfile(int const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00240">profile.cpp:240</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a28b760b0a9e63afd01e29610888fc7bc"><div class="ttname"><a href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">CGeomCell::bIsInContiguousSea</a></div><div class="ttdeci">bool bIsInContiguousSea(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00102">cell.cpp:102</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a54949735a3e7fefed49704f7a9a50fff"><div class="ttname"><a href="class_c_geom_cell.html#a54949735a3e7fefed49704f7a9a50fff">CGeomCell::bIsInundated</a></div><div class="ttdeci">bool bIsInundated(void) const</div><div class="ttdoc">Returns true if the elevation of the sediment top surface for this cell (plus any intervention) is le...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00408">cell.cpp:408</a></div></div>
<div class="ttc" id="acme_8h_html_a6da5abe13cf250e9663012ef6633d92a"><div class="ttname"><a href="cme_8h.html#a6da5abe13cf250e9663012ef6633d92a">NO_NONZERO_THICKNESS_LAYERS</a></div><div class="ttdeci">const int NO_NONZERO_THICKNESS_LAYERS</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00421">cme.h:421</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Dec 9 2020 19:46:13 for CoastalME (Coastal Modelling Environment) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
