<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CoastalME (Coastal Modelling Environment): calc_waves.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CoastalME (Coastal Modelling Environment)
   </div>
   <div id="projectbrief">Simulates the long-term behaviour of complex coastlines</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">calc_waves.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="calc__waves_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> This file is part of CoastalME, the Coastal Modelling Environment.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> CoastalME is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using</span> std::stoi;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">using</span> std::to_string;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">using</span> std::ifstream;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">using</span> std::cout;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">using</span> std::cerr;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">using</span> std::endl;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">using</span> std::ios;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keyword">using</span> std::setprecision;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">using</span> std::setiosflags;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keyword">using</span> std::resetiosflags;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">using</span> std::setw;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">using</span> std::sort;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">using</span> std::remove;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">using</span> std::reverse;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &lt;stack&gt;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">using</span> std::stack;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cme_8h.html">cme.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="coast_8h.html">coast.h</a>&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="simulation_8h.html">simulation.h</a>&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hermite__cubic_8h.html">hermite_cubic.h</a>&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="linearinterp_8h.html">linearinterp.h</a>&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="interpolate_8h.html">interpolate.h</a>&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> Give every coast point a value for deep water wave height and direction TODO This may not be realistic, maybe better to use end-of-profile value instead (how?)</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keywordtype">int</span> CSimulation::nSetAllCoastpointDeepWaterWaveValues(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;{</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;   <span class="comment">// For each coastline, put a value for deep water wave height and direction at each coastline point</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      nNextProfile,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      nDistFromPrevProfile = 0,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      nDistToNextProfile = 0;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      dPrevProfileDeepWaterWaveHeight = 0,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      dPrevProfileDeepWaterWaveOrientation = 0,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      dPrevProfileDeepWaterWavePeriod = 0,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      dNextProfileDeepWaterWaveHeight = 0,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      dNextProfileDeepWaterWaveOrientation = 0,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      dNextProfileDeepWaterWavePeriod = 0,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      dDist = 0;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(m_VCoast.size()); nCoast++)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;   {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nPoint = 0; nPoint &lt; m_VCoast[nCoast].nGetCoastlineSize(); nPoint++)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;         <span class="comment">// We are going down-coast</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;         <span class="keywordflow">if</span> (m_VCoast[nCoast].bIsProfileStartPoint(nPoint))</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;         {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="comment">// OK, a coastline-normal profile begins at this coastline point, so set the deep water wave values at this coastline point to be the values at the seaward end of the coastline normal</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="keywordtype">int</span> nProfile = m_VCoast[nCoast].nGetProfileNumber(nPoint);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="keywordtype">double</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;               dThisDeepWaterWaveHeight = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a0c1e09e58976d6b870a8c1f976e72018">dGetDeepWaterWaveHeight</a>(),</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;               dThisDeepWaterWaveOrientation = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ae1947ab9ff15bc28ee44aea111e3b428">dGetDeepWaterWaveOrientation</a>(),</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;               dThisDeepWaterWavePeriod = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ae6b2153bed15ad0862a156d0d49d85c1">dGetDeepWaterWavePeriod</a>();</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            m_VCoast[nCoast].SetDeepWaterWaveHeight(nPoint, dThisDeepWaterWaveHeight);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            m_VCoast[nCoast].SetDeepWaterWaveOrientation(nPoint, dThisDeepWaterWaveOrientation);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            m_VCoast[nCoast].SetDeepWaterWavePeriod(nPoint, dThisDeepWaterWavePeriod);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="comment">// Reset for next time</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            nDistFromPrevProfile = 0;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            dPrevProfileDeepWaterWaveHeight = dThisDeepWaterWaveHeight;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            dPrevProfileDeepWaterWaveOrientation = dThisDeepWaterWaveOrientation;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            dPrevProfileDeepWaterWavePeriod = dThisDeepWaterWavePeriod;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="comment">// Find the next profile</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            nNextProfile = m_VCoast[nCoast].nGetDownCoastProfileNumber(nProfile);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="keywordflow">if</span> (nNextProfile == <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;               <span class="comment">// We are at the end of the coast</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;               <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pNextProfile = m_VCoast[nCoast].pGetProfile(nNextProfile);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="comment">// And the distance (in along-coast points) to the next profile</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            nDistToNextProfile = pNextProfile-&gt;<a class="code" href="class_c_geom_profile.html#a0aead517e2105d6c1a14c27126b1fe92">nGetNumCoastPoint</a>() - nPoint;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            dDist = nDistToNextProfile;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <span class="comment">// And the next profile&#39;s deep water wave values</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            dNextProfileDeepWaterWaveHeight = pNextProfile-&gt;<a class="code" href="class_c_geom_profile.html#a0c1e09e58976d6b870a8c1f976e72018">dGetDeepWaterWaveHeight</a>();</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            dNextProfileDeepWaterWaveOrientation = pNextProfile-&gt;<a class="code" href="class_c_geom_profile.html#ae1947ab9ff15bc28ee44aea111e3b428">dGetDeepWaterWaveOrientation</a>();</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            dNextProfileDeepWaterWavePeriod = pNextProfile-&gt;<a class="code" href="class_c_geom_profile.html#ae6b2153bed15ad0862a156d0d49d85c1">dGetDeepWaterWavePeriod</a>();</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast point = &quot; &lt;&lt; nPoint &lt;&lt; &quot; IS PROFILE START, dThisDeepWaterWaveHeight = &quot; &lt;&lt; dThisDeepWaterWaveHeight &lt;&lt; &quot;, dThisDeepWaterWaveOrientation = &quot; &lt;&lt; dThisDeepWaterWaveOrientation &lt;&lt; endl;</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;         }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;         {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            <span class="comment">// This coast point is not the start of a coastline normal, so set the deep water wave values to a weighted average of those from the up-coast and down-coast profiles</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            nDistFromPrevProfile++;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            nDistToNextProfile--;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="keywordtype">double</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;               dPrevWeight = (dDist - nDistFromPrevProfile) / dDist,</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;               dNextWeight = (dDist - nDistToNextProfile) / dDist,</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;               dThisDeepWaterWaveHeight = (dPrevWeight * dPrevProfileDeepWaterWaveHeight) + (dNextWeight * dNextProfileDeepWaterWaveHeight),</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;               dThisDeepWaterWaveOrientation = dKeepWithin360((dPrevWeight * dPrevProfileDeepWaterWaveOrientation) + (dNextWeight * dNextProfileDeepWaterWaveOrientation)),</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;               dThisDeepWaterWavePeriod = (dPrevWeight * dPrevProfileDeepWaterWavePeriod) + (dNextWeight * dNextProfileDeepWaterWavePeriod);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            m_VCoast[nCoast].SetDeepWaterWaveHeight(nPoint, dThisDeepWaterWaveHeight);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            m_VCoast[nCoast].SetDeepWaterWaveOrientation(nPoint, dThisDeepWaterWaveOrientation);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            m_VCoast[nCoast].SetDeepWaterWavePeriod(nPoint, dThisDeepWaterWavePeriod);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: coast point = &quot; &lt;&lt; nPoint &lt;&lt; &quot; dThisDeepWaterWaveHeight = &quot; &lt;&lt; dThisDeepWaterWaveHeight &lt;&lt; &quot; dThisDeepWaterWaveOrientation = &quot; &lt;&lt; dThisDeepWaterWaveOrientation &lt;&lt; endl;</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;         }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;   }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;}</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment"> Simulates wave propagation along all coastline-normal profiles</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keywordtype">int</span> CSimulation::nDoAllPropagateWaves(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;{</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;   <span class="comment">// Set up all-profile vectors to hold the wave attribute data at every profile point on all profiles</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;   vector&lt;bool&gt;VbBreakingAll;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;   vector&lt;int&gt;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      VnXAll,</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      VnYAll;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      VdHeightXAll,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      VdHeightYAll;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   <span class="comment">// Calculate wave properties for every coast</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;   <span class="keywordtype">bool</span> bSomeNonStartOrEndOfCoastProfiles = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(m_VCoast.size()); nCoast++)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;         nCoastSize = m_VCoast[nCoast].nGetCoastlineSize(),</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;         nNumProfiles = m_VCoast[nCoast].nGetNumProfiles();</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <span class="comment">// Calculate wave properties at every point along each valid profile, and for the cells under the profiles. Do this in the original (curvature-related) profile sequence</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfile = 0; nProfile &lt; nNumProfiles; nProfile++)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;         vector&lt;bool&gt; VbBreaking;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;         vector&lt;int&gt;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            VnX,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            VnY;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;         vector&lt;double&gt;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            VdHeightX,</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            VdHeightY;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;         <span class="keywordtype">int</span> nRet = nCalcWavePropertiesOnProfile(nCoast, nCoastSize, nProfile, &amp;VnX, &amp;VnY, &amp;VdHeightX, &amp;VdHeightY, &amp;VbBreaking);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;         <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;         <span class="comment">// Are the waves off-shore? If so, do nothing more with this profile. The wave values for cells have already been given the off-shore value</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;         <span class="keywordflow">if</span> (VbBreaking.empty())</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;         <span class="comment">// Is this a start of coast or end of coast profile?</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;         <span class="keywordflow">if</span> ((! m_VCoast[nCoast].pGetProfile(nProfile)-&gt;bStartOfCoast()) &amp;&amp; (! m_VCoast[nCoast].pGetProfile(nProfile)-&gt;bEndOfCoast()))</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;         {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="comment">// It is neither a start of coast or an end of coast profile, so set switch</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            bSomeNonStartOrEndOfCoastProfiles = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;         }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;         <span class="comment">// TEST</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">//          for (int nn = 0; nn &lt; VnX.size(); nn++)</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">//          {</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">//             LogStream &lt;&lt; &quot;nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot; nn = &quot; &lt;&lt; nn &lt;&lt; &quot; VnX[nn] = &quot; &lt;&lt; VnX[nn] &lt;&lt; &quot; VnY[nn] = &quot; &lt;&lt; VnY[nn] &lt;&lt; &quot; VdHeightX[nn] = &quot; &lt;&lt; VdHeightX[nn] &lt;&lt; &quot; VdHeightY[nn] = &quot; &lt;&lt; VdHeightY[nn] &lt;&lt; &quot; VbBreaking[nn] = &quot; &lt;&lt; VbBreaking[nn] &lt;&lt; endl;</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">//          }</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">//          LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;         <span class="comment">// TEST</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;         <span class="comment">// Append to the all-profile vectors</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;         VnXAll.insert(VnXAll.end(), VnX.begin(), VnX.end());</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;         VnYAll.insert(VnYAll.end(), VnY.begin(), VnY.end());</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;         VdHeightXAll.insert(VdHeightXAll.end(), VdHeightX.begin(), VdHeightX.end());</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;         VdHeightYAll.insert(VdHeightYAll.end(), VdHeightY.begin(), VdHeightY.end());</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;         VbBreakingAll.insert(VbBreakingAll.end(), VbBreaking.begin(), VbBreaking.end());</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   <span class="comment">// OK, do we have some profiles other than start of coast or end of coast profiles in the all-profile vectors? We need to check this, because GDALGridCreate() in nInterpolateWavePropertiesToWithinPolygonCells() does not work if we give it only a start-of-coast or an end-of-coast profile to work with</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;   <span class="keywordflow">if</span> (! bSomeNonStartOrEndOfCoastProfiles)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: waves are on-shore only for start and/or end of coast profiles&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">//    // DEBUG CODE ============================================</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">//    LogStream &lt;&lt; &quot;Out of loop&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">//    for (int nn = 0; nn &lt; VnXAll.size(); nn++)</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;nn = &quot; &lt;&lt; nn &lt;&lt; &quot; VnXAll[nn] = &quot; &lt;&lt; VnXAll[nn] &lt;&lt; &quot; VnYAll[nn] = &quot; &lt;&lt; VnYAll[nn] &lt;&lt; &quot; VdHeightXAll[nn] = &quot; &lt;&lt; VdHeightXAll[nn] &lt;&lt; &quot; VdHeightYAll[nn] = &quot; &lt;&lt; VdHeightYAll[nn] &lt;&lt; &quot; VbBreakingAll[nn] = &quot; &lt;&lt; VbBreakingAll[nn] &lt;&lt; endl;</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">//    LogStream &lt;&lt; endl;</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">//    // DEBUG CODE ============================================</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   <span class="comment">// Are the waves off-shore for every profile? If so, do nothing more</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   <span class="keywordflow">if</span> (VbBreakingAll.empty())</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;   {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: waves off-shore for all profiles&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;   }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   <span class="comment">// Some waves are on-shore, so interpolate the wave attributes from all profile points to all within-polygon sea cells</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <span class="keywordtype">int</span> nRet = nInterpolateWavePropertiesToWithinPolygonCells(&amp;VnXAll, &amp;VnYAll, &amp;VdHeightXAll, &amp;VdHeightYAll);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   <span class="comment">// Interpolate the wave attributes from all profile points to all sea cells that are in the active zone</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   <span class="comment">//nRet = nInterpolateWavePropertiesToActiveZoneCells(&amp;VnXAll, &amp;VnYAll, &amp;VbBreakingAll);</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   nRet = nInterpolateWavePropertiesToActiveZoneCells();</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   <span class="comment">// Find the shadow zones and then modify waves in and adjacent to them</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   nRet = nDoAllShadowZones();</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   <span class="comment">// Fill in artefactual &#39;holes&#39; in active zone and wave property patterns</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;   CalcD50AndFillWaveCalcHoles();</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   <span class="comment">// Modify the wave breaking properties (wave height, wave dir, breaking depth, breaking distance) for coastline points within the shadow zone</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(m_VCoast.size()); nCoast++)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordtype">int</span> nNumProfiles = m_VCoast[nCoast].nGetNumProfiles();</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfile = 0; nProfile &lt; nNumProfiles; nProfile++)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;         ModifyBreakingWavePropertiesWithinShadowZoneToCoastline(nCoast, nProfile);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <span class="comment">// Interpolate these wave properties for all remaining coastline points. Do this in along-coastline sequence</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(m_VCoast.size()); nCoast++)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;         nCoastSize = m_VCoast[nCoast].nGetCoastlineSize(),</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;         nNumProfiles = m_VCoast[nCoast].nGetNumProfiles();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="comment">// Interpolate these wave properties for all remaining coastline points. Do this in along-coastline sequence, but do not do this for the end-of-coastline profile (which is the final one)</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nNumProfiles-1; n++)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      InterpolateWavePropertiesToCoastline(nCoast, n, nNumProfiles);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="comment">// And do the same for the coastline cells</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      InterpolateWavePropertiesToCoastlineCells(nCoast);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="comment">// Calculate wave energy at breaking for every point on the coastline</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoastPoint = 0; nCoastPoint &lt; nCoastSize; nCoastPoint++)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;         <span class="comment">// Equation 4 from Walkden &amp; Hall, 2005</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            dBreakingWaveHeight = m_VCoast[nCoast].dGetBreakingWaveHeight(nCoastPoint),</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            dCoastPointWavePeriod = m_VCoast[nCoast].dGetDeepWaterWavePeriod(nCoastPoint);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;         <span class="keywordflow">if</span> (dBreakingWaveHeight != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;         {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keywordtype">double</span> dErosiveWaveForce = pow(dBreakingWaveHeight, <a class="code" href="cme_8h.html#aa7d7726ee4a2306d4ee580841689129c">WALKDEN_HALL_PARAM_1</a>) * pow(dCoastPointWavePeriod, <a class="code" href="cme_8h.html#ad238599c0266f9981973bdcf22b96b83">WALKDEN_HALL_PARAM_2</a>);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="comment">// Calculate total wave energy at each coast point during this timestep</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keywordtype">double</span> dWaveEnergy = dErosiveWaveForce * m_dTimeStep * 3600;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            m_VCoast[nCoast].SetWaveEnergyAtBreaking(nCoastPoint, dWaveEnergy);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;         }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"> Calculates the angle between the wave direction and a normal to the coastline tangent. If wave direction has a component which is down-coast (i.e. in the direction with increasing coast point numbers), then the angle returned is +ve. If wave direction has a component which is up-coast (i.e. in the direction with decreasing coast point numbers), then the angle returned is -ve. If waves are in an off-shore direction, DBL_NODATA is returned</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="keywordtype">double</span> CSimulation::dCalcWaveAngleToCoastNormal(<span class="keywordtype">double</span> <span class="keyword">const</span> dCoastAngle, <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveOrientation, <span class="keywordtype">int</span> <span class="keyword">const</span> nSeaHand)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;{</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="keywordtype">double</span> dWaveToNormalAngle = 0;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="keywordflow">if</span> (nSeaHand == <a class="code" href="cme_8h.html#a96e58f57ae0cc113e899eab923e8d395">LEFT_HANDED</a>)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="comment">// Left-handed coast</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      dWaveToNormalAngle = fmod((dWaveOrientation - dCoastAngle + 360), 360) - 90;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="comment">// Right-handed coast</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      dWaveToNormalAngle = fmod((dWaveOrientation - dCoastAngle + 360), 360) - 270;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <span class="keywordflow">if</span> ((dWaveToNormalAngle &gt;= 90) || (dWaveToNormalAngle &lt;= -90))</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      dWaveToNormalAngle = <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;   <span class="keywordflow">return</span> dWaveToNormalAngle;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment"> Calculates wave properties along a coastline-normal profile using either the COVE linear wave theory approach or the external CShore model</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keywordtype">int</span> CSimulation::nCalcWavePropertiesOnProfile(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nCoastSize, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfile, vector&lt;int&gt;* pVnX, vector&lt;int&gt;* pVnY, vector&lt;double&gt;* pVdHeightX, vector&lt;double&gt;* pVdHeightY, vector&lt;bool&gt;* pVbBreaking)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;{</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   <span class="comment">// Calculate some wave properties based on the wave period following Airy wave theory</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <span class="keywordtype">double</span> dDeepWaterWavePeriod = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ae6b2153bed15ad0862a156d0d49d85c1">dGetDeepWaterWavePeriod</a>();</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;   m_dC_0 = (m_dG * dDeepWaterWavePeriod) / (2 * <a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a>);           <span class="comment">// Deep water (offshore) wave celerity (m/s)</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   m_dL_0 = m_dC_0 * dDeepWaterWavePeriod;                      <span class="comment">// Deep water (offshore) wave length (m)</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;   <span class="comment">// Only do this for profiles without problems. Still do start- and end-of-coast profiles however</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;   <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aac223e2610d50ca2c7eadaf8542e9498">bOKIncStartAndEndOfCoast</a>())</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;   {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot; has been marked invalid, will not calc wave properties on this profile&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      nSeaHand = m_VCoast[nCoast].nGetSeaHandedness(),</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      nCoastPoint = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a0aead517e2105d6c1a14c27126b1fe92">nGetNumCoastPoint</a>();</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;   <span class="comment">// Get the flux orientation (the orientation of a line which is tangential to the coast) at adjacent coastline points. Note special treatment for the coastline end points</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      dFluxOrientationThis = m_VCoast[nCoast].dGetFluxOrientation(nCoastPoint),</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      dFluxOrientationPrev = 0,</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      dFluxOrientationNext = 0;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;   <span class="keywordflow">if</span> (nCoastPoint == 0)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      dFluxOrientationPrev = dFluxOrientationThis;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      dFluxOrientationNext = m_VCoast[nCoast].dGetFluxOrientation(1);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nCoastPoint == nCoastSize-1)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;   {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      dFluxOrientationPrev = m_VCoast[nCoast].dGetFluxOrientation(nCoastPoint-2);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      dFluxOrientationNext = dFluxOrientationThis;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;   {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      dFluxOrientationPrev = m_VCoast[nCoast].dGetFluxOrientation(nCoastPoint-1);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      dFluxOrientationNext = m_VCoast[nCoast].dGetFluxOrientation(nCoastPoint+1);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   <span class="comment">// Get the deep water wave orientation for this profile</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;   <span class="keywordtype">double</span> dDeepWaterWaveOrientation = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ae1947ab9ff15bc28ee44aea111e3b428">dGetDeepWaterWaveOrientation</a>();</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   <span class="comment">// Calculate the angle between the deep water wave direction and a normal to the coast tangent</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   <span class="keywordtype">double</span> dWaveToNormalAngle = dCalcWaveAngleToCoastNormal(dFluxOrientationThis, dDeepWaterWaveOrientation, nSeaHand);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   <span class="comment">// Are the waves off-shore?</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   <span class="keywordflow">if</span> (dWaveToNormalAngle == <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>)</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;   {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="comment">// They are so, do nothing (each cell under the profile has already been initialised with deep water wave height and wave direction)</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; has sea to &quot; &lt;&lt; (m_VCoast[nCoast].nGetSeaHandedness() == RIGHT_HANDED ? &quot;right&quot; : &quot;left&quot;) &lt;&lt; &quot; dWaveToNormalAngle = &quot; &lt;&lt; dWaveToNormalAngle &lt;&lt; &quot; which is off-shore&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;   }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">//    LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: profile = &quot; &lt;&lt; nProfile &lt;&lt; &quot; has sea to &quot; &lt;&lt; (m_VCoast[nCoast].nGetSeaHandedness() == RIGHT_HANDED ? &quot;right&quot; : &quot;left&quot;) &lt;&lt; &quot; dWaveToNormalAngle = &quot; &lt;&lt; dWaveToNormalAngle &lt;&lt; &quot; which is &quot; &lt;&lt; (dWaveToNormalAngle &lt; 0 ? &quot;DOWN&quot; : &quot;UP&quot;) &lt;&lt; &quot;-coast&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <span class="comment">// Calculate the angle between the deep water wave direction and a normal to the coast tangent for the previous coast point</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   <span class="keywordtype">double</span> dWaveToNormalAnglePrev;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   <span class="keywordflow">if</span> (nCoastPoint &gt; 0)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;   {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="comment">// Get the deep water wave orientation for the up-coast point</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <span class="keywordtype">double</span> dPrevDeepWaterWaveOrientation = m_VCoast[nCoast].dGetDeepWaterWaveOrientation(nCoastPoint-1);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      dWaveToNormalAnglePrev = dCalcWaveAngleToCoastNormal(dFluxOrientationPrev, dPrevDeepWaterWaveOrientation, nSeaHand);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      dWaveToNormalAnglePrev = dWaveToNormalAngle;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;   }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">//    if (dWaveToNormalAnglePrev == DBL_NODATA)</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tPrevious profile, dWaveToNormalAnglePrev = &quot; &lt;&lt; dWaveToNormalAnglePrev &lt;&lt; &quot; which is off-shore&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">//    else</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tPrevious profile, dWaveToNormalAnglePrev = &quot; &lt;&lt; dWaveToNormalAnglePrev &lt;&lt; &quot; which is &quot; &lt;&lt; (dWaveToNormalAnglePrev &lt; 0 ? &quot;DOWN&quot; : &quot;UP&quot;) &lt;&lt; &quot;-coast&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;   <span class="comment">// Calculate the angle between the deep water wave direction and a normal to the coast tangent for the next coast point</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;   <span class="keywordtype">double</span> dWaveToNormalAngleNext;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;   <span class="keywordflow">if</span> (nCoastPoint &lt; nCoastSize-1)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="comment">// Get the deep water wave orientation for the down-coast point</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="keywordtype">double</span> dNextDeepWaterWaveOrientation = m_VCoast[nCoast].dGetDeepWaterWaveOrientation(nCoastPoint+1);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      dWaveToNormalAngleNext = dCalcWaveAngleToCoastNormal(dFluxOrientationNext, dNextDeepWaterWaveOrientation, nSeaHand);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      dWaveToNormalAngleNext = dWaveToNormalAngle;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;   }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">//    if (dWaveToNormalAngleNext == DBL_NODATA)</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tNext profile, dWaveToNormalAngleNext = &quot; &lt;&lt; dWaveToNormalAngleNext &lt;&lt; &quot; which is off-shore&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">//    else</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">//       LogStream &lt;&lt; &quot;\tNext profile, dWaveToNormalAngleNext = &quot; &lt;&lt; dWaveToNormalAngleNext &lt;&lt; &quot; which is &quot; &lt;&lt; (dWaveToNormalAngleNext &lt; 0 ? &quot;DOWN&quot; : &quot;UP&quot;) &lt;&lt; &quot;-coast&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   <span class="comment">// Following Ashton and Murray (2006), if we have high-angle waves then use the flux orientation of the previous (up-coast) profile, if transitioning from diffusive to antidiffusive use flux maximizing angle (45 degrees)</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;   <span class="keywordflow">if</span> ((dWaveToNormalAngle &gt; 0) &amp;&amp; (dWaveToNormalAnglePrev != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>) &amp;&amp; (dWaveToNormalAnglePrev &gt; 0))</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="keywordflow">if</span> (dWaveToNormalAngle &gt; 45)</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;         <span class="keywordflow">if</span> (dWaveToNormalAnglePrev &lt; 45)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;         {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            dWaveToNormalAngle = 45;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="comment">//            LogStream &lt;&lt; &quot;\tA1&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;         }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;         {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            dWaveToNormalAngle = dWaveToNormalAnglePrev;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="comment">//            LogStream &lt;&lt; &quot;\tA2&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;         }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dWaveToNormalAngle &lt; 0) &amp;&amp; (dWaveToNormalAngleNext != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>) &amp;&amp; (dWaveToNormalAngleNext &lt; 0))</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;   {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="keywordflow">if</span> (dWaveToNormalAngle &lt; -45)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;         <span class="keywordflow">if</span> (dWaveToNormalAngleNext &gt; -45)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;         {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            dWaveToNormalAngle = -45;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <span class="comment">//            LogStream &lt;&lt; &quot;\tB1&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;         }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;         {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            dWaveToNormalAngle = dWaveToNormalAngleNext;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="comment">//            LogStream &lt;&lt; &quot;\tB2&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;         }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dWaveToNormalAngle &gt; 45) &amp;&amp; (dWaveToNormalAnglePrev != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>) &amp;&amp; (dWaveToNormalAnglePrev &gt; 0))</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="comment">// The wave direction here has an up-coast (decreasing indices) component: so for high-angle waves use the orientation from the up-coast (previous) profile</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="comment">//      LogStream &lt;&lt; &quot;\tCCC&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      dWaveToNormalAngle = dFluxOrientationPrev;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;   }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dWaveToNormalAngle &lt; -45)  &amp;&amp; (dWaveToNormalAngleNext != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>) &amp;&amp; (dWaveToNormalAngleNext &lt; 0))</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;   {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="comment">// The wave direction here has a down-coast (increasing indices) component: so for high-angle waves use the orientation from the down-coast (next) profile</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="comment">//      LogStream &lt;&lt; &quot;\tDDD&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      dWaveToNormalAngle = dFluxOrientationNext;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   <span class="comment">// Initialize the wave properties at breaking for this profile</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;   <span class="keywordtype">bool</span> bBreaking = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      nProfileSize = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">nGetNumCellsInProfile</a>(),</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      nProfileBreakingDist = 0;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      dProfileBreakingWaveHeight = 0,</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      dProfileBreakingWaveOrientation = 0,</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      dProfileBreakingDepth = 0,</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      dProfileWaveHeight = <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>,</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      dProfileDeepWaterWaveHeight = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a0c1e09e58976d6b870a8c1f976e72018">dGetDeepWaterWaveHeight</a>(),</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      dProfileWaveOrientation = <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>,</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      dProfileDeepWaterWaveOrientation = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ae1947ab9ff15bc28ee44aea111e3b428">dGetDeepWaterWaveOrientation</a>();</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;   vector&lt;bool&gt;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      VbWaveIsBreaking(nProfileSize,0);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      VdWaveHeight(nProfileSize,0),</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      VdWaveDirection(nProfileSize,0);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;   <span class="keywordflow">if</span> (m_nWavePropagationModel == <a class="code" href="cme_8h.html#a66f1550c565d9d7737dbb2c43f4807ec">WAVE_MODEL_CSHORE</a>)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;   {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="comment">// We are using CShore to propagate the waves</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;         dCShoreTimeStep = 3600,     <span class="comment">// In seconds, not important because we are not using CShore to erode the profile, just to get the hydrodynamics</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;         dSurgeLevel = <a class="code" href="cme_8h.html#a3f242306dda26e4d5fb547e49e176b26">CSHORE_SURGE_LEVEL</a>;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160; </div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="comment">// Set up vectors for the coastline-normal profile elevations. The length of this vector line is given by the number of cells &#39;under&#39; the profile. Thus each point on the vector relates to a single cell in the grid. This assumes that all points on the profile vector are equally spaced (not quite true, depends on the orientation of the line segments which comprise the profile)</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      vector&lt;double&gt;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;         VdProfileZ,                  <span class="comment">// Initial (pre-erosion) elevation of both consolidated and unconsolidated sediment for cells &#39;under&#39; the profile, in CShore units</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;         VdProfileDistXY,             <span class="comment">// Along-profile distance measured from the seaward limit, in CShore units</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;         VdProfileFrictionFactor;     <span class="comment">// Along-profile friction factor from seaward limit</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="comment">// The elevation of each of these profile points is the elevation of the centroid of the cell that is &#39;under&#39; the point. However we cannot always be confident that this is the &#39;true&#39; elevation of the point on the vector since (unless the profile runs planview N-S or W-E) the vector does not always run exactly through the centroid of the cell</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordtype">int</span> nRet = nGetThisProfileElevationVectorsForCShore(nCoast, nProfile, nProfileSize, &amp;VdProfileDistXY, &amp;VdProfileZ, &amp;VdProfileFrictionFactor);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;         <span class="comment">// Could not create the profile elevation vectors</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: could not create CShore profile elevation vectors for profile &quot;</span> &lt;&lt; nProfile &lt;&lt; endl;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">if</span> (VdProfileDistXY.empty())</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;         <span class="comment">// The profile elevation vector was created, but was not populated</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: could not populate CShore profile elevation vector for profile &quot;</span> &lt;&lt; nProfile &lt;&lt; endl;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a84940800790cc4002f662cad53119f2e">RTN_ERR_CSHORE_EMPTY_PROFILE</a>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="comment">// Constrain the wave to normal angle to be between -80 and 80 degrees, this is a requirement of CShore</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      dWaveToNormalAngle = <a class="code" href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a>(dWaveToNormalAngle, -80.0);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      dWaveToNormalAngle = <a class="code" href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a>(dWaveToNormalAngle, 80.0);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="keywordtype">int</span> nProfileDistXYSize = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VdProfileDistXY.size());</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      vector&lt;double&gt;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;         VdFreeSurfaceStd(nProfileDistXYSize, 0),          <span class="comment">// This is converted to Hrms by Hrms = sqr(8)*FreeSurfaceStd</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;         VdSinWaveAngleRadians(nProfileDistXYSize, 0),     <span class="comment">// This is converted to deg by asin(VdSinWaveAngleRadians)*(180/pi)</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;         VdFractionBreakingWaves(nProfileDistXYSize, 0);   <span class="comment">// Is 0 if no wave breaking, and 1 if all waves breaking</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="comment">// Now define the other values that CShore requires</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;         nILine   = 1,           <span class="comment">// This is the number of cross-shore lines i.e. the number of CoastalME profiles. Only one at a time, at present</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;         nIProfl  = 0,           <span class="comment">// 0 for fixed bottom profile, 1 for profile evolution computation</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;         nIPerm   = 0,           <span class="comment">// 0 for impermeable bottom, 1 for permeable bottom of stone structure</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;         nIOver   = 0,           <span class="comment">// 0 for no wave overtopping and overflow on crest, 1 for wave overtopping and overflow</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;         nIWCInt  = 0,           <span class="comment">// 0 for no wave/current interaction, 1 for wave/current interaction in frequency dispersion, momentum and wave action equations</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;         nIRoll   = 0,           <span class="comment">// 0 for no roller effects, 1 for roller effects in governing equations</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;         nIWind   = 0,           <span class="comment">// 0 for no wind effects, 1 for wind shear stresses on momentum equations</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;         nITide   = 0,           <span class="comment">// 0 for no tidal effect on currents, 1 for longshore and cross-shore tidal currents</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;         nILab    = 0,           <span class="comment">// 0 for field data set, 1 for laboratory data set</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;         nNWave   = 1,           <span class="comment">// Number of waves at x = 0 starting from time = 0</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;         nNSurge  = 1;           <span class="comment">// Number of water levels at x = 0 from time = 0</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;         dDX = VdProfileDistXY.back() / (<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(VdProfileDistXY.size() - 1)),</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;         dWaveInitTime = 0,      <span class="comment">// CShore wave start time</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;         dSurgeInitTime = 0;     <span class="comment">// CShore surge start time</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="preprocessor">#if defined CSHORE_FILE_INOUT || CSHORE_BOTH</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="comment">// Move to the CShore folder</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      nRet = chdir(<a class="code" href="cme_8h.html#af6bae16c7e97385220c7ace0a46495de">CSHORE_DIR</a>.c_str());</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="preprocessor">#if defined CSHORE_FILE_INOUT</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="comment">// We are communicating with CShore using ASCII files, so create an input file for this profile which will be read by CShore</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      nRet = nCreateCShoreInfile(nCoast, nProfile, nILine, nIProfl, nIPerm, nIOver, nIWCInt, nIRoll, nIWind, nITide, nILab, nNWave, nNSurge, dDX, dCShoreTimeStep, dWaveInitTime, dDeepWaterWavePeriod, dProfileDeepWaterWaveHeight, dWaveToNormalAngle, dSurgeInitTime, dSurgeLevel, &amp;VdProfileDistXY, &amp;VdProfileZ, &amp;VdProfileFrictionFactor);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <span class="comment">// Set the error flag: this will be changed to 0 within CShore if CShore returns correctly</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      nRet = -1;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="comment">// Run CShore for this profile</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      cshore(&amp;nRet, &amp;m_ulIter, &amp;nProfile, &amp;nProfile);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="comment">// Check return code for error</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordflow">if</span> (nRet != 0)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;         <span class="keywordtype">string</span> strErr;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;         <span class="keywordflow">switch</span>(nRet)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;         {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;         <span class="keywordflow">case</span> -1:</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            strErr = to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore ERROR: negative depth at the first node &quot;</span>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;         <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            strErr = to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore WARNING 2: negative value at end of landward marching computation &quot;</span>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;         <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            strErr = to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore WARNING 3: large energy gradients at the first node: small waves with short period at sea boundary &quot;</span>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160; </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;         <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            strErr= to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore WARNING 4: zero energy at the first node &quot;</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;         <span class="keywordflow">case</span> 5:</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            strErr = to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore WARNING 5: at end of landward marching computation, insufficient water depth &quot;</span>;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;         <span class="keywordflow">case</span> 7:</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            strErr = to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore WARNING 7: did not reach convergence &quot;</span>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;         }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;         strErr += <span class="stringliteral">&quot;(coast &quot;</span> + to_string(nCoast) + <span class="stringliteral">&quot; profile &quot;</span> + to_string(nProfile) + <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; strErr;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;         <span class="keywordflow">if</span> (nRet &lt; 0)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;         {</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            <span class="comment">// This is serious, so give up</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            cerr &lt;&lt; strErr;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a45610ba778a13cb26dfa0bd2ac5c42cd">RTN_ERR_CSHORE_ERROR</a>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;         }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;         <span class="comment">// Not too serious, so carry on</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="comment">// Fetch the CShore results by reading files written by CShore</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordtype">string</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;         strOSETUP = <span class="stringliteral">&quot;OSETUP&quot;</span>,</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;         strOYVELO = <span class="stringliteral">&quot;OYVELO&quot;</span>,</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;         strOPARAM = <span class="stringliteral">&quot;OPARAM&quot;</span>;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      nRet = nReadCShoreOutput(nProfile, &amp;strOSETUP, 4, 4, &amp;VdProfileDistXY, &amp;VdFreeSurfaceStd);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      nRet = nReadCShoreOutput(nProfile, &amp;strOYVELO, 4, 2, &amp;VdProfileDistXY, &amp;VdSinWaveAngleRadians);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      nRet = nReadCShoreOutput(nProfile, &amp;strOPARAM, 4, 3, &amp;VdProfileDistXY, &amp;VdFractionBreakingWaves);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="comment">// Clean up the CShore outputs</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      nRet = system(<span class="stringliteral">&quot;./clean.bat&quot;</span>);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="cme_8h.html#a11e609647b6dbb5e02678ef4c32d669f">SAVE_CSHORE_OUTPUT</a>)</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;         <span class="keywordtype">string</span> strCommand = <span class="stringliteral">&quot;./save_CShore_output.sh &quot;</span>;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;         strCommand += to_string(m_ulIter);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;         strCommand += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;         strCommand += to_string(nCoast);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;         strCommand += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;         strCommand += to_string(nProfile);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;         nRet = system(strCommand.c_str());</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;         <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; </div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      nRet = system(<span class="stringliteral">&quot;./clean.sh&quot;</span>);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="comment">// And return to the CoastalME folder</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      nRet = chdir(m_strCMEDir.c_str());</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="preprocessor">#if defined CSHORE_ARG_INOUT || CSHORE_BOTH</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="comment">// We are communicating with CShore by passing arguments</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordtype">int</span> nOutSize = 0;     <span class="comment">// CShore will return the size of the output vectors</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="comment">// Set the error flag: this will be changed within CShore if there is a problem</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      nRet = 0;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keywordtype">int</span> <span class="keyword">const</span> CSHOREARRAYOUTSIZE = 1500;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      vector&lt;double&gt;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      VdInitTime = {dWaveInitTime, dCShoreTimeStep},                             <span class="comment">// Size is nNwave+1, value 1 is for the start of the CShore run, value 2 for end of CShore run</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;         VdTPIn = {dDeepWaterWavePeriod, dDeepWaterWavePeriod},                  <span class="comment">// Ditto</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;         VdHrmsIn = {dProfileDeepWaterWaveHeight, dProfileDeepWaterWaveHeight},  <span class="comment">// Ditto</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;         VdWangIn = {dWaveToNormalAngle, dWaveToNormalAngle},                    <span class="comment">// Ditto</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;         VdTSurg = {dSurgeInitTime, dCShoreTimeStep},                            <span class="comment">// Ditto</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;         VdSWLin = {dSurgeLevel, dSurgeLevel},                                   <span class="comment">// Ditto</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;         VdFPInp = VdProfileFrictionFactor,                                      <span class="comment">// Set the value for wave friction at every point of the normal profile</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;         VdXYDistFromCShoreOut(CSHOREARRAYOUTSIZE, 0),         <span class="comment">// Output from CShore</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;         VdFreeSurfaceStdOut(CSHOREARRAYOUTSIZE, 0),           <span class="comment">// Ditto</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;         VdSinWaveAngleRadiansOut(CSHOREARRAYOUTSIZE, 0),      <span class="comment">// Ditto</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;         VdFractionBreakingWavesOut(CSHOREARRAYOUTSIZE, 0);    <span class="comment">// Ditto</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="comment">// Call CShore using the argument-passing wrapper</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      CShoreWrapper(&amp;m_ulIter, &amp;nCoast, &amp;nProfile, &amp;nILine, &amp;nIProfl, &amp;nIPerm, &amp;nIOver, &amp;nIWCInt, &amp;nIRoll, &amp;nIWind, &amp;nITide, &amp;nILab, &amp;nNWave, &amp;nNSurge, &amp;dDX, &amp;m_dBreakingWaveHeightDepthRatio, &amp;VdInitTime[0], &amp;VdTPIn[0], &amp;VdHrmsIn[0], &amp;VdWangIn[0], &amp;VdTSurg[0], &amp;VdSWLin[0], &amp;nProfileDistXYSize, &amp;VdProfileDistXY[0], &amp;VdProfileZ[0], &amp;VdFPInp[0], &amp;nRet, &amp;nOutSize, &amp;VdXYDistFromCShoreOut[0], &amp;VdFreeSurfaceStdOut[0], &amp;VdSinWaveAngleRadiansOut[0], &amp;VdFractionBreakingWavesOut[0]);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="comment">// OK, now check for warnings and errors</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="keywordflow">if</span> (nOutSize &lt; 2)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;         <span class="comment">// CShore sometimes returns only one row of results, which contains data only for the seaward point of the profile. This happens when all other (more coastward) points give an invalid result during CShore&#39;s calculations. This is a problem. We don&#39;t want to abandon the simulation just because of this, so instead we just duplicate the row</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#aefc63c4bde02ca170b0e7bd038ba7702">WARN</a> &lt;&lt; <span class="stringliteral">&quot;for coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot; profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot;, only &quot;</span> &lt;&lt; nOutSize &lt;&lt; <span class="stringliteral">&quot; CShore output row&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;         <span class="comment">// Duplicate the data</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;         VdXYDistFromCShoreOut.push_back(VdXYDistFromCShoreOut[0]);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;         VdFreeSurfaceStdOut.push_back(VdFreeSurfaceStdOut[0]);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;         VdSinWaveAngleRadiansOut.push_back(VdSinWaveAngleRadiansOut[0]);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;         VdFractionBreakingWavesOut.push_back(VdFractionBreakingWavesOut[0]);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;         <span class="comment">// And increase the expected number of rows</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;         nOutSize++;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      }</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      {</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;         <span class="keywordtype">string</span> strErr;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;         <span class="keywordflow">switch</span>(nRet)</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;         {</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;         <span class="keywordflow">case</span> -1:</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            strErr = to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore ERROR: negative depth at the first node &quot;</span>;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;         <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            strErr = to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore WARNING 2: negative value at end of landward marching computation &quot;</span>;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160; </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;         <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            strErr = to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore WARNING 3: large energy gradients at the first node: small waves with short period at sea boundary &quot;</span>;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;         <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            strErr= to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore WARNING 4: zero energy at the first node &quot;</span>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;         <span class="keywordflow">case</span> 5:</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            strErr = to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore WARNING 5: at end of landward marching computation, insufficient water depth &quot;</span>;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;         <span class="keywordflow">case</span> 7:</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            strErr = to_string(m_ulIter) + <span class="stringliteral">&quot;: CShore WARNING 7: did not reach convergence &quot;</span>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;         }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;         strErr += <span class="stringliteral">&quot;(coast &quot;</span> + to_string(nCoast) + <span class="stringliteral">&quot; profile &quot;</span> + to_string(nProfile) + <span class="stringliteral">&quot; profile length &quot;</span> + to_string(nOutSize) + <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;         <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; strErr;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;         <span class="keywordflow">if</span> (nRet &lt; 0)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;         {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="comment">// This is serious, so give up</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            cerr &lt;&lt; strErr;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a45610ba778a13cb26dfa0bd2ac5c42cd">RTN_ERR_CSHORE_ERROR</a>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;         }</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;         <span class="comment">// Not too serious, so carry on</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <span class="comment">// Now interpolate the output</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      InterpolateCShoreOutput(&amp;VdProfileDistXY, nOutSize, &amp;VdXYDistFromCShoreOut, &amp;VdFreeSurfaceStdOut, &amp;VdSinWaveAngleRadiansOut, &amp;VdFractionBreakingWavesOut, &amp;VdFreeSurfaceStd, &amp;VdSinWaveAngleRadians, &amp;VdFractionBreakingWaves);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160; </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="preprocessor">#if defined CSHORE_BOTH</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="preprocessor">   #if ! defined _WIN32</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="cme_8h.html#a11e609647b6dbb5e02678ef4c32d669f">SAVE_CSHORE_OUTPUT</a>)</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;         <span class="keywordtype">string</span> strCommand = <span class="stringliteral">&quot;./save_CShore_output.sh &quot;</span>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;         strCommand += to_string(m_ulIter);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;         strCommand += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;         strCommand += to_string(nCoast);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;         strCommand += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;         strCommand += to_string(nProfile);</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;         nRet = system(strCommand.c_str());</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;         <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      }</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="preprocessor">   #endif</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="comment">// Return to the CoastalME folder</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      nRet = chdir(m_strCMEDir.c_str());</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="keywordflow">if</span> (nRet != <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>)</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;         <span class="keywordflow">return</span> nRet;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="comment">// OK we have the CShore output, so now we must convert this to wave height and wave direction and update wave profile attributes</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfilePoint = (nProfileSize-1); nProfilePoint &gt;= 0; nProfilePoint--)</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;         <span class="keywordtype">int</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            nX = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            nY = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;         VdWaveHeight[nProfilePoint] = sqrt(8) * VdFreeSurfaceStd[nProfilePoint];</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;         <span class="keywordtype">double</span> dAlpha = asin(VdSinWaveAngleRadians[nProfilePoint]) * (180/<a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a>);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;         <span class="keywordflow">if</span> (nSeaHand == <a class="code" href="cme_8h.html#a96e58f57ae0cc113e899eab923e8d395">LEFT_HANDED</a>)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            VdWaveDirection[nProfilePoint] = dKeepWithin360(dAlpha + 90 + dFluxOrientationThis);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            VdWaveDirection[nProfilePoint] = dKeepWithin360(dAlpha + 270 + dFluxOrientationThis);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;         <span class="keywordflow">if</span> ((VdFractionBreakingWaves[nProfilePoint] &gt;= 0.10) &amp;&amp; (! bBreaking))</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;         {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            bBreaking = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            dProfileBreakingWaveHeight = VdWaveHeight[nProfilePoint];</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            dProfileBreakingWaveOrientation = VdWaveDirection[nProfilePoint];</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            dProfileBreakingDepth = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a3a378431e2f6095792582989f50fb435">dGetSeaDepth</a>();  <span class="comment">// Water depth for the cell &#39;under&#39; this point in the profile</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            nProfileBreakingDist = nProfilePoint;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <span class="comment">//             LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: CShore breaking at [&quot; &lt;&lt; nX &lt;&lt; &quot;][&quot; &lt;&lt; nY &lt;&lt; &quot;] = {&quot; &lt;&lt; dGridCentroidXToExtCRSX(nX) &lt;&lt; &quot;, &quot; &lt;&lt; dGridCentroidYToExtCRSY(nY) &lt;&lt; &quot;} nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, nProfilePoint = &quot; &lt;&lt; nProfilePoint &lt;&lt; &quot;, dBreakingWaveHeight = &quot; &lt;&lt; dBreakingWaveHeight &lt;&lt; &quot;, dBreakingWaveOrientation = &quot; &lt;&lt; dBreakingWaveOrientation &lt;&lt; &quot;, dProfileBreakingDepth = &quot; &lt;&lt; dProfileBreakingDepth &lt;&lt; &quot;, nProfileBreakingDist = &quot; &lt;&lt; nProfileBreakingDist &lt;&lt; endl;</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;         }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;         VbWaveIsBreaking[nProfilePoint] = bBreaking;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;   }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_nWavePropagationModel == <a class="code" href="cme_8h.html#aeb2e58b62fd962a2b31439fac918fbb5">WAVE_MODEL_COVE</a>)</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="comment">// We are using COVE&#39;s linear wave theory to propagate the waves</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      <span class="keywordtype">double</span> dDepthLookupMax = m_dWaveDepthRatioForWaveCalcs * dProfileDeepWaterWaveHeight;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160; </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="comment">// Go landwards along the profile, calculating wave height and wave angle for every inundated point on the profile (don&#39;t do point zero, this is on the coastline) until the waves start to break  after breaking wave height is assumed to decrease linearly to zero at the shoreline and wave angle is equalt to wave angle at breaking</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfilePoint = (nProfileSize-1); nProfilePoint &gt; 0; nProfilePoint--)</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;         <span class="keywordtype">int</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            nX = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            nY = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;         <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;         <span class="keywordflow">if</span> (! m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>())</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;         <span class="keywordtype">double</span> dSeaDepth = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a3a378431e2f6095792582989f50fb435">dGetSeaDepth</a>();  <span class="comment">// Water depth for the cell &#39;under&#39; this point in the profile</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;         <span class="keywordflow">if</span> (dSeaDepth &gt; dDepthLookupMax)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;         {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="comment">// Sea depth is too large relative to wave height to feel the bottom, so do nothing since each cell under the profile has already been initialised with deep water wave height and wave direction</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            dProfileWaveHeight = dProfileDeepWaterWaveHeight;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            dProfileWaveOrientation = dProfileDeepWaterWaveOrientation;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;         }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;         {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <span class="keywordflow">if</span> (! bBreaking)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;               <span class="comment">// Start calculating wave properties using linear wave theory</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;               <span class="keywordtype">double</span> dL = m_dL_0 * sqrt(tanh((2 * <a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a> * dSeaDepth) / m_dL_0));               <span class="comment">// Wavelength (m) in intermediate-shallow waters</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;               <span class="keywordtype">double</span> dC = m_dC_0 * tanh((2 * <a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a> * dSeaDepth) / dL);                         <span class="comment">// Wave speed (m/s) set by dSeaDepth, dL and m_dC_0</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;               <span class="keywordtype">double</span> dk = 2 * <a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a> / dL;                                                      <span class="comment">// Wave number (1/m)</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;               <span class="keywordtype">double</span> dn = ((2 * dSeaDepth * dk) / (sinh(2 * dSeaDepth * dk)) + 1) / 2;      <span class="comment">// Shoaling factor</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;               <span class="keywordtype">double</span> dKs = sqrt(m_dC_0 / (dn * dC * 2));                                    <span class="comment">// Shoaling coefficient</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;               <span class="keywordtype">double</span> dAlpha = (180 / <a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a>) * asin((dC / m_dC_0) * sin((<a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a> / 180) * dWaveToNormalAngle));  <span class="comment">// Calculate angle between wave direction and the normal to the coast tangent</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;               <span class="keywordtype">double</span> dKr = sqrt(cos((<a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a> / 180) * dWaveToNormalAngle) / cos((<a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a> / 180) * dAlpha));       <span class="comment">// Refraction coefficient</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;               dProfileWaveHeight = dProfileDeepWaterWaveHeight * dKs * dKr;                               <span class="comment">// Calculate wave height, based on the previous (more seaward) wave height</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;               <span class="keywordflow">if</span> (nSeaHand == <a class="code" href="cme_8h.html#a96e58f57ae0cc113e899eab923e8d395">LEFT_HANDED</a>)</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                  dProfileWaveOrientation = dKeepWithin360(dAlpha + 90 + dFluxOrientationThis);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                  dProfileWaveOrientation = dKeepWithin360(dAlpha + 270 + dFluxOrientationThis);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;               <span class="comment">// Test to see if the wave breaks at this depth</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;               <span class="keywordflow">if</span> (dProfileWaveHeight &gt; (dSeaDepth * m_dBreakingWaveHeightDepthRatio))</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;               {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                  <span class="comment">// It does</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                  bBreaking = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                  dProfileBreakingWaveHeight = dProfileWaveHeight;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                  dProfileBreakingWaveOrientation = dProfileWaveOrientation;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                  dProfileBreakingDepth = dSeaDepth;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                  nProfileBreakingDist = nProfilePoint;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;               }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;               <span class="comment">// Wave has already broken</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;               dProfileWaveOrientation = dProfileBreakingWaveOrientation;                          <span class="comment">// Wave orientation remains equal to wave orientation at breaking</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;               <span class="comment">//dProfileWaveHeight = dProfileBreakingWaveHeight * (nProfilePoint / nProfileBreakingDist);    // Wave height decreases linearly to zero at shoreline</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;               dProfileWaveHeight = dSeaDepth * m_dBreakingWaveHeightDepthRatio;                    <span class="comment">// Wave height is limited by depth</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;         }</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;         <span class="comment">// Save current wave attributes</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;         VdWaveDirection[nProfilePoint] = dProfileWaveOrientation;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;         VdWaveHeight[nProfilePoint] = dProfileWaveHeight;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;         VbWaveIsBreaking[nProfilePoint] = bBreaking;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   }</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;   <span class="comment">// Go landwards along the profile, fetching the calculated wave height and wave angle for every inundated point on this profile</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfilePoint = (nProfileSize-1); nProfilePoint &gt; 0; nProfilePoint--)</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;         nX = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;         nY = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="comment">// Safety check</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="keywordflow">if</span> (! m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>())</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;         <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160; </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <span class="comment">// Fetch the wave attributes calculated for this profile: wave height, wave angle, and whether is in the active zone</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;         dWaveHeight = VdWaveHeight[nProfilePoint],</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;         dWaveOrientation = VdWaveDirection[nProfilePoint];</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      bBreaking = VbWaveIsBreaking[nProfilePoint];</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <span class="comment">// Update RasterGrid wave properties</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28847f89cc0d216f7f668d0d997837e1">SetInActiveZone</a>(bBreaking);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a213153422f9420825faafb87281e9f64">SetWaveHeight</a>(dWaveHeight);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#ae9f6bf560ede907f60849a6927000e4e">SetWaveOrientation</a>(dWaveOrientation);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160; </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="comment">// And store the wave properties for this point in the all-profiles vectors</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      pVnX-&gt;push_back(nX);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      pVnY-&gt;push_back(nY);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      pVdHeightX-&gt;push_back(dWaveHeight * sin(dWaveOrientation * <a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a>/180));</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      pVdHeightY-&gt;push_back(dWaveHeight * cos(dWaveOrientation * <a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a>/180));</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      pVbBreaking-&gt;push_back(bBreaking);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;   }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; </div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;   <span class="comment">// Update wave attributes along the coastline object. Wave height at the coast is always calculated (i.e. whether or not waves are breaking)</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160; </div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;   <span class="comment">//cout &lt;&lt; &quot;Wave Height at the coast is &quot; &lt;&lt; VdWaveHeight[0] &lt;&lt; endl;</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;   m_VCoast[nCoast].SetCoastWaveHeight(nCoastPoint, VdWaveHeight[0]);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;   <span class="keywordflow">if</span> (nProfileBreakingDist &gt; 0)</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;   {</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="comment">// This coast point is in the active zone, so set breaking wave height, breaking wave angle, and depth of breaking for the coast point</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      m_VCoast[nCoast].SetBreakingWaveHeight(nCoastPoint, dProfileBreakingWaveHeight);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      m_VCoast[nCoast].SetBreakingWaveOrientation(nCoastPoint, dProfileBreakingWaveOrientation);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      m_VCoast[nCoast].SetDepthOfBreaking(nCoastPoint, dProfileBreakingDepth);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      m_VCoast[nCoast].SetBreakingDistance(nCoastPoint, nProfileBreakingDist);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, nCoastPoint = &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; in active zone, dBreakingWaveHeight = &quot; &lt;&lt; dBreakingWaveHeight &lt;&lt; endl;</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;   }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;   {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="comment">// This coast point is not in the active zone, so breaking wave height, breaking wave angle, and depth of breaking are all meaningless</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      m_VCoast[nCoast].SetBreakingWaveHeight(nCoastPoint, <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      m_VCoast[nCoast].SetBreakingWaveOrientation(nCoastPoint, <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>);</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      m_VCoast[nCoast].SetDepthOfBreaking(nCoastPoint, <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      m_VCoast[nCoast].SetBreakingDistance(nCoastPoint, <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, nCoastPoint = &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; NOT in active zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;   }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;}</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160; </div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="preprocessor">#if defined CSHORE_FILE_INOUT</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment"> Create and write to the CShore input file</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="keywordtype">int</span> CSimulation::nCreateCShoreInfile(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfile, <span class="keywordtype">int</span> <span class="keyword">const</span> nILine, <span class="keywordtype">int</span> <span class="keyword">const</span> nIProfl, <span class="keywordtype">int</span> <span class="keyword">const</span> nIPerm, <span class="keywordtype">int</span> <span class="keyword">const</span> nIOver, <span class="keywordtype">int</span> <span class="keyword">const</span> nIWcint, <span class="keywordtype">int</span> <span class="keyword">const</span> nIRoll, <span class="keywordtype">int</span> <span class="keyword">const</span> nIWind, <span class="keywordtype">int</span> <span class="keyword">const</span> nITide, <span class="keywordtype">int</span> <span class="keyword">const</span> nILab, <span class="keywordtype">int</span> <span class="keyword">const</span> nWave, <span class="keywordtype">int</span> <span class="keyword">const</span> nSurge, <span class="keywordtype">double</span> <span class="keyword">const</span> dX, <span class="keywordtype">double</span> <span class="keyword">const</span> dTimestep, <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveInitTime, <span class="keywordtype">double</span> <span class="keyword">const</span> dWavePeriod, <span class="keywordtype">double</span> <span class="keyword">const</span> dHrms, <span class="keywordtype">double</span> <span class="keyword">const</span> dWaveAngle, <span class="keywordtype">double</span> <span class="keyword">const</span> dSurgeInitTime, <span class="keywordtype">double</span> <span class="keyword">const</span> dSurgeLevel, vector&lt;double&gt; <span class="keyword">const</span>* pVdXdist, vector&lt;double&gt; <span class="keyword">const</span>* pVdBottomElevation, vector&lt;double&gt; <span class="keyword">const</span>* pVdWaveFriction)</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;{</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;   <span class="comment">// Create the CShore input file</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   ofstream CShoreOutStream;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;   CShoreOutStream.open(<a class="code" href="cme_8h.html#a8082ddc5ffa1755ec8e009bd3314829d">CSHORE_INFILE</a>.c_str(), ios::out | ios::app);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="keywordflow">if</span> (CShoreOutStream.fail())</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <span class="comment">// Error, cannot open file for writing</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> &lt;&lt; <span class="stringliteral">&quot;cannot write to CShore input file &#39;&quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#a8082ddc5ffa1755ec8e009bd3314829d">CSHORE_INFILE</a> &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#aacea0bc2762691df36e6cb0c648ca82b">RTN_ERR_CSHORE_FILE_INPUT</a>;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   <span class="comment">// And write to the file</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   CShoreOutStream &lt;&lt; 3 &lt;&lt; endl;       <span class="comment">// Number of comment lines</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   CShoreOutStream &lt;&lt; <span class="stringliteral">&quot;------------------------------------------------------------&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   CShoreOutStream &lt;&lt; <span class="stringliteral">&quot;CShore input file created by CoastalME for iteration &quot;</span> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;, coast &quot;</span> &lt;&lt; nCoast &lt;&lt; <span class="stringliteral">&quot;, profile &quot;</span> &lt;&lt; nProfile &lt;&lt; endl;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;   CShoreOutStream &lt;&lt; <span class="stringliteral">&quot;------------------------------------------------------------&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;   CShoreOutStream &lt;&lt; nILine  &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; ILINE&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;   CShoreOutStream &lt;&lt; nIProfl &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IPROFL&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;   CShoreOutStream &lt;&lt; nIPerm  &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IPERM&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;   CShoreOutStream &lt;&lt; nIOver  &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IOVER&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;   CShoreOutStream &lt;&lt; nIWcint &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IWCINT&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;   CShoreOutStream &lt;&lt; nIRoll  &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IROLL&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;   CShoreOutStream &lt;&lt; nIWind  &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; IWIND&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;   CShoreOutStream &lt;&lt; nITide  &lt;&lt; <span class="stringliteral">&quot;                                         -&gt; ITIDE&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;   CShoreOutStream &lt;&lt; std::fixed;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(4) &lt;&lt; dX &lt;&lt; <span class="stringliteral">&quot;                               -&gt; DX&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; m_dBreakingWaveHeightDepthRatio &lt;&lt; <span class="stringliteral">&quot;                               -&gt; GAMMA&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; nILab  &lt;&lt; <span class="stringliteral">&quot;                               -&gt; ILAB&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; nWave  &lt;&lt; <span class="stringliteral">&quot;                               -&gt; NWAVE&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; nSurge &lt;&lt; <span class="stringliteral">&quot;                               -&gt; NSURGE&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160; </div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   <span class="comment">// Line 18 of infile</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(2) &lt;&lt; dWaveInitTime;        <span class="comment">// TWAVE(1) in CShore</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(4) &lt;&lt; dWavePeriod;          <span class="comment">// TPIN(1) in CShore</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; dHrms;                                   <span class="comment">// HRMS(1) in CShore</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; dWaveAngle &lt;&lt; endl;                      <span class="comment">// WANGIN(1) in CShore</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;   <span class="comment">// Line 19 of infile</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(2) &lt;&lt; dTimestep;            <span class="comment">// TWAVE(2) in CShore</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(4) &lt;&lt; dWavePeriod;          <span class="comment">// TPIN(2) in CShore</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; dHrms;                                   <span class="comment">// HRMS(2) in CShore</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; dWaveAngle &lt;&lt; endl;                      <span class="comment">// WANGIN(2) in CShore</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;   <span class="comment">// Line 20 of infile</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(2) &lt;&lt; dSurgeInitTime;       <span class="comment">// TSURG(1) in CShore</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(4) &lt;&lt; dSurgeLevel &lt;&lt; endl;  <span class="comment">// SWLIN(1) in CShore</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;   <span class="comment">// Line 21 of infile</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(2) &lt;&lt; dTimestep;            <span class="comment">// TSURG(2) in CShore</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   CShoreOutStream &lt;&lt; setw(11) &lt;&lt; setprecision(4) &lt;&lt; dSurgeLevel &lt;&lt; endl;  <span class="comment">// SWLIN(2) in CShore</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160; </div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;   <span class="comment">// Line 22 of infile</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;   CShoreOutStream &lt;&lt; setw(8) &lt;&lt; pVdXdist-&gt;size() &lt;&lt; <span class="stringliteral">&quot;                                  -&gt; NBINP&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160; </div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;   CShoreOutStream &lt;&lt; std::fixed &lt;&lt; setprecision(4);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; pVdXdist-&gt;size(); i++)</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="comment">// These are BINP(J,1), ZBINP(J,1), FBINP(J-1,1) in CShore</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      CShoreOutStream &lt;&lt; setw(11) &lt;&lt; pVdXdist-&gt;at(i) &lt;&lt; setw(11) &lt;&lt; pVdBottomElevation-&gt;at(i) &lt;&lt; setw(11) &lt;&lt; pVdWaveFriction-&gt;at(i) &lt;&lt; endl;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160; </div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;   CShoreOutStream &lt;&lt; endl;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;   <span class="comment">// File written, so close it</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;   CShoreOutStream.close();</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160; </div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;}</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160; </div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment"> Get profile horizontal distance and bottom elevation vectors in CShore units</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="keywordtype">int</span> CSimulation::nGetThisProfileElevationVectorsForCShore(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfile, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfSize, vector&lt;double&gt;* VdDistXY, vector&lt;double&gt;* VdVZ, vector&lt;double&gt;* VdFricF)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;{</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;   <span class="keywordtype">bool</span> bIsBehindIntervention = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160; </div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      nX1 = 0,</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      nY1 = 0;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      dXDist,</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      dYDist,</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      dProfileDistXY = 0,</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      dProfileFricFact = 0,</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      dPrevDist = -1;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160; </div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = nProfSize-1; i &gt;= 0; i--)</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;   {</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;         nX = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetX(),</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;         nY = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">pPtiVGetCellsInProfile</a>()-&gt;at(i).nGetY();</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <span class="comment">// Calculate the horizontal distance relative to the most seaward point</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="keywordflow">if</span> (i == nProfSize-1)</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;         dProfileDistXY = 0;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      {</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;         dXDist = dGridCentroidXToExtCRSX(nX1) - dGridCentroidXToExtCRSX(nX),</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;         dYDist = dGridCentroidYToExtCRSY(nY1) - dGridCentroidYToExtCRSY(nY),</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;         dProfileDistXY = dProfileDistXY + hypot(dXDist, dYDist);</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <span class="comment">// Update the cell indexes, the initial cell is now the previous one</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      nX1 = nX;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      nY1 = nY;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <span class="comment">// Get the number of the highest layer with non-zero thickness</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      <span class="keywordtype">int</span> <span class="keyword">const</span> nTopLayer = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a43434d6fd45da697ae17f7b274ba9a83">nGetTopNonZeroLayerAboveBasement</a>();</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160; </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <span class="comment">// Safety check</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <span class="keywordflow">if</span> (nTopLayer == <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#ac8de8e3c8f526683cf8a372e00bdcde3">RTN_ERR_NO_TOP_LAYER</a>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <span class="keywordflow">if</span> (nTopLayer == <a class="code" href="cme_8h.html#a6da5abe13cf250e9663012ef6633d92a">NO_NONZERO_THICKNESS_LAYERS</a>)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;         <span class="comment">// TODO We are down to basement, decide what to do</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160; </div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <span class="comment">// Get the elevation for both consolidated and unconsolidated sediment on this cell</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      <span class="keywordtype">double</span> VdProfileZ = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a6387aaac391af63a9f2be1c809ce169c">dGetSedimentTopElev</a>() - m_dThisTimestepSWL;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      VdVZ-&gt;push_back(VdProfileZ);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      <span class="comment">// Before we store the X-Y distance, must check that it is not the same as the previously-stored distance (if it is, we get zero-divide errors in CShore). If they are the same, skip this one</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <span class="keywordflow">if</span> (dProfileDistXY == dPrevDist) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      <span class="comment">// Now store the X-Y plane distance from the start of the profile</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      VdDistXY-&gt;push_back(dProfileDistXY);</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      <span class="comment">// Get the landform type at each point along the profile</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      <span class="keywordtype">double</span> dInterventionHeight = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a6d9ce76438644be9fe4aa5b4f7efea3e">dGetInterventionHeight</a>();</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160; </div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      <span class="comment">// Modify default friction factor if a structural intervention is found, otherwise use the default</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <span class="keywordflow">if</span> (dInterventionHeight &gt; 0 || bIsBehindIntervention)</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      {</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;         <span class="comment">// Use an arbitrarily high value if structure is present</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;         dProfileFricFact = 100 * <a class="code" href="cme_8h.html#adb91e1fabae5900fb39988f61b6c1f27">CSHORE_FRICTION_FACTOR</a>;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;         bIsBehindIntervention = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      }</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;         dProfileFricFact = <a class="code" href="cme_8h.html#adb91e1fabae5900fb39988f61b6c1f27">CSHORE_FRICTION_FACTOR</a>;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="comment">// Store the friction factor</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      VdFricF-&gt;push_back(dProfileFricFact);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160; </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <span class="comment">// For next time round</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      dPrevDist = dProfileDistXY;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;   }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160; </div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;}</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160; </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="preprocessor">#if defined CSHORE_FILE_INOUT</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment"> Reads a CShore output file and creates a vector holding interpolated values. The interpolation may be simple linear or a more advanced hermite cubic method</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="keywordtype">int</span> CSimulation::nReadCShoreOutput(<span class="keywordtype">int</span> <span class="keyword">const</span> nProfile, <span class="keywordtype">string</span> <span class="keyword">const</span>* strCShoreFilename, <span class="keywordtype">int</span> <span class="keyword">const</span> nExpectedColumns, <span class="keywordtype">int</span> <span class="keyword">const</span> nCShorecolumn, vector&lt;double&gt; <span class="keyword">const</span>* pVdProfileDistXYCME, vector&lt;double&gt;* pVdInterpolatedValues)</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;{</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;   <span class="comment">// Select the interpolation method to be used: CSHORE_INTERPOLATION_HERMITE_CUBIC seems to work better generally</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">//    int nInterpolationMethod = CSHORE_INTERPOLATION_LINEAR;</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;   <span class="keywordtype">int</span> nInterpolationMethod = <a class="code" href="cme_8h.html#adc0fbf157c5dddb28478ff147e74dbd4">CSHORE_INTERPOLATION_HERMITE_CUBIC</a>;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160; </div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;   <span class="comment">// Read in the first column (contains XY distance relative to seaward limit) and CShore column from the CShore output file</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;   ifstream InStream;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;   InStream.open(strCShoreFilename-&gt;c_str(), ios::in);</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;   <span class="comment">// Did it open OK?</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;   <span class="keywordflow">if</span> (! InStream.is_open())</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;   {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="comment">// Error: cannot open CShore file for input</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> &lt;&lt; <span class="stringliteral">&quot;for profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot;, cannot open &quot;</span> &lt;&lt; *strCShoreFilename &lt;&lt; <span class="stringliteral">&quot; for input&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160; </div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a98446ed820d505727dfc35190f492ebf">RTN_ERR_READING_CSHORE_FILE_OUTPUT</a>;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;   }</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;   <span class="comment">// Opened OK, so set up the vectors to hold the CShore output data</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      VdXYDistCShore,</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      VdValuesCShore;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;   <span class="comment">// And read in the data</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      n = -1,</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      nExpectedRows = 0;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;   <span class="keywordtype">string</span> strLineIn;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;   <span class="keywordflow">while</span> (getline(InStream, strLineIn))</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;   {</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      n++;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160; </div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      <span class="keywordflow">if</span> (n == 0)</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      {</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;         <span class="comment">// Read in the header line</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;         vector&lt;string&gt; VstrItems = VstrSplit(&amp;strLineIn, <a class="code" href="cme_8h.html#a53b090bafe453cf12513e68d0fe1eb37">SPACE</a>);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;         <span class="keywordflow">if</span> (! <a class="code" href="utils__global_8cpp.html#a1432a707917cd3a9582796679f4d583f">bIsStringValidInt</a>(VstrItems[1]))</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;         {</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            <span class="keywordtype">string</span> strErr = <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> + <span class="stringliteral">&quot;invalid integer for number of expected rows &#39;&quot;</span> + VstrItems[1] + <span class="stringliteral">&quot;&#39; in &quot;</span> + *strCShoreFilename + <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;            cerr &lt;&lt; strErr;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;            <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; strErr;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160; </div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a98446ed820d505727dfc35190f492ebf">RTN_ERR_READING_CSHORE_FILE_OUTPUT</a>;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;         }</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160; </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;         <span class="comment">// Get the number of expected rows</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;         nExpectedRows = stoi(VstrItems[1]);</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      }</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      {</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;         <span class="comment">// Read in a data line</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;         vector&lt;string&gt; VstrItems = VstrSplit(&amp;strLineIn, <a class="code" href="cme_8h.html#a53b090bafe453cf12513e68d0fe1eb37">SPACE</a>);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160; </div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;         <span class="keywordtype">int</span> nCols = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VstrItems.size());</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;         <span class="keywordflow">if</span> (nCols != nExpectedColumns)</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;         {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            <span class="comment">// Error: did not read the expected number of CShore output columns</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> &lt;&lt; <span class="stringliteral">&quot;for profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot;, expected &quot;</span> &lt;&lt; nExpectedColumns &lt;&lt; <span class="stringliteral">&quot; CShore output columns but read &quot;</span> &lt;&lt; nCols &lt;&lt; <span class="stringliteral">&quot; columns from header section of file &quot;</span> &lt;&lt; *strCShoreFilename &lt;&lt; endl;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160; </div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a98446ed820d505727dfc35190f492ebf">RTN_ERR_READING_CSHORE_FILE_OUTPUT</a>;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;         }</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160; </div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;         <span class="comment">// Number of columns is OK</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;         VdXYDistCShore.push_back(strtod(VstrItems[0].c_str(), NULL));</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;         VdValuesCShore.push_back(strtod(VstrItems[nCShorecolumn-1].c_str(), NULL));</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      }</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160; </div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;   <span class="comment">// Check that we have read nExpectedRows from the file</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;   <span class="keywordtype">int</span> nReadRows = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VdXYDistCShore.size());</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;   <span class="keywordflow">if</span> (nReadRows != nExpectedRows)</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;   {</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="comment">// Error: did not get nExpectedRows CShore output rows</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a> &lt;&lt; <span class="stringliteral">&quot;for profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot;, expected &quot;</span> &lt;&lt; nExpectedRows &lt;&lt; <span class="stringliteral">&quot; CShore output rows, but read &quot;</span> &lt;&lt; nReadRows &lt;&lt; <span class="stringliteral">&quot; rows from file &quot;</span> &lt;&lt; *strCShoreFilename &lt;&lt; endl;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a98446ed820d505727dfc35190f492ebf">RTN_ERR_READING_CSHORE_FILE_OUTPUT</a>;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   }</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160; </div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;   <span class="keywordflow">if</span> (nReadRows &lt; 2)</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;   {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      <span class="comment">// CShore sometimes returns only one row, which contains data for the seaward point of the profile. This happens when all other (more coastward) points give an invalid result during CShore&#39;s calculations. This is a problem. We don&#39;t want to abandon the simulation just because of this, so instead we just duplicate the row, so that the profile will later get marked as invalid</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <a class="code" href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">LogStream</a> &lt;&lt; m_ulIter &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="cme_8h.html#aefc63c4bde02ca170b0e7bd038ba7702">WARN</a> &lt;&lt; <span class="stringliteral">&quot;for profile &quot;</span> &lt;&lt; nProfile &lt;&lt; <span class="stringliteral">&quot;, only &quot;</span> &lt;&lt; nReadRows &lt;&lt; <span class="stringliteral">&quot; CShore output rows in file &quot;</span> &lt;&lt; *strCShoreFilename &lt;&lt; endl;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160; </div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      <span class="comment">// Duplicate the data</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      VdXYDistCShore.push_back(VdXYDistCShore[0]);</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      VdValuesCShore.push_back(VdValuesCShore[0]);</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      <span class="comment">// And increase the expected number of rows</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      nReadRows++;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;   }</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;   <span class="comment">// The output is OK, so change the origin of the across-shore distance from the CShore convention to the one used here (i.e. with the origin at the shoreline)</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;   vector&lt;double&gt; VdXYDistCShoreTmp(nReadRows, 0);</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nReadRows; i++)</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      VdXYDistCShoreTmp[i] = VdXYDistCShore[nReadRows-1] - VdXYDistCShore[i];</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;   <span class="comment">// Reverse the XY-distance and value vectors (i.e. first point is at the shoreline and must be in strictly ascending order)</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;   reverse(VdXYDistCShoreTmp.begin(), VdXYDistCShoreTmp.end());</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; </div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;   <span class="comment">// Similarly, reverse the CShore output</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;   reverse(VdValuesCShore.begin(), VdValuesCShore.end());</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;   <span class="comment">// Now we have everything ready to do the interpolation</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   <span class="keywordflow">if</span> (nInterpolationMethod == <a class="code" href="cme_8h.html#adc0fbf157c5dddb28478ff147e74dbd4">CSHORE_INTERPOLATION_HERMITE_CUBIC</a>)</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   {</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      CShoreHermiteSmoothing(nReadRows, &amp;VdXYDistCShoreTmp, pVdProfileDistXYCME, &amp;VdValuesCShore, pVdInterpolatedValues);</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   }</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;   {</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      <span class="comment">// Using the simple linear approach</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      vector&lt;double&gt; VdDistXYCopy(pVdProfileDistXYCME-&gt;begin(), pVdProfileDistXYCME-&gt;end());</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160; </div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      *pVdInterpolatedValues = <a class="code" href="linearinterp_8cpp.html#a296bcc297041de33c969a50dc0c63f86">VdInterp1</a>(&amp;VdXYDistCShoreTmp, &amp;VdValuesCShore, &amp;VdDistXYCopy);</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;   }</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160; </div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a>;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;}</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160; </div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160; </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="preprocessor">#if defined CSHORE_ARG_INOUT || CSHORE_BOTH</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment"> Interpolates CShore output. The interpolation may be simple linear or a more advanced hermite cubic method</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="keywordtype">void</span> CSimulation::InterpolateCShoreOutput(vector&lt;double&gt; <span class="keyword">const</span>* pVdProfileDistXYCME, <span class="keywordtype">int</span> <span class="keyword">const</span> nOutSize, vector&lt;double&gt; <span class="keyword">const</span>* pVdXYDistFromCShoreOut, vector&lt;double&gt; <span class="keyword">const</span>* pVdFreeSurfaceStdCShore, vector&lt;double&gt; <span class="keyword">const</span>* pVdSinWaveAngleRadiansCShore, vector&lt;double&gt; <span class="keyword">const</span>* pVdFractionBreakingWavesCShore, vector&lt;double&gt;* pVdFreeSurfaceStdCME, vector&lt;double&gt;* pVdSinWaveAngleRadiansCME, vector&lt;double&gt;* pVdFractionBreakingWavesCME)</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;{</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;   <span class="comment">// Select the interpolation method to be used: CSHORE_INTERPOLATION_HERMITE_CUBIC seems to work better for spit growth</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;   <span class="comment">//    int nInterpolationMethod = CSHORE_INTERPOLATION_LINEAR;</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   <span class="keywordtype">int</span> nInterpolationMethod = <a class="code" href="cme_8h.html#adc0fbf157c5dddb28478ff147e74dbd4">CSHORE_INTERPOLATION_HERMITE_CUBIC</a>;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160; </div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;   <span class="comment">// The CShore cross-shore distance has its origin at the seaward end, so create a copy of the valid part of this which is in the CME convention (i.e. with the origin at the shoreline)</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   vector&lt;double&gt; VdXYDistCShoreTmp(nOutSize, 0);</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nOutSize; i++)</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      VdXYDistCShoreTmp[i] = pVdXYDistFromCShoreOut-&gt;at(nOutSize-1) - pVdXYDistFromCShoreOut-&gt;at(i);</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160; </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;   <span class="comment">// And then reverse this, so that the first point is at the shoreline</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;   reverse(VdXYDistCShoreTmp.begin(), VdXYDistCShoreTmp.end());</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160; </div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   <span class="comment">// Now create reversed copies of the valid part of the other CShore outputs</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      VdFreeSurfaceStdCShoreTmp(pVdFreeSurfaceStdCShore-&gt;begin(), pVdFreeSurfaceStdCShore-&gt;begin() + nOutSize),</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      VdSinWaveAngleRadiansCShoreTmp(pVdSinWaveAngleRadiansCShore-&gt;begin(), pVdSinWaveAngleRadiansCShore-&gt;begin() + nOutSize),</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      VdFractionBreakingWavesCShoreTmp(pVdFractionBreakingWavesCShore-&gt;begin(), pVdFractionBreakingWavesCShore-&gt;begin() + nOutSize);</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;   reverse(VdFreeSurfaceStdCShoreTmp.begin(), VdFreeSurfaceStdCShoreTmp.end());</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;   reverse(VdSinWaveAngleRadiansCShoreTmp.begin(), VdSinWaveAngleRadiansCShoreTmp.end());</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;   reverse(VdFractionBreakingWavesCShoreTmp.begin(), VdFractionBreakingWavesCShoreTmp.end());</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160; </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;   <span class="comment">// Now we have everything ready to do the interpolation</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;   <span class="keywordflow">if</span> (nInterpolationMethod == <a class="code" href="cme_8h.html#adc0fbf157c5dddb28478ff147e74dbd4">CSHORE_INTERPOLATION_HERMITE_CUBIC</a>)</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;   {</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      CShoreHermiteSmoothing(nOutSize, &amp;VdXYDistCShoreTmp, pVdProfileDistXYCME, &amp;VdFreeSurfaceStdCShoreTmp, pVdFreeSurfaceStdCME);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      CShoreHermiteSmoothing(nOutSize, &amp;VdXYDistCShoreTmp, pVdProfileDistXYCME, &amp;VdSinWaveAngleRadiansCShoreTmp, pVdSinWaveAngleRadiansCME);</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      CShoreHermiteSmoothing(nOutSize, &amp;VdXYDistCShoreTmp, pVdProfileDistXYCME, &amp;VdFractionBreakingWavesCShoreTmp, pVdFractionBreakingWavesCME);</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;   }</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;   {</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="comment">// Using the simple linear approach</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      vector&lt;double&gt; VdDistXYCopy(pVdProfileDistXYCME-&gt;begin(), pVdProfileDistXYCME-&gt;end());</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160; </div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      *pVdFreeSurfaceStdCME = <a class="code" href="linearinterp_8cpp.html#a296bcc297041de33c969a50dc0c63f86">VdInterp1</a>(&amp;VdXYDistCShoreTmp, pVdFreeSurfaceStdCShore, &amp;VdDistXYCopy);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      *pVdSinWaveAngleRadiansCME = <a class="code" href="linearinterp_8cpp.html#a296bcc297041de33c969a50dc0c63f86">VdInterp1</a>(&amp;VdXYDistCShoreTmp, pVdSinWaveAngleRadiansCShore, &amp;VdDistXYCopy);</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      *pVdFractionBreakingWavesCME = <a class="code" href="linearinterp_8cpp.html#a296bcc297041de33c969a50dc0c63f86">VdInterp1</a>(&amp;VdXYDistCShoreTmp, pVdFractionBreakingWavesCShore, &amp;VdDistXYCopy);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;   }</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;}</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160; </div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160; </div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160; </div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">/*==============================================================================================================================</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment"> Does the hermite cubic smoothing of a CShore output vector</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">==============================================================================================================================*/</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="keywordtype">void</span> CSimulation::CShoreHermiteSmoothing(<span class="keywordtype">int</span> <span class="keyword">const</span> nOutSize, vector&lt;double&gt; <span class="keyword">const</span>* pVdXYDistFromCShoreOut, vector&lt;double&gt; <span class="keyword">const</span>* pVdProfileDistXYCME, vector&lt;double&gt; <span class="keyword">const</span>* pVdValuesCShore, vector&lt;double&gt;* pVdInterpolatedValues)</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;{</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;   <span class="comment">// Calculate the first derivative of CShore values (needed for the hermite interpolant)</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;   vector&lt;double&gt; VdValuesCShoreDeriv(nOutSize, 0);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; nOutSize-1; i++)</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;   {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <span class="comment">// Calculate the horizontal distance increment between two adjacent points (not always the same distance because it depend on profile-cells centroid location)</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <span class="keywordtype">double</span> dX = pVdXYDistFromCShoreOut-&gt;at(i+1) - pVdXYDistFromCShoreOut-&gt;at(i-1);    <span class="comment">// This is always positive</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      VdValuesCShoreDeriv[i] = (pVdValuesCShore-&gt;at(i+1) - pVdValuesCShore-&gt;at(i-1)) / (2 * dX);</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;   }</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160; </div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;   <span class="comment">// Sort out the values at the beginning and end of the array</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;   VdValuesCShoreDeriv[0] = VdValuesCShoreDeriv[1];</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;   VdValuesCShoreDeriv[nOutSize-1] = VdValuesCShoreDeriv[nOutSize-2];</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160; </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;   <span class="comment">// Interpolate the CShore values OK</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;   <span class="keywordtype">int</span> nSize = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(pVdProfileDistXYCME-&gt;size());</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      VdDistXYCopy(pVdProfileDistXYCME-&gt;begin(), pVdProfileDistXYCME-&gt;end()),</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      <span class="comment">//dVInter(nSize, 0.),</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      VdDeriv(nSize, 0),         <span class="comment">// First derivative at the sample points: calculated by the spline function but not subsequently used</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;      VdDeriv2(nSize, 0),        <span class="comment">// Second derivative at the sample points, ditto</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      VdDeriv3(nSize, 0);        <span class="comment">// Third derivative at the sample points, ditto</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160; </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;   <span class="comment">// Do the smoothing</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <a class="code" href="hermite__cubic_8cpp.html#ad696aa5baaf487b32cc0c3afdecd2b4b">hermite_cubic_spline_value</a>(nOutSize, &amp;(<span class="keyword">const_cast&lt;</span><span class="keywordtype">double</span>&amp;<span class="keyword">&gt;</span>(pVdXYDistFromCShoreOut-&gt;at(0))), &amp;(<span class="keyword">const_cast&lt;</span><span class="keywordtype">double</span>&amp;<span class="keyword">&gt;</span>(pVdValuesCShore-&gt;at(0))), &amp;(VdValuesCShoreDeriv.at(0)), nSize, &amp;(VdDistXYCopy[0]), &amp;(pVdInterpolatedValues-&gt;at(0)), &amp;(VdDeriv[0]), &amp;(VdDeriv2[0]), &amp;(VdDeriv3[0]));</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;}</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160; </div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160; </div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment"> Modifies the wave breaking properties at coastline points of profiles within the shadow zone</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="keywordtype">void</span> CSimulation::ModifyBreakingWavePropertiesWithinShadowZoneToCoastline(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfIndex)</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;{</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;   <span class="keywordtype">int</span> nProfile = m_VCoast[nCoast].nGetProfileFromAlongCoastProfileIndex(nProfIndex);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160; </div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;   <span class="comment">// Only do this for profiles without problems, including the start and end-of-coast profile</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;   <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code" href="class_c_geom_profile.html#aac223e2610d50ca2c7eadaf8542e9498">bOKIncStartAndEndOfCoast</a>())</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160; </div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;   <span class="keywordtype">int</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      nThisCoastPoint = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a0aead517e2105d6c1a14c27126b1fe92">nGetNumCoastPoint</a>(),</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      nProfileSize = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">nGetNumCellsInProfile</a>();</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160; </div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;   <span class="keywordtype">int</span> nThisBreakingDist = m_VCoast[nCoast].nGetBreakingDistance(nThisCoastPoint);</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      dThisBreakingWaveHeight = m_VCoast[nCoast].dGetBreakingWaveHeight(nThisCoastPoint),       <span class="comment">// This could be DBL_NODATA</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      dThisBreakingWaveOrientation = m_VCoast[nCoast].dGetBreakingWaveOrientation(nThisCoastPoint),</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      dThisBreakingDepth = m_VCoast[nCoast].dGetDepthOfBreaking(nThisCoastPoint);</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;   <span class="keywordtype">bool</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      bModfiedWaveHeightisBreaking = <span class="keyword">false</span>,</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      bProfileIsinShadowZone = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160; </div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;   <span class="comment">// Traverse the profile landwards, checking if any profile cell is within the shadow zone</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nProfilePoint = (nProfileSize-1); nProfilePoint &gt;= 0; nProfilePoint--)</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;   {</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <span class="keywordtype">int</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;         nX = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code" href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">nGetX</a>(),</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;         nY = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a6d13079f744085f2d132405e0120ca54">pPtiGetCellInProfile</a>(nProfilePoint)-&gt;<a class="code" href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">nGetY</a>();</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160; </div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;      <span class="comment">// If there is any cell profile  within the shadow zone and waves are breaking then modify wave breaking properties otherwise continue</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a164c51a1e98183be0e8fd5513eea496f">bIsinAnyShadowZone</a>())</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;      {</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;         bProfileIsinShadowZone = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160; </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;         <span class="comment">// Check if the new wave height is breaking</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            dSeaDepth = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a3a378431e2f6095792582989f50fb435">dGetSeaDepth</a>(),</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;            dWaveHeight = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a770135e779cf4e4d74c9e78f19429d3c">dGetWaveHeight</a>(),</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;            dWaveOrientation = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a8577263897fb809e3b9bb4e39f16c16e">dGetWaveOrientation</a>();</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160; </div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;         <span class="keywordflow">if</span> (dWaveHeight &gt; (dSeaDepth * m_dBreakingWaveHeightDepthRatio) &amp;&amp; (! bModfiedWaveHeightisBreaking))</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;         {</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            <span class="comment">// It is breaking</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            bModfiedWaveHeightisBreaking = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160; </div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            dThisBreakingWaveHeight = dWaveHeight;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;            dThisBreakingWaveOrientation = dWaveOrientation;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;            dThisBreakingDepth = dSeaDepth;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            nThisBreakingDist = nProfilePoint;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;         }</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      }</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;   }</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160; </div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;   <span class="comment">// Update breaking wave properties along coastal line object (Wave height, dir, distance). TODO update the active zone cells</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;   <span class="keywordflow">if</span> (bProfileIsinShadowZone &amp;&amp; bModfiedWaveHeightisBreaking) <span class="comment">// Modified wave height is still breaking</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;   {</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      <span class="comment">// This coast point is in the active zone, so set breaking wave height, breaking wave angle, and depth of breaking for the coast point</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      m_VCoast[nCoast].SetBreakingWaveHeight(nThisCoastPoint, dThisBreakingWaveHeight);</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      m_VCoast[nCoast].SetBreakingWaveOrientation(nThisCoastPoint, dThisBreakingWaveOrientation);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;      m_VCoast[nCoast].SetDepthOfBreaking(nThisCoastPoint, dThisBreakingDepth);</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      m_VCoast[nCoast].SetBreakingDistance(nThisCoastPoint, nThisBreakingDist);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160; </div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      <span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, nCoastPoint = &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; in active zone, dBreakingWaveHeight = &quot; &lt;&lt; dBreakingWaveHeight &lt;&lt; endl;</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;   }</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;   <span class="comment">/*else if (bProfileIsinShadowZone &amp;&amp; !bModfiedWaveHeightisBreaking)</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment">    *   {</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">    *      // This coast point is no longer in the active zone</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">    *      m_VCoast[nCoast].SetBreakingWaveHeight(nThisCoastPoint, DBL_NODATA);</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment">    *      m_VCoast[nCoast].SetBreakingWaveOrientation(nThisCoastPoint, DBL_NODATA);</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">    *      m_VCoast[nCoast].SetDepthOfBreaking(nThisCoastPoint, DBL_NODATA);</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment">    *      m_VCoast[nCoast].SetBreakingDistance(nThisCoastPoint, INT_NODATA);</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">    *</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">    * //       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nProfile = &quot; &lt;&lt; nProfile &lt;&lt; &quot;, nCoastPoint = &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; NOT in active zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">}*/</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160; </div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;   <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;}</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160; </div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160; </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment"> Interpolates wave properties from profiles to the coastline points between two profiles. Do this by weighting the wave properties so that they change smoothly between the two profiles</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="keywordtype">void</span> CSimulation::InterpolateWavePropertiesToCoastline(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast, <span class="keywordtype">int</span> <span class="keyword">const</span> nProfIndex, <span class="keywordtype">int</span> <span class="keyword">const</span> nNumProfiles)</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;{</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;   <span class="keywordtype">int</span> nProfile = m_VCoast[nCoast].nGetProfileFromAlongCoastProfileIndex(nProfIndex);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;   <a class="code" href="class_c_geom_profile.html">CGeomProfile</a>* pProfile = m_VCoast[nCoast].pGetProfile(nProfile);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160; </div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;   <span class="comment">// Only do this for profiles without problems, including the start-of-coast profile (but not the end-of-coast profile)</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;   <span class="keywordflow">if</span> (! pProfile-&gt;<a class="code" href="class_c_geom_profile.html#ac35bb7a0e72a3e84ce89c6ea1de4e38d">bOKIncStartOfCoast</a>())</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160; </div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;   <span class="keywordtype">int</span> nThisCoastPoint = pProfile-&gt;<a class="code" href="class_c_geom_profile.html#a0aead517e2105d6c1a14c27126b1fe92">nGetNumCoastPoint</a>();</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160; </div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;   <span class="comment">// For the breaking wave stuff, to go into the in-between coastline points</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;   <span class="keywordtype">int</span> <span class="keyword">const</span> nThisBreakingDist = m_VCoast[nCoast].nGetBreakingDistance(nThisCoastPoint);</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      dThisBreakingWaveHeight = m_VCoast[nCoast].dGetBreakingWaveHeight(nThisCoastPoint),       <span class="comment">// This could be DBL_NODATA</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      dThisBreakingWaveOrientation = m_VCoast[nCoast].dGetBreakingWaveOrientation(nThisCoastPoint),</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      dThisBreakingDepth = m_VCoast[nCoast].dGetDepthOfBreaking(nThisCoastPoint);</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160; </div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;   <span class="comment">// Get the number of the next profile along the coast. If this next profile has a problem, go to the one after that, etc</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;   <span class="keywordtype">int</span> nNextProfile = -1;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nNextProfIndex = nProfIndex+1; nNextProfIndex &lt; nNumProfiles; nNextProfIndex++)</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;   {</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      nNextProfile = m_VCoast[nCoast].nGetProfileFromAlongCoastProfileIndex(nNextProfIndex);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160; </div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      <span class="keywordflow">if</span> (m_VCoast[nCoast].pGetProfile(nNextProfile)-&gt;bOKIncStartAndEndOfCoast())</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;   }</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160; </div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;   <span class="keywordtype">int</span> <span class="keyword">const</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      nNextCoastPoint = m_VCoast[nCoast].pGetProfile(nNextProfile)-&gt;nGetNumCoastPoint(),</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      nDistBetween = nNextCoastPoint - nThisCoastPoint - 1;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160; </div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;   <span class="keywordflow">if</span> (nDistBetween &lt;= 0)</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      <span class="comment">// Nothing to do</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160; </div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;   <span class="keywordtype">int</span> nNextBreakingDist = m_VCoast[nCoast].nGetBreakingDistance(nNextCoastPoint);</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;   <span class="keywordtype">double</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      dNextBreakingWaveHeight = m_VCoast[nCoast].dGetBreakingWaveHeight(nNextCoastPoint),          <span class="comment">// This could be DBL_NODATA</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      dNextBreakingWaveOrientation = m_VCoast[nCoast].dGetBreakingWaveOrientation(nNextCoastPoint),</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      dNextBreakingDepth = m_VCoast[nCoast].dGetDepthOfBreaking(nNextCoastPoint);</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160; </div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;   <span class="comment">// If both this profile and the next profile are not in the active zone, then do no more</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;   <span class="keywordflow">if</span> ((dThisBreakingWaveHeight == <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>) &amp;&amp; (dNextBreakingWaveHeight == <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>))</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;   {</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">//       LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: both profile &quot; &lt;&lt; nProfile &lt;&lt; &quot; at coast point &quot; &lt;&lt; nThisCoastPoint &lt;&lt; &quot;, and profile &quot; &lt;&lt; nNextProfile &lt;&lt; &quot; at coast point &quot; &lt;&lt; nNextCoastPoint &lt;&lt; &quot;, are not in the active zone&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;   }</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160; </div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;   <span class="comment">// OK, at least one of the two profiles is in the active zone</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;   <span class="keywordflow">if</span> (dThisBreakingWaveHeight == <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>)</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;   {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="comment">// The next profile must be in the active zone, so use values from the next profile</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nThisCoastPoint; n &lt; nNextCoastPoint; n++)</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      {</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;         <span class="comment">// Set the breaking wave height, breaking wave angle, and depth of breaking for this coast point</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;         m_VCoast[nCoast].SetBreakingWaveHeight(n, dNextBreakingWaveHeight);</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;         m_VCoast[nCoast].SetBreakingWaveOrientation(n, dNextBreakingWaveOrientation);</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;         m_VCoast[nCoast].SetDepthOfBreaking(n, dNextBreakingDepth);</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;         m_VCoast[nCoast].SetBreakingDistance(n, nNextBreakingDist);</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      }</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160; </div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;   }</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160; </div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;   <span class="keywordflow">if</span> (dNextBreakingWaveHeight == <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>)</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;   {</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="comment">// This profile must be in the active zone, so use values from this profile</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nThisCoastPoint+1; n &lt;= nNextCoastPoint; n++)</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      {</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;         <span class="comment">// Set the breaking wave height, breaking wave angle, and depth of breaking for this coast point</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;         m_VCoast[nCoast].SetBreakingWaveHeight(n, dThisBreakingWaveHeight);</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;         m_VCoast[nCoast].SetBreakingWaveOrientation(n, dThisBreakingWaveOrientation);</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;         m_VCoast[nCoast].SetDepthOfBreaking(n, dThisBreakingDepth);</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;         m_VCoast[nCoast].SetBreakingDistance(n, nThisBreakingDist);</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      }</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;   }</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160; </div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;   <span class="comment">// The values for both this profile point and the next profile point are fine, so do a weighted interpolation between this profile and the next profile</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = nThisCoastPoint+1; n &lt; nNextCoastPoint; n++)</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;   {</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      <span class="keywordtype">int</span> nDist = n - nThisCoastPoint;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160; </div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;         dBreakingWaveHeight = 0,</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;         dBreakingWaveOrientation = 0,</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;         dBreakingDepth = 0,</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;         dBreakingDist = 0;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160; </div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      <span class="keywordflow">if</span> ((dNextBreakingDepth &gt; 0) &amp;&amp; (dThisBreakingDepth &gt; 0))</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      {</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;         <span class="keywordtype">double</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            dThisWeight = (nDistBetween - nDist) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(nDistBetween),</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;            dNextWeight = 1 - dThisWeight;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160; </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment">//          assert(dThisWeight &gt;= 0);</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">//          assert(dNextWeight &gt;= 0);</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160; </div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;         dBreakingWaveHeight = (dThisWeight * dThisBreakingWaveHeight) + (dNextWeight * dNextBreakingWaveHeight),</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;         dBreakingWaveOrientation = (dThisWeight * dThisBreakingWaveOrientation) + (dNextWeight * dNextBreakingWaveOrientation),</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;         dBreakingDepth = (dThisWeight * dThisBreakingDepth) + (dNextWeight * dNextBreakingDepth),</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;         dBreakingDist = (dThisWeight * nThisBreakingDist) + (dNextWeight * nNextBreakingDist);</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      }</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dThisBreakingDepth &gt; 0)</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      {</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;         dBreakingWaveHeight = dNextBreakingWaveHeight,</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;         dBreakingWaveOrientation = dNextBreakingWaveOrientation,</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;         dBreakingDepth = dNextBreakingDepth,</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;         dBreakingDist = nNextBreakingDist;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;      }</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dNextBreakingDepth &gt; 0)</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;      {</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;         dBreakingWaveHeight = dThisBreakingWaveHeight,</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;         dBreakingWaveOrientation = dThisBreakingWaveOrientation,</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;         dBreakingDepth = dThisBreakingDepth,</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;         dBreakingDist = nThisBreakingDist;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      }</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160; </div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160; </div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      <span class="comment">// Set the breaking wave height, breaking wave angle, and depth of breaking for this coast point</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      m_VCoast[nCoast].SetBreakingWaveHeight(n, dBreakingWaveHeight);</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      m_VCoast[nCoast].SetBreakingWaveOrientation(n, dBreakingWaveOrientation);</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      m_VCoast[nCoast].SetDepthOfBreaking(n, dBreakingDepth);</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      m_VCoast[nCoast].SetBreakingDistance(n, <a class="code" href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a>(dBreakingDist));</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;   }</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;}</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160; </div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160; </div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment"> Interpolates wave properties from profiles to the coastline cells between two profiles.</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment"> Do this by linear interpolation between profiles</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="keywordtype">void</span> CSimulation::InterpolateWavePropertiesToCoastlineCells(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast)</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;{</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;   <span class="keywordtype">int</span> nCoastPoints = m_VCoast[nCoast].nGetCoastlineSize();</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160; </div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;   <span class="comment">// Initialize all vectors pairs (x,y) for each variable</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;   vector&lt;int&gt;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      nVCoastWaveHeightX;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;   vector&lt;double&gt;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      dVCoastWaveHeightY;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160; </div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160; </div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;   <span class="comment">// Search all coast points for non NAN values and store them into temporary variables for later interporlation</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; nCoastPoints; n++)</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    {</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;       <span class="keywordtype">double</span> dCoastWaveHeight = m_VCoast[nCoast].dGetCoastWaveHeight(n);</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160; </div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;       <span class="keywordflow">if</span>(dCoastWaveHeight!= <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>)</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;       {</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    nVCoastWaveHeightX.push_back(n);</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    dVCoastWaveHeightY.push_back(dCoastWaveHeight);</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;       }</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;     }</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160; </div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;   <span class="comment">// Interpolate all coast points. Check first that x,y have more than 3 points and are both of equal size</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;   <span class="keywordflow">if</span>((nVCoastWaveHeightX.size() &gt;= 3) &amp;&amp; (nVCoastWaveHeightX.size() == dVCoastWaveHeightY.size()))</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;   {</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n = 0; n &lt; nCoastPoints; n++)</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;     <span class="keywordtype">double</span> dInterpCoastWaveHeight = <a class="code" href="interpolate_8cpp.html#a1b021853eedf579935a6bd2bfe054961">interpolate</a>( nVCoastWaveHeightX, dVCoastWaveHeightY, n, <span class="keyword">false</span> );</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;     m_VCoast[nCoast].SetCoastWaveHeight(n,dInterpCoastWaveHeight);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      }</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;   }</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160; </div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;}</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160; </div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment"> Calculates tangents to a coastline: the tangent is assumed to be the orientation of energy/sediment flux along a coast. The tangent is specified as an angle (in degrees) measured clockwise from north. Based on a routine by Martin Hurst</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="keywordtype">void</span> CSimulation::CalcCoastTangents(<span class="keywordtype">int</span> <span class="keyword">const</span> nCoast)</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;{</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;   <span class="keywordtype">int</span> nCoastSize = m_VCoast[nCoast].nGetCoastlineSize();</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160; </div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoastPoint = 0; nCoastPoint &lt; nCoastSize; nCoastPoint++)</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;   {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      <span class="keywordtype">double</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;         dXDiff,</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;         dYDiff;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160; </div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      <span class="keywordflow">if</span> (nCoastPoint == 0)</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      {</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;         <span class="comment">// For the point at the start of the coastline: use the straight line from &#39;this&#39; point to the next point</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;         <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtThis = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint);              <span class="comment">// In external CRS</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;         <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtAfter = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint+1);           <span class="comment">// In external CRS</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160; </div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;         dXDiff = PtAfter.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() - PtThis.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>();</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;         dYDiff = PtAfter.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() - PtThis.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>();</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      }</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nCoastPoint == nCoastSize-1)</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      {</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;         <span class="comment">// For the point at the end of the coastline: use the straight line from the point before to &#39;this&#39; point</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;         <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtBefore = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint-1);          <span class="comment">// In external CRS</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;         <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtThis = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint);              <span class="comment">// In external CRS</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160; </div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;         dXDiff = PtThis.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() - PtBefore.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>();</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;         dYDiff = PtThis.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() - PtBefore.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>();</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      }</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      {</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;         <span class="comment">// For coastline points not at the start or end of the coast: start with a straight line which links the coastline points before and after &#39;this&#39; coastline point</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;         <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtBefore = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint-1);           <span class="comment">// In external CRS</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;         <a class="code" href="class_c_geom2_d_point.html">CGeom2DPoint</a> PtAfter = *m_VCoast[nCoast].pPtGetCoastlinePointExtCRS(nCoastPoint+1);            <span class="comment">// In external CRS</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160; </div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;         dXDiff = PtAfter.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>() - PtBefore.<a class="code" href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">dGetX</a>();</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;         dYDiff = PtAfter.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>() - PtBefore.<a class="code" href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">dGetY</a>();</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      }</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160; </div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      <span class="comment">// Calculate angle between line and north point, measured clockwise (the azimuth)</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      <span class="keywordflow">if</span> (bFPIsEqual(dYDiff, 0, <a class="code" href="cme_8h.html#a89311a98397f9d6967d2cb10d5152d77">TOLERANCE</a>))</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;      {</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;         <span class="comment">// The linking line runs either W-E or E-W</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;         <span class="keywordflow">if</span> (dXDiff &gt; 0)</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;            <span class="comment">// It runs W to E</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;            m_VCoast[nCoast].SetFluxOrientation(nCoastPoint, 90);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            <span class="comment">// It runs E to W</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;            m_VCoast[nCoast].SetFluxOrientation(nCoastPoint, 270);</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      }</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bFPIsEqual(dXDiff, 0, <a class="code" href="cme_8h.html#a89311a98397f9d6967d2cb10d5152d77">TOLERANCE</a>))</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      {</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;         <span class="comment">// The linking line runs N-S or S-N</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;         <span class="keywordflow">if</span> (dYDiff &gt; 0)</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;            <span class="comment">// It runs S to N</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            m_VCoast[nCoast].SetFluxOrientation(nCoastPoint, 0);</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;            <span class="comment">// It runs N to S</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            m_VCoast[nCoast].SetFluxOrientation(nCoastPoint, 180);</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;      }</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      {</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;         <span class="comment">// The linking line runs neither W-E nor N-S so we have to work a bit harder to find the angle between it and the azimuth</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;         <span class="keywordtype">double</span> dAzimuthAngle;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;         <span class="keywordflow">if</span> (dXDiff &gt; 0)</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;            dAzimuthAngle= (180 / <a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a>) * (<a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a> * 0.5 - atan(dYDiff / dXDiff));</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            dAzimuthAngle = (180 / <a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a>) * (<a class="code" href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a> * 1.5 - atan(dYDiff / dXDiff));</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160; </div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;         m_VCoast[nCoast].SetFluxOrientation(nCoastPoint, dAzimuthAngle);</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      }</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160; </div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment">//      LogStream &lt;&lt; m_ulIter &lt;&lt; &quot;: nCoastPoint = &quot; &lt;&lt; nCoastPoint &lt;&lt; &quot; FluxOrientation = &quot; &lt;&lt; m_VCoast[nCoast].dGetFluxOrientation(nCoastPoint) &lt;&lt; endl;</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;   }</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;}</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160; </div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160; </div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="comment">/*===============================================================================================================================</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment"> Calculates an average d50 for each polygon, and also fills in &#39;holes&#39; in active zone and wave calcs i.e. orphan cells which should have been included in the active zone but which have been omitted because of rounding problems</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment">===============================================================================================================================*/</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="keywordtype">void</span> CSimulation::CalcD50AndFillWaveCalcHoles(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;{</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;   vector&lt;int&gt; VnPolygonD50Count(m_nGlobalPolygonID+1, 0);</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;   vector&lt;double&gt; VdPolygonD50(m_nGlobalPolygonID+1, 0);</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160; </div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nX = 0; nX &lt; m_nXGridMax; nX++)</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;   {</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nY = 0; nY &lt; m_nYGridMax; nY++)</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      {</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;         <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">bIsInContiguousSea</a>())</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;         {</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;            <span class="comment">// This is a sea cell, is it in the active zone?</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;            <span class="keywordflow">if</span> (m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a657a6ebbff5ffe37aedad0d26281eb03">bIsInActiveZone</a>())</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            {</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;               <span class="comment">// It is, so does it have unconsolidated sediment on it?</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;               <span class="keywordtype">double</span> dTmpd50 = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a9d86c4a25b495ad1d502e9a13db28ffc">dGetUnconsD50</a>();</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;               <span class="keywordflow">if</span> (dTmpd50 != <a class="code" href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a>)</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;               {</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                  <span class="comment">// It does, so which polygon is it in?</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                  <span class="keywordtype">int</span> nID = m_pRasterGrid-&gt;m_Cell[nX][nY].<a class="code" href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">nGetPolygonID</a>();</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                  <span class="keywordflow">if</span> (nID != <a class="code" href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a>)</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                  {</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;                     VnPolygonD50Count[nID]++;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                     VdPolygonD50[nID] += dTmpd50;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                  }</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;               }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;            }</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160; </div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">            // Now fill in wave calc holes, start by looking at the cell&#39;s N-S and W-E neighbours</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">            int</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment">               nXTmp,</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment">               nYTmp,</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="comment">               nActive = 0,</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="comment">               nShadow = 0,</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="comment">               nShadowNum = 0,</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="comment">               nDownDrift = 0,</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="comment">               nDownDriftNum = 0,</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="comment">               nCoast = 0,</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="comment">               nRead = 0;</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="comment">            double</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="comment">               dWaveHeight = 0,</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="comment">               dWaveAngle = 0;</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="comment">            // North</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="comment">            nXTmp = nX;</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="comment">            nYTmp = nY-1;</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment">            if (bIsWithinValidGrid(nXTmp, nYTmp))</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="comment">            {</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="comment">               if (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].bIsInContiguousSea())</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="comment">               {</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="comment">                  nRead++;</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="comment">                  dWaveHeight += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].dGetWaveHeight();</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="comment">                  dWaveAngle += (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].dGetWaveOrientation());</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="comment">                  if (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].bIsInActiveZone())</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="comment">                     nActive++;</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="comment">                  int nTmp = m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].nGetShadowZoneNumber();</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="comment">                  if (nTmp != 0)</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">                     nShadow++;</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">                     nShadowNum = nTmp;</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">                  nTmp = m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].nGetDownDriftZoneNumber();</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">                  if ( nTmp &gt; 0)</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment">                     nDownDrift++;</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">                     nDownDriftNum = nTmp;</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment">               }</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment">               else</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="comment">                  nCoast++;</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="comment">            // East</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="comment">            nXTmp = nX+1;</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="comment">            nYTmp = nY;</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="comment">            if (bIsWithinValidGrid(nXTmp, nYTmp))</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="comment">            {</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="comment">               if (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].bIsInContiguousSea())</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="comment">               {</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="comment">                  nRead++;</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="comment">                  dWaveHeight += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].dGetWaveHeight();</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="comment">                  dWaveAngle += (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].dGetWaveOrientation());</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="comment">                  if (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].bIsInActiveZone())</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="comment">                     nActive++;</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment">                  int nTmp = m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].nGetShadowZoneNumber();</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">                  if (nTmp != 0)</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment">                     nShadow++;</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment">                     nShadowNum = nTmp;</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">                  nTmp = m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].nGetDownDriftZoneNumber();</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment">                  if ( nTmp &gt; 0)</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment">                     nDownDrift++;</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="comment">                     nDownDriftNum = nTmp;</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment">               }</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="comment">               else</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment">                  nCoast++;</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">            // South</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment">            nXTmp = nX;</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment">            nYTmp = nY+1;</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment">            if (bIsWithinValidGrid(nXTmp, nYTmp))</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="comment">            {</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment">               if (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].bIsInContiguousSea())</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment">               {</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="comment">                  nRead++;</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="comment">                  dWaveHeight += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].dGetWaveHeight();</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment">                  dWaveAngle += (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].dGetWaveOrientation());</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment">                  if (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].bIsInActiveZone())</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="comment">                     nActive++;</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="comment">                  int nTmp = m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].nGetShadowZoneNumber();</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="comment">                  if (nTmp != 0)</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="comment">                     nShadow++;</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="comment">                     nShadowNum = nTmp;</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment">                  nTmp = m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].nGetDownDriftZoneNumber();</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment">                  if ( nTmp &gt; 0)</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment">                     nDownDrift++;</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment">                     nDownDriftNum = nTmp;</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">               }</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment">               else</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">                  nCoast++;</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="comment">            // West</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="comment">            nXTmp = nX-1;</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">            nYTmp = nY;</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment">            if (bIsWithinValidGrid(nXTmp, nYTmp))</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment">            {</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment">               if (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].bIsInContiguousSea())</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment">               {</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment">                  nRead++;</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">                  dWaveHeight += m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].dGetWaveHeight();</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment">                  dWaveAngle += (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].dGetWaveOrientation());</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">                  if (m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].bIsInActiveZone())</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">                     nActive++;</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment">                  int nTmp = m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].nGetShadowZoneNumber();</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment">                  if (nTmp != 0)</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment">                     nShadow++;</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment">                     nShadowNum = nTmp;</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment">                  nTmp = m_pRasterGrid-&gt;m_Cell[nXTmp][nYTmp].nGetDownDriftZoneNumber();</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment">                  if ( nTmp &gt; 0)</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">                     nDownDrift++;</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment">                     nDownDriftNum = nTmp;</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment">               }</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">               else</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment">                  nCoast++;</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="comment">            if (nRead &gt; 0)</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="comment">            {</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="comment">               // Calculate the average of neighbours</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="comment">               dWaveHeight /= nRead;</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="comment">               dWaveAngle /= nRead;</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="comment">               dWaveAngle = dKeepWithin360(dWaveAngle);</span></div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment">               // If this sea cell has four active-zone neighbours, then it must also be in the active zone: give it wave height and orientation which is the average of its neighbours</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="comment">               if (nActive == 4)</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment">               {</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment">                  m_pRasterGrid-&gt;m_Cell[nX][nY].SetInActiveZone(true);</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment">                  m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveHeight(dWaveHeight);</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment">                  m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveOrientation(dWaveAngle);</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="comment">               }</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="comment">               // If this sea cell has a wave height which is the same as its deep-water wave height, but its neighbours have a different average wave height, then give it the average of its neighbours</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="comment">               double dDeepWaterWaveHeight = m_pRasterGrid-&gt;m_Cell[nX][nY].dGetDeepWaterWaveHeight();</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment">               if ((m_pRasterGrid-&gt;m_Cell[nX][nY].dGetWaveHeight() == dDeepWaterWaveHeight) &amp;&amp; (! bFPIsEqual(dDeepWaterWaveHeight, dWaveHeight, TOLERANCE)))</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="comment">               {</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment">                  m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveHeight(dWaveHeight);</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment">               }</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment">               // If this sea cell has a wave orientation which is the same as its deep-water wave orientation, but its neighbours have a different average wave orientation, then give it the average of its neighbours</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment">               double dDeepWaterWaveOrientation = m_pRasterGrid-&gt;m_Cell[nX][nY].dGetDeepWaterWaveOrientation();</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">               if ((m_pRasterGrid-&gt;m_Cell[nX][nY].dGetWaveOrientation() == dDeepWaterWaveOrientation) &amp;&amp; (! bFPIsEqual(dDeepWaterWaveOrientation, dWaveAngle, TOLERANCE)))</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">               {</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">                  m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveOrientation(dWaveAngle);</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">               }</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment">               // Is this sea cell is not already marked as in a shadow zone (note could be marked as in a shadow zone but not yet processed: a -ve number)?</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment">               int nShadowZoneCode = m_pRasterGrid-&gt;m_Cell[nX][nY].nGetShadowZoneNumber();</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">               if (nShadowZoneCode &lt;= 0)</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment">               {</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment">                  // If the cell has four neighbours which are all in a shadow zone, or four neighbours some of which are shadow zone and the remainder downdrift zone, or four neighbours some of which are shadow zone and the remainder coast; then it should also be in the shadow zone: give it the average of its neighbours</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment">                  if (nShadow == 4)</span></div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment">                     m_pRasterGrid-&gt;m_Cell[nX][nY].SetShadowZoneNumber(nShadowNum);</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">                     m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveHeight(dWaveHeight);</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">                     m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveOrientation(dWaveAngle);</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">                  else if (nShadow + nDownDrift == 4)</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">                     m_pRasterGrid-&gt;m_Cell[nX][nY].SetShadowZoneNumber(nShadowNum);</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">                     m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveHeight(dWaveHeight);</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">                     m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveOrientation(dWaveAngle);</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment">                  else if (nShadow + nCoast == 4)</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="comment">                  {</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="comment">                     m_pRasterGrid-&gt;m_Cell[nX][nY].SetShadowZoneNumber(nShadowNum);</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="comment">                     m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveHeight(dWaveHeight);</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="comment">                     m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveOrientation(dWaveAngle);</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="comment">                  }</span></div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment">               }</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="comment">               // If this sea cell is not marked as in a downdrift zone but has four neighbours which are in a downdrift zone, then it should also be in the downdrift zone: give it the average of its neighbours</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment">               int nDownDriftZoneCode = m_pRasterGrid-&gt;m_Cell[nX][nY].nGetDownDriftZoneNumber();</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="comment">               if ((nDownDriftZoneCode == 0) &amp;&amp; (nDownDrift == 4))</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="comment">               {</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment">                  m_pRasterGrid-&gt;m_Cell[nX][nY].SetDownDriftZoneNumber(nDownDriftNum);</span></div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">                  m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveHeight(dWaveHeight);</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment">                  m_pRasterGrid-&gt;m_Cell[nX][nY].SetWaveOrientation(dWaveAngle);</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment">               }</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;          }</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      }</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;   }</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160; </div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;   <span class="comment">// Calculate the average d50 for every polygon</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nCoast = 0; nCoast &lt; static_cast&lt;int&gt;(m_VCoast.size()); nCoast++)</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;   {</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nPoly = 0; nPoly &lt; m_VCoast[nCoast].nGetNumPolygons(); nPoly++)</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;      {</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;         <a class="code" href="class_c_geom_coast_polygon.html">CGeomCoastPolygon</a>* pPolygon = m_VCoast[nCoast].pGetPolygon(nPoly);</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;         <span class="keywordtype">int</span> nID = pPolygon-&gt;<a class="code" href="class_c_geom_coast_polygon.html#a765ccfcf69a2d02959dd156d32af579e">nGetGlobalID</a>();</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160; </div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;         <span class="keywordflow">if</span> (VnPolygonD50Count[nID] &gt; 0)</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;            VdPolygonD50[nID] /= VnPolygonD50Count[nID];</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;         pPolygon-&gt;<a class="code" href="class_c_geom_coast_polygon.html#ab219b0486c117c4bf946d58fab51763e">SetAvgUnconsD50</a>(VdPolygonD50[nID]);</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;      }</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;   }</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;}</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="acme_8h_html_a53b090bafe453cf12513e68d0fe1eb37"><div class="ttname"><a href="cme_8h.html#a53b090bafe453cf12513e68d0fe1eb37">SPACE</a></div><div class="ttdeci">const char SPACE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00146">cme.h:146</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a657a6ebbff5ffe37aedad0d26281eb03"><div class="ttname"><a href="class_c_geom_cell.html#a657a6ebbff5ffe37aedad0d26281eb03">CGeomCell::bIsInActiveZone</a></div><div class="ttdeci">bool bIsInActiveZone(void) const</div><div class="ttdoc">Returns a flag which shows whether this cell is in the active zone.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00126">cell.cpp:126</a></div></div>
<div class="ttc" id="acme_8h_html_a96e58f57ae0cc113e899eab923e8d395"><div class="ttname"><a href="cme_8h.html#a96e58f57ae0cc113e899eab923e8d395">LEFT_HANDED</a></div><div class="ttdeci">const int LEFT_HANDED</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00203">cme.h:203</a></div></div>
<div class="ttc" id="acme_8h_html_aacea0bc2762691df36e6cb0c648ca82b"><div class="ttname"><a href="cme_8h.html#aacea0bc2762691df36e6cb0c648ca82b">RTN_ERR_CSHORE_FILE_INPUT</a></div><div class="ttdeci">const int RTN_ERR_CSHORE_FILE_INPUT</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00406">cme.h:406</a></div></div>
<div class="ttc" id="ahermite__cubic_8h_html"><div class="ttname"><a href="hermite__cubic_8h.html">hermite_cubic.h</a></div><div class="ttdoc">Definitions of some routines from the hermite_cubic library.</div></div>
<div class="ttc" id="acme_8h_html_a11e609647b6dbb5e02678ef4c32d669f"><div class="ttname"><a href="cme_8h.html#a11e609647b6dbb5e02678ef4c32d669f">SAVE_CSHORE_OUTPUT</a></div><div class="ttdeci">const bool SAVE_CSHORE_OUTPUT</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00158">cme.h:158</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html"><div class="ttname"><a href="class_c_geom2_d_point.html">CGeom2DPoint</a></div><div class="ttdoc">Geometry class used to represent 2D point objects with floating-point co-ordinates.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8h_source.html#l00029">2d_point.h:29</a></div></div>
<div class="ttc" id="acme_8h_html_a068017859403c0629d89f8d348f6c224"><div class="ttname"><a href="cme_8h.html#a068017859403c0629d89f8d348f6c224">tMin</a></div><div class="ttdeci">T tMin(T a, T b)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00783">cme.h:783</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_ae9f6bf560ede907f60849a6927000e4e"><div class="ttname"><a href="class_c_geom_cell.html#ae9f6bf560ede907f60849a6927000e4e">CGeomCell::SetWaveOrientation</a></div><div class="ttdeci">void SetWaveOrientation(double const)</div><div class="ttdoc">Sets the wave orientation on this cell, also increments the total wave orientation.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00626">cell.cpp:626</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a8a29c3fa364ab1f7b3930b7a9c83f45f"><div class="ttname"><a href="class_c_geom_profile.html#a8a29c3fa364ab1f7b3930b7a9c83f45f">CGeomProfile::nGetNumCellsInProfile</a></div><div class="ttdeci">int nGetNumCellsInProfile(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00396">profile.cpp:396</a></div></div>
<div class="ttc" id="acme_8h_html_aee2e0742555937187504ee86b95bc29c"><div class="ttname"><a href="cme_8h.html#aee2e0742555937187504ee86b95bc29c">INT_NODATA</a></div><div class="ttdeci">const int INT_NODATA</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00185">cme.h:185</a></div></div>
<div class="ttc" id="acme_8h_html_a89311a98397f9d6967d2cb10d5152d77"><div class="ttname"><a href="cme_8h.html#a89311a98397f9d6967d2cb10d5152d77">TOLERANCE</a></div><div class="ttdeci">const double TOLERANCE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00462">cme.h:462</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html"><div class="ttname"><a href="class_c_geom_profile.html">CGeomProfile</a></div><div class="ttdoc">Geometry class used to represent coast profile objects.</div><div class="ttdef"><b>Definition:</b> <a href="profile_8h_source.html#l00037">profile.h:37</a></div></div>
<div class="ttc" id="acme_8h_html_ad238599c0266f9981973bdcf22b96b83"><div class="ttname"><a href="cme_8h.html#ad238599c0266f9981973bdcf22b96b83">WALKDEN_HALL_PARAM_2</a></div><div class="ttdeci">const double WALKDEN_HALL_PARAM_2</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00452">cme.h:452</a></div></div>
<div class="ttc" id="acme_8h_html"><div class="ttname"><a href="cme_8h.html">cme.h</a></div><div class="ttdoc">This file contains global definitions for CoastalME.</div></div>
<div class="ttc" id="acme_8h_html_aa7d7726ee4a2306d4ee580841689129c"><div class="ttname"><a href="cme_8h.html#aa7d7726ee4a2306d4ee580841689129c">WALKDEN_HALL_PARAM_1</a></div><div class="ttdeci">const double WALKDEN_HALL_PARAM_1</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00451">cme.h:451</a></div></div>
<div class="ttc" id="acme_8h_html_af6bae16c7e97385220c7ace0a46495de"><div class="ttname"><a href="cme_8h.html#af6bae16c7e97385220c7ace0a46495de">CSHORE_DIR</a></div><div class="ttdeci">const string CSHORE_DIR</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00534">cme.h:534</a></div></div>
<div class="ttc" id="acme_8h_html_a7e895b460cef877dec4d12ead0c74f15"><div class="ttname"><a href="cme_8h.html#a7e895b460cef877dec4d12ead0c74f15">tMax</a></div><div class="ttdeci">T tMax(T a, T b)</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00772">cme.h:772</a></div></div>
<div class="ttc" id="aclass_c_geom_coast_polygon_html_ab219b0486c117c4bf946d58fab51763e"><div class="ttname"><a href="class_c_geom_coast_polygon.html#ab219b0486c117c4bf946d58fab51763e">CGeomCoastPolygon::SetAvgUnconsD50</a></div><div class="ttdeci">void SetAvgUnconsD50(double const)</div><div class="ttdef"><b>Definition:</b> <a href="coast__polygon_8cpp_source.html#l00356">coast_polygon.cpp:356</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_ac35bb7a0e72a3e84ce89c6ea1de4e38d"><div class="ttname"><a href="class_c_geom_profile.html#ac35bb7a0e72a3e84ce89c6ea1de4e38d">CGeomProfile::bOKIncStartOfCoast</a></div><div class="ttdeci">bool bOKIncStartOfCoast(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00161">profile.cpp:161</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_ada96aa991d179ac71f4523de7a4be560"><div class="ttname"><a href="class_c_geom_profile.html#ada96aa991d179ac71f4523de7a4be560">CGeomProfile::pPtiVGetCellsInProfile</a></div><div class="ttdeci">vector&lt; CGeom2DIPoint &gt; * pPtiVGetCellsInProfile(void)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00384">profile.cpp:384</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_a250f937d03cfdf6e0244b74ad2bf96a4"><div class="ttname"><a href="class_c_geom2_d_point.html#a250f937d03cfdf6e0244b74ad2bf96a4">CGeom2DPoint::dGetX</a></div><div class="ttdeci">double dGetX(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object's double X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00044">2d_point.cpp:44</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a0aead517e2105d6c1a14c27126b1fe92"><div class="ttname"><a href="class_c_geom_profile.html#a0aead517e2105d6c1a14c27126b1fe92">CGeomProfile::nGetNumCoastPoint</a></div><div class="ttdeci">int nGetNumCoastPoint(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00057">profile.cpp:57</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a6d13079f744085f2d132405e0120ca54"><div class="ttname"><a href="class_c_geom_profile.html#a6d13079f744085f2d132405e0120ca54">CGeomProfile::pPtiGetCellInProfile</a></div><div class="ttdeci">CGeom2DIPoint * pPtiGetCellInProfile(int const)</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00390">profile.cpp:390</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_af84c687b2d0be01ab41cbcc0565f4f3f"><div class="ttname"><a href="class_c_geom2_d_i_point.html#af84c687b2d0be01ab41cbcc0565f4f3f">CGeom2DIPoint::nGetX</a></div><div class="ttdeci">int nGetX(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object's integer X co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00044">2di_point.cpp:44</a></div></div>
<div class="ttc" id="acoast_8h_html"><div class="ttname"><a href="coast_8h.html">coast.h</a></div><div class="ttdoc">Contains CRWCoast definitions.</div></div>
<div class="ttc" id="acme_8h_html_a8082ddc5ffa1755ec8e009bd3314829d"><div class="ttname"><a href="cme_8h.html#a8082ddc5ffa1755ec8e009bd3314829d">CSHORE_INFILE</a></div><div class="ttdeci">const string CSHORE_INFILE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00535">cme.h:535</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a9d86c4a25b495ad1d502e9a13db28ffc"><div class="ttname"><a href="class_c_geom_cell.html#a9d86c4a25b495ad1d502e9a13db28ffc">CGeomCell::dGetUnconsD50</a></div><div class="ttdeci">double dGetUnconsD50(void) const</div><div class="ttdoc">Returns the D50 of unconsolidated sediment on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00822">cell.cpp:822</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a164c51a1e98183be0e8fd5513eea496f"><div class="ttname"><a href="class_c_geom_cell.html#a164c51a1e98183be0e8fd5513eea496f">CGeomCell::bIsinAnyShadowZone</a></div><div class="ttdeci">bool bIsinAnyShadowZone(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00234">cell.cpp:234</a></div></div>
<div class="ttc" id="aclass_c_simulation_html_a222962121613613a48f518e0c2110f21"><div class="ttname"><a href="class_c_simulation.html#a222962121613613a48f518e0c2110f21">CSimulation::LogStream</a></div><div class="ttdeci">ofstream LogStream</div><div class="ttdef"><b>Definition:</b> <a href="simulation_8h_source.html#l00781">simulation.h:781</a></div></div>
<div class="ttc" id="acme_8h_html_a3f242306dda26e4d5fb547e49e176b26"><div class="ttname"><a href="cme_8h.html#a3f242306dda26e4d5fb547e49e176b26">CSHORE_SURGE_LEVEL</a></div><div class="ttdeci">const double CSHORE_SURGE_LEVEL</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00460">cme.h:460</a></div></div>
<div class="ttc" id="aclass_c_geom_coast_polygon_html"><div class="ttname"><a href="class_c_geom_coast_polygon.html">CGeomCoastPolygon</a></div><div class="ttdoc">Geometry class used for coast polygon objects.</div><div class="ttdef"><b>Definition:</b> <a href="coast__polygon_8h_source.html#l00031">coast_polygon.h:31</a></div></div>
<div class="ttc" id="aclass_c_geom2_d_point_html_a216921dc2c592d9468e6430fee7c7719"><div class="ttname"><a href="class_c_geom2_d_point.html#a216921dc2c592d9468e6430fee7c7719">CGeom2DPoint::dGetY</a></div><div class="ttdeci">double dGetY(void) const</div><div class="ttdoc">Returns the CGeom2DPoint object's double Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2d__point_8cpp_source.html#l00050">2d_point.cpp:50</a></div></div>
<div class="ttc" id="acme_8h_html_ac8de8e3c8f526683cf8a372e00bdcde3"><div class="ttname"><a href="cme_8h.html#ac8de8e3c8f526683cf8a372e00bdcde3">RTN_ERR_NO_TOP_LAYER</a></div><div class="ttdeci">const int RTN_ERR_NO_TOP_LAYER</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00398">cme.h:398</a></div></div>
<div class="ttc" id="acme_8h_html_a84940800790cc4002f662cad53119f2e"><div class="ttname"><a href="cme_8h.html#a84940800790cc4002f662cad53119f2e">RTN_ERR_CSHORE_EMPTY_PROFILE</a></div><div class="ttdeci">const int RTN_ERR_CSHORE_EMPTY_PROFILE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00405">cme.h:405</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_aac223e2610d50ca2c7eadaf8542e9498"><div class="ttname"><a href="class_c_geom_profile.html#aac223e2610d50ca2c7eadaf8542e9498">CGeomProfile::bOKIncStartAndEndOfCoast</a></div><div class="ttdeci">bool bOKIncStartAndEndOfCoast(void) const</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00148">profile.cpp:148</a></div></div>
<div class="ttc" id="acme_8h_html_a45610ba778a13cb26dfa0bd2ac5c42cd"><div class="ttname"><a href="cme_8h.html#a45610ba778a13cb26dfa0bd2ac5c42cd">RTN_ERR_CSHORE_ERROR</a></div><div class="ttdeci">const int RTN_ERR_CSHORE_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00411">cme.h:411</a></div></div>
<div class="ttc" id="acme_8h_html_a71d8d6db0e41ed2022d0a95b9a70528c"><div class="ttname"><a href="cme_8h.html#a71d8d6db0e41ed2022d0a95b9a70528c">RTN_OK</a></div><div class="ttdeci">const int RTN_OK</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00351">cme.h:351</a></div></div>
<div class="ttc" id="acme_8h_html_aefc63c4bde02ca170b0e7bd038ba7702"><div class="ttname"><a href="cme_8h.html#aefc63c4bde02ca170b0e7bd038ba7702">WARN</a></div><div class="ttdeci">const string WARN</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00538">cme.h:538</a></div></div>
<div class="ttc" id="acme_8h_html_adc0fbf157c5dddb28478ff147e74dbd4"><div class="ttname"><a href="cme_8h.html#adc0fbf157c5dddb28478ff147e74dbd4">CSHORE_INTERPOLATION_HERMITE_CUBIC</a></div><div class="ttdeci">const int CSHORE_INTERPOLATION_HERMITE_CUBIC</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00183">cme.h:183</a></div></div>
<div class="ttc" id="acme_8h_html_ab0094f1ece3facf8eb8afd210a7a7835"><div class="ttname"><a href="cme_8h.html#ab0094f1ece3facf8eb8afd210a7a7835">ERR</a></div><div class="ttdeci">const string ERR</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00537">cme.h:537</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_ae1947ab9ff15bc28ee44aea111e3b428"><div class="ttname"><a href="class_c_geom_profile.html#ae1947ab9ff15bc28ee44aea111e3b428">CGeomProfile::dGetDeepWaterWaveOrientation</a></div><div class="ttdeci">double dGetDeepWaterWaveOrientation(void) const</div><div class="ttdoc">Returns the deep-water wave orientation for this profile.</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00469">profile.cpp:469</a></div></div>
<div class="ttc" id="ahermite__cubic_8cpp_html_ad696aa5baaf487b32cc0c3afdecd2b4b"><div class="ttname"><a href="hermite__cubic_8cpp.html#ad696aa5baaf487b32cc0c3afdecd2b4b">hermite_cubic_spline_value</a></div><div class="ttdeci">void hermite_cubic_spline_value(int const nn, double *const xn, double *const fn, double *const dn, int const n, double *const x, double *f, double *d, double *s, double *t)</div><div class="ttdef"><b>Definition:</b> <a href="hermite__cubic_8cpp_source.html#l00345">hermite_cubic.cpp:345</a></div></div>
<div class="ttc" id="acme_8h_html_a98446ed820d505727dfc35190f492ebf"><div class="ttname"><a href="cme_8h.html#a98446ed820d505727dfc35190f492ebf">RTN_ERR_READING_CSHORE_FILE_OUTPUT</a></div><div class="ttdeci">const int RTN_ERR_READING_CSHORE_FILE_OUTPUT</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00407">cme.h:407</a></div></div>
<div class="ttc" id="ainterpolate_8cpp_html_a1b021853eedf579935a6bd2bfe054961"><div class="ttname"><a href="interpolate_8cpp.html#a1b021853eedf579935a6bd2bfe054961">interpolate</a></div><div class="ttdeci">double interpolate(vector&lt; double &gt; xData, vector&lt; double &gt; yData, double x, bool extrapolate)</div><div class="ttdef"><b>Definition:</b> <a href="interpolate_8cpp_source.html#l00031">interpolate.cpp:31</a></div></div>
<div class="ttc" id="autils__global_8cpp_html_a1432a707917cd3a9582796679f4d583f"><div class="ttname"><a href="utils__global_8cpp.html#a1432a707917cd3a9582796679f4d583f">bIsStringValidInt</a></div><div class="ttdeci">bool bIsStringValidInt(string &amp;str)</div><div class="ttdef"><b>Definition:</b> <a href="utils__global_8cpp_source.html#l00101">utils_global.cpp:101</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a43434d6fd45da697ae17f7b274ba9a83"><div class="ttname"><a href="class_c_geom_cell.html#a43434d6fd45da697ae17f7b274ba9a83">CGeomCell::nGetTopNonZeroLayerAboveBasement</a></div><div class="ttdeci">int nGetTopNonZeroLayerAboveBasement(void) const</div><div class="ttdoc">Returns the index of the topmost sediment layer (layer 0 being the one just above basement) with non-...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00326">cell.cpp:326</a></div></div>
<div class="ttc" id="aclass_c_geom_profile_html_ae6b2153bed15ad0862a156d0d49d85c1"><div class="ttname"><a href="class_c_geom_profile.html#ae6b2153bed15ad0862a156d0d49d85c1">CGeomProfile::dGetDeepWaterWavePeriod</a></div><div class="ttdeci">double dGetDeepWaterWavePeriod(void) const</div><div class="ttdoc">Returns the deep-water wave Period for this profile.</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00481">profile.cpp:481</a></div></div>
<div class="ttc" id="aclass_c_geom_coast_polygon_html_a765ccfcf69a2d02959dd156d32af579e"><div class="ttname"><a href="class_c_geom_coast_polygon.html#a765ccfcf69a2d02959dd156d32af579e">CGeomCoastPolygon::nGetGlobalID</a></div><div class="ttdeci">int nGetGlobalID(void) const</div><div class="ttdef"><b>Definition:</b> <a href="coast__polygon_8cpp_source.html#l00087">coast_polygon.cpp:87</a></div></div>
<div class="ttc" id="alinearinterp_8cpp_html_a296bcc297041de33c969a50dc0c63f86"><div class="ttname"><a href="linearinterp_8cpp.html#a296bcc297041de33c969a50dc0c63f86">VdInterp1</a></div><div class="ttdeci">vector&lt; double &gt; VdInterp1(vector&lt; double &gt; const *pVdX, vector&lt; double &gt; const *pVdY, vector&lt; double &gt; const *pVdX_new)</div><div class="ttdef"><b>Definition:</b> <a href="linearinterp_8cpp_source.html#l00046">linearinterp.cpp:46</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a622387009a4fcb864bfdab627389ea84"><div class="ttname"><a href="class_c_geom_cell.html#a622387009a4fcb864bfdab627389ea84">CGeomCell::nGetPolygonID</a></div><div class="ttdeci">int nGetPolygonID(void) const</div><div class="ttdoc">Returns the global ID number of the polygon which 'contains' this cell (returns INT_NODATA if the cel...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00210">cell.cpp:210</a></div></div>
<div class="ttc" id="acme_8h_html_adb91e1fabae5900fb39988f61b6c1f27"><div class="ttname"><a href="cme_8h.html#adb91e1fabae5900fb39988f61b6c1f27">CSHORE_FRICTION_FACTOR</a></div><div class="ttdeci">const double CSHORE_FRICTION_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00459">cme.h:459</a></div></div>
<div class="ttc" id="autils__global_8cpp_html_a20842d0a19d0ca952c91f3e1eb175fee"><div class="ttname"><a href="utils__global_8cpp.html#a20842d0a19d0ca952c91f3e1eb175fee">nRound</a></div><div class="ttdeci">int nRound(double const d)</div><div class="ttdef"><b>Definition:</b> <a href="utils__global_8cpp_source.html#l00054">utils_global.cpp:54</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a8577263897fb809e3b9bb4e39f16c16e"><div class="ttname"><a href="class_c_geom_cell.html#a8577263897fb809e3b9bb4e39f16c16e">CGeomCell::dGetWaveOrientation</a></div><div class="ttdeci">double dGetWaveOrientation(void) const</div><div class="ttdoc">Returns the wave orientation on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00633">cell.cpp:633</a></div></div>
<div class="ttc" id="acme_8h_html_a66f1550c565d9d7737dbb2c43f4807ec"><div class="ttname"><a href="cme_8h.html#a66f1550c565d9d7737dbb2c43f4807ec">WAVE_MODEL_CSHORE</a></div><div class="ttdeci">const int WAVE_MODEL_CSHORE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00435">cme.h:435</a></div></div>
<div class="ttc" id="acme_8h_html_a01a70d7ac0aaa506ffa66e0e93d348b5"><div class="ttname"><a href="cme_8h.html#a01a70d7ac0aaa506ffa66e0e93d348b5">DBL_NODATA</a></div><div class="ttdeci">const double DBL_NODATA</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00469">cme.h:469</a></div></div>
<div class="ttc" id="asimulation_8h_html"><div class="ttname"><a href="simulation_8h.html">simulation.h</a></div><div class="ttdoc">Contains CSimulation definitions.</div></div>
<div class="ttc" id="aclass_c_geom_profile_html_a0c1e09e58976d6b870a8c1f976e72018"><div class="ttname"><a href="class_c_geom_profile.html#a0c1e09e58976d6b870a8c1f976e72018">CGeomProfile::dGetDeepWaterWaveHeight</a></div><div class="ttdeci">double dGetDeepWaterWaveHeight(void) const</div><div class="ttdoc">Returns the deep-water wave height for this profile.</div><div class="ttdef"><b>Definition:</b> <a href="profile_8cpp_source.html#l00457">profile.cpp:457</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a770135e779cf4e4d74c9e78f19429d3c"><div class="ttname"><a href="class_c_geom_cell.html#a770135e779cf4e4d74c9e78f19429d3c">CGeomCell::dGetWaveHeight</a></div><div class="ttdeci">double dGetWaveHeight(void) const</div><div class="ttdoc">Returns the wave height on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00614">cell.cpp:614</a></div></div>
<div class="ttc" id="acme_8h_html_aeb2e58b62fd962a2b31439fac918fbb5"><div class="ttname"><a href="cme_8h.html#aeb2e58b62fd962a2b31439fac918fbb5">WAVE_MODEL_COVE</a></div><div class="ttdeci">const int WAVE_MODEL_COVE</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00434">cme.h:434</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a6d9ce76438644be9fe4aa5b4f7efea3e"><div class="ttname"><a href="class_c_geom_cell.html#a6d9ce76438644be9fe4aa5b4f7efea3e">CGeomCell::dGetInterventionHeight</a></div><div class="ttdeci">double dGetInterventionHeight(void) const</div><div class="ttdoc">Returns the intervention height.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00865">cell.cpp:865</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a28847f89cc0d216f7f668d0d997837e1"><div class="ttname"><a href="class_c_geom_cell.html#a28847f89cc0d216f7f668d0d997837e1">CGeomCell::SetInActiveZone</a></div><div class="ttdeci">void SetInActiveZone(bool const)</div><div class="ttdoc">Sets a flag to show whether this cell is in the active zone.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00120">cell.cpp:120</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a6387aaac391af63a9f2be1c809ce169c"><div class="ttname"><a href="class_c_geom_cell.html#a6387aaac391af63a9f2be1c809ce169c">CGeomCell::dGetSedimentTopElev</a></div><div class="ttdeci">double dGetSedimentTopElev(void) const</div><div class="ttdoc">Returns the true elevation of the sediment's top surface for this cell (if there is a cliff notch,...</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00389">cell.cpp:389</a></div></div>
<div class="ttc" id="alinearinterp_8h_html"><div class="ttname"><a href="linearinterp_8h.html">linearinterp.h</a></div><div class="ttdoc">Declarations of some routines from the linear interp library.</div></div>
<div class="ttc" id="ainterpolate_8h_html"><div class="ttname"><a href="interpolate_8h.html">interpolate.h</a></div><div class="ttdoc">Definitions of Linear interpolation routines.</div></div>
<div class="ttc" id="aclass_c_geom2_d_i_point_html_a4d9c20bcca90dcb9d519b664aba09cbd"><div class="ttname"><a href="class_c_geom2_d_i_point.html#a4d9c20bcca90dcb9d519b664aba09cbd">CGeom2DIPoint::nGetY</a></div><div class="ttdeci">int nGetY(void) const</div><div class="ttdoc">Returns the CGeom2DIPoint object's integer Y co-ordinate.</div><div class="ttdef"><b>Definition:</b> <a href="2di__point_8cpp_source.html#l00050">2di_point.cpp:50</a></div></div>
<div class="ttc" id="acme_8h_html_a952eac791b596a61bba0a133a3bb439f"><div class="ttname"><a href="cme_8h.html#a952eac791b596a61bba0a133a3bb439f">PI</a></div><div class="ttdeci">const double PI</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00444">cme.h:444</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a28b760b0a9e63afd01e29610888fc7bc"><div class="ttname"><a href="class_c_geom_cell.html#a28b760b0a9e63afd01e29610888fc7bc">CGeomCell::bIsInContiguousSea</a></div><div class="ttdeci">bool bIsInContiguousSea(void) const</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00102">cell.cpp:102</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a3a378431e2f6095792582989f50fb435"><div class="ttname"><a href="class_c_geom_cell.html#a3a378431e2f6095792582989f50fb435">CGeomCell::dGetSeaDepth</a></div><div class="ttdeci">double dGetSeaDepth(void) const</div><div class="ttdoc">Returns the depth of seawater on this cell.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00296">cell.cpp:296</a></div></div>
<div class="ttc" id="acme_8h_html_a6da5abe13cf250e9663012ef6633d92a"><div class="ttname"><a href="cme_8h.html#a6da5abe13cf250e9663012ef6633d92a">NO_NONZERO_THICKNESS_LAYERS</a></div><div class="ttdeci">const int NO_NONZERO_THICKNESS_LAYERS</div><div class="ttdef"><b>Definition:</b> <a href="cme_8h_source.html#l00421">cme.h:421</a></div></div>
<div class="ttc" id="aclass_c_geom_cell_html_a213153422f9420825faafb87281e9f64"><div class="ttname"><a href="class_c_geom_cell.html#a213153422f9420825faafb87281e9f64">CGeomCell::SetWaveHeight</a></div><div class="ttdeci">void SetWaveHeight(double const)</div><div class="ttdoc">Sets the wave height on this cell, also increments the total wave height.</div><div class="ttdef"><b>Definition:</b> <a href="cell_8cpp_source.html#l00604">cell.cpp:604</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Dec 9 2020 19:46:12 for CoastalME (Coastal Modelling Environment) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
